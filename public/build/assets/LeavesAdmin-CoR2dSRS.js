import{J as $e,r as o,a as R,j as t,b as i,e as I,Q as Oe,h as Ie,c as W,F as qe}from"./app-Bf03_iUP.js";import{u as Ge,a as le,n as N,c as Qe,b as ne,e as ie,T as w,B as ce,G as Ke,i as de,o as Ve,p as me,m as q,A as We}from"./App-B8yQqlR8.js";import{P as He}from"./PageHeader-C8tPdf3i.js";import{S as Je}from"./StatsCards-DWiTYLAM.js";import{L as pe,D as Xe,a as Ze}from"./DeleteLeaveForm-tulkpIEw.js";import{d as ue}from"./dayjs.min-C4UFRVqv.js";import{F as Ue}from"./CheckCircleIcon-Dw2IVKG9.js";import{F as ea}from"./XCircleIcon-HaA6seZm.js";import{F as ge}from"./ExclamationTriangleIcon-mVJs3AiE.js";import{F as aa}from"./MagnifyingGlassIcon-B6GcJQpX.js";import{b as ta,F as ra}from"./AdjustmentsHorizontalIcon-BFYs3dV3.js";import{C as sa}from"./CircularProgress-DJkS65QC.js";import{F as oa}from"./PlusIcon-CyitAw20.js";import{F as la}from"./DocumentArrowDownIcon-D2NH_1fB.js";import{F as na}from"./PresentationChartLineIcon-e7XhWaP7.js";import{s as H,l as x}from"./chunk-2GIFKCNQ-CocKCi1u.js";import"./app-CA3O2NZp.js";import"./chunk-D5XJWRAV-DReVokZ2.js";import"./PencilIcon-BWQp-Vy9.js";import"./TrashIcon-w2paRgyg.js";import"./XCircleIcon-Dox9b2mK.js";import"./CardContent-ysAN3Agj.js";import"./colorManipulator-DK9w28pg.js";import"./chunk-F3UDT23P-COogn4qm.js";import"./chunk-MZRCPRP2-DBrPm_3w.js";import"./LiveAnnouncer-BHN36TTO.js";import"./useHasTabbableChild-14wDzunC.js";import"./chunk-7F3ZLNJ6-BH4VRWdz.js";import"./chunk-7ZZXWEXF-DBlHoVTx.js";import"./chunk-R6AK6OQ4-DNrKuc_F.js";import"./chunk-O5I3QTYU-xES2Zt8X.js";import"./index-CokAva9Y.js";import"./Clear-wP1ZZE8O.js";import"./GlassDialog-eySHNbvB.js";import"./DialogContent-DrPvUI8F.js";import"./DialogTitle-cLKhbCet.js";import"./InputLabel-Dk7ax3Oe.js";import"./Select-D34P2L3N.js";import"./Popover-BwBpsgIS.js";import"./List-B0oat8Pd.js";import"./MenuItem-L4y_4b8n.js";import"./listItemTextClasses-oOAo87JO.js";import"./dividerClasses-YyuC23Yw.js";import"./TextField-B_ZwruKD.js";import"./Avatar-CqOvfgJB.js";import"./useSlot-DF7IXe6p.js";import"./LoadingButton-RJcA7ss4.js";import"./Button-CVU-V8a8.js";import"./DialogContentText-CZl3YfVu.js";import"./chunk-2PG5BJX6-h4GTMymb.js";const ia=({title:G,allUsers:v})=>{var ae,te,re,se,oe;const{auth:k}=$e().props,J=Ge(),E=le(J.breakpoints.down("sm"));le(J.breakpoints.down("md"));const[he,Q]=o.useState(!1),[L,j]=o.useState([]),[c,m]=o.useState(),[P,f]=o.useState(0),[ve,b]=o.useState(0),[B,X]=o.useState(),[Z,_]=o.useState(""),[U,fe]=o.useState([]),[l,z]=o.useState({perPage:30,currentPage:1}),[ca,y]=o.useState(!1),[Y,be]=o.useState(!1),[a,ye]=o.useState({employee:"",selectedMonth:ue().format("YYYY-MM"),status:[],leaveType:[],department:[]}),u=o.useCallback((e,r)=>{if(e==="year"){const s=Number(r);if(s<1900||s>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}ye(s=>({...s,[e]:r})),z(s=>({...s,currentPage:1}))},[]),[F,we]=o.useState({pending:0,approved:0,rejected:0,total:0}),T=((ae=k.permissions)==null?void 0:ae.includes("leaves.view"))||!1,A=((te=k.permissions)==null?void 0:te.includes("leaves.approve"))||!1,Pe=((re=k.permissions)==null?void 0:re.includes("leaves.create"))||!1,Ce=((se=k.permissions)==null?void 0:se.includes("leaves.update"))||!1,Ne=((oe=k.permissions)==null?void 0:oe.includes("leaves.delete"))||!1,Se=o.useMemo(()=>{const e=[{key:"all",label:"All Types",value:"all"}];if(!L.leaveTypes)return e;const r=L.leaveTypes.map(s=>({key:s.type.toLowerCase(),label:s.type,value:s.type.toLowerCase()}));return[...e,...r]},[L.leaveTypes]),Me=o.useCallback(e=>{$(r=>({...r,[e]:!0}))},[]),xe=o.useCallback((e,r)=>{X({id:e}),$(s=>({...s,[r]:!0}))},[]);o.useCallback(e=>{u("employee",e.target.value.toLowerCase())},[u]);const K=o.useCallback(e=>{u("selectedMonth",e.target.value)},[u]),ke=o.useCallback(e=>{z(r=>({...r,currentPage:e}))},[]),Le=o.useCallback(e=>{z(r=>({...r,perPage:e,currentPage:1}))},[]),h=o.useCallback(async()=>{var e,r,s,n,g;Q(!0);try{const p=await R.get(route("leaves.paginate"),{params:{page:l.currentPage,perPage:l.perPage,employee:a.employee,month:a.selectedMonth,status:a.status!=="all"?a.status:void 0,leave_type:a.leaveType!=="all"?a.leaveType:void 0,department:a.department!=="all"?a.department:void 0}});if(p.status===200){const{leaves:d,leavesData:ze,departments:Ye}=p.data;d!=null&&d.data&&Array.isArray(d.data)?(m(d.data),f(d.total||d.data.length),b(d.last_page||1)):Array.isArray(d)?(m(d),f(d.length),b(1)):(console.error("Unexpected leaves data format:",d),m([]),f(0),b(1)),j(ze),fe(Ye||[]),_("")}}catch(p){if(console.error("Error fetching leaves data:",p.response),((e=p.response)==null?void 0:e.status)===404){const{leavesData:d}=p.response.data||{};j(d||[]),_(((s=(r=p.response)==null?void 0:r.data)==null?void 0:s.message)||"No leaves found for the selected criteria.")}else _(((g=(n=p.response)==null?void 0:n.data)==null?void 0:g.message)||"Error retrieving leaves data. Please try again.");m([]),f(0),b(1)}finally{Q(!1)}},[a,l.currentPage,l.perPage]),D=o.useCallback(async()=>{var e,r,s;try{const n=await R.get(route("leaves.stats"),{params:{month:a.selectedMonth}});if(n.status===200){const{stats:g}=n.data;we(g)}}catch(n){console.error("Error fetching leaves data:",n.response),((e=n.response)==null?void 0:e.status)===404?_(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.message)||"No leaves found for the selected criteria."):_("Error retrieving leaves data. Please try again."),Q(!1)}},[a]),_e=o.useCallback(async e=>{if(A)try{(await R.post(route("leaves.bulk-approve"),{leave_ids:e})).status===200&&(h(),N.success("Selected leaves approved successfully"))}catch(r){console.error("Error bulk approving leaves:",r),N.error("Failed to approve selected leaves")}},[A,h]),Fe=o.useCallback(async e=>{if(A)try{(await R.post(route("leaves.bulk-reject"),{leave_ids:e})).status===200&&(h(),N.success("Selected leaves rejected successfully"))}catch(r){console.error("Error bulk rejecting leaves:",r),N.error("Failed to reject selected leaves")}},[A,h]),Te=o.useMemo(()=>[{title:"Pending",value:F.pending,icon:t(Qe,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Awaiting approval"},{title:"Approved",value:F.approved,icon:t(Ue,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Successfully approved"},{title:"Rejected",value:F.rejected,icon:t(ea,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Declined requests"},{title:"Total",value:F.total,icon:t(ne,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All leave requests"}],[F]);if(!T)return t(ce,{sx:{display:"flex",justifyContent:"center",p:2},children:t(ie,{children:i(I,{className:"p-8 text-center",children:[t(ge,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),t(w,{variant:"h6",className:"mb-2",children:"Access Denied"}),t(w,{variant:"body2",color:"textSecondary",children:"You don't have permission to view leave management."})]})})});const[S,$]=o.useState({add_leave:!1,edit_leave:!1,delete_leave:!1}),Ae=o.useRef(null),De=o.useCallback(e=>{$(r=>({...r,[e]:!0}))},[]),V=o.useCallback(e=>{$(r=>({...r,[e]:!1}))},[]),M=o.useCallback(e=>[...e].sort((r,s)=>new Date(s.from_date)-new Date(r.from_date)),[]),O=o.useCallback((e,r=null)=>{f(e);const s=Math.max(1,Math.ceil(e/l.perPage));b(s),l.currentPage>s&&z(n=>({...n,currentPage:s}))},[l.perPage,l.currentPage]),C=o.useCallback(e=>{const r=ue(e.from_date).format("YYYY-MM");if(a.selectedMonth&&r!==a.selectedMonth)return!1;if(a.employee){const s=v==null?void 0:v.find(g=>String(g.id)===String(e.user_id)),n=a.employee.trim().toLowerCase();if(s){if(String(s.id)!==n&&!(s.name&&s.name.trim().toLowerCase().includes(n)))return!1}else if(String(a.employee)!==String(e.user_id))return!1}if(a.status&&a.status!=="all"&&String(e.status).toLowerCase()!==String(a.status).toLowerCase()||a.leaveType&&a.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(a.leaveType).toLowerCase())return!1;if(a.department&&a.department!=="all"){const s=v==null?void 0:v.find(n=>String(n.id)===String(e.user_id));if(!s||String(s.department).toLowerCase()!==String(a.department).toLowerCase())return!1}return!0},[a,v]),Re=o.useMemo(()=>c||[],[c]),Ee=o.useCallback(e=>{C(e)&&(y(!0),m(r=>{const s=[...r,e];return M(s).slice(0,l.perPage)}),O(P+1),y(!1),l.currentPage!==1&&h())},[C,M,l.currentPage,l.perPage,P,O,h]),je=o.useCallback(e=>{const r=c.some(s=>s.id===e.id);if(y(!0),!C(e)&&r){m(s=>s.filter(n=>n.id!==e.id)),N.info("Leave removed from filtered view."),y(!1);return}if(!r&&!C(e)){y(!1);return}m(s=>{const n=s.some(p=>p.id===e.id);let g;return n?g=s.map(p=>p.id===e.id?e:p):g=[...s,e],M(g).slice(0,l.perPage)}),N.success("Leave updated!"),y(!1),l.currentPage!==1&&h()},[C,M,c,l.currentPage,l.perPage,h]),ee=o.useCallback(async()=>{if(c&&c.length<l.perPage&&P>c.length){const e=Math.min(l.perPage-c.length,P-c.length);if(e<=0)return;y(!0);try{const r=await R.get(route("leaves.paginate"),{params:{page:l.currentPage+1,perPage:e,employee:a.employee,month:a.selectedMonth,status:a.status!=="all"?a.status:void 0,leave_type:a.leaveType!=="all"?a.leaveType:void 0,department:a.department!=="all"?a.department:void 0}});r.status===200&&r.data.leaves.data&&m(s=>{const n=r.data.leaves.data.filter(C),g=[...s,...n];return M(g)})}catch(r){N.error("Error fetching additional items."),console.error(`Error fetching additional items from page ${l.currentPage+1}:`,r)}finally{y(!1)}}},[l.currentPage,l.perPage,c,a,M,C]),Be=o.useCallback(e=>{c.some(s=>s.id===e)&&(m(s=>s.filter(n=>n.id!==e)),O(P-1),ee())},[c,P,O,ee]);return o.useEffect(()=>{T&&h()},[h,T,l.currentPage,a.employee,a.selectedMonth,a.status,a.leaveType,a.department]),o.useEffect(()=>{T&&D()},[h,T]),i(qe,{children:[t(Oe,{title:G}),S.add_leave&&t(pe,{open:S.add_leave,closeModal:()=>V("add_leave"),leavesData:L,setLeavesData:j,currentLeave:null,allUsers:v,setTotalRows:f,setLastPage:b,setLeaves:m,handleMonthChange:K,employee:a.employee,selectedMonth:a.selectedMonth,addLeaveOptimized:Ee,fetchLeavesStats:D}),S.edit_leave&&t(pe,{open:S.edit_leave,closeModal:()=>V("edit_leave"),leavesData:L,setLeavesData:j,currentLeave:B,allUsers:v,setTotalRows:f,setLastPage:b,setLeaves:m,handleMonthChange:K,employee:a.employee,selectedMonth:a.selectedMonth,updateLeaveOptimized:je,fetchLeavesStats:D}),S.delete_leave&&t(Xe,{open:S.delete_leave,closeModal:()=>V("delete_leave"),leaveId:B==null?void 0:B.id,setLeaves:m,setTotalRows:f,setLastPage:b,deleteLeaveOptimized:Be,fetchLeavesStats:D}),t(ce,{sx:{display:"flex",justifyContent:"center",p:2},children:t(Ke,{in:!0,children:t(ie,{children:t(He,{title:"Leave Management",subtitle:"Manage employee leave requests and approvals",icon:t(na,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[...Pe?[{label:"Add Leave",icon:t(oa,{className:"w-4 h-4"}),onPress:()=>De("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],{label:"Export",icon:t(la,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:i("div",{className:"p-6",children:[t(Je,{stats:Te}),i("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[t("div",{className:"flex-1",children:t(de,{label:"Search Employee",variant:"bordered",placeholder:"Search by name or ID...",value:a.employee,onValueChange:e=>u("employee",e),startContent:t(aa,{className:"w-4 h-4"}),classNames:{input:"bg-transparent",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:E?"sm":"md"})}),t("div",{className:"flex gap-2 items-end",children:t(ta,{variant:"bordered",className:"bg-white/5",children:i(Ie,{isIconOnly:E,color:Y?"primary":"default",onPress:()=>be(!Y),className:Y?"bg-purple-500/20":"bg-white/5",children:[t(ra,{className:"w-4 h-4"}),!E&&t("span",{className:"ml-1",children:"Filters"})]})})})]}),Y&&t(Ve,{in:!0,timeout:300,children:i("div",{className:"mb-6 p-4 bg-white/5 backdrop-blur-md rounded-lg border border-white/10",children:[i("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[i(H,{label:"Leave Status",selectionMode:"multiple",variant:"bordered",selectedKeys:a.status,onSelectionChange:e=>u("status",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:[t(x,{value:"pending",children:"Pending"},"pending"),t(x,{value:"approved",children:"Approved"},"approved"),t(x,{value:"rejected",children:"Rejected"},"rejected"),t(x,{value:"new",children:"New"},"new")]}),t(H,{label:"Leave Type",variant:"bordered",selectionMode:"multiple",selectedKeys:a.leaveType,onSelectionChange:e=>u("leaveType",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:Se.map(e=>t(x,{value:e.value,children:e.label},e.key))}),t(H,{label:"Department",variant:"bordered",selectionMode:"multiple",selectedKeys:a.department,onSelectionChange:e=>u("department",Array.from(e)),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:U.map(e=>t(x,{value:e.id,children:e.name},e.id))}),t(de,{label:"Month/Year",type:"month",value:a.selectedMonth,onChange:K,startContent:t(me,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:E?"sm":"md"})]}),(a.employee||a.status.length||a.leaveType.length||a.department.length)&&i("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-white/10",children:[a.employee&&i(q,{variant:"flat",color:"primary",size:"sm",onClose:()=>u("employee",""),children:["Employee: ",a.employee]}),a.status.map(e=>i(q,{variant:"flat",color:"secondary",size:"sm",onClose:()=>u("status",a.status.filter(r=>r!==e)),children:["Status: ",e]},e)),a.leaveType.map(e=>i(q,{variant:"flat",color:"warning",size:"sm",onClose:()=>u("leaveType",a.leaveType.filter(r=>r!==e)),children:["Type: ",e]},e)),a.department.map(e=>{var r;return i(q,{variant:"flat",color:"success",size:"sm",onClose:()=>u("department",a.department.filter(s=>s!==e)),children:["Department: ",((r=U.find(s=>s.id===Number(e)))==null?void 0:r.name)||"Unknown"]},e)})]})]})}),i("div",{className:"min-h-96",children:[i(w,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[t(ne,{className:"w-5 h-5"}),"Leave Requests Management"]}),he?t(W,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(I,{className:"text-center py-12",children:[t(sa,{size:40}),t(w,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):c&&c.length>0?t("div",{className:"overflow-hidden rounded-lg",children:t(Ze,{ref:Ae,totalRows:P,lastPage:ve,setCurrentPage:ke,setPerPage:Le,perPage:l.perPage,currentPage:l.currentPage,handleClickOpen:xe,setCurrentLeave:X,openModal:Me,leaves:Re,allUsers:v,setLeaves:m,employee:a.employee,selectedMonth:a.selectedMonth,isAdminView:!0,onBulkApprove:_e,onBulkReject:Fe,canApproveLeaves:A,canEditLeaves:Ce,canDeleteLeaves:Ne,fetchLeavesStats:D})}):Z?t(W,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(I,{className:"text-center py-12",children:[t(ge,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),t(w,{variant:"h6",className:"mb-2",children:"No Data Found"}),t(w,{color:"textSecondary",children:Z})]})}):t(W,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(I,{className:"text-center py-12",children:[t(me,{className:"w-16 h-16 text-default-400 mx-auto mb-4"}),t(w,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),t(w,{color:"textSecondary",children:"No leave records found for the selected criteria."})]})})]})]})})})})})]})};ia.layout=G=>t(We,{children:G});export{ia as default};
