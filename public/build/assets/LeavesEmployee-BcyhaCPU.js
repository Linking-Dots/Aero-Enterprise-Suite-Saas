import{J as ie,r as s,a as I,b as o,j as e,Q as ce,h as de,c as N,e as x,f as me,F as ue,d as he}from"./app-z4s5sYKZ.js";import{d as pe}from"./dayjs.min-DZFMHsZ9.js";import{u as ve,a as Q,j as ge,B as be,c as fe,k as C,T as i,G as ye,A as we}from"./App-lYuiCeFz.js";import{P as Ne}from"./PageHeader-CqkUxZm7.js";import{L as q,D as xe,a as Ce}from"./DeleteLeaveForm-D7mfSljJ.js";import{F as T}from"./ChartBarIcon-rbTIP0NK.js";import{C as _e}from"./CircularProgress-DIt3rVlg.js";import{F as Se}from"./XCircleIcon-CnsrqKVm.js";import{F as Le}from"./PlusIcon-BnsbFFF2.js";import{F as ke}from"./PresentationChartLineIcon-Ud-SRZL9.js";import{s as Fe,l as Ye}from"./chunk-2GIFKCNQ-DKADZLNf.js";import{c as Me}from"./chunk-D5XJWRAV-DYHUiYgb.js";import"./app-DNvvDii_.js";import"./PencilIcon-H8rDExDO.js";import"./TrashIcon-tECU6Km-.js";import"./UserIcon-CThnUmFQ.js";import"./CardContent-Dr_xO4Ae.js";import"./colorManipulator-fGOXFJsc.js";import"./chunk-F3UDT23P-DmHXsHIa.js";import"./useHasTabbableChild-BzdOGCVc.js";import"./chunk-7F3ZLNJ6-CESd7uTm.js";import"./chunk-7ZZXWEXF-DBReItMz.js";import"./chunk-R6AK6OQ4-D-AbbXCy.js";import"./chunk-O5I3QTYU-CzsU2vYt.js";import"./index-CokAva9Y.js";import"./Clear-Cu6tDWXb.js";import"./GlassDialog-BPHbPfG8.js";import"./DialogContent-D88NsPJ_.js";import"./DialogTitle--yJ9U4gg.js";import"./TextField-yuj0Q4Bl.js";import"./Select-j5AnG5eG.js";import"./Popover-DvUmpdej.js";import"./List-WeVe4rDG.js";import"./MenuItem-bff8aMgb.js";import"./listItemTextClasses-DKVS5CgH.js";import"./dividerClasses-CYiRuqzU.js";import"./Avatar-ChToq-_v.js";import"./useSlot-C2BSLxE1.js";import"./LoadingButton-BMUrW638.js";import"./Button-flahXtBE.js";import"./DialogContentText-ORhoOKkT.js";const De=({title:M,allUsers:D})=>{const{auth:_}=ie().props,A=ve(),v=Q(A.breakpoints.down("sm")),H=Q(A.breakpoints.down("md")),[J,h]=s.useState(0),[V,p]=s.useState(0),[S,P]=s.useState(!1),[E,c]=s.useState([]),[g,y]=s.useState({leaveTypes:[],leaveCountsByUser:{}}),[j,R]=s.useState(""),[w,$]=s.useState({page:1,perPage:30,total:0,lastPage:0}),[n,W]=s.useState({employee:"",selectedMonth:pe().format("YYYY-MM"),year:new Date().getFullYear()}),X=s.useMemo(()=>{const a=new Date().getFullYear();return Array.from({length:a-1900+1},(t,r)=>{const l=1900+r;return{key:l.toString(),label:l.toString(),value:l}}).reverse()},[]),z=s.useCallback((a,t)=>{if(a==="year"){const r=Number(t);if(r<1900||r>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}W(r=>({...r,[a]:t})),a==="year"&&$(r=>({...r,page:1}))},[]),[b,L]=s.useState({add_leave:!1,edit_leave:!1,delete_leave:!1});s.useCallback((a,t=null)=>{L(r=>({...r,[a]:!0}))},[]);const B=s.useCallback(()=>{L({add_leave:!1,edit_leave:!1,delete_leave:!1})},[]),U=s.useCallback(a=>{L(t=>({...t,[a]:!0}))},[]),Z=s.useCallback((a,t)=>{O({id:a}),L(r=>({...r,[t]:!0}))},[]),[k,O]=s.useState(null),K=s.useCallback(a=>{O(a)},[]),F=s.useCallback(async()=>{var a,t,r;P(!0);try{const{page:l,perPage:m}=w,{year:f}=n,G=await I.get(route("leaves.paginate"),{params:{page:l,perPage:m,year:f},timeout:1e4});if(G.status===200){const{leaves:u,leavesData:ne}=G.data;u.data&&Array.isArray(u.data)?(c(u.data),h(u.total||u.data.length),p(u.last_page||1)):Array.isArray(u)?(c(u),h(u.length),p(1)):(console.error("Unexpected leaves data format:",u),c([]),h(0),p(1)),y(ne),R(""),P(!1)}}catch(l){if(console.error("Error fetching leaves:",l),((a=l.response)==null?void 0:a.status)===404){const{leavesData:m}=l.response.data;y(m),R(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.message)||"No leaves found for the selected criteria.")}else R("Error retrieving leaves data. Please try again."),ge.error("Failed to load leave data. Please try again.");c([]),h(0),p(1)}finally{P(!1)}},[w.page,w.perPage,n]),d=s.useCallback(async()=>{try{const a=await I.get(route("leaves.stats"),{params:{year:n.year}});if(a.status===200){const{stats:t,leaveCounts:r}=a.data;r&&y(l=>({...l,leaveCountsByUser:{...l.leaveCountsByUser,[_.user.id]:r}}))}}catch(a){console.error("Error fetching leaves stats:",a.response)}},[n.year,_.user.id]),ee=s.useCallback(a=>{$(t=>({...t,page:a}))},[]);s.useEffect(()=>{F(),d()},[F,d]);const ae=s.useMemo(()=>g.leaveCountsByUser[_.user.id]||[],[g.leaveCountsByUser,_.user.id]),Y=s.useCallback(a=>[...a].sort((t,r)=>new Date(t.from_date)-new Date(r.from_date)),[]),te=s.useCallback(a=>{new Date(a.from_date).getFullYear()===n.year&&(c(l=>{const m=[...l,a];return Y(m)}),h(l=>l+1),d())},[Y,n.year,d]),re=s.useCallback(a=>{new Date(a.from_date).getFullYear()===n.year&&(c(l=>{const m=l.map(f=>f.id===a.id?a:f);return Y(m)}),d())},[Y,n.year,d]),se=s.useCallback(a=>{c(t=>t.filter(r=>r.id!==a)),h(t=>Math.max(0,t-1)),d()},[d]),le=()=>g.leaveTypes.length?e("div",{className:`grid gap-4 ${v?"grid-cols-1":H?"grid-cols-2":"grid-cols-4"}`,children:g.leaveTypes.map(({type:a})=>{const t=ae.find(f=>f.leave_type===a)||{},r=t.days_used||0,l=t.remaining_days||0,m=r+l;return o(N,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[e(Me,{className:"pb-2",children:o("div",{className:"flex items-center gap-2",children:[e(C,{className:"w-5 h-5"}),e(i,{variant:v?"subtitle1":"h6",className:"font-semibold truncate",children:a})]})}),e(x,{className:"pt-0",children:o("div",{className:"space-y-3",children:[o("div",{className:"flex justify-between items-center",children:[o("div",{className:"text-center",children:[e(i,{variant:"caption",color:"textSecondary",children:"Used"}),e(i,{variant:v?"h6":"h5",className:"font-bold text-red-400",children:r})]}),e(he,{orientation:"vertical",className:"h-8"}),o("div",{className:"text-center",children:[e(i,{variant:"caption",color:"textSecondary",children:"Remaining"}),e(i,{variant:v?"h6":"h5",className:"font-bold text-green-400",children:l})]})]}),m>0&&e("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${r/m*100}%`}})})]})})]},a)})}):e(N,{className:"bg-white/10 backdrop-blur-md border-white/20",children:o(x,{className:"text-center py-8",children:[e(T,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e(i,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),oe=s.useRef(null);return o(ue,{children:[e(ce,{title:M}),b.add_leave&&e(q,{open:b.add_leave,closeModal:()=>B(),leavesData:g,setLeavesData:y,currentLeave:null,allUsers:D,setTotalRows:h,setLastPage:p,setLeaves:c,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:te,fetchLeavesStats:d}),b.edit_leave&&e(q,{open:b.edit_leave,closeModal:()=>B(),leavesData:g,setLeavesData:y,currentLeave:k,allUsers:D,setTotalRows:h,setLastPage:p,setLeaves:c,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:re,fetchLeavesStats:d}),b.delete_leave&&e(xe,{open:b.delete_leave,closeModal:()=>B(),leaveId:k==null?void 0:k.id,setLeaves:c,setTotalRows:h,setLastPage:p,deleteLeaveOptimized:se,fetchLeavesStats:d}),o(be,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",e(ye,{in:!0,children:e(fe,{children:e(Ne,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:e(ke,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:e(Le,{className:"w-4 h-4"}),onPress:()=>U("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Current Year",icon:e(C,{className:"w-4 h-4"}),onPress:()=>z("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:e(me,{className:"w-4 h-4"}),onPress:F,isDisabled:S,variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:o("div",{className:"p-6",children:[e("div",{className:"mb-6",children:o("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(Fe,{label:"Select Year",variant:"bordered",selectedKeys:[String(n.year)],onSelectionChange:a=>{const t=Array.from(a)[0];t&&z("year",Number(t))},startContent:e(C,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:v?"sm":"md",children:X.map(a=>e(Ye,{value:a.value,children:a.label},a.key))})}),e("div",{className:"flex gap-2",children:e(de,{variant:"flat",color:"primary",size:v?"sm":"md",onPress:F,isLoading:S,startContent:!S&&e(T,{className:"w-4 h-4"}),children:"Refresh"})})]})}),o("div",{className:"mb-6",children:[o(i,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(T,{className:"w-5 h-5"}),"Leave Balance Summary"]}),le()]}),o("div",{className:"min-h-96",children:[o(i,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(C,{className:"w-5 h-5"}),"Leave History"]}),S?e(N,{className:"bg-white/10 backdrop-blur-md border-white/20",children:o(x,{className:"text-center py-12",children:[e(_e,{size:40}),e(i,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):j?e(N,{className:"bg-white/10 backdrop-blur-md border-white/20",children:o(x,{className:"text-center py-12",children:[e(Se,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),e(i,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),e(i,{color:"textSecondary",children:j})]})}):E.length>0?e("div",{className:"overflow-hidden rounded-lg",children:e(Ce,{ref:oe,leaves:E,allUsers:D||[],handleClickOpen:Z,setCurrentLeave:K,openModal:U,setLeaves:c,setCurrentPage:ee,currentPage:w.page,totalRows:J,lastPage:V,perPage:w.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1})}):e(N,{className:"bg-white/10 backdrop-blur-md border-white/20",children:o(x,{className:"text-center py-12",children:[e(C,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e(i,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),o(i,{color:"textSecondary",children:["You haven't submitted any leave requests for ",n.year,"."]}),"                      "]})})]})]})})})})]})]})};De.layout=M=>e(we,{children:M});export{De as default};
