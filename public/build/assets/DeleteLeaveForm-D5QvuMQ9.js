import{r as ie,q as ee,a as e,j as l,B as $,F as T}from"./app-CjgqAK5G.js";import{s as de,q as ce,r as g,u as U,k as ue,l as J,m as i,n as pe,B as z,V as G,T as E,F as O,S as j,M as I,c as H,j as he,i as me,o as V,N as re,G as w,h as K,W as Q,b as R,O as ae,P as te,X as ge,f as Z}from"./vendor-BBvAslwD.js";import{d as be}from"./Edit-BO9iAtx3.js";import{d as ye}from"./Delete-DjXAdUVS.js";import{d as xe,G as oe}from"./GlassDialog-CvrtYDzh.js";import{L as fe}from"./LoadingButton-DHZxIi3J.js";var X={},Ce=de;Object.defineProperty(X,"__esModule",{value:!0});var L=X.default=void 0,we=Ce(ie()),Se=ce;L=X.default=(0,we.default)((0,Se.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked");const Be=({allLeaves:F,allUsers:u,handleClickOpen:b,setCurrentLeave:f,openModal:h,setLeavesData:s})=>{const{auth:S}=ee().props,[x,n]=g.useState(null),a=U(),W=r=>{n(r.currentTarget)},k=()=>{n(null)},A=async(r,o)=>{k(),await _(r,"status",o)},_=async(r,o,B)=>{const M=new Promise(async(D,C)=>{try{const d=await axios.post(route("leave-add"),{route:route().current(),user_id:r.user_id,id:r.id,leaveType:r.leave_type,fromDate:r.from_date,toDate:r.to_date,daysCount:r.no_of_days,leaveReason:r.reason,[o]:B});d.status===200&&(s(d.data.leavesData),D([d.data.message||"Leave status updated successfully"]))}catch(d){d.response?(d.response.status===422?C(d.response.statusText||"Failed to update leave status"):C("An unexpected error occurred. Please try again later."),console.error(d.response)):d.request?(C("No response received from the server. Please check your internet connection."),console.error(d.request)):(C("An error occurred while setting up the request."),console.error("Error",d.message))}});$.promise(M,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(V,{}),e("span",{style:{marginLeft:"8px"},children:"Updating leave status..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},success:{render({data:D}){return e(T,{children:D.map((C,d)=>e("div",{children:C},d))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},error:{render({data:D}){return e(T,{children:D})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}}})},q=r=>{switch(r){case"New":return a.palette.primary.main;case"Pending":return a.palette.warning.main;case"Approved":return a.palette.success.main;case"Declined":return a.palette.error.main;default:return a.palette.text.primary}};return e(me,{style:{maxHeight:"84vh",overflowY:"auto"},children:l(he,{size:"small",children:[e(ue,{children:l(J,{children:[S.roles.includes("admin")&&route().current()==="leaves"&&e(i,{sx:{whiteSpace:"nowrap"},children:"Employee"}),e(i,{sx:{whiteSpace:"nowrap"},children:"Leave Type"}),e(i,{sx:{whiteSpace:"nowrap"},children:"From"}),e(i,{sx:{whiteSpace:"nowrap"},children:"To"}),e(i,{sx:{whiteSpace:"nowrap"},children:"No of Days"}),e(i,{sx:{whiteSpace:"nowrap"},children:"Reason"}),e(i,{sx:{whiteSpace:"nowrap"},children:"Status"}),e(i,{sx:{whiteSpace:"nowrap"},children:"Approved/Declined by"}),e(i,{sx:{whiteSpace:"nowrap"},align:"center",children:"Actions"})]})}),e(pe,{children:F.map(r=>l(J,{children:[S.roles.includes("admin")&&route().current()==="leaves"&&e(i,{children:l(z,{sx:{display:"flex",alignItems:"center"},children:[e(G,{src:u.find(o=>String(o.id)===String(r.user_id)).profile_image,alt:u.find(o=>String(o.id)===String(r.user_id)).name}),e(E,{sx:{marginLeft:"10px",fontWeight:"bold"},children:u.find(o=>String(o.id)===String(r.user_id)).name})]})}),e(i,{sx:{whiteSpace:"nowrap"},children:r.leave_type}),e(i,{sx:{whiteSpace:"nowrap"},children:new Date(r.from_date).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})}),e(i,{sx:{whiteSpace:"nowrap"},children:new Date(r.to_date).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})}),e(i,{sx:{whiteSpace:"nowrap"},children:r.no_of_days}),e(i,{sx:{whiteSpace:"nowrap"},children:r.reason}),e(i,{sx:{whiteSpace:"nowrap"},children:e(O,{fullWidth:!0,children:e(j,{disabled:!S.roles.includes("admin")&&route().current()!=="leaves",variant:"outlined",color:"primary",size:"small",onClick:W,startIcon:e(L,{}),value:r.status,onChange:o=>A(r,o.target.value),sx:{border:a.glassCard.border,borderRadius:"50px"},MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,borderRadius:2,boxShadow:a.glassCard.boxShadow}}},children:["New","Pending","Approved","Declined"].map(o=>e(I,{value:o,sx:{display:"flex",alignItems:"center","&:hover":{backgroundColor:a.palette.action.hover}},children:l(z,{sx:{display:"flex"},children:[e(L,{sx:{marginRight:1,color:q(o)}}),o]})},o))})})}),e(i,{sx:{whiteSpace:"nowrap"},children:r.approved_by?l(E,{sx:{display:"flex",alignItems:"center",whiteSpace:"nowrap"},children:[e(G,{src:u.find(o=>o.id===r.approved_by).profile_image,alt:u.find(o=>o.id===r.approved_by).name}),e(E,{sx:{marginLeft:"10px",fontWeight:"bold"},children:u.find(o=>o.id===r.approved_by).name})]}):null}),l(i,{sx:{whiteSpace:"nowrap"},align:"center",children:[e(H,{sx:{m:1},variant:"outlined",color:"success",size:"small",onClick:()=>{f(r),h("edit_leave")},children:e(be,{})}),e(H,{sx:{m:1},variant:"outlined",color:"error",size:"small",onClick:()=>b(r.id,"delete_leave"),children:e(ye,{})})]})]},r.id))})]})})},Ee=({open:F,closeModal:u,leaveTypes:b,leaveCounts:f,setLeavesData:h,currentLeave:s,allUsers:S})=>{const{auth:x}=ee().props,n=U(),[a,W]=g.useState((s==null?void 0:s.user_id)||x.user.id),[k,A]=g.useState((s==null?void 0:s.leave_type)||(b.length>0?b[0].type:"")),[_,q]=g.useState((s==null?void 0:s.from_date)||""),[r,o]=g.useState((s==null?void 0:s.to_date)||""),[B,M]=g.useState((s==null?void 0:s.no_of_days)||""),[D,C]=g.useState(""),[d,se]=g.useState((s==null?void 0:s.reason)||""),[p,le]=g.useState({}),[Y,N]=g.useState(!1),[ke,ne]=g.useState("");return g.useEffect(()=>{var y;const t=((y=f==null?void 0:f.find(m=>m.leave_type===k))==null?void 0:y.days_used)||0;ne(t);const v=b==null?void 0:b.find(m=>m.type===k);v&&C(v.days-t)},[k,f,b]),g.useEffect(()=>{M(((v,y)=>{if(!v||!y)return"";const m=new Date(v),c=new Date(y);if(m>c)return"";const P=c.getTime()-m.getTime();return Math.ceil(P/(1e3*3600*24))+1})(_,r))},[_,r]),l(oe,{open:F,onClose:u,fullWidth:!0,maxWidth:"sm",children:[l(re,{sx:{display:"flex",alignItems:"center"},children:[e(E,{variant:"h6",children:"Add Leave"}),e(H,{onClick:u,sx:{position:"absolute",top:8,right:16},children:e(xe,{})})]}),l("form",{onSubmit:async t=>{t.preventDefault(),N(!0);const v=new Promise(async(y,m)=>{try{const c={route:route().current(),user_id:a,leaveType:k,fromDate:_,toDate:r,daysCount:B,leaveReason:d};s&&(c.id=s.id);const P=await axios.post(route("leave-add"),c);P.status===200&&(h(P.data.leavesData),y([P.data.message||"Leave application submitted successfully"]),u())}catch(c){N(!1),c.response?(c.response.status===422?(le(c.response.data.errors||{}),m(c.response.statusText||"Failed to submit leave application")):m("An unexpected error occurred. Please try again later."),console.error(c.response)):c.request?(m("No response received from the server. Please check your internet connection."),console.error(c.request)):(m("An error occurred while setting up the request."),console.error("Error",c.message))}finally{N(!1)}});$.promise(v,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(V,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:y}){return e(T,{children:y.map((m,c)=>e("div",{children:m},c))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:y}){return e(T,{children:y})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,color:n.palette.text.primary}}})},children:[e(ae,{children:l(w,{container:!0,spacing:2,children:[e(w,{item:!0,xs:12,md:6,children:l(O,{fullWidth:!0,children:[e(K,{id:"leave-type-label",children:"Leave Type"}),l(j,{labelId:"leave-type-label",value:k,onChange:t=>A(t.target.value),label:"Leave Type",error:!!p.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,borderRadius:2,boxShadow:n.glassCard.boxShadow}}},children:[e(I,{value:"",disabled:!0,children:"Select Leave Type"}),b.map(t=>l(I,{value:t.type,children:[t.type," ",t.days," Days"]},t.id))]}),e(Q,{children:p.leaveType})]})}),e(w,{item:!0,xs:12,md:6,children:e(R,{label:"From",type:"date",fullWidth:!0,value:_,onChange:t=>q(t.target.value),InputLabelProps:{shrink:!0},error:!!p.fromDate,helperText:p.fromDate})}),e(w,{item:!0,xs:12,md:6,children:e(R,{label:"To",type:"date",fullWidth:!0,value:r,onChange:t=>o(t.target.value),InputLabelProps:{shrink:!0},error:!!p.toDate,helperText:p.toDate})}),e(w,{item:!0,xs:12,md:6,children:e(R,{label:"Number of days",type:"text",fullWidth:!0,value:B,InputProps:{readOnly:!0},error:!!p.daysCount,helperText:p.daysCount})}),e(w,{item:!0,xs:12,md:6,children:e(R,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:D,InputProps:{readOnly:!0},error:!!p.remainingLeaves,helperText:p.remainingLeaves})}),x.roles.includes("admin")&&route().current()==="leaves"&&e(w,{item:!0,xs:12,md:6,children:l(O,{fullWidth:!0,children:[e(K,{id:"leave-employee-label",children:"Employee"}),l(j,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:a||"na",error:!!p.user_id,onChange:t=>W(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,borderRadius:2,boxShadow:n.glassCard.boxShadow}}},children:[e(I,{value:"na",disabled:!0,children:"Please select"}),S.map(t=>e(I,{value:t.id,children:l(z,{sx:{display:"flex"},children:[e(G,{src:t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(Q,{children:p.user_id})]})}),e(w,{item:!0,xs:12,children:e(R,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:d,onChange:t=>se(t.target.value),error:!!p.leaveReason,helperText:p.leaveReason})})]})}),e(te,{sx:{padding:"16px",justifyContent:"center"},children:e(fe,{type:"submit",variant:"outlined",color:"primary",loading:Y,disabled:Y,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},We=({open:F,handleClose:u,leaveIdToDelete:b,setLeavesData:f})=>{const h=U();return l(oe,{open:F,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(re,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(ae,{children:e(ge,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(te,{children:[e(Z,{onClick:u,color:"primary",children:"Cancel"}),e(Z,{onClick:()=>{const S=new Promise(async(x,n)=>{try{const a=await axios.delete(route("leave-delete",{id:b,route:route().current()}));a.status===200&&(f(a.data.leavesData),x("Leave application deleted successfully"))}catch(a){console.error("Error deleting task:",a),n(a.response.data.error||"Failed to delete leave application")}finally{u()}});$.promise(S,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(V,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:h.glassCard.backgroundColor,border:h.glassCard.border,color:h.palette.text.primary}},success:{render({data:x}){return e(T,{children:x})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:h.glassCard.backgroundColor,border:h.glassCard.border,color:h.palette.text.primary}},error:{render({data:x}){return e(T,{children:x})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:h.glassCard.backgroundColor,border:h.glassCard.border,color:h.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{We as D,Ee as L,Be as a};
