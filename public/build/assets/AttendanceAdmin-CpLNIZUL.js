import{r as n,b as e,a,i as U,R as be,J as ge,Q as ye,F as we,g as W}from"./app-DMbZ8egF.js";import{u as ne,e as E,f as J,B as d,T as _,W as X,X as z,I as O,y as q,h as V,d as le,D as xe,i as K,z as ee,b as ve,E as te,P as Ne,A as ke}from"./App-DBihHj7U.js";import{P as $e}from"./PageHeader-Dkz_rrRt.js";import{S as Me}from"./StatsCards-B_piGP08.js";import{d as l}from"./dayjs.min-CjVTJRzo.js";import"./jspdf.es.min-B_lr8YdN.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{F as S}from"./DocumentChartBarIcon-DN8sXvA0.js";import{F as B}from"./UserIcon-D2DuDTuw.js";import{s as Fe}from"./chunk-TLYTI3QM-BZq_GWk0.js";import{P as _e}from"./PictureAsPdf-DfXxB1vq.js";import{R as ae}from"./Refresh-i2y8PpT9.js";import{C as re}from"./CardHeader-c37JMDG-.js";import{C as Q}from"./CardContent-B0Zh1gK5.js";import{t as Re,a as Ce,b as Pe,c as Ae,d as Se,e as Y}from"./chunk-F3UDT23P-DtFhl1MB.js";import{t as Ye}from"./chunk-7ZZXWEXF-Bmmm2n3N.js";import{u as oe}from"./chunk-R6AK6OQ4-7JPU21Vm.js";import{b as Ee,F as Te,a as Le}from"./XCircleIcon-Di2h1Bp2.js";import{a as F}from"./colorManipulator-B4EFOkEC.js";import{F as We}from"./CheckCircleIcon-CPp_yjo1.js";import{F as Be}from"./XCircleIcon-b-Y9KmSO.js";import{F as je}from"./ExclamationTriangleIcon-BvVa33WY.js";import{F as De}from"./ChartBarIcon-BTm8n4vW.js";import{F as Ie}from"./MagnifyingGlassIcon-BoY2h7mE.js";import{p as He}from"./chunk-O5I3QTYU-CsHrxnEj.js";import{F as se}from"./DocumentArrowDownIcon-bgUsMNtg.js";import{F as Ue}from"./PresentationChartLineIcon-Cpmk3w7f.js";import"./app-DbVQyYWD.js";import"./chunk-D5XJWRAV-C0iPUUQx.js";import"./useHasTabbableChild-BXtalMCB.js";import"./chunk-7F3ZLNJ6-CCnKMx8B.js";import"./index-CokAva9Y.js";function ze({title:w,titleId:g,...i},u){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":g},i),w?n.createElement("title",{id:g},w):null,n.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const Oe=n.forwardRef(ze),Qe=({loading:w,attendanceData:g,currentYear:i,currentMonth:u,leaveTypes:x,leaveCounts:$,onRefresh:R})=>{console.log(g);const v=ne(),T=E("(min-width: 1025px)");E("(min-width: 641px) and (max-width: 1024px)");const j=E("(max-width: 640px)"),C=l(`${i}-${u}-01`).daysInMonth(),D={"√":{icon:Le,color:"text-success",bg:"bg-success-100",label:"√",short:"P"},"▼":{icon:Te,color:"text-danger",bg:"bg-danger-100",label:"▼",short:"A"},"#":{icon:Ee,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:Oe,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},I=n.useMemo(()=>[{label:"No.",key:"sl",icon:S,width:60},{label:"Employee",key:"name",icon:B,width:200},...Array.from({length:C},(t,f)=>{const h=f+1,b=l(`${i}-${u}-${h}`);return{label:`${h}`,sublabel:b.format("ddd"),key:`day-${h}`,width:40,isWeekend:b.day()===0||b.day()===6}}),...x?x.map(t=>({label:t.type,key:t.type,icon:J,width:80})):[]],[C,i,u,x]),L=t=>D[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},H=({data:t,index:f})=>e(le,{className:"mb-4",shadow:"sm",children:a(Q,{className:"p-4",children:[e(d,{className:"flex items-center gap-3 mb-4",children:e(oe,{avatarProps:{radius:"lg",size:"md",src:t.profile_image,fallback:e(B,{className:"w-6 h-6"})},name:e(_,{variant:"body1",fontWeight:"medium",children:t.name}),description:a(_,{variant:"caption",color:"textSecondary",children:["Employee #",f+1]})})}),e(U,{className:"my-3"}),e(d,{className:"grid grid-cols-7 gap-1 mb-4",children:Array.from({length:C},(h,b)=>{const p=b+1,N=l(`${i}-${u}-${p}`).format("YYYY-MM-DD"),k=t[N]||"▼",r=L(k),m=l(`${i}-${u}-${p}`).day()===0||l(`${i}-${u}-${p}`).day()===6;return a(d,{className:`
                                    flex flex-col items-center justify-center p-1 rounded text-xs
                                    ${m?"bg-default-100":"bg-default-50"}
                                    ${r.bg}
                                `,children:[e("span",{className:"font-medium",children:p}),e("span",{className:"text-xs",children:r.icon?e(r.icon,{className:`w-3 h-3 ${r.color}`}):e("span",{className:r.color,children:k})})]},p)})}),x&&x.length>0&&e(d,{className:"flex flex-wrap gap-2",children:x.map(h=>{const b=$&&$[t.user_id]&&$[t.user_id][h.type]||0;return a(V,{size:"sm",variant:"flat",color:b>0?"warning":"default",startContent:e(J,{className:"w-3 h-3"}),children:[h.type,": ",b]},h.type)})})]})});return w?e(d,{className:"flex justify-center items-center h-64",children:e(Fe,{className:"w-full h-full rounded-lg"})}):!g||g.length===0?a(d,{className:"flex flex-col items-center justify-center py-8",children:[e(S,{className:"w-12 h-12 text-default-300 mb-4"}),e(_,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):j?a(d,{children:[e(re,{title:a(d,{className:"flex items-center gap-3",children:[e(S,{className:"w-6 h-6 text-primary"}),e(_,{variant:"h6",component:"h1",children:"Attendance Report"})]}),action:a(X,{direction:"row",children:[e(z,{title:"Download as PDF",children:e(O,{onClick:downloadPDF,disabled:w||!g||g.length===0,sx:{background:F(v.palette.error.main,.1),"&:hover":{background:F(v.palette.error.main,.2)}},children:e(_e,{sx:{color:v.palette.error.main}})})}),R&&e(z,{title:"Refresh Data",children:e(O,{onClick:R,disabled:w,sx:{background:F(v.palette.primary.main,.1),"&:hover":{background:F(v.palette.primary.main,.2)}},children:e(ae,{color:"primary"})})})]})}),e(U,{}),e(Q,{children:e(q,{className:"max-h-[70vh]",children:g.map((t,f)=>e(H,{data:t,index:f},t.user_id||f))})})]}):a(d,{children:[e(re,{title:a(d,{className:"flex items-center gap-3",children:[e(S,{className:"w-6 h-6 text-primary"}),a(_,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",l(`${i}-${u}-01`).format("MMMM YYYY")]})]}),action:e(X,{direction:"row",spacing:1,children:R&&e(z,{title:"Refresh Data",children:e(O,{onClick:R,disabled:w,sx:{background:F(v.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${F(v.palette.primary.main,.2)}`,"&:hover":{background:F(v.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(ae,{color:"primary"})})})}),sx:{padding:"24px"}}),e(U,{}),e(Q,{children:e(d,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e(q,{className:"max-h-[70vh]",children:a(Re,{isCompact:!T,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e(Ce,{columns:I,children:t=>e(Pe,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:a(d,{className:"flex flex-col items-center gap-1",children:[a(d,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e(Ae,{items:g,emptyContent:a(d,{className:"flex flex-col items-center justify-center py-8",children:[e(S,{className:"w-12 h-12 text-default-300 mb-4"}),e(_,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e(Se,{children:f=>{var b;const h=g.findIndex(p=>(p.user_id||p.id)===(t.user_id||t.id));switch(f){case"sl":return e(Y,{className:"text-center font-medium",children:h+1});case"name":return e(Y,{className:"whitespace-nowrap",children:e(oe,{avatarProps:{radius:"lg",size:T?"md":"sm",src:t.profile_image,fallback:e(B,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(f.startsWith("day-")){const N=parseInt(f.split("-")[1]),k=l(`${i}-${u}-${N}`).format("YYYY-MM-DD"),r=t[k],m=l(k).day()===0||l(k).day()===6,P=typeof r=="object"&&(r==null?void 0:r.status)||"▼",o=L(P);return e(Y,{className:`text-center ${m?"bg-default-50":""}`,children:e(Ye,{content:a("div",{className:"text-sm space-y-1",children:[a("div",{children:[e("strong",{children:"Status:"})," ",P]}),a("div",{children:[e("strong",{children:"Punch In:"})," ",(r==null?void 0:r.punch_in)||"-"]}),a("div",{children:[e("strong",{children:"Punch Out:"})," ",(r==null?void 0:r.punch_out)||"-"]}),a("div",{children:[e("strong",{children:"Work Hours:"})," ",(r==null?void 0:r.total_work_hours)||"00:00"]}),a("div",{children:[e("strong",{children:"Remarks:"})," ",(r==null?void 0:r.remarks)||"N/A"]})]}),placement:"top",className:"z-[99999]",children:e(d,{className:"flex items-center justify-center cursor-help",children:o.icon?e(o.icon,{className:`w-4 h-4 ${o.color}`}):e("span",{className:`text-xs ${o.color}`,children:P})})})})}const p=x==null?void 0:x.find(N=>N.type===f);if(p){const N=((b=$==null?void 0:$[t.user_id])==null?void 0:b[p.type])||0;return e(Y,{className:"text-center",children:e(V,{size:"sm",variant:N>0?"flat":"bordered",color:N>0?"warning":"default",className:"min-w-8",children:N})})}return e(Y,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},Ge=be.memo(({title:w,allUsers:g})=>{const i=ne(),u=E(i.breakpoints.down("sm"));E(i.breakpoints.down("md"));const[x,$]=n.useState(!1),{auth:R}=ge().props,[v,T]=n.useState([]),[j,C]=n.useState([]),[D,I]=n.useState([]),[L,H]=n.useState(0),[t,f]=n.useState(0),[h,b]=n.useState(""),[p,N]=n.useState(30),[k,r]=n.useState(1),[m,P]=n.useState({currentMonth:l().format("YYYY-MM")}),[o,ie]=n.useState({totalEmployees:0,totalWorkingDays:0,totalDaysInMonth:0,holidaysCount:0,weekendsCount:0,presentDays:0,absentDays:0,lateArrivals:0,attendancePercentage:0,averageWorkHours:0,overtimeHours:0,totalWorkHours:0,totalLeaveDays:0,leaveBreakdown:{},presentToday:0,absentToday:0,lateToday:0,month:"",generated_at:null});l(`${m.currentYear}-${m.currentMonth}-01`).daysInMonth();const ce=n.useCallback((s,M)=>{P(y=>({...y,[s]:M}))},[]),de=async(s=1,M=30,y)=>{$(!0);try{const c=y.currentMonth?l(y.currentMonth).format("MM"):l().format("MM"),G=y.currentMonth?l(y.currentMonth).year():l().year(),A=await W.get(route("attendancesAdmin.paginate"),{params:{page:s,perPage:M,employee:h,currentYear:G,currentMonth:c}});T(A.data.data),H(A.data.total),f(A.data.last_page),I(A.data.leaveTypes),C(A.data.leaveCounts);const Z=await W.get(route("attendance.monthlyStats"),{params:{currentYear:G,currentMonth:c}});Z.data.success&&ie(Z.data.data)}catch(c){console.error(c),Ne.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}})}finally{$(!1)}},me=s=>{const M=s.target.value.toLowerCase();b(M)};n.useEffect(()=>{de(k,p,m)},[k,p,m,h]);const he=s=>{r(s)},pe=async()=>{try{const s=m.currentMonth?l(m.currentMonth).format("YYYY-MM"):l().format("YYYY-MM"),M=await W.get(route("attendance.exportAdminExcel"),{params:{month:s},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([M.data])),c=document.createElement("a");c.href=y,c.download=`Admin_Attendance_${s}.xlsx`,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(y)}catch(s){console.error("Download failed:",s),alert("Failed to download attendance sheet.")}},ue=async()=>{try{const s=m.currentMonth?l(m.currentMonth).format("YYYY-MM"):l().format("YYYY-MM"),M=await W.get(route("attendance.exportAdminPdf"),{params:{month:s},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([M.data],{type:"application/pdf"})),c=document.createElement("a");c.href=y,c.download=`Admin_Attendance_${s}.pdf`,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(y)}catch(s){console.error("PDF download failed:",s),alert("Failed to download attendance PDF.")}},fe=n.useMemo(()=>[{title:"Total Employees",value:o.totalEmployees,icon:e(xe,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Working Days",value:o.totalWorkingDays,icon:e(K,{}),color:"text-indigo-600",iconBg:"bg-indigo-500/20",description:`This month (${o.month})`},{title:"Present Today",value:o.presentToday,icon:e(We,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:o.presentToday>0?`${(o.presentToday/o.totalEmployees*100).toFixed(1)}% of employees`:"No attendance yet"},{title:"Absent Today",value:o.absentToday,icon:e(Be,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:o.absentToday>0?`${(o.absentToday/o.totalEmployees*100).toFixed(1)}% absent`:"All present"},{title:"Late Today",value:o.lateToday,icon:e(je,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Late arrivals today"},{title:"Attendance Rate",value:`${o.attendancePercentage}%`,icon:e(De,{}),color:"text-emerald-600",iconBg:"bg-emerald-500/20",description:"Monthly average"},{title:"Avg Work Hours",value:`${o.averageWorkHours}h`,icon:e(ee,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Daily average this month"},{title:"Overtime",value:`${o.overtimeHours}h`,icon:e(ee,{}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Total overtime this month"},{title:"Leave Days",value:o.totalLeaveDays,icon:e(B,{}),color:"text-amber-600",iconBg:"bg-amber-500/20",description:"Total leaves this month"}],[o]);return a(we,{children:[e(ye,{title:w}),e(d,{sx:{display:"flex",justifyContent:"center",p:2},children:e(ve,{in:!0,children:e(le,{children:e($e,{title:"Attendance Management",subtitle:"Monitor and manage employee attendance records",icon:e(Ue,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Excel",icon:e(se,{className:"w-4 h-4 text-primary"}),variant:"bordered",onPress:pe,className:"border-primary/30 bg-primary/5 hover:bg-primary/10 text-primary"},{label:"PDF",icon:e(se,{className:"w-4 h-4 text-rose-600"}),variant:"bordered",onPress:ue,className:"border-rose-600/30 bg-rose-600/5 hover:bg-rose-600/10 text-rose-600"}],children:a("div",{className:"p-6",children:[e(Me,{stats:fe,className:"mb-6"}),e("div",{className:"mb-6",children:a("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(te,{label:"Search Employee",type:"text",value:h,onChange:me,placeholder:"Enter employee name...",startContent:e(Ie,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:u?"sm":"md"})}),e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(te,{label:"Month/Year",type:"month",value:m.currentMonth,onChange:s=>ce("currentMonth",s.target.value),startContent:e(K,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:u?"sm":"md"})})]})}),a("div",{className:"bg-white/5 backdrop-blur-md rounded-lg border border-white/10 p-4",children:[e(Qe,{attendanceData:v,currentYear:m.currentYear,currentMonth:m.currentMonth,leaveTypes:D,leaveCounts:j,loading:x}),L>=30&&a("div",{className:"py-4 px-2 flex justify-center items-center",children:[e(He,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:k,total:t,onChange:he,classNames:{wrapper:"bg-white/10 backdrop-blur-md border-white/20",item:"bg-white/5 border-white/10",cursor:"bg-primary/20 backdrop-blur-md"}}),"                                        "]})]})]})})})})})]})});Ge.layout=w=>e(ke,{children:w});export{Ge as default};
