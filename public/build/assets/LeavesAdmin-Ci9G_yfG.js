import{J as Le,r as s,a as A,j as a,b as c,e as R,Q as Ae,h as Re,c as O,F as je}from"./app-BZvX8riX.js";import{u as De,a as U,j,b as Ee,c as ee,T as d,B as ae,G as Te,i as te,k as se,A as Ye}from"./App-D2PTpgr-.js";import{P as Be}from"./PageHeader-CwyyoqfD.js";import{S as ze}from"./StatsCards-XKoSKlCV.js";import{L as re,D as $e,a as Oe}from"./DeleteLeaveForm-CRphIHMT.js";import{d as q}from"./dayjs.min-JBVFLdXr.js";import{F as qe}from"./CheckCircleIcon-SarcIDbn.js";import{F as Ge}from"./XCircleIcon-BORchtBo.js";import{F as G}from"./ChartBarIcon-D3yAifzP.js";import{F as le}from"./ExclamationTriangleIcon-BykmOhkp.js";import{F as Ie}from"./MagnifyingGlassIcon-DIdA7HFG.js";import{C as Qe}from"./CircularProgress-BxwoYXSq.js";import{F as We}from"./PlusIcon-CS1cNz50.js";import{F as He}from"./DocumentArrowDownIcon-DYzbHb5b.js";import{F as Je}from"./PresentationChartLineIcon-6hQfWmHD.js";import{s as oe,l as ne}from"./chunk-2GIFKCNQ-C-PMyBLX.js";import"./app-DNvvDii_.js";import"./chunk-D5XJWRAV-VorZ02wn.js";import"./PencilIcon-v4sLVMTj.js";import"./TrashIcon-BqvXXD5L.js";import"./XCircleIcon-DIV99hxR.js";import"./UserIcon-AbenJjno.js";import"./CardContent-D5QIS50C.js";import"./colorManipulator-Jo7ooQvy.js";import"./chunk-F3UDT23P-0i50BnDV.js";import"./useHasTabbableChild-mJTNXZ8t.js";import"./chunk-7F3ZLNJ6-xjvXi-Xk.js";import"./chunk-7ZZXWEXF-CNo-6bxW.js";import"./chunk-R6AK6OQ4-C72ufLLr.js";import"./chunk-O5I3QTYU-B3pUaaRP.js";import"./index-CokAva9Y.js";import"./Clear-CbcStar_.js";import"./GlassDialog-Bw827B9A.js";import"./DialogContent-Cach5Oia.js";import"./DialogTitle-C8i6El3v.js";import"./TextField-D0AdkxLz.js";import"./Select-C04t32wG.js";import"./Popover-BNWuiqZD.js";import"./List-BLcxbLyt.js";import"./MenuItem-oDW_Ne-C.js";import"./listItemTextClasses-CoL0HIwP.js";import"./dividerClasses-DqVo4v1U.js";import"./Avatar-CDXeC_OK.js";import"./useSlot-DOANZOe7.js";import"./LoadingButton-CvoUX8pc.js";import"./Button-D3GT0X1j.js";import"./DialogContentText-Bd4jimYt.js";const Ke=({title:D,allUsers:E})=>{var H,J,K,V,X;const{auth:b}=Le().props,I=De(),f=U(I.breakpoints.down("sm"));U(I.breakpoints.down("md"));const[T,x]=s.useState(!1),[y,S]=s.useState([]),[Y,i]=s.useState(),[ie,p]=s.useState(0),[ce,u]=s.useState(0),[_,Q]=s.useState(),[W,w]=s.useState(""),[r,de]=s.useState({employee:"",selectedMonth:q().format("YYYY-MM"),status:"all",leaveType:"all",department:"all"}),[P,B]=s.useState({perPage:30,currentPage:1}),v=s.useCallback((e,t)=>{if(e==="year"){const l=Number(t);if(l<1900||l>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}de(l=>({...l,[e]:t})),B(l=>({...l,currentPage:1}))},[]),[k,me]=s.useState({pending:0,approved:0,rejected:0,total:0}),M=((H=b.permissions)==null?void 0:H.includes("leaves.view"))||!1,N=((J=b.permissions)==null?void 0:J.includes("leaves.approve"))||!1,pe=((K=b.permissions)==null?void 0:K.includes("leaves.create"))||!1,ue=((V=b.permissions)==null?void 0:V.includes("leaves.update"))||!1,ve=((X=b.permissions)==null?void 0:X.includes("leaves.delete"))||!1,he=s.useMemo(()=>[{key:"all",label:"All Status",value:"all"},{key:"pending",label:"Pending",value:"pending"},{key:"approved",label:"Approved",value:"approved"},{key:"rejected",label:"Rejected",value:"rejected"},{key:"new",label:"New",value:"new"}],[]),ge=s.useMemo(()=>{const e=[{key:"all",label:"All Types",value:"all"}];if(!y.leaveTypes)return e;const t=y.leaveTypes.map(l=>({key:l.type.toLowerCase(),label:l.type,value:l.type.toLowerCase()}));return[...e,...t]},[y.leaveTypes]),be=s.useCallback(e=>{F(t=>({...t,[e]:!0}))},[]),fe=s.useCallback((e,t)=>{Q({id:e}),F(l=>({...l,[t]:!0}))},[]),ye=s.useCallback(e=>{v("employee",e.target.value.toLowerCase())},[v]),z=s.useCallback(e=>{v("selectedMonth",e.target.value)},[v]),we=s.useCallback(e=>{B(t=>({...t,currentPage:e}))},[]),ke=s.useCallback(e=>{B(t=>({...t,perPage:e,currentPage:1}))},[]),m=s.useCallback(async()=>{var e,t,l;x(!0);try{const o=await A.get(route("leaves.paginate"),{params:{page:P.currentPage,perPage:P.perPage,employee:r.employee,month:r.selectedMonth,status:r.status!=="all"?r.status:void 0,leave_type:r.leaveType!=="all"?r.leaveType:void 0,department:r.department!=="all"?r.department:void 0}});if(o.status===200){const{leaves:n,leavesData:C}=o.data;n.data&&Array.isArray(n.data)?(i(n.data),p(n.total||n.data.length),u(n.last_page||1)):Array.isArray(n)?(i(n),p(n.length),u(1)):(console.error("Unexpected leaves data format:",n),i([]),p(0),u(1)),S(C),w(""),x(!1)}}catch(o){if(console.error("Error fetching leaves data:",o.response),((e=o.response)==null?void 0:e.status)===404){const{leavesData:n}=o.response.data;S(n),w(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.message)||"No leaves found for the selected criteria.")}else w("Error retrieving leaves data. Please try again.");i(!1),x(!1)}},[r]),h=s.useCallback(async()=>{var e,t,l;try{const o=await A.get(route("leaves.stats"),{params:{month:r.selectedMonth}});if(o.status===200){const{stats:n}=o.data;me(n)}}catch(o){console.error("Error fetching leaves data:",o.response),((e=o.response)==null?void 0:e.status)===404?w(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.message)||"No leaves found for the selected criteria."):w("Error retrieving leaves data. Please try again."),x(!1)}},[r]),Me=s.useCallback(async e=>{if(N)try{(await A.post(route("leaves.bulk-approve"),{leave_ids:e})).status===200&&(m(),j.success("Selected leaves approved successfully"))}catch(t){console.error("Error bulk approving leaves:",t),j.error("Failed to approve selected leaves")}},[N,m]),Ne=s.useCallback(async e=>{if(N)try{(await A.post(route("leaves.bulk-reject"),{leave_ids:e})).status===200&&(m(),j.success("Selected leaves rejected successfully"))}catch(t){console.error("Error bulk rejecting leaves:",t),j.error("Failed to reject selected leaves")}},[N,m]),Ce=s.useMemo(()=>[{title:"Pending",value:k.pending,icon:a(Ee,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Awaiting approval"},{title:"Approved",value:k.approved,icon:a(qe,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Successfully approved"},{title:"Rejected",value:k.rejected,icon:a(Ge,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Declined requests"},{title:"Total",value:k.total,icon:a(G,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All leave requests"}],[k]);if(!M)return a(ae,{sx:{display:"flex",justifyContent:"center",p:2},children:a(ee,{children:c(R,{className:"p-8 text-center",children:[a(le,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),a(d,{variant:"h6",className:"mb-2",children:"Access Denied"}),a(d,{variant:"body2",color:"textSecondary",children:"You don't have permission to view leave management."})]})})});const[g,F]=s.useState({add_leave:!1,edit_leave:!1,delete_leave:!1}),xe=s.useRef(null),Se=s.useCallback(e=>{F(t=>({...t,[e]:!0}))},[]),$=s.useCallback(e=>{F(t=>({...t,[e]:!1}))},[]),L=s.useCallback(e=>[...e].sort((t,l)=>new Date(t.from_date)-new Date(l.from_date)),[]),_e=s.useCallback(e=>{const l=q(e.from_date).format("YYYY-MM")===r.selectedMonth,o=!r.employee||String(r.employee)===String(e.user_id);!l||!o||i(n=>{const C=[...n,e];return L(C)})},[L,r.selectedMonth,r.employee]),Pe=s.useCallback(e=>{const l=q(e.from_date).format("YYYY-MM")===r.selectedMonth,o=!r.employee||String(r.employee)===String(e.user_id);!l||!o||i(n=>{const C=n.map(Z=>Z.id===e.id?e:Z);return L(C)})},[L,r.selectedMonth,r.employee]),Fe=s.useCallback(e=>{i(t=>t.filter(l=>l.id!==e))},[]);return s.useEffect(()=>{M&&m()},[h,M]),s.useEffect(()=>{M&&h()},[m,M]),c(je,{children:[a(Ae,{title:D}),g.add_leave&&a(re,{open:g.add_leave,closeModal:()=>$("add_leave"),leavesData:y,setLeavesData:S,currentLeave:null,allUsers:E,setTotalRows:p,setLastPage:u,setLeaves:i,handleMonthChange:z,employee:r.employee,selectedMonth:r.selectedMonth,addLeaveOptimized:_e,fetchLeavesStats:h}),g.edit_leave&&a(re,{open:g.edit_leave,closeModal:()=>$("edit_leave"),leavesData:y,setLeavesData:S,currentLeave:_,allUsers:E,setTotalRows:p,setLastPage:u,setLeaves:i,handleMonthChange:z,employee:r.employee,selectedMonth:r.selectedMonth,updateLeaveOptimized:Pe,fetchLeavesStats:h}),g.delete_leave&&a($e,{open:g.delete_leave,closeModal:()=>$("delete_leave"),leaveId:_==null?void 0:_.id,setLeaves:i,setTotalRows:p,setLastPage:u,deleteLeaveOptimized:Fe,fetchLeavesStats:h}),a(ae,{sx:{display:"flex",justifyContent:"center",p:2},children:a(Te,{in:!0,children:a(ee,{children:a(Be,{title:"Leave Management",subtitle:"Manage employee leave requests and approvals",icon:a(Je,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[...pe?[{label:"Add Leave",icon:a(We,{className:"w-4 h-4"}),onPress:()=>Se("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],{label:"Export",icon:a(He,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:c("div",{className:"p-6",children:[a(ze,{stats:Ce}),a("div",{className:"mb-6",children:c("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(te,{label:"Month/Year",type:"month",value:r.selectedMonth,onChange:z,startContent:a(se,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:f?"sm":"md"})}),a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(te,{label:"Search Employee",placeholder:"Enter name or ID...",value:r.employee,onChange:ye,startContent:a(Ie,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:f?"sm":"md"})}),a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(oe,{label:"Leave Status",selectedKeys:[r.status],onSelectionChange:e=>v("status",Array.from(e)[0]),variant:"bordered",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:f?"sm":"md",children:he.map(e=>a(ne,{value:e.value,children:e.label},e.key))})}),a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(oe,{label:"Leave Type",selectedKeys:[r.leaveType],onSelectionChange:e=>v("leaveType",Array.from(e)[0]),variant:"bordered",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:f?"sm":"md",children:ge.map(e=>a(ne,{value:e.value,children:e.label},e.key))})}),a("div",{className:"flex gap-2",children:a(Re,{variant:"flat",color:"primary",size:f?"sm":"md",onPress:m,isLoading:T,startContent:!T&&a(G,{className:"w-4 h-4"}),children:"Refresh"})})]})}),c("div",{className:"min-h-96",children:[c(d,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(G,{className:"w-5 h-5"}),"Leave Requests Management"]}),T?a(O,{className:"bg-white/10 backdrop-blur-md border-white/20",children:c(R,{className:"text-center py-12",children:[a(Qe,{size:40}),a(d,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):Y&&Y.length>0?a("div",{className:"overflow-hidden rounded-lg",children:a(Oe,{ref:xe,totalRows:ie,lastPage:ce,setCurrentPage:we,setPerPage:ke,perPage:P.perPage,currentPage:P.currentPage,handleClickOpen:fe,setCurrentLeave:Q,openModal:be,leaves:Y,allUsers:E,setLeaves:i,employee:r.employee,selectedMonth:r.selectedMonth,isAdminView:!0,onBulkApprove:Me,onBulkReject:Ne,canApproveLeaves:N,canEditLeaves:ue,canDeleteLeaves:ve,fetchLeavesStats:h})}):W?a(O,{className:"bg-white/10 backdrop-blur-md border-white/20",children:c(R,{className:"text-center py-12",children:[a(le,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),a(d,{variant:"h6",className:"mb-2",children:"No Data Found"}),a(d,{color:"textSecondary",children:W})]})}):a(O,{className:"bg-white/10 backdrop-blur-md border-white/20",children:c(R,{className:"text-center py-12",children:[a(se,{className:"w-16 h-16 text-default-400 mx-auto mb-4"}),a(d,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),a(d,{color:"textSecondary",children:"No leave records found for the selected criteria."})]})})]})]})})})})})]})};Ke.layout=D=>a(Ye,{children:D});export{Ke as default};
