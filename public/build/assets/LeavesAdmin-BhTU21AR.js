import{V as ne,j as s,a as e,F as G,M as he}from"./app-B0EkXB6P.js";import{u as ie,r,W as de,T as $,c as ge,G as g,F as ae,k as te,S as re,M as H,U as se,b as W,B as K,X as ye,Y as ce,Z as ue,t as ee,$ as be,f as Q,e as fe,h as ve,a as oe}from"./vendor-DG6x5ItM.js";import{d as Ce}from"./Search-C09yah2e.js";import{B as pe,G as xe,A as De}from"./App-Lcca0Ucc.js";import{L as Se}from"./LeaveEmployeeTable-Dep3e3p2.js";import{d as ke,G as me}from"./GlassDialog-CUJi_Q68.js";import{L as Te}from"./LoadingButton-D7xyitX5.js";import{d as Pe}from"./dayjs.min-DoTx5zCQ.js";import{A as _e}from"./Add-BAkyKogE.js";import{i as le}from"./chunk-HJTJQZF3-fM_PQaBX.js";import"./Edit-C7Y0JyE7.js";import"./chunk-F3UDT23P-DfbpX8wK.js";import"./chunk-MZRCPRP2-C0G3_1Rf.js";import"./chunk-SLABUSGS-B6gW2mYM.js";import"./chunk-7F3ZLNJ6-DcgTPguD.js";import"./chunk-YHY32LNM-CCJ1ikQC.js";import"./chunk-CSXHODZI-DGasHezh.js";import"./chunk-7JXO3E7I-DWqOUYhX.js";import"./chunk-2BFF5KFD-BBpGbtWI.js";import"./chunk-4EXC76WE-QXgUf1V8.js";import"./chunk-R6AK6OQ4-Czh6rNaR.js";const we=({open:C,closeModal:y,leavesData:h,setLeavesData:f,currentLeave:a,allUsers:x,setTotalRows:w,setLastPage:p,setLeaves:D,handleMonthChange:m,employee:V})=>{const{auth:R}=ne().props,o=ie(),[S,X]=r.useState((a==null?void 0:a.user_id)||R.user.id),[b,k]=r.useState(h.leaveTypes||[]),[F,T]=r.useState(h.leaveCounts||[]),[P,E]=r.useState((a==null?void 0:a.leave_type)||(b.length>0?b[0].type:"")),[_,I]=r.useState((a==null?void 0:a.from_date)||""),[B,Z]=r.useState((a==null?void 0:a.to_date)||""),[U,M]=r.useState((a==null?void 0:a.no_of_days)||""),[A,Y]=r.useState(""),[j,z]=r.useState((a==null?void 0:a.reason)||""),[n,N]=r.useState({}),[O,i]=r.useState(!1),[L,q]=r.useState("");return r.useEffect(()=>{h&&(k(h.leaveTypes||[]),T(h.leaveCountsByUser[S]||[]))},[h,S]),r.useEffect(()=>{var c;const t=((c=F==null?void 0:F.find(u=>u.leave_type===P))==null?void 0:c.days_used)||0;q(t);const d=b==null?void 0:b.find(u=>u.type===P);d&&Y(d.days-t)},[P,F,b]),r.useEffect(()=>{M(((d,c)=>{if(!d||!c)return"";const u=new Date(d),l=new Date(c);if(u>l)return"";const v=l.getTime()-u.getTime();return Math.ceil(v/(1e3*3600*24))+1})(_,B))},[_,B]),s(me,{open:C,onClose:y,fullWidth:!0,maxWidth:"sm",children:[s(de,{sx:{display:"flex",alignItems:"center"},children:[e($,{variant:"h6",children:"Add Leave"}),e(ge,{onClick:y,sx:{position:"absolute",top:8,right:16},children:e(ke,{})})]}),s("form",{onSubmit:async t=>{t.preventDefault(),i(!0);const d=new Promise(async(c,u)=>{try{const l={route:route().current(),user_id:S,leaveType:P,fromDate:_,toDate:B,daysCount:U,leaveReason:j,employee:V};a&&(l.id=a.id);const v=await axios.post(route("leave-add"),l);v.status===200&&(f(v.data.leavesData),w(v.data.leavesData.leaveRecords.total),p(v.data.leavesData.leaveRecords.last_page),D(v.data.leavesData.leaveRecords.data),m({target:{value:_.slice(0,7)}}),y(),c([v.data.message||"Leave application submitted successfully"]))}catch(l){console.error(l),i(!1),l.response?(l.response.status===422?(N(l.response.data.errors||{}),u(l.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(l.response.data.error)):l.request?(u("No response received from the server. Please check your internet connection."),console.error(l.request)):(u("An error occurred while setting up the request."),console.error("Error",l.message))}finally{i(!1)}});pe.promise(d,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(ee,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:c}){return e(G,{children:c.map((u,l)=>e("div",{children:u},l))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:c}){return e(G,{children:c})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(ce,{children:s(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,md:6,children:s(ae,{fullWidth:!0,children:[e(te,{id:"leave-type-label",children:"Leave Type"}),s(re,{labelId:"leave-type-label",value:P,onChange:t=>E(t.target.value),label:"Leave Type",error:!!n.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(H,{value:"",disabled:!0,children:"Select Leave Type"}),b.map(t=>s(H,{value:t.type,children:[t.type," ",t.days," Days"]},t.id))]}),e(se,{children:n.leaveType})]})}),e(g,{item:!0,xs:12,md:6,children:e(W,{label:"From",type:"date",fullWidth:!0,value:_,onChange:t=>I(t.target.value),InputLabelProps:{shrink:!0},error:!!n.fromDate,helperText:n.fromDate})}),e(g,{item:!0,xs:12,md:6,children:e(W,{label:"To",type:"date",fullWidth:!0,value:B,onChange:t=>Z(t.target.value),InputLabelProps:{shrink:!0},error:!!n.toDate,helperText:n.toDate})}),e(g,{item:!0,xs:12,md:6,children:e(W,{label:"Number of days",type:"text",fullWidth:!0,value:U,InputProps:{readOnly:!0},error:!!n.daysCount,helperText:n.daysCount})}),e(g,{item:!0,xs:12,md:6,children:e(W,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:A,InputProps:{readOnly:!0},error:!!n.remainingLeaves,helperText:n.remainingLeaves})}),R.roles.includes("Administrator")&&route().current()==="leaves"&&e(g,{item:!0,xs:12,md:6,children:s(ae,{fullWidth:!0,children:[e(te,{id:"leave-employee-label",children:"Employee"}),s(re,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:S||"na",error:!!n.user_id,onChange:t=>X(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(H,{value:"na",disabled:!0,children:"Please select"}),x.map(t=>e(H,{value:t.id,children:s(K,{sx:{display:"flex"},children:[e(ye,{src:t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(se,{children:n.user_id})]})}),e(g,{item:!0,xs:12,children:e(W,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:j,onChange:t=>z(t.target.value),error:!!n.leaveReason,helperText:n.leaveReason})})]})}),e(ue,{sx:{padding:"16px",justifyContent:"center"},children:e(Te,{type:"submit",variant:"outlined",color:"primary",loading:O,disabled:O,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Fe=({open:C,handleClose:y,leaveIdToDelete:h,setLeavesData:f})=>{const a=ie();return s(me,{open:C,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(de,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(ce,{children:e(be,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),s(ue,{children:[e(Q,{onClick:y,color:"primary",children:"Cancel"}),e(Q,{onClick:()=>{const w=new Promise(async(p,D)=>{try{const m=await axios.delete(route("leave-delete",{id:h,route:route().current()}));m.status===200&&(f(m.data.leavesData),p("Leave application deleted successfully"))}catch(m){console.error("Error deleting task:",m),D(m.response.data.error||"Failed to delete leave application")}finally{y()}});pe.promise(w,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(ee,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},success:{render({data:p}){return e(G,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},error:{render({data:p}){return e(G,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ee=({title:C,allUsers:y})=>{ne();const[h,f]=r.useState(!1),[a,x]=r.useState(null),[w,p]=r.useState([]),[D,m]=r.useState(),[V,R]=r.useState(0),[o,S]=r.useState(0),[X,b]=r.useState(null),[k,F]=r.useState(""),[T,P]=r.useState(Pe().format("YYYY-MM")),[E,_]=r.useState(30),[I,B]=r.useState(1),[Z,U]=r.useState(),[M,A]=r.useState(""),Y=i=>x(i),j=r.useCallback((i,L)=>{b(i),x(L)},[]),z=r.useCallback(()=>{x(null),b(null)},[]),n=i=>F(i.target.value.toLowerCase()),N=i=>{P(i.target.value)},O=async()=>{var i,L,q,J;try{const t=await axios.get(route("leaves.paginate"),{params:{page:I,perPage:E,employee:k,month:T}});if(t.status===200){const{leaves:d,leavesData:c}=t.data;m(d.data),p(c),R(d.total),S(d.last_page),A(!1),f(!1)}if(t.status===404){const{leavesData:d}=t.data;p(d),A(((L=(i=M.response)==null?void 0:i.data)==null?void 0:L.message)||"Error retrieving data."),f(!1)}}catch(t){console.error("Error fetching leaves data:",t.response),m(!1),A(((J=(q=t.response)==null?void 0:q.data)==null?void 0:J.message)||"Error retrieving data."),f(!1)}};return r.useEffect(()=>{f(!0),O()},[T,I,E,k]),console.log(w),s(G,{children:[e(he,{title:C}),["add_leave","edit_leave"].includes(a)&&e(we,{setTotalRows:R,setLastPage:S,setLeaves:m,perPage:E,employee:k,currentPage:I,selectedMonth:T,allUsers:y,open:!0,setLeavesData:p,closeModal:()=>x(null),leavesData:w,currentLeave:a==="edit_leave"?Z:null,handleMonthChange:N}),a==="delete_leave"&&e(Fe,{open:!0,handleClose:z,leaveIdToDelete:X,setLeavesData:p}),e(K,{sx:{display:"flex",justifyContent:"center",p:2},children:e(fe,{in:!0,children:s(xe,{children:[e(ve,{title:"Leaves",sx:{padding:"24px"},action:e(Q,{title:"Add Leave",variant:"outlined",color:"success",startIcon:e(_e,{}),onClick:()=>Y("add_leave"),children:"Add Leave"})}),e(oe,{children:s(g,{container:!0,spacing:2,children:[e(g,{item:!0,xs:12,sm:6,md:4,children:e(le,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:k,onChange:n,endContent:e(Ce,{})})}),e(g,{item:!0,xs:12,sm:6,md:4,children:e(le,{label:"Select Month",type:"month",variant:"bordered",onChange:N,value:T,isLoading:h})})]})}),e(oe,{children:h?s(K,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:[e(ee,{sx:{p:1}}),e($,{variant:"body1",align:"center",children:"Loading leaves data..."})]}):D&&D.length>0?e(Se,{totalRows:V,lastPage:o,setCurrentPage:B,setPerPage:_,perPage:E,currentPage:I,handleClickOpen:j,setCurrentLeave:U,openModal:Y,leaves:D,allUsers:y,setLeaves:m,employee:k,selectedMonth:T}):M?e($,{variant:"body1",align:"center",children:M}):e($,{variant:"body1",align:"center",children:"No leaves data found."})})]})})})]})};Ee.layout=C=>e(De,{children:C});export{Ee as default};
