import{q as z,j as s,a as e,F as D,Y as O}from"./app-Dyy-F2b9.js";import{s as Y,v as B,y as K,B as k,r as g,D as Q,T as X,c as _,z as $,A as q,E as R,H as W,J,x as N,K as U,L as V,t as Z,M as ee,N as te,e as re,O as ae,f as oe,a as j,G as M,b as G,F as le,P as ne,S as se,Q as H}from"./vendor-N08UupYT.js";import{B as ie,G as de,A as ce}from"./App-CdC1ZRe-.js";import{X as ue,D as A,u as E,w as pe,d as b,m as me,a as be,A as ge,L as ye,b as he}from"./xlsx-mDc-c6oP.js";import{d as xe,G as ke}from"./GlassDialog-BqlN9hZd.js";import{L as Ce}from"./LoadingButton-QHHPzujN.js";const De=Y(ue)(({theme:o})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{backgroundColor:"transparent",color:o.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","& .rdt_TableRow":{backgroundColor:"transparent",color:o.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${o.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:o.palette.action.hover}}}})),fe=({handleClickOpen:o,allInCharges:y,setDailyWorks:f,reports:P,juniors:d,reports_with_daily_works:S,openModal:m,setCurrentRow:w,filteredData:h,setFilteredData:v})=>{const{auth:l}=z().props,c=B();l.roles.includes("admin"),l.roles.includes("se");const p=[{name:"Date",selector:t=>t.date,sortable:!0,center:!0,width:"100px"},{name:"Total Daily Works",selector:t=>t.totalDailyWorks,sortable:!0,center:!0,width:"160px"},{name:"Resubmissions",selector:t=>t.resubmissions,sortable:!0,center:!0,width:"130px"},{name:"Embankment",selector:t=>t.embankment,sortable:!0,center:!0,width:"130px"},{name:"Structure",selector:t=>t.structure,sortable:!0,center:!0,width:"130px"},{name:"Pavement",selector:t=>t.pavement,sortable:!0,center:!0,width:"130px"},{name:"Completed",selector:t=>t.completed,sortable:!0,center:!0,width:"130px"},{name:"Pending",selector:t=>t.pending,sortable:!0,center:!0,width:"130px"},{name:"Completion Percentage",selector:t=>t.completionPercentage,sortable:!0,center:!0,width:"180px",cell:t=>s(k,{sx:{textAlign:"center",color:t.completionPercentage>=100?"green":"red"},children:[t.completionPercentage,"%"]})},{name:"RFI Submissions",selector:t=>t.rfiSubmissions,sortable:!0,center:!0,width:"160px"},{name:"RFI Submission Percentage",selector:t=>t.rfiSubmissionPercentage,sortable:!0,center:!0,width:"180px",cell:t=>s(k,{sx:{textAlign:"center",color:t.rfiSubmissionPercentage>=100?"green":"red"},children:[t.rfiSubmissionPercentage,"%"]})}];return s(D,{children:[e(K,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:c.palette.text.primary}}}),e(De,{columns:p,data:h,defaultSortField:"date",defaultSortFieldId:1,defaultSortAsc:!1,pagination:!0,highlightOnHover:!0,responsive:!0})]})},Se=({open:o,closeModal:y,filteredData:f,users:P})=>{console.log(P),g.useState(!1);const d=B(),S=[{label:"Date",key:"date"},{label:"Total Daily Works",key:"totalDailyWorks"},{label:"Resubmissions",key:"resubmissions"},{label:"Embankment",key:"embankment"},{label:"Structure",key:"structure"},{label:"Pavement",key:"pavement"},{label:"Completed",key:"completed"},{label:"Pending",key:"pending"},{label:"Completion Percentage",key:"completionPercentage"},{label:"RFI Submissions",key:"rfiSubmissions"},{label:"RFI Submission Percentage",key:"rfiSubmissionPercentage"}],[m,w]=g.useState(S.map(l=>({...l,checked:!0}))),h=l=>{const c=[...m];c[l].checked=!c[l].checked,w(c)},v=async l=>{const c=new Promise((p,t)=>{try{const x=f.map(T=>{const C={};return l.forEach(r=>{r.checked&&(C[r.label]=T[r.key])}),C}),F=E.json_to_sheet(x),i=E.book_new();E.book_append_sheet(i,F,"Daily Work Summary"),pe(i,"DailyWorkSummary.xlsx"),p("Export successful!"),y()}catch(x){t("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",x)}});ie.promise(c,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},success:{render({data:p}){return e(D,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},error:{render({data:p}){return e(D,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}}})};return s(ke,{open:o,onClose:y,children:[s(Q,{style:{cursor:"move"},id:"draggable-dialog-title",children:[e(X,{children:"Export Daily Works"}),e(_,{variant:"outlined",color:"primary",onClick:y,sx:{position:"absolute",top:8,right:16},children:e(xe,{})})]}),e(U,{children:s($,{size:"small",sx:{"& .MuiTableCell-root":{padding:"4px 8px"},"& .MuiCheckbox-root":{padding:"0px"}},children:[e(q,{children:s(R,{children:[e(W,{children:"Column Label"}),e(W,{align:"center",children:"Include in Export"})]})}),e(J,{children:m.map((l,c)=>s(R,{children:[e(W,{children:l.label}),e(W,{align:"center",children:e(N,{checked:l.checked,onChange:()=>h(c)})})]},l.key))})]})}),e(V,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:e(Ce,{sx:{borderRadius:"50px",padding:"6px 16px"},variant:"outlined",color:"primary",type:"submit",onClick:()=>v(m),startIcon:e(A,{}),children:"Download"})})]})};b.extend(me);const L=ee(be)(({theme:o})=>({"& .MuiPaper-root":{backgroundColor:o.glassCard.backgroundColor},"& .MuiInputBase-root":{color:o.palette.text.primary,borderColor:o.palette.divider},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:o.palette.divider},"&:hover fieldset":{borderColor:o.palette.primary.main},"&.Mui-focused fieldset":{borderColor:o.palette.primary.main}},"& .MuiSvgIcon-root":{color:o.palette.text.secondary},"& .MuiPickersDay-root":{color:o.palette.text.primary,"&.Mui-selected":{backgroundColor:o.palette.primary.main,color:o.palette.primary.contrastText},"&.MuiPickersDay-today":{borderColor:o.palette.primary.main}}})),Ie=({auth:o,title:y,summary:f,jurisdictions:P,inCharges:d})=>{const S=B(),[m,w]=g.useState(f),[h,v]=g.useState(f),l=m.map(r=>b(r.date)),[c,p]=g.useState(null),t=te(S.breakpoints.down("md"));console.log(m,h);const x=r=>{p(r)},F=()=>{p(null)},[i,T]=g.useState({startDate:b.min(...l),endDate:b.max(...l),status:"all",incharge:"all"}),C=(r,I)=>{T(a=>({...a,[r]:I}))};return g.useEffect(()=>{(!i.startDate||!i.endDate)&&T(r=>({...r,startDate:b.min(...l),endDate:b.max(...l)}))},[l]),g.useEffect(()=>{const I=m.filter(a=>b(a.date).isBetween(i.startDate,i.endDate,null,"[]")&&(i.incharge==="all"||!i.incharge||a.incharge===i.incharge)).reduce((a,u)=>{const n=b(u.date).format("YYYY-MM-DD");return a[n]?(a[n].totalDailyWorks+=u.totalDailyWorks,a[n].resubmissions+=u.resubmissions,a[n].embankment+=u.embankment,a[n].structure+=u.structure,a[n].pavement+=u.pavement,a[n].pending+=u.pending,a[n].completed+=u.completed,a[n].rfiSubmissions+=u.rfiSubmissions,a[n].completionPercentage=a[n].totalDailyWorks>0?a[n].completed/a[n].totalDailyWorks*100:0,a[n].rfiSubmissionPercentage=a[n].totalDailyWorks>0?a[n].rfiSubmissions/a[n].totalDailyWorks*100:0):a[n]={...u},a},{});v(Object.values(I))},[i,m]),s(ce,{children:[e(O,{title:y}),c==="exportDailyWorkSummary"&&e(Se,{open:c==="exportDailyWorkSummary",closeModal:F,filteredData:h}),e(k,{sx:{display:"flex",justifyContent:"center",p:2},children:e(re,{in:!0,children:s(de,{children:[e(ae,{title:y,sx:{padding:"24px"},action:s(k,{display:"flex",gap:2,children:[o.permissions.includes("addTask")&&e(_,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:e(ge,{})}),o.roles.includes("admin")&&e(D,{children:t?e(D,{children:e(_,{title:"Export Daily Works",color:"success",onClick:()=>x("exportDailyWorkSummary"),children:e(A,{})})}):e(D,{children:e(oe,{title:"Export Daily Works",variant:"outlined",color:"success",startIcon:e(A,{}),onClick:()=>x("exportDailyWorkSummary"),children:"Export"})})})]})}),e(j,{children:e(k,{children:s(M,{container:!0,spacing:3,children:[e(M,{item:!0,xs:12,sm:6,md:3,sx:{paddingTop:"8px !important"},children:e(ye,{dateAdapter:he,children:s(k,{display:"flex",alignItems:"center",children:[e(L,{label:"Start date",value:i.startDate,onChange:r=>C("startDate",r),textField:r=>e(G,{...r,fullWidth:!0,size:"small"})}),e(k,{sx:{mx:1},children:" to "}),e(L,{label:"End date",value:i.endDate,onChange:r=>C("endDate",r),textField:r=>e(G,{...r,fullWidth:!0,size:"small"})})]})})}),o.roles.includes("admin")&&e(M,{item:!0,xs:6,sm:4,md:3,sx:{paddingTop:"8px !important"},children:s(le,{fullWidth:!0,children:[e(ne,{id:"incharge-label",children:"Incharge"}),s(se,{variant:"outlined",labelId:"incharge-label",label:"Incharge",name:"incharge",value:i.incharge,onChange:r=>C("incharge",r.target.value),children:[e(H,{value:"all",children:"All"}),d.map(r=>e(H,{value:r.id,children:r.name},r.id))]})]})})]})})}),e(j,{children:e(fe,{filteredData:h,openModal:x})})]})})})]})};export{Ie as default};
