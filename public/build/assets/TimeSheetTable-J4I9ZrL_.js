import{V as $,a as e,j as s,F as j}from"./app-C1WntmjD.js";import{g as A,r as a,G as o,e as F,h as I,T as m,a as L,B as d,i as G,j as he,f as pe}from"./vendor-BNH6533b.js";import{G as O}from"./App-12Z14cay.js";import{d as T}from"./dayjs.min-Q3DE0Veq.js";import{d as xe}from"./Search-DNe4kiYU.js";import{s as ge}from"./chunk-4EXC76WE-BaBultbA.js";import{a as fe,u as ye}from"./chunk-R6AK6OQ4-DVPnVZ9c.js";import{i as U}from"./chunk-HJTJQZF3-BnX5DVB_.js";import{t as Se,a as _e,b as be,c as ve,d as we,e as u}from"./chunk-F3UDT23P-B7Z6A6B_.js";import{p as Ce}from"./chunk-YHY32LNM-Dg5_JLUV.js";const He=({handleDateChange:Y,selectedDate:x,updateTimeSheet:z})=>{const{auth:g}=$().props,{url:l}=$();A("(max-width: 640px)");const B=A("(min-width: 641px) and (max-width: 1024px)"),V=A("(min-width: 1025px)"),[W,Q]=a.useState([]),[q,J]=a.useState([]),[f,N]=a.useState([]),[P,E]=a.useState(""),[K,X]=a.useState(0),[Z,ee]=a.useState(0),[te,Me]=a.useState(10),[D,re]=a.useState(1),[k,ne]=a.useState(""),[_,ae]=a.useState({currentMonth:T().format("YYYY-MM")}),se=t=>{const n=t.target.value.toLowerCase();ne(n)},[b,H]=a.useState(2),v=a.useRef(null),w=a.useRef(null),C=()=>{if(v.current&&w.current){const t=v.current.clientHeight,n=w.current.clientHeight,r=t-150,h=Math.floor(r/n);H(h)}},ie=()=>{H(t=>t+2)},oe=t=>q.find(n=>String(n.user_id)===String(t)),le=async(t,n,r,h,c)=>{var y,M,p,S;const R=l!=="/attendance-employee"?route("getAllUsersAttendanceForDate"):route("getCurrentUserAttendanceForDate");try{const i=await axios.get(R,{params:{page:n,perPage:r,employee:h,date:t,currentYear:c.currentMonth?T(c.currentMonth).year():"",currentMonth:c.currentMonth?T(c.currentMonth).format("MM"):""}});i.status===200&&(Q(i.data.attendances),J(i.data.leaves),N(i.data.absent_users),X(i.data.total),ee(i.data.last_page),E(""))}catch(i){console.error("Error fetching attendance data:",i),E(((M=(y=i.response)==null?void 0:y.data)==null?void 0:M.message)||"An error occurred while retrieving attendance data."),N((S=(p=i.response)==null?void 0:p.data)==null?void 0:S.absent_users)}},ce=(t,n)=>{var r,h,c;switch(n){case"date":return e(u,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:new Date(t.date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})});case"employee":return e(u,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base lg:text-lg",children:e(ye,{avatarProps:{radius:"lg",size:V||B?"md":"sm",src:(r=t.user)==null?void 0:r.profile_image},description:(h=t.user)==null?void 0:h.phone,name:(c=t.user)==null?void 0:c.name})});case"clockin_time":return e(u,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:t.punchin_time?new Date(`2024-06-04T${t.punchin_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"});case"clockout_time":return e(u,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:t.punchout_time?new Date(`2024-06-04T${t.punchout_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"});case"production_time":if(t.punchin_time&&t.punchout_time){const y=new Date(`2024-06-04T${t.punchin_time}`),p=new Date(`2024-06-04T${t.punchout_time}`)-y,S=Math.floor(p/(1e3*60*60)),i=Math.floor(p%(1e3*60*60)/(1e3*60));return e(u,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:`${S}h ${i}m`})}return e(u,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:"N/A"});default:return e(u,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:"N/A"})}},me=[{name:"Date",uid:"date"},...g.roles.includes("Administrator")&&l!=="/attendance-employee"?[{name:"Employee",uid:"employee"}]:[],{name:"Clockin Time",uid:"clockin_time"},{name:"Clockout Time",uid:"clockout_time"},{name:"Production Time",uid:"production_time"}],de=t=>{re(t)},ue=a.useCallback((t,n)=>{ae(r=>({...r,[t]:n}))},[]);return a.useEffect(()=>(setTimeout(()=>{C()},500),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)),[]),a.useEffect(()=>{le(x,D,te,k,_)},[z]),e(d,{sx:{display:"flex",justifyContent:"center",p:2},children:s(o,{container:!0,spacing:2,children:[e(o,{item:!0,xs:12,md:l!=="/attendance-employee"?9:12,children:e(F,{in:!0,children:s(O,{children:[e(I,{title:e(m,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:l==="/attendance-employee"?"Timesheet for the month of "+new Date(_.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"}):"Timesheet of "+new Date(x).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}),sx:{padding:"24px"}}),e(L,{children:e(d,{children:s(o,{container:!0,spacing:2,children:[g.roles.includes("Administrator")&&l!=="/attendance-employee"&&s(j,{children:[e(o,{item:!0,xs:12,sm:6,md:4,children:e(U,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:k,onChange:se,endContent:e(xe,{})})}),e(o,{item:!0,xs:12,sm:6,md:4,children:e(U,{label:"Select Date",type:"date",variant:"bordered",onChange:Y,value:new Date(x).toISOString().slice(0,10)||""})})]}),g.roles.includes("Employee")&&l==="/attendance-employee"&&e(o,{item:!0,xs:12,sm:6,md:4,children:e(U,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:_.currentMonth,onChange:t=>ue("currentMonth",t.target.value)})})]})})}),e(L,{children:P?e(m,{color:"error",children:P}):s("div",{style:{maxHeight:"84vh"},children:[e(ge,{orientation:"horizontal",className:"overflow-y-hidden",children:s(Se,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Attendance Table",isHeaderSticky:!0,children:[e(_e,{columns:me,children:t=>e(be,{align:"start",children:t.name},t.uid)}),e(ve,{items:W,children:t=>e(we,{children:n=>ce(t,n)},t.id)})]},z)}),K>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(Ce,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:D,total:Z,onChange:de})})]})})]})})}),g.roles.includes("Administrator")&&l!=="/attendance-employee"&&f.length>0&&e(o,{item:!0,xs:12,md:3,children:e(F,{in:!0,children:s(O,{ref:v,children:[e(I,{title:s(d,{sx:{display:"flex",alignItems:"center"},children:[e(m,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:"Absent on "+new Date(x).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e(G,{sx:{ml:1,fontSize:{xs:"0.8rem",sm:"1.1rem",md:"1.4rem"}},label:f.length,variant:"outlined",color:"error",size:"small"})]})}),e(L,{children:s(d,{children:[f.slice(0,b).map((t,n)=>{const r=oe(t.id);return e(he,{in:n<b,timeout:"auto",unmountOnExit:!0,children:e(d,{ref:w,sx:{mb:2,p:2,border:"1px solid #e0e0e0",borderRadius:2},children:s(o,{container:!0,alignItems:"center",children:[e(o,{item:!0,xs:12,children:s(d,{sx:{display:"flex",alignItems:"center"},children:[e(fe,{src:t.profile_image,alt:t.name}),e(m,{sx:{m:2,fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:t.name})]})}),r?s(j,{children:[s(o,{item:!0,xs:6,children:[e(m,{sx:{fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:r.from_date===r.to_date?r.from_date:`${r.from_date} to ${r.to_date}`}),e(m,{sx:{fontSize:{xs:"0.8rem",sm:"1.0rem",md:"1.2rem"}},color:"textSecondary",children:"On "+r.leave_type+" Leave"})]}),e(o,{item:!0,xs:6,sx:{textAlign:"right"},children:e(G,{label:r.status,variant:"outlined",color:r.status==="Pending"?"error":"success",size:"small"})})]}):e(o,{item:!0,xs:12,children:e(m,{color:"error",sx:{fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:"Absent without Leave"})})]})})},n)}),b<f.length&&e(d,{textAlign:"center",children:e(pe,{variant:"outlined",onClick:ie,children:"Load More"})})]})})]})})})]})})};export{He as T};
