import{J as le,r as i,j as e,b as n,s as Ce,f as $,F as Ne,a as k,Q as Pe}from"./app-MpRbYhkS.js";import{aA as Q,ap as Se,aq as Te,ar as G,as as Fe,h as Ae,aw as Ee,u as ce,a as q,T as A,aB as de,I as me,f as M,S as Ie,aC as Me,aD as ke,r as N,B as H,m as Re,G as Be,e as $e,i as je,p as ze,A as Le}from"./App-ChX5VV_r.js";import{P as Oe}from"./PageHeader-CC10cuU_.js";import{S as We}from"./StatsCards-CJ5Ssr_v.js";import"./dayjs.min-CJrLyVxQ.js";import{N as Ge}from"./NoDataMessage-C8AKZj8u.js";import{F as ae}from"./EyeIcon-C4TRlYWU.js";import{F as se}from"./PencilIcon-Cak8D3Xc.js";import{F as re}from"./TrashIcon-CM3pcnfe.js";import{F as Ve}from"./EllipsisVerticalIcon-DNOdx7A-.js";import{F as ue}from"./CheckCircleIcon-BmWdTM3l.js";import{F as he}from"./XCircleIcon-B4LCdjsW.js";import{a as Qe,b as qe,c as He,d as Ue,e as Ye,t as Je}from"./chunk-F3UDT23P-DKqst6lu.js";import{p as Xe}from"./chunk-O5I3QTYU-BaX5EXwf.js";import{t as V}from"./chunk-7ZZXWEXF-7AMtdiwt.js";import{G as Ze}from"./GlassDialog-CrLmwJCc.js";import{D as pe}from"./DialogTitle-B87vulL7.js";import{D as j}from"./Divider-mBuyDOBJ.js";import{T as Ke,F as ne}from"./TextField-UdoyefGR.js";import{I as et}from"./InputLabel-CPjNQET0.js";import{S as tt}from"./Select-yj1GpTXy.js";import{M as oe}from"./MenuItem-PLPDg3_f.js";import{b as fe,c as ge,a as at}from"./DialogContent-Bq3dEBgs.js";import{B as z}from"./Button-CiQQsF2p.js";import{F as st}from"./ExclamationTriangleIcon-BE7yaTBp.js";import{A as ie}from"./Alert-CzSGSufA.js";import{C as be}from"./CircularProgress-BVgMTZG7.js";import{F as rt}from"./PlusIcon-BZvK_9oq.js";import"./app-CYPnucT-.js";import"./chunk-D5XJWRAV-Dkfk7po4.js";import"./chunk-MZRCPRP2-B90AE6mW.js";import"./LiveAnnouncer-C2FyYgAC.js";import"./useHasTabbableChild-CnYlH9ZU.js";import"./chunk-7F3ZLNJ6-CF7c3QhX.js";import"./index-CokAva9Y.js";import"./dividerClasses-DyD1oX6F.js";import"./Popover-DRLuHBe9.js";import"./List-zZ64sibn.js";import"./listItemTextClasses-LbtaCQDN.js";import"./useSlot-D_8OGX0s.js";const nt=({designations:l,onEdit:o,onDelete:P,onView:r,loading:d,isMobile:x,isTablet:m,pagination:s,onPageChange:D,onRowsPerPageChange:u,canEditDesignation:v=!1,canDeleteDesignation:g=!1})=>{var _,w;const{auth:f}=le().props,h=v||((_=f.permissions)==null?void 0:_.includes("designations.update"))||!1,c=g||((w=f.permissions)==null?void 0:w.includes("designations.delete"))||!1,F=i.useMemo(()=>[{name:"TITLE",uid:"title"},{name:"DEPARTMENT",uid:"department_name"},{name:"EMPLOYEES",uid:"employee_count"},{name:"STATUS",uid:"status"},{name:"ACTIONS",uid:"actions"}],[]),y=(a,T)=>{switch(T){case"title":return e("span",{className:"font-semibold text-foreground",children:a.title});case"department_name":return e("span",{className:"text-default-500",children:a.department_name||"-"});case"employee_count":return n("div",{className:"flex items-center gap-2",children:[e(Ee,{className:"w-4 h-4 text-default-400"}),e("span",{children:a.employee_count||0})]});case"status":return e(Ae,{size:"sm",variant:a.is_active?"solid":"bordered",color:a.is_active?"success":"danger",startContent:a.is_active?e(ue,{className:"w-3 h-3"}):e(he,{className:"w-3 h-3"}),children:a.is_active?"Active":"Inactive"});case"actions":return e("div",{className:"flex justify-end items-center",children:x?n(Fe,{children:[e(Se,{children:e($,{isIconOnly:!0,size:"sm",variant:"light",children:e(Ve,{className:"w-4 h-4"})})}),n(Te,{"aria-label":"Designation actions",children:[e(G,{startContent:e(ae,{className:"w-4 h-4"}),onPress:()=>r(a),children:"View Details"},"view"),h&&e(G,{startContent:e(se,{className:"w-4 h-4"}),onPress:()=>o(a),children:"Edit Designation"},"edit"),c&&e(G,{className:"text-danger",color:"danger",startContent:e(re,{className:"w-4 h-4"}),isDisabled:a.employee_count>0,onPress:()=>P(a),children:"Delete Designation"},"delete")]})]}):n(Ne,{children:[e(V,{content:"View Designation",children:e($,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-foreground",onPress:()=>r(a),children:e(ae,{className:"w-4 h-4"})})}),h&&e(V,{content:"Edit Designation",children:e($,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-blue-500",onPress:()=>o(a),children:e(se,{className:"w-4 h-4"})})}),c&&e(V,{content:a.employee_count>0?"Cannot delete designation with employees":"Delete Designation",children:e($,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-danger",isDisabled:a.employee_count>0,onPress:()=>P(a),children:e(re,{className:"w-4 h-4"})})})]})});default:return e("span",{children:a[T]})}},b=()=>!l||!l.data||d?null:n("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2 border-t border-white/10",children:[n("span",{className:"text-xs text-default-400 mb-3 sm:mb-0",children:["Showing ",(s.currentPage-1)*s.perPage+1," to ",Math.min(s.currentPage*s.perPage,l.total)," of ",l.total," designations"]}),e(Xe,{total:Math.ceil(l.total/s.perPage),initialPage:s.currentPage,page:s.currentPage,onChange:D,size:x?"sm":"md",variant:"bordered",showControls:!0,classNames:{item:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",cursor:"bg-white/20 backdrop-blur-md border-white/20"}})]});return!d&&(!l||!l.data||l.data.length===0)?e("div",{className:"w-full",children:e(Ge,{message:"No designations found",icon:e(Q,{className:"w-12 h-12 text-default-300"}),description:"Try adjusting your search or filters"})}):e("div",{className:"w-full",children:n(Je,{"aria-label":"Designations table",removeWrapper:!0,classNames:{base:"bg-transparent",th:"bg-white/5 backdrop-blur-md text-default-500 border-b border-white/10 font-medium text-xs",td:"border-b border-white/5 py-3"},bottomContent:b(),children:[e(Qe,{columns:F,children:a=>e(qe,{children:a.name},a.uid)}),e(He,{items:l.data||[],emptyContent:!d&&"No designations found",loadingContent:e(Ce,{}),isLoading:d,children:a=>e(Ue,{children:T=>e(Ye,{children:y(a,T)})},a.id)})]})})},ot=({open:l,onClose:o,onSuccess:P,designation:r=null,departments:d=[]})=>{var y;const x=ce(),m=q(x.breakpoints.down("md")),[s,D]=i.useState(!1),[u,v]=i.useState({}),g={title:"",department_id:"",is_active:!0},[f,h]=i.useState(g);i.useEffect(()=>{h(r?{title:r.title||"",department_id:r.department_id||"",is_active:r.is_active??!0}:g),v({})},[r,l]);const c=b=>{const{name:_,value:w,type:a,checked:T}=b.target;h(S=>({...S,[_]:a==="checkbox"?T:w})),u[_]&&v(S=>({...S,[_]:null}))},F=async()=>{var b,_;D(!0),v({});try{const w={...f};let a;r!=null&&r.id?(a=await k.put(`/designations/${r.id}`,w),N.success("Designation updated successfully")):(a=await k.post("/designations",w),N.success("Designation created successfully")),P(a.data.designation),o()}catch(w){if((_=(b=w.response)==null?void 0:b.data)!=null&&_.errors){v(w.response.data.errors);const a=Object.values(w.response.data.errors)[0];a&&N.error(a[0])}else N.error("An error occurred while saving the designation")}finally{D(!1)}};return n(Ze,{open:l,onClose:s?void 0:o,maxWidth:"sm",fullWidth:!0,fullScreen:m,"aria-labelledby":"designation-form-dialog",children:[n(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e(A,{variant:"h6",component:"div",children:r?"Edit Designation":"Create New Designation"}),e(me,{edge:"end",color:"inherit",onClick:o,disabled:s,"aria-label":"close",children:e(de,{className:"w-5 h-5"})})]}),e(j,{}),e(fe,{sx:{pt:2},children:n(M,{container:!0,spacing:3,children:[e(M,{item:!0,xs:12,children:e(A,{variant:"subtitle1",color:"primary",gutterBottom:!0,children:"Designation Information"})}),e(M,{item:!0,xs:12,md:6,children:e(Ke,{name:"title",label:"Designation Title",fullWidth:!0,required:!0,value:f.title,onChange:c,error:!!u.title,helperText:((y=u.title)==null?void 0:y[0])||"",disabled:s})}),e(M,{item:!0,xs:12,md:6,children:n(Ie,{fullWidth:!0,error:!!u.department_id,children:[e(et,{id:"department-label",children:"Department"}),n(tt,{labelId:"department-label",name:"department_id",value:f.department_id,onChange:c,label:"Department",disabled:s,children:[e(oe,{value:"",children:e("em",{children:"Select Department"})}),d.map(b=>e(oe,{value:b.id,children:b.name},b.id))]}),u.department_id&&e(ne,{children:u.department_id[0]})]})}),n(M,{item:!0,xs:12,children:[e(Me,{control:e(ke,{checked:f.is_active,onChange:c,name:"is_active",color:"success",disabled:s}),label:"Designation is active"}),u.is_active&&e(ne,{error:!0,children:u.is_active[0]})]})]})}),e(j,{}),n(ge,{sx:{px:3,py:2},children:[e(z,{onClick:o,disabled:s,color:"inherit",children:"Cancel"}),e(z,{onClick:F,variant:"contained",color:"primary",disabled:s,children:s?"Saving...":r?"Update Designation":"Create Designation"})]})]})},it=({open:l,onClose:o,onSuccess:P,designation:r})=>{const[d,x]=i.useState(!1),[m,s]=i.useState(null),D=async()=>{var u,v,g,f;if(r){x(!0),s(null);try{await k.delete(`/hr/designations/${r.id}`),N.success("Designation deleted successfully"),P(),o()}catch(h){if((v=(u=h.response)==null?void 0:u.data)!=null&&v.message)s(h.response.data.message),N.error(h.response.data.message);else if((f=(g=h.response)==null?void 0:g.data)!=null&&f.errors){const c=Object.values(h.response.data.errors)[0];s(c),N.error(c)}else s("An error occurred while deleting the designation"),N.error("An error occurred while deleting the designation")}finally{x(!1)}}};return r?n(at,{open:l,onClose:d?void 0:o,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"delete-designation-dialog",children:[n(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e(A,{variant:"h6",children:"Delete Designation"}),e(me,{edge:"end",color:"inherit",onClick:o,disabled:d,"aria-label":"close",children:e(de,{className:"w-5 h-5"})})]}),e(j,{}),e(fe,{children:n(H,{sx:{display:"flex",flexDirection:"column",gap:2},children:[n(H,{sx:{display:"flex",alignItems:"center",gap:2},children:[e(st,{className:"w-8 h-8 text-yellow-500"}),n(A,{variant:"body1",children:["Are you sure you want to delete the designation ",e("strong",{children:r.title}),"?"]})]}),r.employee_count>0&&n(ie,{severity:"warning",sx:{mt:2},children:["This designation has ",r.employee_count," employees assigned to it. You cannot delete a designation with active employees. Please reassign these employees to other designations first."]}),m&&e(ie,{severity:"error",sx:{mt:2},children:m}),e(A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This action cannot be undone. All associated data will be permanently removed."})]})}),e(j,{}),n(ge,{sx:{px:3,py:2},children:[e(z,{onClick:o,disabled:d,color:"inherit",children:"Cancel"}),e(z,{onClick:D,variant:"contained",color:"error",disabled:d||r.employee_count>0,startIcon:d&&e(be,{size:20,color:"inherit"}),children:d?"Deleting...":"Delete Designation"})]})]}):null},Ut=({title:l,initialDesignations:o,departments:P,managers:r,parentDesignations:d,stats:x,filters:m})=>{var K,ee,te;const{auth:s}=le().props,D=ce(),u=q(D.breakpoints.down("sm"));q(D.breakpoints.down("md"));const[v,g]=i.useState(o||{data:[]}),[f,h]=i.useState(!1),[c,F]=i.useState({type:null,designation:null}),[y,b]=i.useState({search:(m==null?void 0:m.search)||"",status:(m==null?void 0:m.status)||"all",parentDesignation:(m==null?void 0:m.parentDesignation)||"all"}),[_,w]=i.useState(!1),[a,T]=i.useState("table"),[S,L]=i.useState({currentPage:(o==null?void 0:o.current_page)||1,perPage:(o==null?void 0:o.per_page)||10}),[E,we]=i.useState(x||{total:0,active:0,inactive:0,parent_designations:0}),U=((K=s.permissions)==null?void 0:K.includes("designations.create"))||!1,Y=((ee=s.permissions)==null?void 0:ee.includes("designations.update"))||!1,J=((te=s.permissions)==null?void 0:te.includes("designations.delete"))||!1,O=i.useCallback(async()=>{h(!0);try{const t=await k.get(route("designations.json"),{params:{page:S.currentPage,per_page:S.perPage,search:y.search,status:y.status,parent_designation:y.parentDesignation}});g(t.data.designations||t.data)}catch(t){console.error("Error fetching designations:",t),N.error("Failed to load designations data")}finally{h(!1)}},[S,y]),W=i.useCallback(async()=>{try{const t=await k.get(route("designations.stats"));t.status===200&&we(t.data.stats)}catch(t){console.error("Error fetching designation stats:",t)}},[]);i.useEffect(()=>{O(),W()},[O,W]);const ve=(t,C)=>{b(p=>({...p,[t]:C})),L(p=>({...p,currentPage:1}))},ye=t=>{L(C=>({...C,currentPage:t})),window.scrollTo({top:0,behavior:"smooth"})},_e=t=>{L({currentPage:1,perPage:t})},R=(t,C=null)=>{F({type:t,designation:C})},X=()=>{F({type:null,designation:null})},Z=(t=null,C=null)=>{C==="add"&&t?g(p=>{const I=[t,...p.data];return{...p,data:I,total:(p.total||0)+1}}):C==="edit"&&t?g(p=>{const I=p.data.map(B=>B.id===t.id?t:B);return{...p,data:I}}):C==="delete"&&t?g(p=>{const I=p.data.filter(B=>B.id!==t.id);return{...p,data:I,total:(p.total||1)-1}}):(O(),W())},xe=i.useMemo(()=>[{title:"Total Designations",value:E.total,icon:e(Q,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All designations"},{title:"Active",value:E.active,icon:e(ue,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Active designations"},{title:"Inactive",value:E.inactive,icon:e(he,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Inactive designations"},{title:"Parent Designations",value:E.parent_designations,icon:e(Re,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Top-level designations"}],[E]),De=i.useMemo(()=>{const t=[];return U&&t.push({label:u?"Add":"Add Designation",icon:e(rt,{className:"w-4 h-4"}),onPress:()=>R("add_designation"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}),t},[U,u]);return n(Le,{children:[e(Pe,{title:l}),e(H,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Be,{in:!0,timeout:800,children:e($e,{children:e(Oe,{title:"Designation Management",subtitle:"Manage company designations and hierarchy",icon:e(Q,{className:"w-8 h-8"}),variant:"default",actionButtons:De,children:n("div",{className:"p-4 sm:p-6",children:[e(We,{stats:xe,className:"mb-6"}),e("div",{className:"mb-6",children:e(je,{label:"Search",placeholder:"Search designations...",value:y.search,onValueChange:t=>ve("search",t),startContent:e(ze,{className:"w-4 h-4"}),size:"md"})}),e("div",{children:f?n("div",{className:"text-center py-6",children:[e(be,{size:40}),e(A,{className:"mt-4",children:"Loading..."})]}):e(nt,{designations:v,loading:f,onEdit:Y?t=>R("edit_designation",t):void 0,onDelete:J?t=>R("delete_designation",t):void 0,onView:t=>R("view_designation",t),pagination:S,onPageChange:ye,onRowsPerPageChange:_e,canEditDesignation:Y,canDeleteDesignation:J})})]})})})})}),(c.type==="add_designation"||c.type==="edit_designation")&&e(ot,{open:!0,departments:P,onClose:X,onSuccess:t=>Z(t,c.type==="add_designation"?"add":"edit"),designation:c.designation,managers:r,parentDesignations:d}),c.type==="delete_designation"&&e(it,{open:!0,onClose:X,onSuccess:t=>Z(t,"delete"),designation:c.designation})]})};export{Ut as default};
