import{r as t,m as se,j as s,a as Ce,b as a,Q as Pt,f as _,h as kt,S as Et,F as ts,e as Me,c as Le}from"./app-vxJEuD-Q.js";import{b as _t,t as Dt,a as j,i as Vs,j as qs,d as Qs,_ as ds,s as Xe,e as At,g as Ks,P as Mt,h as Lt,u as Xs,k as Ke,B as Re,T as w,G as Ot}from"./logo-g9YP4PG9.js";import{G as rs}from"./GlassDialog-emp7_90C.js";import{P as Ft}from"./PageHeader-BeJuacUS.js";import{S as Tt}from"./StatsCards-9Uz3XXED.js";import{a5 as ms,a6 as as,a7 as It,a8 as Os,G as Ys,a9 as zt,u as Fs,e as Pe,aa as Ts,B as U,E as qe,h as ns,c as X,T as Oe,ab as Ut,A as $t}from"./App-BT8BxCJ3.js";import{F as ke,a as jt}from"./ShieldCheckIcon-B4rgpKpm.js";import{F as Bt}from"./FunnelIcon-CtcgxxyM.js";import{A as is}from"./Alert-C_ieXAXx.js";import{F as Is}from"./ExclamationTriangleIcon-BLU4Cpqb.js";import{F as Gt}from"./CogIcon-BC5J1E_X.js";import{T as Wt,a as Qe}from"./Tabs-4Wk6hEb4.js";import{F as os}from"./AdjustmentsHorizontalIcon-B8D11j4z.js";import{F as Ht}from"./DocumentArrowDownIcon-Ccq1BO5v.js";import{s as Ee,l as W}from"./chunk-2GIFKCNQ-CFraMr1A.js";import{F as zs}from"./PlusIcon-C4bbiGhJ.js";import{F as Us}from"./PencilSquareIcon-BiBxjJE5.js";import{F as $s}from"./TrashIcon-uQ6a2ypJ.js";import{p as js}from"./chunk-CXOJTH5M-CfpC4ruC.js";import{i as Y}from"./chunk-6MDMHKHV-D9rXeZJI.js";import{c as Fe}from"./chunk-D5XJWRAV-D2I4RFfZ.js";import"./app-CX8GSXRI.js";import"./create-visual-element-BaeSogmb.js";import"./Dialog-D_Q59pOx.js";import"./EnvelopeIcon-0Ed3Ojh4.js";import"./UserIcon-Cwmcvl4r.js";import"./useSlot-ANw5ZdAp.js";import"./KeyboardArrowRight-DJvuDLBx.js";import"./chunk-7F3ZLNJ6-C__I5l7e.js";import"./index-DYHv9MRM.js";import"./NumberFormatter-DNR9MAW-.js";function Bs(i){return i.substring(2).toLowerCase()}function Vt(i,o){return o.documentElement.clientWidth<i.clientX||o.documentElement.clientHeight<i.clientY}function qt(i){const{children:o,disableReactTree:b=!1,mouseEvent:g="onClick",onClickAway:v,touchEvent:N="onTouchEnd"}=i,M=t.useRef(!1),L=t.useRef(null),T=t.useRef(!1),D=t.useRef(!1);t.useEffect(()=>(setTimeout(()=>{T.current=!0},0),()=>{T.current=!1}),[]);const x=_t(Dt(o),L),P=ms(k=>{const p=D.current;D.current=!1;const I=as(L.current);if(!T.current||!L.current||"clientX"in k&&Vt(k,I))return;if(M.current){M.current=!1;return}let c;k.composedPath?c=k.composedPath().indexOf(L.current)>-1:c=!I.documentElement.contains(k.target)||L.current.contains(k.target),!c&&(b||!p)&&v(k)}),q=k=>p=>{D.current=!0;const I=o.props[k];I&&I(p)},$={ref:x};return N!==!1&&($[N]=q(N)),t.useEffect(()=>{if(N!==!1){const k=Bs(N),p=as(L.current),I=()=>{M.current=!0};return p.addEventListener(k,P),p.addEventListener("touchmove",I),()=>{p.removeEventListener(k,P),p.removeEventListener("touchmove",I)}}},[P,N]),g!==!1&&($[g]=q(g)),t.useEffect(()=>{if(g!==!1){const k=Bs(g),p=as(L.current);return p.addEventListener(k,P),()=>{p.removeEventListener(k,P)}}},[P,g]),se.jsx(t.Fragment,{children:t.cloneElement(o,$)})}function Qt(i={}){const{autoHideDuration:o=null,disableWindowBlurListener:b=!1,onClose:g,open:v,resumeHideDuration:N}=i,M=It();t.useEffect(()=>{if(!v)return;function c(y){y.defaultPrevented||(y.key==="Escape"||y.key==="Esc")&&(g==null||g(y,"escapeKeyDown"))}return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[v,g]);const L=ms((c,y)=>{g==null||g(c,y)}),T=ms(c=>{!g||c==null||M.start(c,()=>{L(null,"timeout")})});t.useEffect(()=>(v&&T(o),M.clear),[v,o,T,M]);const D=c=>{g==null||g(c,"clickaway")},x=M.clear,P=t.useCallback(()=>{o!=null&&T(N??o*.5)},[o,N,T]),q=c=>y=>{const C=c.onBlur;C==null||C(y),P()},$=c=>y=>{const C=c.onFocus;C==null||C(y),x()},k=c=>y=>{const C=c.onMouseEnter;C==null||C(y),x()},p=c=>y=>{const C=c.onMouseLeave;C==null||C(y),P()};return t.useEffect(()=>{if(!b&&v)return window.addEventListener("focus",P),window.addEventListener("blur",x),()=>{window.removeEventListener("focus",P),window.removeEventListener("blur",x)}},[b,v,P,x]),{getRootProps:(c={})=>{const y=j({},Os(i),Os(c));return j({role:"presentation"},c,y,{onBlur:q(y),onFocus:$(y),onMouseEnter:k(y),onMouseLeave:p(y)})},onClickAway:D}}function Kt(i){return Vs("MuiSnackbarContent",i)}qs("MuiSnackbarContent",["root","message","action"]);const Xt=["action","className","message","role"],Yt=i=>{const{classes:o}=i;return Ks({root:["root"],action:["action"],message:["message"]},Kt,o)},Jt=Xe(Mt,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(i,o)=>o.root})(({theme:i})=>{const o=i.palette.mode==="light"?.8:.98,b=Lt.emphasize(i.palette.background.default,o);return j({},i.typography.body2,{color:i.vars?i.vars.palette.SnackbarContent.color:i.palette.getContrastText(b),backgroundColor:i.vars?i.vars.palette.SnackbarContent.bg:b,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(i.vars||i).shape.borderRadius,flexGrow:1,[i.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})}),Zt=Xe("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(i,o)=>o.message})({padding:"8px 0"}),er=Xe("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(i,o)=>o.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),sr=t.forwardRef(function(o,b){const g=Qs({props:o,name:"MuiSnackbarContent"}),{action:v,className:N,message:M,role:L="alert"}=g,T=ds(g,Xt),D=g,x=Yt(D);return se.jsxs(Jt,j({role:L,square:!0,elevation:6,className:At(x.root,N),ownerState:D,ref:b},T,{children:[se.jsx(Zt,{className:x.message,ownerState:D,children:M}),v?se.jsx(er,{className:x.action,ownerState:D,children:v}):null]}))});function tr(i){return Vs("MuiSnackbar",i)}qs("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const rr=["onEnter","onExited"],ar=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],nr=i=>{const{classes:o,anchorOrigin:b}=i,g={root:["root",`anchorOrigin${Ke(b.vertical)}${Ke(b.horizontal)}`]};return Ks(g,tr,o)},Gs=Xe("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(i,o)=>{const{ownerState:b}=i;return[o.root,o[`anchorOrigin${Ke(b.anchorOrigin.vertical)}${Ke(b.anchorOrigin.horizontal)}`]]}})(({theme:i,ownerState:o})=>{const b={left:"50%",right:"auto",transform:"translateX(-50%)"};return j({zIndex:(i.vars||i).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},o.anchorOrigin.vertical==="top"?{top:8}:{bottom:8},o.anchorOrigin.horizontal==="left"&&{justifyContent:"flex-start"},o.anchorOrigin.horizontal==="right"&&{justifyContent:"flex-end"},{[i.breakpoints.up("sm")]:j({},o.anchorOrigin.vertical==="top"?{top:24}:{bottom:24},o.anchorOrigin.horizontal==="center"&&b,o.anchorOrigin.horizontal==="left"&&{left:24,right:"auto"},o.anchorOrigin.horizontal==="right"&&{right:24,left:"auto"})})}),Ws=t.forwardRef(function(o,b){const g=Qs({props:o,name:"MuiSnackbar"}),v=Xs(),N={enter:v.transitions.duration.enteringScreen,exit:v.transitions.duration.leavingScreen},{action:M,anchorOrigin:{vertical:L,horizontal:T}={vertical:"bottom",horizontal:"left"},autoHideDuration:D=null,children:x,className:P,ClickAwayListenerProps:q,ContentProps:$,disableWindowBlurListener:k=!1,message:p,open:I,TransitionComponent:c=Ys,transitionDuration:y=N,TransitionProps:{onEnter:C,onExited:te}={}}=g,Q=ds(g.TransitionProps,rr),Ye=ds(g,ar),z=j({},g,{anchorOrigin:{vertical:L,horizontal:T},autoHideDuration:D,disableWindowBlurListener:k,TransitionComponent:c,transitionDuration:y}),K=nr(z),{getRootProps:E,onClickAway:B}=Qt(j({},z)),[J,A]=t.useState(!0),Je=zt({elementType:Gs,getSlotProps:E,externalForwardedProps:Ye,ownerState:z,additionalProps:{ref:b},className:[K.root,P]}),Te=ge=>{A(!0),te&&te(ge)},Ze=(ge,us)=>{A(!1),C&&C(ge,us)};return!I&&J?null:se.jsx(qt,j({onClickAway:B},q,{children:se.jsx(Gs,j({},Je,{children:se.jsx(c,j({appear:!0,in:I,timeout:y,direction:L==="top"?"down":"up",onEnter:Ze,onExited:Te},Q,{children:x||se.jsx(sr,j({message:p,action:M},$))}))}))}))}),ls=i=>Array.isArray(i)?[...i]:[],Hs=i=>i&&typeof i=="object"&&!Array.isArray(i)?{...i}:{},ir=i=>{const o={roles:ls(i.roles),permissions:ls(i.permissions),role_has_permissions:ls(i.role_has_permissions),permissionsGrouped:Hs(i.permissionsGrouped||i.permissions_grouped),enterprise_modules:Hs(i.enterprise_modules),errors:[]};if(o.roles.length===0&&o.errors.push("No roles data available"),o.permissions.length===0&&o.errors.push("No permissions data available"),o.roles.length>0&&o.permissions.length>0&&o.role_has_permissions.length===0&&o.errors.push("Role-permission relationships missing - this may indicate a cache or database issue"),o.role_has_permissions.length>0){const b=o.roles.map(N=>N.id),g=o.permissions.map(N=>N.id),v=o.role_has_permissions.filter(N=>!b.includes(N.role_id)||!g.includes(N.permission_id));v.length>0&&o.errors.push(`${v.length} invalid role-permission relationships found`)}return o},cs=(i,o)=>{const[b,g]=t.useState(i);return t.useEffect(()=>{const v=setTimeout(()=>{g(i)},o);return()=>{clearTimeout(v)}},[i,o]),b},S={IDLE:"idle",LOADING:"loading",SUCCESS:"success",ERROR:"error"},or=i=>{const o=t.useMemo(()=>ir(i),[i]),b=o.roles,g=o.permissions,v=o.permissionsGrouped,N=o.role_has_permissions;o.enterprise_modules;const M=!!i.can_manage_super_admin,L=i.title;i.error;const T=o.errors,D=i.users||[],x=t.useRef(null),P=t.useRef(Date.now()),q=Xs();Fs(q.breakpoints.down("sm")),Fs(q.breakpoints.down("md"));const[$,k]=t.useState(0),[p,I]=t.useState(b),[c,y]=t.useState(g),[C,te]=t.useState(N),[Q,Ye]=t.useState(b.length>0?b[0].id:null),[z,K]=t.useState(new Set),[E,B]=t.useState(!1),[J,A]=t.useState({permissions:{},modules:{},roles:S.IDLE,users:S.IDLE}),[Je,Te]=t.useState(!1),[Ze,ge]=t.useState(!1),[us,hs]=t.useState(!1),[lr,ps]=t.useState(!1),[re,gs]=t.useState(null),[ae,fs]=t.useState(null),[cr,bs]=t.useState(null),[dr,ws]=t.useState(null),[Js,fe]=t.useState(!1),[be,vs]=t.useState(null),[Ie,ys]=t.useState(null),[ze,xs]=t.useState(""),[Ue,Ns]=t.useState(""),[$e,Ss]=t.useState(""),[we,Cs]=t.useState("all"),[ne,Rs]=t.useState("all"),[_e,Ps]=t.useState("all"),je=cs(ze,300),Be=cs(Ue,300),Ge=cs($e,300),[ve,We]=t.useState(0),[ye,He]=t.useState(0),[xe,Ve]=t.useState(0),[ie,mr]=t.useState(10),[oe,ur]=t.useState(10),[le,hr]=t.useState(10),[ks,O]=t.useState(""),[Es,ce]=t.useState(""),[Z,Ne]=t.useState({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0}),[H,de]=t.useState({name:"",display_name:"",description:"",module:"",guard_name:"web"}),[V,G]=t.useState({}),[pr,_s]=t.useState(new Set),[gr,Ds]=t.useState(new Set),[fr,br]=t.useState(!1),h=t.useMemo(()=>p.find(e=>e.id===Q)||null,[p,Q]),me=t.useCallback(e=>{if(Array.isArray(C)){const r=C.filter(n=>n&&n.role_id===e).map(n=>n.permission_id).filter(Boolean);if(r.length>0)return r}if(Array.isArray(p)){const r=p.find(n=>n&&n.id===e);if(r&&Array.isArray(r.permissions))return r.permissions.map(n=>n.id).filter(Boolean)}return[]},[C,p]);t.useEffect(()=>{if(Q){const e=me(Q),r=new Set(e);(r.size!==z.size||[...r].some(n=>!z.has(n)))&&K(r)}else z.size>0&&K(new Set)},[Q,C,p,me]),t.useMemo(()=>h,[h==null?void 0:h.id,h==null?void 0:h.name]),t.useMemo(()=>M,[M]);const ue=t.useMemo(()=>({totalRoles:Array.isArray(p)?p.length:0,totalPermissions:Array.isArray(c)?c.length:0,activeRole:(h==null?void 0:h.name)||"None Selected",grantedPermissions:z.size}),[p,c,h,z]);t.useMemo(()=>[{title:"Total Roles",value:ue.totalRoles,icon:s(Pe,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:ue.totalPermissions,icon:s(ke,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Role",value:ue.activeRole==="None Selected"?"None":ue.activeRole,icon:s(Ts,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"Currently selected",customStyle:ue.activeRole==="None Selected"?{fontSize:"1rem"}:{}},{title:"Granted",value:ue.grantedPermissions,icon:s(Bt,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Active permissions"}],[ue]);const he=t.useMemo(()=>p.filter(e=>{const r=je===""||e.name.toLowerCase().includes(je.toLowerCase())||e.description&&e.description.toLowerCase().includes(je.toLowerCase()),n=we==="all"||we==="active"&&e.is_active!==!1||we==="inactive"&&e.is_active===!1;return r&&n}),[p,je,we]),pe=t.useMemo(()=>c.filter(e=>{const r=Be===""||e.name&&e.name.toLowerCase().includes(Be.toLowerCase())||e.display_name&&e.display_name.toLowerCase().includes(Be.toLowerCase()),n=ne==="all"||e.module===ne||e.name&&e.name.startsWith(ne);return r&&n}),[c,Be,ne]),Se=t.useMemo(()=>D.filter(e=>{var l,d;const r=Ge===""||((l=e.name)==null?void 0:l.toLowerCase().includes(Ge.toLowerCase()))||((d=e.email)==null?void 0:d.toLowerCase().includes(Ge.toLowerCase())),n=_e==="all"||e.roles&&e.roles.some(m=>m.name===_e);return r&&n}),[D,Ge,_e]),Zs=t.useMemo(()=>{const e=ve*ie;return he.slice(e,e+ie)},[he,ve,ie]),et=t.useMemo(()=>{const e=ye*oe;return pe.slice(e,e+oe)},[pe,ye,oe]),st=t.useMemo(()=>{const e=xe*le;return Se.slice(e,e+le)},[Se,xe,le]),De=t.useMemo(()=>{const e=new Set;return c.forEach(r=>{r.module?e.add(r.module):r.name&&r.name.includes(".")&&e.add(r.name.split(".")[0])}),Array.from(e).sort()},[c]),tt=t.useMemo(()=>p.map(e=>e.name).sort(),[p]),ee=t.useCallback((e,r)=>{if(Array.isArray(C)&&Array.isArray(c)){const n=C.filter(d=>d&&d.role_id===e),l=c.find(d=>d&&d.name===r);if(l&&n.some(d=>d.permission_id===l.id))return!0}if(Array.isArray(p)){const n=p.find(l=>l&&l.id===e);if(n&&Array.isArray(n.permissions))return n.permissions.some(l=>l&&l.name===r)}if(h&&h.id===e&&z.size>0){const n=c.find(l=>l&&l.name===r);if(n)return z.has(n.id)}return!1},[C,c,p,h,z]);t.useCallback(e=>!h||!v[e]?!1:v[e].permissions.every(n=>ee(h.id,n.name)),[h,v,ee]),t.useCallback(e=>!h||!v[e]?!1:v[e].permissions.some(n=>ee(h.id,n.name)),[h,v,ee]);const As=e=>e.name==="Super Administrator"?M:!0,rt=t.useCallback(e=>{try{Ye(e);const r=me(e);K(new Set(r)),O("")}catch(r){console.error("Error selecting role:",r),O("Failed to select role. Please try again.")}},[me]),at=t.useCallback(e=>{xs(e),We(0)},[]),nt=t.useCallback(e=>{Ns(e),He(0)},[]),it=t.useCallback(e=>{Ss(e),Ve(0)},[]),ot=t.useCallback(e=>{Cs(e),We(0)},[]),lt=t.useCallback(e=>{Rs(e),He(0)},[]),ct=t.useCallback(e=>{Ps(e),Ve(0)},[]),Ms=t.useCallback((e=null)=>{gs(e),Ne({name:(e==null?void 0:e.name)||"",description:(e==null?void 0:e.description)||"",permissions:(e==null?void 0:e.permissions)||[],hierarchy_level:(e==null?void 0:e.hierarchy_level)||10,is_active:(e==null?void 0:e.is_active)??!0}),Te(!0),G({}),O("")},[]),es=t.useCallback(()=>{Te(!1),gs(null),G({}),O(""),Ne({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0})},[]),Ls=t.useCallback((e=null)=>{fs(e),de({name:(e==null?void 0:e.name)||"",display_name:(e==null?void 0:e.display_name)||"",description:(e==null?void 0:e.description)||"",module:(e==null?void 0:e.module)||De[0]||"users",guard_name:(e==null?void 0:e.guard_name)||"web"}),ge(!0),G({}),O("")},[De]),ss=t.useCallback(()=>{ge(!1),fs(null),G({}),O(""),de({name:"",display_name:"",description:"",module:"",guard_name:"web"})},[]);t.useCallback(e=>{bs(e),hs(!0);const r=me(e.id);Ds(new Set(r))},[me]),t.useCallback(()=>{hs(!1),bs(null),Ds(new Set)},[]);const dt=t.useCallback(e=>{ws(e),ps(!0);const r=e.roles?new Set(e.roles.map(n=>n.id)):new Set;_s(r)},[]);t.useCallback(()=>{ps(!1),ws(null),_s(new Set)},[]);const mt=t.useCallback(e=>{vs(e),fe(!0)},[]),ut=t.useCallback(e=>{ys(e),fe(!0)},[]),ht=async()=>{var e,r;if(be){B(!0);try{await Ce.delete(`/api/roles/${be.id}`),U.success("Role deleted successfully"),ce("Role deleted successfully"),fe(!1),vs(null),P.current=Date.now()}catch(n){console.error("Error deleting role:",n);const l=((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to delete role";U.error(l),O(l)}finally{B(!1)}}},pt=async()=>{var e,r;if(Ie){B(!0);try{await Ce.delete(`/api/permissions/${Ie.id}`),U.success("Permission deleted successfully"),ce("Permission deleted successfully"),fe(!1),ys(null),P.current=Date.now()}catch(n){console.error("Error deleting permission:",n);const l=((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to delete permission";U.error(l),O(l)}finally{B(!1)}}},gt=async()=>{var r,n,l;G({}),O("");const e={};if(Z.name.trim()||(e.name="Role name is required"),Z.name.length>255&&(e.name="Role name must be less than 255 characters"),Z.description&&Z.description.length>500&&(e.description="Description must be less than 500 characters"),Object.keys(e).length>0){G(e);return}B(!0),A(d=>({...d,roles:S.LOADING}));try{const d=re?`/api/roles/${re.id}`:"/api/roles",f=await Ce[re?"put":"post"](d,Z);(f.status===200||f.status===201)&&(re?(I(u=>u.map(R=>R.id===re.id?f.data.role:R)),U.success("Role updated successfully"),ce("Role updated successfully")):(I(u=>[...u,f.data.role]),U.success("Role created successfully"),ce("Role created successfully")),es(),A(u=>({...u,roles:S.SUCCESS})),setTimeout(()=>{A(u=>({...u,roles:S.IDLE})),ce("")},3e3),P.current=Date.now())}catch(d){if(console.error("Error saving role:",d),A(m=>({...m,roles:S.ERROR})),((r=d.response)==null?void 0:r.status)===422&&d.response.data.errors)G(d.response.data.errors);else{const m=((l=(n=d.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to save role";U.error(m),O(m)}setTimeout(()=>{A(m=>({...m,roles:S.IDLE}))},3e3)}finally{B(!1)}},ft=async()=>{var r,n,l;G({}),O("");const e={};if(H.name.trim()||(e.name="Permission name is required"),H.display_name.trim()||(e.display_name="Display name is required"),H.module.trim()||(e.module="Module is required"),Object.keys(e).length>0){G(e);return}B(!0);try{const d=ae?`/api/permissions/${ae.id}`:"/api/permissions",f=await Ce[ae?"put":"post"](d,H);(f.status===200||f.status===201)&&(ae?(y(u=>u.map(R=>R.id===ae.id?f.data.permission:R)),U.success("Permission updated successfully")):(y(u=>[...u,f.data.permission]),U.success("Permission created successfully")),ss(),P.current=Date.now())}catch(d){if(console.error("Error saving permission:",d),((r=d.response)==null?void 0:r.status)===422&&d.response.data.errors)G(d.response.data.errors);else{const m=((l=(n=d.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to save permission";U.error(m),O(m)}}finally{B(!1)}},bt=t.useCallback(async e=>{var r,n,l,d;if(!(!h||E)){x.current&&x.current.abort(),x.current=new AbortController,A(m=>({...m,permissions:{...m.permissions,[e]:S.LOADING}}));try{const m=ee(h.id,e),f=m?"revoke":"grant",u=await Ce.post("/admin/roles/update-permission",{role_id:h.id,permission:e,action:f},{signal:x.current.signal});if(u.status===200){if(u.data.role_has_permissions){te(u.data.role_has_permissions);const R=u.data.role_has_permissions.filter(F=>F.role_id===h.id).map(F=>F.permission_id);K(new Set(R))}else{const R=c.find(F=>F.name===e);R&&(m?(te(F=>F.filter(Ae=>!(Ae.role_id===h.id&&Ae.permission_id===R.id))),K(F=>{const Ae=new Set(F);return Ae.delete(R.id),Ae})):(te(F=>[...F,{role_id:h.id,permission_id:R.id}]),K(F=>new Set([...F,R.id]))))}A(R=>({...R,permissions:{...R.permissions,[e]:S.SUCCESS}})),setTimeout(()=>{A(R=>({...R,permissions:{...R.permissions,[e]:S.IDLE}}))},2e3),U.success(`Permission ${f}ed successfully`),P.current=Date.now()}}catch(m){m.name!=="AbortError"&&(console.error("Error updating permission:",m),A(f=>({...f,permissions:{...f.permissions,[e]:S.ERROR}})),setTimeout(()=>{A(f=>({...f,permissions:{...f.permissions,[e]:S.IDLE}}))},3e3),U.error(((n=(r=m.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to update permission"),O(((d=(l=m.response)==null?void 0:l.data)==null?void 0:d.message)||"Failed to update permission"))}finally{B(!1)}}},[h,E,ee,c]),wt=t.useCallback(async e=>{var r,n,l,d;if(!(!h||E)){x.current&&x.current.abort(),x.current=new AbortController,A(m=>({...m,modules:{...m.modules,[e]:S.LOADING}}));try{const m=await Ce.post("/admin/roles/update-module",{roleId:h.id,module:e,action:"toggle"},{signal:x.current.signal});if(m.status===200){te(m.data.role_has_permissions);const f=m.data.role_has_permissions.filter(u=>u.role_id===h.id).map(u=>u.permission_id);K(new Set(f)),A(u=>({...u,modules:{...u.modules,[e]:S.SUCCESS}})),setTimeout(()=>{A(u=>({...u,modules:{...u.modules,[e]:S.IDLE}}))},2e3),U.success("Module permissions updated successfully"),P.current=Date.now()}}catch(m){m.name!=="AbortError"&&(console.error("Error updating module permissions:",m),A(f=>({...f,modules:{...f.modules,[e]:S.ERROR}})),setTimeout(()=>{A(f=>({...f,modules:{...f.modules,[e]:S.IDLE}}))},3e3),U.error(((n=(r=m.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to update module permissions"),O(((d=(l=m.response)==null?void 0:l.data)==null?void 0:d.message)||"Failed to update module permissions"))}}},[h,E]);t.useCallback((e,r)=>{Ne(n=>({...n,[e]:r})),V[e]&&G(n=>({...n,[e]:void 0}))},[V]),t.useEffect(()=>()=>{x.current&&x.current.abort()},[]),t.useEffect(()=>{const e=r=>{if(r.key==="/"&&!r.ctrlKey&&!r.metaKey&&!r.altKey){const n=r.target;if(n.tagName!=="INPUT"&&n.tagName!=="TEXTAREA"&&!n.isContentEditable){r.preventDefault();const l=document.querySelector('input[placeholder*="Search"]');l&&l.focus()}}if(r.key==="Escape"&&(ze||Ue||$e||ne!=="all")&&(xs(""),Ns(""),Ss(""),Rs("all"),Cs("all"),Ps("all")),(r.ctrlKey||r.metaKey)&&r.key==="k"){r.preventDefault();const n=document.querySelector('input[placeholder*="Search"]');n&&n.focus()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[ze,Ue,$e,ne,we,_e]);const vt=t.useCallback(e=>J.permissions[e]||S.IDLE,[J.permissions]),yt=t.useCallback(e=>J.modules[e]||S.IDLE,[J.modules]),xt=()=>a(Le,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[a(Fe,{className:"p-4 border-b border-white/10",children:[a("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[a(w,{variant:"h6",className:"flex items-center gap-2",children:[s(Pe,{className:"w-5 h-5"}),"Roles Management"]}),s(_,{onPress:()=>Ms(),startContent:s(zs,{className:"w-4 h-4"}),className:"bg-gradient-to-r from-blue-500/20 to-purple-500/20 hover:from-blue-500/30 hover:to-purple-500/30 border border-blue-400/30 text-white",variant:"bordered",children:"Add Role"})]}),a("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s(Y,{label:"Search Roles",variant:"bordered",placeholder:"Search by role name...",value:ze,onValueChange:at,startContent:s(ns,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),a(Ee,{label:"Status Filter",variant:"bordered",selectedKeys:[we],onSelectionChange:e=>ot(Array.from(e)[0]),className:"min-w-[140px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s(W,{value:"all",children:"All Status"},"all"),s(W,{value:"active",children:"Active"},"active"),s(W,{value:"inactive",children:"Inactive"},"inactive")]})]})]}),a(Me,{className:"p-0",children:[s("div",{className:"divide-y divide-white/10",children:Zs.map(e=>{const r=me(e.id),n=r.map(l=>{var d;return(d=c.find(m=>m.id===l))==null?void 0:d.name}).filter(Boolean).slice(0,3);return s("div",{className:"p-4 hover:bg-white/5 transition-colors",children:a("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[a("div",{className:"flex items-center gap-3",children:[s("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:e.name.charAt(0).toUpperCase()}),a("div",{children:[a("div",{className:"flex items-center gap-2",children:[s(w,{variant:"body1",className:"font-medium",children:e.name}),e.name==="Super Administrator"&&s(X,{size:"sm",color:"warning",variant:"flat",children:"System"}),s(X,{size:"sm",color:e.is_active!==!1?"success":"default",variant:"flat",children:e.is_active!==!1?"Active":"Inactive"})]}),e.description&&s(w,{variant:"body2",color:"textSecondary",className:"mt-1",children:e.description}),a("div",{className:"flex flex-wrap gap-1 mt-2",children:[n.map((l,d)=>s(X,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:l},d)),r.length>3&&a(X,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",r.length-3," more"]})]})]})]}),a("div",{className:"flex gap-2",children:[s(Oe,{content:"Edit Role",children:s(_,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Ms(e),isDisabled:!As(e),className:"text-blue-400 hover:text-blue-300",children:s(Us,{className:"w-4 h-4"})})}),s(Oe,{content:"Delete Role",children:s(_,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>mt(e),isDisabled:!As(e),className:"text-red-400 hover:text-red-300",children:s($s,{className:"w-4 h-4"})})})]})]})},e.id)})}),he.length===0&&a("div",{className:"text-center py-12",children:[s(Pe,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(w,{variant:"body1",color:"textSecondary",children:"No roles found matching your criteria"})]}),he.length>ie&&a("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[a(w,{variant:"body2",color:"textSecondary",children:["Showing ",ve*ie+1," to ",Math.min((ve+1)*ie,he.length)," of ",he.length," roles"]}),a("div",{className:"flex gap-2",children:[s(_,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:ve===0,onPress:()=>We(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s(_,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(ve+1)*ie>=he.length,onPress:()=>We(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),Nt=()=>a(Le,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[a(Fe,{className:"p-4 border-b border-white/10",children:[a("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[a(w,{variant:"h6",className:"flex items-center gap-2",children:[s(ke,{className:"w-5 h-5"}),"Permissions Management"]}),s(_,{onPress:()=>Ls(),startContent:s(zs,{className:"w-4 h-4"}),className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30 border border-green-400/30 text-white",variant:"bordered",children:"Add Permission"})]}),a("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s(Y,{label:"Search Permissions",variant:"bordered",placeholder:"Search by permission name...",value:Ue,onValueChange:nt,startContent:s(ns,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),a(Ee,{label:"Module Filter",variant:"bordered",selectedKeys:[ne],onSelectionChange:e=>lt(Array.from(e)[0]),className:"min-w-[180px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s(W,{value:"all",children:"All Modules"},"all"),De.map(e=>s(W,{value:e,children:e},e))]})]})]}),a(Me,{className:"p-0",children:[s("div",{className:"divide-y divide-white/10",children:et.map(e=>s("div",{className:"p-4 hover:bg-white/5 transition-colors",children:a("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[a("div",{className:"flex items-center gap-3",children:[s("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold",children:e.name?e.name.charAt(0).toUpperCase():"P"}),a("div",{children:[a("div",{className:"flex items-center gap-2",children:[s(w,{variant:"body1",className:"font-medium",children:e.display_name||e.name}),s(X,{size:"sm",color:"secondary",variant:"flat",children:e.module||(e.name?e.name.split(".")[0]:"General")})]}),s(w,{variant:"body2",color:"textSecondary",className:"mt-1",children:e.name}),e.description&&s(w,{variant:"body2",color:"textSecondary",className:"mt-1 max-w-md",children:e.description})]})]}),a("div",{className:"flex gap-2",children:[s(Oe,{content:"Edit Permission",children:s(_,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Ls(e),className:"text-blue-400 hover:text-blue-300",children:s(Us,{className:"w-4 h-4"})})}),s(Oe,{content:"Delete Permission",children:s(_,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>ut(e),className:"text-red-400 hover:text-red-300",children:s($s,{className:"w-4 h-4"})})})]})]})},e.id))}),pe.length===0&&a("div",{className:"text-center py-12",children:[s(ke,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(w,{variant:"body1",color:"textSecondary",children:"No permissions found matching your criteria"})]}),pe.length>oe&&a("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[a(w,{variant:"body2",color:"textSecondary",children:["Showing ",ye*oe+1," to ",Math.min((ye+1)*oe,pe.length)," of ",pe.length," permissions"]}),a("div",{className:"flex gap-2",children:[s(_,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:ye===0,onPress:()=>He(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s(_,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(ye+1)*oe>=pe.length,onPress:()=>He(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),St=()=>a(Le,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[s(Fe,{className:"p-4 border-b border-white/10",children:a("div",{className:"flex flex-col gap-4 w-full",children:[a(w,{variant:"h6",className:"flex items-center gap-2",children:[s(os,{className:"w-5 h-5"}),"Role-Permission Assignment"]}),s(Ee,{label:"Select Role to Manage",variant:"bordered",selectedKeys:Q?[Q.toString()]:[],onSelectionChange:e=>{const r=Array.from(e)[0];r&&rt(parseInt(r))},className:"max-w-md",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:p.map(e=>s(W,{value:e.id.toString(),children:e.name},e.id.toString()))})]})}),s(Me,{className:"p-4",children:h?a("div",{className:"space-y-6",children:[a("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10",children:[a("div",{children:[a(w,{variant:"body1",className:"font-medium",children:["Managing permissions for: ",h.name]}),a(w,{variant:"body2",color:"textSecondary",children:[z.size," of ",c.length," permissions granted"]})]}),s(js,{value:z.size/c.length*100,size:"sm",color:"primary",className:"w-32","aria-label":`${Math.round(z.size/c.length*100)}% permissions granted`})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(v).map(([e,r])=>{const n=r.permissions||[],l=n.filter(u=>ee(h.id,u.name)).length,d=n.length,m=l===d,f=l>0&&l<d;return a(Le,{className:"bg-white/5 border-white/10",children:[a(Fe,{className:"pb-2",children:[a("div",{className:"flex items-center justify-between w-full",children:[s(w,{variant:"body1",className:"font-medium capitalize",children:e}),a("div",{className:"flex items-center gap-2",children:[a(X,{size:"sm",variant:"flat",color:m?"success":f?"warning":"default",children:[l,"/",d]}),s(_,{size:"sm",variant:"light",onPress:()=>wt(e),isLoading:yt(e)===S.LOADING,className:"text-xs",children:m?"Revoke All":"Grant All"})]})]}),s(js,{value:l/d*100,size:"sm",color:m?"success":f?"warning":"default","aria-label":`${l} of ${d} permissions granted for ${e} module`})]}),s(Me,{className:"pt-0",children:s("div",{className:"space-y-2",children:n.map(u=>{const R=ee(h.id,u.name),F=vt(u.name);return a("div",{className:"flex items-center justify-between p-2 rounded bg-white/5 hover:bg-white/10 transition-colors",children:[a("div",{children:[s(w,{variant:"body2",className:"font-medium",children:u.display_name||u.name}),s(w,{variant:"caption",color:"textSecondary",children:u.name})]}),s(Ut,{size:"sm",isSelected:R,onValueChange:()=>bt(u.name),isDisabled:F===S.LOADING,color:"success","aria-label":`Toggle ${u.display_name||u.name} permission`},`${u.id}-${R}-${F}`)]},u.id)})})})]},e)})})]}):a("div",{className:"text-center py-12",children:[s(os,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(w,{variant:"body1",color:"textSecondary",className:"mb-2",children:"Select a role to manage permissions"}),s(w,{variant:"body2",color:"textSecondary",children:"Choose a role from the dropdown above to assign or revoke permissions"})]})})]}),Ct=()=>a(Le,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[a(Fe,{className:"p-4 border-b border-white/10",children:[s("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:a(w,{variant:"h6",className:"flex items-center gap-2",children:[s(qe,{className:"w-5 h-5"}),"User-Role Assignment"]})}),a("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s(Y,{label:"Search Users",variant:"bordered",placeholder:"Search by user name or email...",value:$e,onValueChange:it,startContent:s(ns,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),a(Ee,{label:"Filter by Role",variant:"bordered",selectedKeys:[_e],onSelectionChange:e=>ct(Array.from(e)[0]),className:"min-w-[160px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s(W,{value:"all",children:"All Roles"},"all"),tt.map(e=>s(W,{value:e,children:e},e))]})]})]}),a(Me,{className:"p-0",children:[D&&D.length>0?s("div",{className:"divide-y divide-white/10",children:st.map(e=>{var r;return s("div",{className:"p-4 hover:bg-white/5 transition-colors",children:a("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[a("div",{className:"flex items-center gap-3",children:[s("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-orange-500 to-red-500 flex items-center justify-center text-white font-bold",children:((r=e.name)==null?void 0:r.charAt(0).toUpperCase())||"U"}),a("div",{children:[s(w,{variant:"body1",className:"font-medium",children:e.name||"Unknown User"}),s(w,{variant:"body2",color:"textSecondary",children:e.email||"No email"}),s("div",{className:"flex flex-wrap gap-1 mt-2",children:e.roles&&e.roles.length>0?a(ts,{children:[e.roles.slice(0,3).map((n,l)=>s(X,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:n.name},l)),e.roles.length>3&&a(X,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",e.roles.length-3," more"]})]}):s(X,{size:"sm",variant:"flat",color:"default",className:"text-xs",children:"No roles assigned"})})]})]}),s("div",{className:"flex gap-2",children:s(Oe,{content:"Assign Roles",children:s(_,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>dt(e),className:"text-orange-400 hover:text-orange-300",children:s(Ts,{className:"w-4 h-4"})})})})]})},e.id)})}):a("div",{className:"text-center py-12",children:[s(qe,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(w,{variant:"body1",children:"No users found"}),s(w,{variant:"body2",children:"Users data is not available. Please ensure users are loaded from the backend."})]}),Se.length>le&&a("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[a(w,{variant:"body2",children:["Showing ",xe*le+1," to ",Math.min((xe+1)*le,Se.length)," of ",Se.length," users"]}),a("div",{className:"flex gap-2",children:[s(_,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:xe===0,onPress:()=>Ve(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s(_,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(xe+1)*le>=Se.length,onPress:()=>Ve(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),Rt=()=>a(ts,{children:[a(rs,{open:Je,onClose:E?void 0:es,maxWidth:"md",title:a("div",{className:"flex items-center gap-2",children:[s(Pe,{className:"w-6 h-6"}),re?"Edit Role":"Create New Role",J.roles===S.LOADING&&s("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"})]}),actions:a("div",{className:"flex gap-3",children:[s(_,{variant:"light",onPress:es,isDisabled:E,children:"Cancel"}),s(_,{color:"primary",onPress:gt,isLoading:E,children:re?"Update Role":"Create Role"})]}),children:[J.roles===S.ERROR&&s("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:s("p",{className:"text-danger text-sm",children:"Failed to save role. Please check the form and try again."})}),a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[s("div",{className:"col-span-1",children:s(Y,{label:"Role Name",placeholder:"Enter role name",value:Z.name,onValueChange:e=>Ne(r=>({...r,name:e})),isInvalid:!!V.name,errorMessage:V.name,description:"Unique identifier for the role",isRequired:!0,isDisabled:E,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-1",children:a(Ee,{label:"Guard Name",placeholder:"Select guard",selectedKeys:[Z.guard_name],onSelectionChange:e=>{const r=Array.from(e)[0];Ne(n=>({...n,guard_name:r}))},isDisabled:E,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:[s(W,{value:"web",children:"Web"},"web"),s(W,{value:"api",children:"API"},"api")]})}),s("div",{className:"col-span-2",children:s(Y,{label:"Description",placeholder:"Optional description of role responsibilities",value:Z.description,onValueChange:e=>Ne(r=>({...r,description:e})),isDisabled:E,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70"}})})]})]}),s(rs,{open:Ze,onClose:E?void 0:ss,maxWidth:"md",title:a("div",{className:"flex items-center gap-2",children:[s(ke,{className:"w-6 h-6"}),ae?"Edit Permission":"Create New Permission"]}),actions:a("div",{className:"flex gap-3",children:[s(_,{variant:"light",onPress:ss,isDisabled:E,children:"Cancel"}),s(_,{color:"success",onPress:ft,isLoading:E,children:ae?"Update Permission":"Create Permission"})]}),children:a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[s("div",{className:"col-span-1",children:s(Y,{label:"Permission Name",placeholder:"e.g., users.create",value:H.name,onValueChange:e=>de(r=>({...r,name:e})),isInvalid:!!V.name,errorMessage:V.name,description:"Use format: module.action (e.g., users.create)",isRequired:!0,isDisabled:E,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-1",children:s(Y,{label:"Display Name",placeholder:"Human-readable name",value:H.display_name,onValueChange:e=>de(r=>({...r,display_name:e})),isInvalid:!!V.display_name,errorMessage:V.display_name,description:"Human-readable name",isRequired:!0,isDisabled:E,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-1",children:s(Ee,{label:"Module",placeholder:"Select module",selectedKeys:H.module?[H.module]:[],onSelectionChange:e=>{const r=Array.from(e)[0];de(n=>({...n,module:r}))},isInvalid:!!V.module,errorMessage:V.module,isDisabled:E,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:De.map(e=>s(W,{value:e,children:e},e))})}),s("div",{className:"col-span-1",children:s(Y,{label:"Guard Name",placeholder:"Usually 'web'",value:H.guard_name,onValueChange:e=>de(r=>({...r,guard_name:e})),description:"Usually 'web' for web permissions",isDisabled:E,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-2",children:s(Y,{label:"Description",placeholder:"Optional description of what this permission allows",value:H.description,onValueChange:e=>de(r=>({...r,description:e})),description:"Optional description of what this permission allows",isDisabled:E,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})})]})}),s(rs,{open:Js,onClose:()=>fe(!1),maxWidth:"sm",title:a("div",{className:"flex items-center gap-2",children:[s(Is,{className:"w-6 h-6 text-danger"}),"Confirm Delete"]}),actions:a("div",{className:"flex gap-3",children:[s(_,{variant:"light",onPress:()=>fe(!1),children:"Cancel"}),a(_,{color:"danger",onPress:be?ht:pt,isLoading:E,children:["Delete ",be?"Role":"Permission"]})]}),children:a("p",{className:"text-white/90",children:["Are you sure you want to delete ",be?`the role "${be.name}"`:Ie?`the permission "${Ie.name}"`:"this item","? This action cannot be undone."]})})]});return a(ts,{children:[s(Pt,{title:L}),s(Ws,{open:!!Es,autoHideDuration:3e3,onClose:()=>ce(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:s(is,{severity:"success",variant:"filled",onClose:()=>ce(""),children:Es})}),s(Ws,{open:!!ks,autoHideDuration:5e3,onClose:()=>O(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:s(is,{severity:"error",variant:"filled",onClose:()=>O(""),children:ks})}),T.length>0&&s(Re,{sx:{mb:2},children:s(is,{severity:"warning",variant:"outlined",icon:s(Is,{className:"w-5 h-5"}),action:s(_,{color:"warning",size:"small",onClick:()=>{Et.reload({only:["roles","permissions","users"]})},startContent:s(kt,{className:"w-4 h-4"}),children:"Refresh Data"}),children:a(Re,{children:[s(w,{variant:"subtitle2",sx:{mb:1},children:"Data Integrity Issues Detected"}),s(Re,{component:"ul",sx:{m:0,pl:2},children:T.map((e,r)=>s(w,{component:"li",variant:"body2",sx:{mb:.5},children:e},r))}),s(w,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:"This may indicate a cache or database synchronization issue on the server."})]})})}),s(Re,{sx:{display:"flex",justifyContent:"center",p:2},children:s(Ys,{in:!0,children:s(Ot,{children:s(Ft,{title:"Role & Permission Management",subtitle:"Comprehensive access control and permission management system",icon:s(jt,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Export Data",icon:s(Ht,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-success-rgb),0.3)] bg-[rgba(var(--theme-success-rgb),0.05)] hover:bg-[rgba(var(--theme-success-rgb),0.1)]"}],children:a("div",{className:"p-6",children:[s(Tt,{stats:[{title:"Total Roles",value:p.length,icon:s(Pe,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:c.length,icon:s(ke,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Users",value:D.length,icon:s(qe,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"System users"},{title:"Modules",value:De.length,icon:s(Gt,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Permission modules"}]}),a(Re,{sx:{width:"100%",mt:4},children:[s(Re,{sx:{borderBottom:1,borderColor:"divider"},children:a(Wt,{value:$,onChange:(e,r)=>k(r),"aria-label":"role management tabs",sx:{"& .MuiTab-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-selected":{color:"#3b82f6"}},"& .MuiTabs-indicator":{backgroundColor:"#3b82f6"}},children:[s(Qe,{label:"Roles Management",icon:s(Pe,{className:"w-5 h-5"}),iconPosition:"start"}),s(Qe,{label:"Permissions Management",icon:s(ke,{className:"w-5 h-5"}),iconPosition:"start"}),s(Qe,{label:"Role-Permission Assignment",icon:s(os,{className:"w-5 h-5"}),iconPosition:"start"}),s(Qe,{label:"User-Role Assignment",icon:s(qe,{className:"w-5 h-5"}),iconPosition:"start"})]})}),$===0&&s(xt,{}),$===1&&s(Nt,{}),$===2&&s(St,{}),$===3&&s(Ct,{})]})]})})})})}),Rt()]})};or.layout=i=>s($t,{children:i});export{or as default};
