import{V as ae,j as o,a as e,F as I}from"./app-DYElJ_YW.js";import{r as d,u as Y,t as z,W as se,T as de,c as ce,G as D,F as J,k as K,S as Q,M as G,U as ee,b as U,B as ue,X as pe,Y as oe,Z as le,$ as me,f as re}from"./vendor-CTZgMKHz.js";import{B as X}from"./App-Bp4z9Ajw.js";import{E as he,D as ge}from"./Edit-D8i8ckpX.js";import{l as ye,s as be}from"./chunk-7H6JMIKS-CxdqbXEv.js";import{t as fe,b as xe,a as Ce,d as ve,e as De,c as _e}from"./chunk-YRZGWF2W-B5DNVXB0.js";import{p as ke}from"./chunk-MT6723RH-oofjVWgE.js";import{t as te}from"./chunk-LY4WDGUU-B-iUDTe5.js";import{u as Se}from"./chunk-TLBGAR4N-DLIHBIEB.js";import{d as Te,G as ne}from"./GlassDialog-CLfXDKpx.js";import{L as we}from"./LoadingButton-Bl_iSpGd.js";var Pe={name:"inyrtd",styles:"width:110px"};const je=({leaves:F,allUsers:y,handleClickOpen:g,setCurrentLeave:A,openModal:r,setLeaves:L,setCurrentPage:R,currentPage:b,totalRows:W,lastPage:f,perPage:Z,selectedMonth:H,employee:i})=>{console.log(F);const{auth:_}=ae().props,[$,x]=d.useState(null),N=Y(),C=_.roles.includes("Administrator");_.roles.includes("Supervision Engineer");const j=t=>R(t),k=()=>x(null),O=async(t,p)=>{console.error(t),k(),await S(t,"status",p)},S=async(t,p,T)=>{console.log(t);const l=new Promise(async(c,s)=>{try{const m=await axios.post(route("leave-update-status"),{id:t.id,[p]:T});m.status===200&&(L(B=>B.map(w=>w.id===t.id?{...w,[p]:T}:w)),c([m.data.message||"Leave status updated successfully"]))}catch(m){const B=m.response?m.response.status===422?m.response.statusText||"Failed to update leave status":"An unexpected error occurred. Please try again later.":m.request?"No response received from the server. Please check your internet connection.":"An error occurred while setting up the request.";s(B),console.error(m)}});X.promise(l,{pending:{render:()=>o("div",{style:{display:"flex",alignItems:"center"},children:[e(z,{}),e("span",{style:{marginLeft:"8px"},children:"Updating leave status..."})]}),icon:!1,style:M(N)},success:{render:({data:c})=>e(I,{children:c.map((s,m)=>e("div",{children:s},m))}),icon:"ðŸŸ¢",style:M(N)},error:{render:({data:c})=>e(I,{children:c}),icon:"ðŸ”´",style:M(N)}})},M=t=>({backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}),E=t=>({New:"primary",Pending:"secondary",Approved:"success",Declined:"danger"})[t]||"primary",V=(t,p)=>{const T=t[p];switch(p){case"employee":const l=y.find(c=>String(c.id)===String(t.user_id));return e(Se,{avatarProps:{radius:"lg",src:l==null?void 0:l.profile_image},description:l==null?void 0:l.phone,name:l==null?void 0:l.name,children:l==null?void 0:l.email});case"from_date":case"to_date":return new Date(T).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"});case"status":return e(be,{isDisabled:!C&&route().current()!=="leaves","aria-label":"Leave Status",color:E(t.status),placeholder:"Select status",size:"sm",selectedKeys:[t.status],onChange:c=>O(t,c.target.value),css:Pe,children:["New","Pending","Approved","Declined"].map(c=>e(ye,{value:c,children:c},c))});case"actions":return o("div",{className:"relative flex items-center gap-2",children:[e(te,{content:"Edit Leave",children:e("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>{A(t),r("edit_leave")},children:e(he,{})})}),e(te,{content:"Delete Leave",color:"danger",children:e("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>g(t.id,"delete_leave"),children:e(ge,{})})})]});default:return T}},q=[...C?[{name:"Employee",uid:"employee"}]:[],{name:"Leave Type",uid:"leave_type"},{name:"From Date",uid:"from_date"},{name:"To Date",uid:"to_date"},{name:"Status",uid:"status"},{name:"Reason",uid:"reason"},...C?[{name:"Actions",uid:"actions"}]:[]];return o("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[o(fe,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Employee Table",children:[e(Ce,{columns:q,children:t=>e(xe,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(_e,{items:F,children:t=>e(ve,{children:p=>e(De,{style:{whiteSpace:"nowrap"},children:V(t,p)})},t.id)})]}),W>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:b,total:f,onChange:j})})]})},Oe=({open:F,closeModal:y,leavesData:g,setLeavesData:A,currentLeave:r,allUsers:L,setTotalRows:R,setLastPage:b,setLeaves:W,handleMonthChange:f,employee:Z})=>{const{auth:H}=ae().props,i=Y(),[_,$]=d.useState((r==null?void 0:r.user_id)||H.user.id),[x,N]=d.useState(g.leaveTypes||[]),[C,j]=d.useState(g.leaveCounts||[]),[k,O]=d.useState((r==null?void 0:r.leave_type)||(x.length>0?x[0].type:"")),[S,M]=d.useState((r==null?void 0:r.from_date)||""),[E,V]=d.useState((r==null?void 0:r.to_date)||""),[q,t]=d.useState((r==null?void 0:r.no_of_days)||""),[p,T]=d.useState(""),[l,c]=d.useState((r==null?void 0:r.reason)||""),[s,m]=d.useState({}),[B,w]=d.useState(!1),[Fe,ie]=d.useState("");return d.useEffect(()=>{g&&(N(g.leaveTypes||[]),j(g.leaveCountsByUser[_]||[]))},[g,_]),d.useEffect(()=>{var h;const a=((h=C==null?void 0:C.find(u=>u.leave_type===k))==null?void 0:h.days_used)||0;ie(a);const P=x==null?void 0:x.find(u=>u.type===k);P&&T(P.days-a)},[k,C,x]),d.useEffect(()=>{t(((P,h)=>{if(!P||!h)return"";const u=new Date(P),n=new Date(h);if(u>n)return"";const v=n.getTime()-u.getTime();return Math.ceil(v/(1e3*3600*24))+1})(S,E))},[S,E]),o(ne,{open:F,onClose:y,fullWidth:!0,maxWidth:"sm",children:[o(se,{sx:{display:"flex",alignItems:"center"},children:[e(de,{variant:"h6",children:"Add Leave"}),e(ce,{onClick:y,sx:{position:"absolute",top:8,right:16},children:e(Te,{})})]}),o("form",{onSubmit:async a=>{a.preventDefault(),w(!0);const P=new Promise(async(h,u)=>{try{const n={route:route().current(),user_id:_,leaveType:k,fromDate:S,toDate:E,daysCount:q,leaveReason:l,employee:Z};r&&(n.id=r.id);const v=await axios.post(route("leave-add"),n);v.status===200&&(A(v.data.leavesData),R(v.data.leavesData.leaveRecords.total),b(v.data.leavesData.leaveRecords.last_page),W(v.data.leavesData.leaveRecords.data),f({target:{value:S.slice(0,7)}}),y(),h([v.data.message||"Leave application submitted successfully"]))}catch(n){console.error(n),w(!1),n.response?(n.response.status===422?(m(n.response.data.errors||{}),u(n.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(n.response.data.error)):n.request?(u("No response received from the server. Please check your internet connection."),console.error(n.request)):(u("An error occurred while setting up the request."),console.error("Error",n.message))}finally{w(!1)}});X.promise(P,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(z,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:i.glassCard.backgroundColor,border:i.glassCard.border,color:i.palette.text.primary}},success:{render({data:h}){return e(I,{children:h.map((u,n)=>e("div",{children:u},n))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:i.glassCard.backgroundColor,border:i.glassCard.border,color:i.palette.text.primary}},error:{render({data:h}){return e(I,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:i.glassCard.backgroundColor,border:i.glassCard.border,color:i.palette.text.primary}}})},children:[e(oe,{children:o(D,{container:!0,spacing:2,children:[e(D,{item:!0,xs:12,md:6,children:o(J,{fullWidth:!0,children:[e(K,{id:"leave-type-label",children:"Leave Type"}),o(Q,{labelId:"leave-type-label",value:k,onChange:a=>O(a.target.value),label:"Leave Type",error:!!s.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:i.glassCard.backgroundColor,border:i.glassCard.border,borderRadius:2,boxShadow:i.glassCard.boxShadow}}},children:[e(G,{value:"",disabled:!0,children:"Select Leave Type"}),x.map(a=>o(G,{value:a.type,children:[a.type," ",a.days," Days"]},a.id))]}),e(ee,{children:s.leaveType})]})}),e(D,{item:!0,xs:12,md:6,children:e(U,{label:"From",type:"date",fullWidth:!0,value:S,onChange:a=>M(a.target.value),InputLabelProps:{shrink:!0},error:!!s.fromDate,helperText:s.fromDate})}),e(D,{item:!0,xs:12,md:6,children:e(U,{label:"To",type:"date",fullWidth:!0,value:E,onChange:a=>V(a.target.value),InputLabelProps:{shrink:!0},error:!!s.toDate,helperText:s.toDate})}),e(D,{item:!0,xs:12,md:6,children:e(U,{label:"Number of days",type:"text",fullWidth:!0,value:q,InputProps:{readOnly:!0},error:!!s.daysCount,helperText:s.daysCount})}),e(D,{item:!0,xs:12,md:6,children:e(U,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:p,InputProps:{readOnly:!0},error:!!s.remainingLeaves,helperText:s.remainingLeaves})}),H.roles.includes("Administrator")&&route().current()==="leaves"&&e(D,{item:!0,xs:12,md:6,children:o(J,{fullWidth:!0,children:[e(K,{id:"leave-employee-label",children:"Employee"}),o(Q,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:_||"na",error:!!s.user_id,onChange:a=>$(a.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:i.glassCard.backgroundColor,border:i.glassCard.border,borderRadius:2,boxShadow:i.glassCard.boxShadow}}},children:[e(G,{value:"na",disabled:!0,children:"Please select"}),L.map(a=>e(G,{value:a.id,children:o(ue,{sx:{display:"flex"},children:[e(pe,{src:a.profile_image,alt:a.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),a.name]})},a.id))]}),e(ee,{children:s.user_id})]})}),e(D,{item:!0,xs:12,children:e(U,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:l,onChange:a=>c(a.target.value),error:!!s.leaveReason,helperText:s.leaveReason})})]})}),e(le,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:B,disabled:B,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ve=({open:F,handleClose:y,leaveIdToDelete:g,setLeavesData:A})=>{const r=Y();return o(ne,{open:F,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(se,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(oe,{children:e(me,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(le,{children:[e(re,{onClick:y,color:"primary",children:"Cancel"}),e(re,{onClick:()=>{const R=new Promise(async(b,W)=>{try{const f=await axios.delete(route("leave-delete",{id:g,route:route().current()}));f.status===200&&(A(f.data.leavesData),b("Leave application deleted successfully"))}catch(f){console.error("Error deleting task:",f),W(f.response.data.error||"Failed to delete leave application")}finally{y()}});X.promise(R,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(z,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:b}){return e(I,{children:b})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:b}){return e(I,{children:b})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{Ve as D,Oe as L,je as a};
