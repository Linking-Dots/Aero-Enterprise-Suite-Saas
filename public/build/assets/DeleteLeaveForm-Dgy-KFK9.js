import{V as ae,j as o,a as e,F as E}from"./app-B-_JgO5j.js";import{r as d,u as X,t as Z,W as se,T as de,c as ce,G as S,F as J,k as K,S as Q,M as G,U as ee,b as M,B as ue,X as pe,Y as oe,Z as le,$ as me,f as re}from"./vendor-CTZgMKHz.js";import{B as $}from"./App-IbWDRuYy.js";import{E as he,D as ge}from"./Edit-D8i8ckpX.js";import{l as ye,s as be}from"./chunk-7H6JMIKS-1d7NZuOy.js";import{t as fe,b as xe,a as Ce,d as ve,e as De,c as _e}from"./chunk-YRZGWF2W-F7ALnk6e.js";import{p as ke}from"./chunk-MT6723RH-DiXTBkLH.js";import{t as te}from"./chunk-LY4WDGUU-Bj-J_YSI.js";import{u as Se}from"./chunk-TLBGAR4N-D78LIqQs.js";import{d as Te,G as ne}from"./GlassDialog-mZPdmifM.js";import{L as we}from"./LoadingButton-Bl_iSpGd.js";var Pe={name:"inyrtd",styles:"width:110px"};const He=({leaves:P,allUsers:g,handleClickOpen:h,setCurrentLeave:B,openModal:r,setLeaves:U,setCurrentPage:I,currentPage:y,totalRows:A,lastPage:b,perPage:H,selectedMonth:n,employee:F})=>{console.log(P);const{auth:L}=ae().props,[C,j]=d.useState(null),v=X(),R=L.roles.includes("Administrator");L.roles.includes("Supervision Engineer");const D=t=>I(t),O=()=>j(null),_=async(t,p)=>{console.error(t),O(),await V(t,"status",p)},V=async(t,p,x)=>{console.log(t);const i=new Promise(async(a,N)=>{try{const c=await axios.post(route("leave-update-status"),{id:t.id,[p]:x});c.status===200&&(U(T=>T.map(q=>q.id===t.id?{...q,[p]:x}:q)),a([c.data.message||"Leave status updated successfully"]))}catch(c){const T=c.response?c.response.status===422?c.response.statusText||"Failed to update leave status":"An unexpected error occurred. Please try again later.":c.request?"No response received from the server. Please check your internet connection.":"An error occurred while setting up the request.";N(T),console.error(c)}});$.promise(i,{pending:{render:()=>o("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Updating leave status..."})]}),icon:!1,style:f(v)},success:{render:({data:a})=>e(E,{children:a.map((N,c)=>e("div",{children:N},c))}),icon:"ðŸŸ¢",style:f(v)},error:{render:({data:a})=>e(E,{children:a}),icon:"ðŸ”´",style:f(v)}})},f=t=>({backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}),Y=t=>({New:"primary",Pending:"secondary",Approved:"success",Declined:"danger"})[t]||"primary",W=(t,p)=>{const x=t[p];switch(p){case"employee":const i=g.find(a=>String(a.id)===String(t.user_id));return e(Se,{avatarProps:{radius:"lg",src:i==null?void 0:i.profile_image},description:i==null?void 0:i.phone,name:i==null?void 0:i.name,children:i==null?void 0:i.email});case"from_date":case"to_date":return new Date(x).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"});case"status":return e(be,{isDisabled:!R&&route().current()!=="leaves","aria-label":"Leave Status",color:Y(t.status),placeholder:"Select status",size:"sm",selectedKeys:[t.status],onChange:a=>_(t,a.target.value),css:Pe,children:["New","Pending","Approved","Declined"].map(a=>e(ye,{value:a,children:a},a))});case"actions":return o("div",{className:"relative flex items-center gap-2",children:[e(te,{content:"Edit Leave",children:e("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>{B(t),r("edit_leave")},children:e(he,{})})}),e(te,{content:"Delete Leave",color:"danger",children:e("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>h(t.id,"delete_leave"),children:e(ge,{})})})]});default:return x}},z=[...R?[{name:"Employee",uid:"employee"}]:[],{name:"Leave Type",uid:"leave_type"},{name:"From Date",uid:"from_date"},{name:"To Date",uid:"to_date"},{name:"Status",uid:"status"},{name:"Reason",uid:"reason"},...R?[{name:"Actions",uid:"actions"}]:[]];return o("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[o(fe,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Employee Table",children:[e(Ce,{columns:z,children:t=>e(xe,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(_e,{items:P,children:t=>e(ve,{children:p=>e(De,{style:{whiteSpace:"nowrap"},children:W(t,p)})},t.id)})]}),A>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:y,total:b,onChange:D})})]})},je=({open:P,closeModal:g,leavesData:h,setLeavesData:B,currentLeave:r,allUsers:U,setTotalRows:I,setLastPage:y,setLeaves:A,handleMonthChange:b})=>{const{auth:H}=ae().props,n=X(),[F,L]=d.useState((r==null?void 0:r.user_id)||H.user.id),[C,j]=d.useState(h.leaveTypes||[]),[v,R]=d.useState(h.leaveCounts||[]),[D,O]=d.useState((r==null?void 0:r.leave_type)||(C.length>0?C[0].type:"")),[_,V]=d.useState((r==null?void 0:r.from_date)||""),[f,Y]=d.useState((r==null?void 0:r.to_date)||""),[W,z]=d.useState((r==null?void 0:r.no_of_days)||""),[t,p]=d.useState(""),[x,i]=d.useState((r==null?void 0:r.reason)||""),[a,N]=d.useState({}),[c,T]=d.useState(!1),[q,ie]=d.useState("");return d.useEffect(()=>{h&&(j(h.leaveTypes||[]),R(h.leaveCountsByUser[F]||[]))},[h,F]),d.useEffect(()=>{var m;const s=((m=v==null?void 0:v.find(u=>u.leave_type===D))==null?void 0:m.days_used)||0;ie(s);const w=C==null?void 0:C.find(u=>u.type===D);w&&p(w.days-s)},[D,v,C]),d.useEffect(()=>{z(((w,m)=>{if(!w||!m)return"";const u=new Date(w),l=new Date(m);if(u>l)return"";const k=l.getTime()-u.getTime();return Math.ceil(k/(1e3*3600*24))+1})(_,f))},[_,f]),o(ne,{open:P,onClose:g,fullWidth:!0,maxWidth:"sm",children:[o(se,{sx:{display:"flex",alignItems:"center"},children:[e(de,{variant:"h6",children:"Add Leave"}),e(ce,{onClick:g,sx:{position:"absolute",top:8,right:16},children:e(Te,{})})]}),o("form",{onSubmit:async s=>{s.preventDefault(),T(!0);const w=new Promise(async(m,u)=>{console.log(F,D,_,f,W,x);try{const l={route:route().current(),user_id:F,leaveType:D,fromDate:_,toDate:f,daysCount:W,leaveReason:x};r&&(l.id=r.id);const k=await axios.post(route("leave-add"),l);k.status===200&&(B(k.data.leavesData),I(k.data.leavesData.leaveRecords.total),y(k.data.leavesData.leaveRecords.last_page),A(k.data.leavesData.leaveRecords.data),b({target:{value:_.slice(0,7)}}),g(),m([k.data.message||"Leave application submitted successfully"]))}catch(l){console.error(l),T(!1),l.response?(l.response.status===422?(N(l.response.data.errors||{}),u(l.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(l.response.data.error)):l.request?(u("No response received from the server. Please check your internet connection."),console.error(l.request)):(u("An error occurred while setting up the request."),console.error("Error",l.message))}finally{T(!1)}});$.promise(w,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:m}){return e(E,{children:m.map((u,l)=>e("div",{children:u},l))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:m}){return e(E,{children:m})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,color:n.palette.text.primary}}})},children:[e(oe,{children:o(S,{container:!0,spacing:2,children:[e(S,{item:!0,xs:12,md:6,children:o(J,{fullWidth:!0,children:[e(K,{id:"leave-type-label",children:"Leave Type"}),o(Q,{labelId:"leave-type-label",value:D,onChange:s=>O(s.target.value),label:"Leave Type",error:!!a.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,borderRadius:2,boxShadow:n.glassCard.boxShadow}}},children:[e(G,{value:"",disabled:!0,children:"Select Leave Type"}),C.map(s=>o(G,{value:s.type,children:[s.type," ",s.days," Days"]},s.id))]}),e(ee,{children:a.leaveType})]})}),e(S,{item:!0,xs:12,md:6,children:e(M,{label:"From",type:"date",fullWidth:!0,value:_,onChange:s=>V(s.target.value),InputLabelProps:{shrink:!0},error:!!a.fromDate,helperText:a.fromDate})}),e(S,{item:!0,xs:12,md:6,children:e(M,{label:"To",type:"date",fullWidth:!0,value:f,onChange:s=>Y(s.target.value),InputLabelProps:{shrink:!0},error:!!a.toDate,helperText:a.toDate})}),e(S,{item:!0,xs:12,md:6,children:e(M,{label:"Number of days",type:"text",fullWidth:!0,value:W,InputProps:{readOnly:!0},error:!!a.daysCount,helperText:a.daysCount})}),e(S,{item:!0,xs:12,md:6,children:e(M,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:t,InputProps:{readOnly:!0},error:!!a.remainingLeaves,helperText:a.remainingLeaves})}),H.roles.includes("Administrator")&&route().current()==="leaves"&&e(S,{item:!0,xs:12,md:6,children:o(J,{fullWidth:!0,children:[e(K,{id:"leave-employee-label",children:"Employee"}),o(Q,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:F||"na",error:!!a.user_id,onChange:s=>L(s.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:n.glassCard.backgroundColor,border:n.glassCard.border,borderRadius:2,boxShadow:n.glassCard.boxShadow}}},children:[e(G,{value:"na",disabled:!0,children:"Please select"}),U.map(s=>e(G,{value:s.id,children:o(ue,{sx:{display:"flex"},children:[e(pe,{src:s.profile_image,alt:s.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),s.name]})},s.id))]}),e(ee,{children:a.user_id})]})}),e(S,{item:!0,xs:12,children:e(M,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:x,onChange:s=>i(s.target.value),error:!!a.leaveReason,helperText:a.leaveReason})})]})}),e(le,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:c,disabled:c,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Oe=({open:P,handleClose:g,leaveIdToDelete:h,setLeavesData:B})=>{const r=X();return o(ne,{open:P,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(se,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(oe,{children:e(me,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(le,{children:[e(re,{onClick:g,color:"primary",children:"Cancel"}),e(re,{onClick:()=>{const I=new Promise(async(y,A)=>{try{const b=await axios.delete(route("leave-delete",{id:h,route:route().current()}));b.status===200&&(B(b.data.leavesData),y("Leave application deleted successfully"))}catch(b){console.error("Error deleting task:",b),A(b.response.data.error||"Failed to delete leave application")}finally{g()}});$.promise(I,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:y}){return e(E,{children:y})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:y}){return e(E,{children:y})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{Oe as D,je as L,He as a};
