import{V as te,j as l,a as e,F as w}from"./app-B7dlnk2H.js";import{r as c,u as j,t as O,X as re,T as le,c as ne,G as x,F as Z,k as $,S as J,M as U,V as K,b as A,B as ie,Y as de,Z as ae,$ as se,a0 as ce,f as Q}from"./vendor-DrHmFQFl.js";import{B as Y}from"./App-CFbuokWX.js";import{E as ue,D as pe}from"./Edit-CtMoSlB4.js";import{l as me,s as he}from"./chunk-QEQ4EHOG-DN0svgQ5.js";import{t as ge,b as ye,a as be,d as fe,e as xe,c as Ce}from"./chunk-YRZGWF2W-BrjnZ63j.js";import{p as ve}from"./chunk-MRXO6UUP-BP6jF2RE.js";import{t as ee}from"./chunk-KQ7OR4H5-Bslgpmgo.js";import{u as _e}from"./chunk-TLBGAR4N-DsWC6QGo.js";import{d as De,G as oe}from"./GlassDialog-DQG0VLYy.js";import{L as ke}from"./LoadingButton-CUeR6bzk.js";var Se={name:"inyrtd",styles:"width:110px"};const Ue=({allLeaves:P,allUsers:h,handleClickOpen:g,setCurrentLeave:F,openModal:r,setLeavesData:R,setCurrentPage:k,setPerPage:o,perPage:C,currentPage:y,totalRows:b,lastPage:L})=>{const{auth:v}=te().props,[z,_]=c.useState(null),E=j(),f=v.roles.includes("Administrator");v.roles.includes("Supervision Engineer");const q=t=>k(t),S=()=>_(null),G=async(t,s)=>{S(),await W(t,"status",s)},W=async(t,s,T)=>{const n=new Promise(async(i,M)=>{try{const u=await axios.post(route("leave-add"),{route:route().current(),user_id:t.user_id,id:t.id,leaveType:t.leave_type,fromDate:t.from_date,toDate:t.to_date,daysCount:t.no_of_days,leaveReason:t.reason,[s]:T});u.status===200&&(R(u.data.leavesData),i([u.data.message||"Leave status updated successfully"]))}catch(u){const X=u.response?u.response.status===422?u.response.statusText||"Failed to update leave status":"An unexpected error occurred. Please try again later.":u.request?"No response received from the server. Please check your internet connection.":"An error occurred while setting up the request.";M(X),console.error(u)}});Y.promise(n,{pending:{render:()=>l("div",{style:{display:"flex",alignItems:"center"},children:[e(O,{}),e("span",{style:{marginLeft:"8px"},children:"Updating leave status..."})]}),icon:!1,style:B(E)},success:{render:({data:i})=>e(w,{children:i.map((M,u)=>e("div",{children:M},u))}),icon:"ðŸŸ¢",style:B(E)},error:{render:({data:i})=>e(w,{children:i}),icon:"ðŸ”´",style:B(E)}})},B=t=>({backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}),H=t=>({New:"primary",Pending:"secondary",Approved:"success",Declined:"danger"})[t]||"primary",V=(t,s)=>{const T=t[s];switch(s){case"employee":const n=h.find(i=>String(i.id)===String(t.user_id));return e(_e,{avatarProps:{radius:"lg",src:n==null?void 0:n.profile_image},description:n==null?void 0:n.phone,name:n==null?void 0:n.name,children:n==null?void 0:n.email});case"from_date":case"to_date":return new Date(T).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"});case"status":return e(he,{isDisabled:!f&&route().current()!=="leaves","aria-label":"Leave Status",color:H(t.status),placeholder:"Select status",size:"sm",selectedKeys:[t.status],onChange:i=>G(t,i.target.value),css:Se,children:["New","Pending","Approved","Declined"].map(i=>e(me,{value:i,children:i},i))});case"actions":return l("div",{className:"relative flex items-center gap-2",children:[e(ee,{content:"Edit Leave",children:e("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>{F(t),r("edit_leave")},children:e(ue,{})})}),e(ee,{content:"Delete Leave",color:"danger",children:e("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>g(t.id,"delete_leave"),children:e(pe,{})})})]});default:return T}},N=[...f?[{name:"Employee",uid:"employee"}]:[],{name:"Leave Type",uid:"leave_type"},{name:"From Date",uid:"from_date"},{name:"To Date",uid:"to_date"},{name:"Status",uid:"status"},{name:"Reason",uid:"reason"},...f?[{name:"Actions",uid:"actions"}]:[]];return l("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[l(ge,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Employee Table",children:[e(be,{columns:N,children:t=>e(ye,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(Ce,{items:P,children:t=>e(fe,{children:s=>e(xe,{style:{whiteSpace:"nowrap"},children:V(t,s)})},t.id)})]}),b>30&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(ve,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:y,total:L,onChange:q})})]})},Le=({open:P,closeModal:h,leavesData:g,setLeavesData:F,currentLeave:r,allUsers:R})=>{const{auth:k}=te().props,o=j(),[C,y]=c.useState((r==null?void 0:r.user_id)||k.user.id),[b,L]=c.useState(g.leaveTypes||[]),[v,z]=c.useState([]),[_,E]=c.useState((r==null?void 0:r.leave_type)||(b.length>0?b[0].type:"")),[f,q]=c.useState((r==null?void 0:r.from_date)||""),[S,G]=c.useState((r==null?void 0:r.to_date)||""),[W,B]=c.useState((r==null?void 0:r.no_of_days)||""),[H,V]=c.useState(""),[N,t]=c.useState((r==null?void 0:r.reason)||""),[s,T]=c.useState({}),[n,i]=c.useState(!1),[M,u]=c.useState("");return c.useEffect(()=>{g&&(L(g.leaveTypes||[]),z(g.leaveCountsByUser[C]||[]))},[g,C]),c.useEffect(()=>{var m;const a=((m=v==null?void 0:v.find(p=>p.leave_type===_))==null?void 0:m.days_used)||0;u(a);const D=b==null?void 0:b.find(p=>p.type===_);D&&V(D.days-a)},[_,v,b]),c.useEffect(()=>{B(((D,m)=>{if(!D||!m)return"";const p=new Date(D),d=new Date(m);if(p>d)return"";const I=d.getTime()-p.getTime();return Math.ceil(I/(1e3*3600*24))+1})(f,S))},[f,S]),l(oe,{open:P,onClose:h,fullWidth:!0,maxWidth:"sm",children:[l(re,{sx:{display:"flex",alignItems:"center"},children:[e(le,{variant:"h6",children:"Add Leave"}),e(ne,{onClick:h,sx:{position:"absolute",top:8,right:16},children:e(De,{})})]}),l("form",{onSubmit:async a=>{a.preventDefault(),i(!0);const D=new Promise(async(m,p)=>{try{const d={route:route().current(),user_id:C,leaveType:_,fromDate:f,toDate:S,daysCount:W,leaveReason:N};r&&(d.id=r.id);const I=await axios.post(route("leave-add"),d);I.status===200&&(F(I.data.leavesData),m([I.data.message||"Leave application submitted successfully"]),h())}catch(d){i(!1),d.response?(d.response.status===422?(T(d.response.data.errors||{}),p(d.response.statusText||"Failed to submit leave application")):p("An unexpected error occurred. Please try again later."),console.error(d.response)):d.request?(p("No response received from the server. Please check your internet connection."),console.error(d.request)):(p("An error occurred while setting up the request."),console.error("Error",d.message))}finally{i(!1)}});Y.promise(D,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(O,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:m}){return e(w,{children:m.map((p,d)=>e("div",{children:p},d))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:m}){return e(w,{children:m})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(ae,{children:l(x,{container:!0,spacing:2,children:[e(x,{item:!0,xs:12,md:6,children:l(Z,{fullWidth:!0,children:[e($,{id:"leave-type-label",children:"Leave Type"}),l(J,{labelId:"leave-type-label",value:_,onChange:a=>E(a.target.value),label:"Leave Type",error:!!s.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(U,{value:"",disabled:!0,children:"Select Leave Type"}),b.map(a=>l(U,{value:a.type,children:[a.type," ",a.days," Days"]},a.id))]}),e(K,{children:s.leaveType})]})}),e(x,{item:!0,xs:12,md:6,children:e(A,{label:"From",type:"date",fullWidth:!0,value:f,onChange:a=>q(a.target.value),InputLabelProps:{shrink:!0},error:!!s.fromDate,helperText:s.fromDate})}),e(x,{item:!0,xs:12,md:6,children:e(A,{label:"To",type:"date",fullWidth:!0,value:S,onChange:a=>G(a.target.value),InputLabelProps:{shrink:!0},error:!!s.toDate,helperText:s.toDate})}),e(x,{item:!0,xs:12,md:6,children:e(A,{label:"Number of days",type:"text",fullWidth:!0,value:W,InputProps:{readOnly:!0},error:!!s.daysCount,helperText:s.daysCount})}),e(x,{item:!0,xs:12,md:6,children:e(A,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:H,InputProps:{readOnly:!0},error:!!s.remainingLeaves,helperText:s.remainingLeaves})}),k.roles.includes("Administrator")&&route().current()==="leaves"&&e(x,{item:!0,xs:12,md:6,children:l(Z,{fullWidth:!0,children:[e($,{id:"leave-employee-label",children:"Employee"}),l(J,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:C||"na",error:!!s.user_id,onChange:a=>y(a.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(U,{value:"na",disabled:!0,children:"Please select"}),R.map(a=>e(U,{value:a.id,children:l(ie,{sx:{display:"flex"},children:[e(de,{src:a.profile_image,alt:a.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),a.name]})},a.id))]}),e(K,{children:s.user_id})]})}),e(x,{item:!0,xs:12,children:e(A,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:N,onChange:a=>t(a.target.value),error:!!s.leaveReason,helperText:s.leaveReason})})]})}),e(se,{sx:{padding:"16px",justifyContent:"center"},children:e(ke,{type:"submit",variant:"outlined",color:"primary",loading:n,disabled:n,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},qe=({open:P,handleClose:h,leaveIdToDelete:g,setLeavesData:F})=>{const r=j();return l(oe,{open:P,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(re,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(ae,{children:e(ce,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(se,{children:[e(Q,{onClick:h,color:"primary",children:"Cancel"}),e(Q,{onClick:()=>{const k=new Promise(async(o,C)=>{try{const y=await axios.delete(route("leave-delete",{id:g,route:route().current()}));y.status===200&&(F(y.data.leavesData),o("Leave application deleted successfully"))}catch(y){console.error("Error deleting task:",y),C(y.response.data.error||"Failed to delete leave application")}finally{h()}});Y.promise(k,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(O,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:o}){return e(w,{children:o})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:o}){return e(w,{children:o})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{qe as D,Le as L,Ue as a};
