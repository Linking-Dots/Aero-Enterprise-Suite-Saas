import{Y as ge,V as fe,J as le,r,j as s,a as e,F as j,Q as be}from"./app-DDhVNfvV.js";import{o as ye,u as ie,G as ve}from"./GlassCard-B8deHOrc.js";import{x as xe,I as Ce,i as m,j as L,B as ne,G as Se,A as Pe}from"./App-CULBC9Jb.js";import{C as De}from"./Clear-Brrz3geX.js";import{G as de}from"./GlassDialog-BbPdd5-L.js";import{D as ce}from"./DialogTitle-DVsFppiK.js";import{T as _e,B as pe}from"./logo-DoLGM3I0.js";import{I as ee,F as te,T as W}from"./TextField-DHyBbceL.js";import{S as re,M as Y}from"./Select-G4UAMmZq.js";import{A as ke}from"./Avatar-pF7eTFjT.js";import{D as ue,a as me}from"./DialogContent-DzqEob6e.js";import{L as Te}from"./LoadingButton-CPf4VyNc.js";import{C as he}from"./CircularProgress-ukpRde3Q.js";import{D as we}from"./DialogContentText-QrzXS9vF.js";import{B as X}from"./Button-PH-Yt16S.js";import{d as Ie}from"./dayjs.min-Dao2E2MD.js";import{C as Fe}from"./CardHeader-BPTzkM70.js";import{A as Re}from"./Add-DaewG29U.js";import{C as ae}from"./CardContent-783YhD2K.js";import{i as oe}from"./chunk-6MDMHKHV-DNEscIMF.js";import{t as Be,a as Ee,b as Me,c as Ae,d as We,e as qe}from"./chunk-F3UDT23P-Bon0qFEG.js";import{p as je}from"./chunk-O5I3QTYU-BlPqa12Y.js";import"./app-CYwLuuRk.js";import"./create-visual-element-DIA5r6xh.js";import"./DocumentTextIcon-QwzC9WoH.js";import"./EnvelopeIcon-jGHS91X9.js";import"./UserGroupIcon-CFQYzcyB.js";import"./UserIcon-BZDmR83e.js";import"./CreditCardIcon-nnu7lg95.js";import"./ShieldCheckIcon-B8pnYfIx.js";import"./ClockIcon-UBQM4q2z.js";import"./QuestionMarkCircleIcon-ClI4UiU9.js";import"./BuildingOfficeIcon-BXNAJj1w.js";import"./KeyIcon-CAZJdP6I.js";import"./CheckCircleIcon-BkPxWqsz.js";import"./ExclamationTriangleIcon-3tpAB86s.js";import"./InformationCircleIcon-D0VUrEF1.js";import"./StarIcon-CB497gpk.js";import"./GlobeAltIcon-BeSAdHAC.js";import"./LockClosedIcon-CNT0kaEE.js";import"./chunk-LGMZDQT5-CF5HrKbt.js";import"./number-DfkVkf0F.js";import"./index-I7bPq2YP.js";import"./chunk-A6PX3NG3-DZLS-1Gt.js";import"./useLabels-Blg_QI1U.js";import"./XMarkIcon-CRGrHH6E.js";import"./useFormReset-Dv_1w4_q.js";import"./chunk-J7I6W5JF-Dj4B-Czi.js";import"./chunk-M3MASYO7-DaLySJZS.js";import"./Dialog-B0tTkTVF.js";import"./Popover-DGnHN2Gx.js";import"./useSlot-vNKPmkVG.js";import"./useLabel-C1JBDqVQ.js";import"./chunk-MZRCPRP2-4Sm2aTj8.js";import"./useHasTabbableChild-BMncZCCk.js";import"./chunk-7F3ZLNJ6-CHfbZssJ.js";import"./index-CokAva9Y.js";var q={},se;function Ge(){if(se)return q;se=1;var y=ye();Object.defineProperty(q,"__esModule",{value:!0}),q.default=void 0;var c=y(xe()),p=ge();return q.default=(0,c.default)((0,p.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),q}var Ye=Ge();const Ue=fe(Ye),He=({open:y,closeModal:c,leavesData:p,setLeavesData:F,currentLeave:t,allUsers:x,setTotalRows:R,setLastPage:h,setLeaves:B,handleMonthChange:g,employee:U})=>{const{auth:E}=le().props,l=ie(),[C,H]=r.useState((t==null?void 0:t.user_id)||E.user.id),[f,D]=r.useState(p.leaveTypes||[]),[_,k]=r.useState(p.leaveCounts||[]),[S,M]=r.useState((t==null?void 0:t.leave_type)||(f.length>0?f[0].type:"")),[T,w]=r.useState((t==null?void 0:t.from_date)||""),[A,N]=r.useState((t==null?void 0:t.to_date)||""),[O,Z]=r.useState((t==null?void 0:t.no_of_days)||""),[J,Q]=r.useState(""),[G,z]=r.useState((t==null?void 0:t.reason)||""),[i,V]=r.useState({}),[o,b]=r.useState(!1),[I,K]=r.useState("");return r.useEffect(()=>{p&&(D(p.leaveTypes||[]),k(p.leaveCountsByUser[C]||[]))},[p,C]),r.useEffect(()=>{var u;const a=((u=_==null?void 0:_.find(d=>d.leave_type===S))==null?void 0:u.days_used)||0;K(a);const P=f==null?void 0:f.find(d=>d.type===S);P&&Q(P.days-a)},[S,_,f]),r.useEffect(()=>{Z(((P,u)=>{if(!P||!u)return"";const d=new Date(P),n=new Date(u);if(d>n)return"";const v=n.getTime()-d.getTime();return Math.ceil(v/(1e3*3600*24))+1})(T,A))},[T,A]),s(de,{open:y,onClose:c,fullWidth:!0,maxWidth:"sm",children:[s(ce,{sx:{display:"flex",alignItems:"center"},children:[e(_e,{variant:"h6",children:"Add Leave"}),e(Ce,{onClick:c,sx:{position:"absolute",top:8,right:16},children:e(De,{})})]}),s("form",{onSubmit:async a=>{a.preventDefault(),b(!0);const P=new Promise(async(u,d)=>{try{const n={route:route().current(),user_id:C,leaveType:S,fromDate:T,toDate:A,daysCount:O,leaveReason:G,employee:U};t&&(n.id=t.id);const v=await axios.post(route("leave-add"),n);v.status===200&&(F(v.data.leavesData),R(v.data.leavesData.leaveRecords.total),h(v.data.leavesData.leaveRecords.last_page),B(v.data.leavesData.leaveRecords.data),g({target:{value:T.slice(0,7)}}),c(),u([v.data.message||"Leave application submitted successfully"]))}catch(n){console.error(n),b(!1),n.response?(n.response.status===422?(V(n.response.data.errors||{}),d(n.response.data.error||"Failed to submit leave application")):d("An unexpected error occurred. Please try again later."),console.error(n.response.data.error)):n.request?(d("No response received from the server. Please check your internet connection."),console.error(n.request)):(d("An error occurred while setting up the request."),console.error("Error",n.message))}finally{b(!1)}});ne.promise(P,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(he,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:u}){return e(j,{children:u.map((d,n)=>e("div",{children:d},n))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:u}){return e(j,{children:u})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,color:l.palette.text.primary}}})},children:[e(ue,{children:s(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,md:6,children:s(L,{fullWidth:!0,children:[e(ee,{id:"leave-type-label",children:"Leave Type"}),s(re,{labelId:"leave-type-label",value:S,onChange:a=>M(a.target.value),label:"Leave Type",error:!!i.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(Y,{value:"",disabled:!0,children:"Select Leave Type"}),f.map(a=>s(Y,{value:a.type,children:[a.type," ",a.days," Days"]},a.id))]}),e(te,{children:i.leaveType})]})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"From",type:"date",fullWidth:!0,value:T,onChange:a=>w(a.target.value),InputLabelProps:{shrink:!0},error:!!i.fromDate,helperText:i.fromDate})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"To",type:"date",fullWidth:!0,value:A,onChange:a=>N(a.target.value),InputLabelProps:{shrink:!0},error:!!i.toDate,helperText:i.toDate})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"Number of days",type:"text",fullWidth:!0,value:O,InputProps:{readOnly:!0},error:!!i.daysCount,helperText:i.daysCount})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:J,InputProps:{readOnly:!0},error:!!i.remainingLeaves,helperText:i.remainingLeaves})}),E.roles.includes("Administrator")&&route().current()==="leaves"&&e(m,{item:!0,xs:12,md:6,children:s(L,{fullWidth:!0,children:[e(ee,{id:"leave-employee-label",children:"Employee"}),s(re,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:C||"na",error:!!i.user_id,onChange:a=>H(a.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:l.glassCard.background,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(Y,{value:"na",disabled:!0,children:"Please select"}),x.map(a=>e(Y,{value:a.id,children:s(pe,{sx:{display:"flex"},children:[e(ke,{src:a.profile_image,alt:a.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),a.name]})},a.id))]}),e(te,{children:i.user_id})]})}),e(m,{item:!0,xs:12,children:e(W,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:G,onChange:a=>z(a.target.value),error:!!i.leaveReason,helperText:i.leaveReason})})]})}),e(me,{sx:{padding:"16px",justifyContent:"center"},children:e(Te,{type:"submit",variant:"outlined",color:"primary",loading:o,disabled:o,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ne=({open:y,handleClose:c,leaveIdToDelete:p,setLeavesData:F})=>{const t=ie();return s(de,{open:y,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ce,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(ue,{children:e(we,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),s(me,{children:[e(X,{onClick:c,color:"primary",children:"Cancel"}),e(X,{onClick:()=>{const R=new Promise(async(h,B)=>{try{const g=await axios.delete(route("leave-delete",{id:p,route:route().current()}));g.status===200&&(F(g.data.leavesData),h("Leave application deleted successfully"))}catch(g){console.error("Error deleting task:",g),B(g.response.data.error||"Failed to delete leave application")}finally{c()}});ne.promise(R,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(he,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},success:{render({data:h}){return e(j,{children:h})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},error:{render({data:h}){return e(j,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Oe=({title:y,allUsers:c})=>{const{auth:p,props:F}=le(),[t,x]=r.useState(null),[R,h]=r.useState(F.leavesData),[B,g]=r.useState(),[U,E]=r.useState(0),[l,C]=r.useState(0),[H,f]=r.useState(null),[D,_]=r.useState(""),[k,S]=r.useState(Ie().format("YYYY-MM")),[M,T]=r.useState(30),[w,A]=r.useState(1),[N,O]=r.useState(),[Z,J]=r.useState(""),Q=o=>x(o);r.useCallback((o,b)=>{f(o),x(b)},[]);const G=r.useCallback(()=>{x(null),f(null)},[]),z=o=>_(o.target.value.toLowerCase()),i=o=>{S(o.target.value)},V=async()=>{var o,b;try{const I=await axios.get(route("leaves.paginate"),{params:{page:w,perPage:M,employee:D,month:k}});if(I.status===200){const{data:K,total:$,last_page:a}=I.data.leaves;g(K),E($),C(a)}}catch(I){console.error("Error fetching leaves data:",I),J(((b=(o=I.response)==null?void 0:o.data)==null?void 0:b.message)||"Error retrieving data.")}};return r.useEffect(()=>{V()},[k,w,M,D]),s(j,{children:[e(be,{title:y}),["add_leave","edit_leave"].includes(t)&&e(He,{setTotalRows:E,setLastPage:C,setPicnicParticipants:g,perPage:M,employee:D,currentPage:w,selectedMonth:k,allUsers:c,open:!0,setPicnicParticipantsData:h,closeModal:()=>x(null),leavesData:R,currentPicnicParticipant:t==="edit_leave"?N:null,handleMonthChange:i}),t==="delete_leave"&&e(Ne,{open:!0,handleClose:G,leaveIdToDelete:H,setPicnicParticipantsData:h}),e(pe,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Se,{in:!0,children:s(ve,{children:[e(Fe,{title:"Picnic Participants",sx:{padding:"24px"},action:e(X,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e(Re,{}),onClick:()=>Q("add_leave"),children:"Add Picnic Participant"})}),e(ae,{children:s(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,sm:6,md:4,children:e(oe,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:D,onChange:z,endContent:e(Ue,{})})}),e(m,{item:!0,xs:12,sm:6,md:4,children:e(oe,{label:"Select Month",type:"month",variant:"bordered",onChange:i,value:k})})]})}),e(ae,{children:s("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[s(Be,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e(Ee,{columns,children:o=>e(Me,{align:o.uid==="actions"?"center":"start",children:o.name},o.uid)}),e(Ae,{items:B,children:o=>e(We,{children:b=>e(qe,{style:{whiteSpace:"nowrap"},children:renderCell(o,b)})},o.id)})]}),U>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(je,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:w,total:l,onChange:handlePageChange})})]})})]})})})]})};Oe.layout=y=>e(Pe,{children:y});export{Oe as default};
