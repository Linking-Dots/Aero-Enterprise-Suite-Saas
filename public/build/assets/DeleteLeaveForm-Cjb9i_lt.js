import{V as ae,j as o,a as e,F as P}from"./app-CFGeZjMb.js";import{r as d,u as X,t as Z,X as se,T as de,c as ce,G as D,F as J,k as K,S as Q,M as H,V as ee,b as N,B as ue,Y as pe,Z as oe,$ as le,a0 as me,f as te}from"./vendor-CvAEURx2.js";import{B as $}from"./App-EZ_d768k.js";import{E as he,D as ge}from"./Edit-etft1p7S.js";import{l as ye,s as be}from"./chunk-7H6JMIKS-CRpcpC9f.js";import{t as fe,b as xe,a as Ce,d as ve,e as _e,c as De}from"./chunk-YRZGWF2W-BClRugZq.js";import{p as ke}from"./chunk-MT6723RH-Bl3FTpAF.js";import{t as re}from"./chunk-LY4WDGUU-DzhB9DG3.js";import{u as Se}from"./chunk-TLBGAR4N-_G2WcJbo.js";import{d as Te,G as ne}from"./GlassDialog-4pHHQBwC.js";import{L as we}from"./LoadingButton-DVsE6rD2.js";var Fe={name:"inyrtd",styles:"width:110px"};const He=({leaves:E,allUsers:g,handleClickOpen:y,setCurrentLeave:B,openModal:r,setLeaves:M,setCurrentPage:I,currentPage:h,totalRows:A,lastPage:b,perPage:U,selectedMonth:l,employee:F})=>{const{auth:L}=ae().props,[f,V]=d.useState(null),x=X(),R=L.roles.includes("Administrator");L.roles.includes("Supervision Engineer");const k=t=>I(t),j=()=>V(null),S=async(t,p)=>{j(),await O(t,"status",p)},O=async(t,p,v)=>{const n=new Promise(async(a,W)=>{try{const c=await axios.post(route("leave-add"),{page:h,perPage:U,employee:F,month:l,route:route().current(),user_id:t.user_id,id:t.id,leaveType:t.leave_type,fromDate:t.from_date,toDate:t.to_date,daysCount:t.no_of_days,leaveReason:t.reason,[p]:v});c.status===200&&(M(T=>T.map(G=>G.id===t.id?{...G,[p]:v}:G)),a([c.data.message||"Leave status updated successfully"]))}catch(c){const T=c.response?c.response.status===422?c.response.statusText||"Failed to update leave status":"An unexpected error occurred. Please try again later.":c.request?"No response received from the server. Please check your internet connection.":"An error occurred while setting up the request.";W(T),console.error(c)}});$.promise(n,{pending:{render:()=>o("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Updating leave status..."})]}),icon:!1,style:C(x)},success:{render:({data:a})=>e(P,{children:a.map((W,c)=>e("div",{children:W},c))}),icon:"ðŸŸ¢",style:C(x)},error:{render:({data:a})=>e(P,{children:a}),icon:"ðŸ”´",style:C(x)}})},C=t=>({backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}),Y=t=>({New:"primary",Pending:"secondary",Approved:"success",Declined:"danger"})[t]||"primary",q=(t,p)=>{const v=t[p];switch(p){case"employee":const n=g.find(a=>String(a.id)===String(t.user_id));return e(Se,{avatarProps:{radius:"lg",src:n==null?void 0:n.profile_image},description:n==null?void 0:n.phone,name:n==null?void 0:n.name,children:n==null?void 0:n.email});case"from_date":case"to_date":return new Date(v).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"});case"status":return e(be,{isDisabled:!R&&route().current()!=="leaves","aria-label":"Leave Status",color:Y(t.status),placeholder:"Select status",size:"sm",selectedKeys:[t.status],onChange:a=>S(t,a.target.value),css:Fe,children:["New","Pending","Approved","Declined"].map(a=>e(ye,{value:a,children:a},a))});case"actions":return o("div",{className:"relative flex items-center gap-2",children:[e(re,{content:"Edit Leave",children:e("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>{B(t),r("edit_leave")},children:e(he,{})})}),e(re,{content:"Delete Leave",color:"danger",children:e("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>y(t.id,"delete_leave"),children:e(ge,{})})})]});default:return v}},z=[...R?[{name:"Employee",uid:"employee"}]:[],{name:"Leave Type",uid:"leave_type"},{name:"From Date",uid:"from_date"},{name:"To Date",uid:"to_date"},{name:"Status",uid:"status"},{name:"Reason",uid:"reason"},...R?[{name:"Actions",uid:"actions"}]:[]];return o("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[o(fe,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Employee Table",children:[e(Ce,{columns:z,children:t=>e(xe,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(De,{items:E,children:t=>e(ve,{children:p=>e(_e,{style:{whiteSpace:"nowrap"},children:q(t,p)})},t.id)})]}),A>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:h,total:b,onChange:k})})]})},Ve=({open:E,closeModal:g,leavesData:y,setLeavesData:B,currentLeave:r,allUsers:M,setTotalRows:I,setLastPage:h,setLeaves:A,handleMonthChange:b})=>{const{auth:U}=ae().props,l=X(),[F,L]=d.useState((r==null?void 0:r.user_id)||U.user.id),[f,V]=d.useState(y.leaveTypes||[]),[x,R]=d.useState([]),[k,j]=d.useState((r==null?void 0:r.leave_type)||(f.length>0?f[0].type:"")),[S,O]=d.useState((r==null?void 0:r.from_date)||""),[C,Y]=d.useState((r==null?void 0:r.to_date)||""),[q,z]=d.useState((r==null?void 0:r.no_of_days)||""),[t,p]=d.useState(""),[v,n]=d.useState((r==null?void 0:r.reason)||""),[a,W]=d.useState({}),[c,T]=d.useState(!1),[G,ie]=d.useState("");return d.useEffect(()=>{y&&(V(y.leaveTypes||[]),R(y.leaveCountsByUser[F]||[]))},[y,F]),d.useEffect(()=>{var m;const s=((m=x==null?void 0:x.find(u=>u.leave_type===k))==null?void 0:m.days_used)||0;ie(s);const w=f==null?void 0:f.find(u=>u.type===k);w&&p(w.days-s)},[k,x,f]),d.useEffect(()=>{z(((w,m)=>{if(!w||!m)return"";const u=new Date(w),i=new Date(m);if(u>i)return"";const _=i.getTime()-u.getTime();return Math.ceil(_/(1e3*3600*24))+1})(S,C))},[S,C]),o(ne,{open:E,onClose:g,fullWidth:!0,maxWidth:"sm",children:[o(se,{sx:{display:"flex",alignItems:"center"},children:[e(de,{variant:"h6",children:"Add Leave"}),e(ce,{onClick:g,sx:{position:"absolute",top:8,right:16},children:e(Te,{})})]}),o("form",{onSubmit:async s=>{s.preventDefault(),T(!0);const w=new Promise(async(m,u)=>{try{const i={route:route().current(),user_id:F,leaveType:k,fromDate:S,toDate:C,daysCount:q,leaveReason:v};r&&(i.id=r.id);const _=await axios.post(route("leave-add"),i);_.status===200&&(B(_.data.leavesData),I(_.data.total),h(_.data.last_page),A(_.data.leaves.data),b({target:{value:S.slice(0,7)}}),g(),m([_.data.message||"Leave application submitted successfully"]))}catch(i){T(!1),i.response?(i.response.status===422?(W(i.response.data.errors||{}),u(i.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(i.response.data.error)):i.request?(u("No response received from the server. Please check your internet connection."),console.error(i.request)):(u("An error occurred while setting up the request."),console.error("Error",i.message))}finally{T(!1)}});$.promise(w,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:m}){return e(P,{children:m.map((u,i)=>e("div",{children:u},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:m}){return e(P,{children:m})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}}})},children:[e(oe,{children:o(D,{container:!0,spacing:2,children:[e(D,{item:!0,xs:12,md:6,children:o(J,{fullWidth:!0,children:[e(K,{id:"leave-type-label",children:"Leave Type"}),o(Q,{labelId:"leave-type-label",value:k,onChange:s=>j(s.target.value),label:"Leave Type",error:!!a.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(H,{value:"",disabled:!0,children:"Select Leave Type"}),f.map(s=>o(H,{value:s.type,children:[s.type," ",s.days," Days"]},s.id))]}),e(ee,{children:a.leaveType})]})}),e(D,{item:!0,xs:12,md:6,children:e(N,{label:"From",type:"date",fullWidth:!0,value:S,onChange:s=>O(s.target.value),InputLabelProps:{shrink:!0},error:!!a.fromDate,helperText:a.fromDate})}),e(D,{item:!0,xs:12,md:6,children:e(N,{label:"To",type:"date",fullWidth:!0,value:C,onChange:s=>Y(s.target.value),InputLabelProps:{shrink:!0},error:!!a.toDate,helperText:a.toDate})}),e(D,{item:!0,xs:12,md:6,children:e(N,{label:"Number of days",type:"text",fullWidth:!0,value:q,InputProps:{readOnly:!0},error:!!a.daysCount,helperText:a.daysCount})}),e(D,{item:!0,xs:12,md:6,children:e(N,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:t,InputProps:{readOnly:!0},error:!!a.remainingLeaves,helperText:a.remainingLeaves})}),U.roles.includes("Administrator")&&route().current()==="leaves"&&e(D,{item:!0,xs:12,md:6,children:o(J,{fullWidth:!0,children:[e(K,{id:"leave-employee-label",children:"Employee"}),o(Q,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:F||"na",error:!!a.user_id,onChange:s=>L(s.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(H,{value:"na",disabled:!0,children:"Please select"}),M.map(s=>e(H,{value:s.id,children:o(ue,{sx:{display:"flex"},children:[e(pe,{src:s.profile_image,alt:s.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),s.name]})},s.id))]}),e(ee,{children:a.user_id})]})}),e(D,{item:!0,xs:12,children:e(N,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:v,onChange:s=>n(s.target.value),error:!!a.leaveReason,helperText:a.leaveReason})})]})}),e(le,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:c,disabled:c,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},je=({open:E,handleClose:g,leaveIdToDelete:y,setLeavesData:B})=>{const r=X();return o(ne,{open:E,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(se,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(oe,{children:e(me,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(le,{children:[e(te,{onClick:g,color:"primary",children:"Cancel"}),e(te,{onClick:()=>{const I=new Promise(async(h,A)=>{try{const b=await axios.delete(route("leave-delete",{id:y,route:route().current()}));b.status===200&&(B(b.data.leavesData),h("Leave application deleted successfully"))}catch(b){console.error("Error deleting task:",b),A(b.response.data.error||"Failed to delete leave application")}finally{g()}});$.promise(I,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(Z,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:h}){return e(P,{children:h})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:h}){return e(P,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{je as D,Ve as L,He as a};
