import{V as I,j as n,a as e,M as k,F as w}from"./app-COej-qut.js";import{r as t,e as B,g as O,a as o,G as c,T as l,B as i,D as N,h as U}from"./vendor-jz9Knmfr.js";import{G as C,A as Y}from"./App-Bh__gnbe.js";import{L as z}from"./LeaveEmployeeTable-CiYhuVvj.js";import{s as H,l as K}from"./chunk-7JXO3E7I-BmHL33O5.js";import"./Edit-BHaH8ya7.js";import"./chunk-F3UDT23P-B9Bbk0MH.js";import"./chunk-MZRCPRP2-CkCeC-Il.js";import"./chunk-SLABUSGS-yLyu-M1S.js";import"./chunk-7F3ZLNJ6-CJy-mc9r.js";import"./chunk-YHY32LNM-BVFuFTPV.js";import"./chunk-CSXHODZI-B_ju90Id.js";import"./chunk-R6AK6OQ4-srYMT2VM.js";import"./chunk-A6PX3NG3-Be0FpWxR.js";import"./chunk-2BFF5KFD-Dt7Cw_Z_.js";import"./chunk-4EXC76WE-C1zfbgpY.js";const R=({title:d,allUsers:D})=>{const{auth:L}=I().props,[P,h]=t.useState(!1),[g,_]=t.useState([]),[v,S]=t.useState({leaveTypes:[],leaveCountsByUser:{}}),[p,y]=t.useState({page:1,perPage:30,total:0,lastPage:0}),[m,F]=t.useState({employee:"",year:new Date().getFullYear()}),T=t.useMemo(()=>{const a=new Date().getFullYear();return Array.from({length:a-1900+1},(r,s)=>1900+s).reverse()},[]),j=t.useCallback((a,r)=>{F(s=>({...s,[a]:r})),a==="year"&&y(s=>({...s,page:1}))},[]),f=t.useCallback((a,r=null)=>{setOpenModalType(a),setDeleteLeaveId(r)},[]);t.useCallback(()=>{setOpenModalType(null),setDeleteLeaveId(null)},[]);const x=t.useCallback(async()=>{h(!0);try{const{page:a,perPage:r}=p,{employee:s,year:A}=m,b=await axios.get(route("leaves.paginate"),{params:{page:a,perPage:r,employee:s,year:A}});if(b.status===200){const{leaves:u,leavesData:E}=b.data;_(u.data),S(E),y(G=>({...G,total:u.total,lastPage:u.last_page}))}}catch(a){console.error("Fetch leaves error",a)}finally{h(!1)}},[p.page,p.perPage,m]);t.useEffect(()=>{x()},[x]);const M=v.leaveCountsByUser[L.user.id]||[];return n(w,{children:[e(k,{title:d}),e(i,{display:"flex",justifyContent:"center",p:2,children:e(B,{in:!0,children:n(C,{children:[e(O,{title:"Leaves",sx:{p:3}}),e(o,{children:e(c,{container:!0,spacing:2,alignItems:"center",children:e(c,{item:!0,xs:12,sm:6,md:4,children:e(H,{label:"Year",variant:"bordered",selectedKeys:[String(m.year)],onChange:a=>j("year",Number(a)),popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:T.map(a=>e(K,{value:a,children:String(a)},a))})})})}),e(o,{children:e(c,{container:!0,spacing:2,children:v.leaveTypes.map(({type:a})=>{const r=M.find(s=>s.leave_type===a)||{};return e(c,{item:!0,xs:12,sm:6,md:3,children:e(C,{children:n(o,{sx:{textAlign:"center"},children:[e(l,{variant:"h6",sx:{mb:2,fontSize:["1rem","1.25rem","1.5rem"]},children:a}),n(i,{display:"flex",justifyContent:"center",alignItems:"center",children:[n(i,{children:[e(l,{variant:"subtitle2",children:"Used"}),e(l,{variant:"h4",children:r.days_used||0})]}),e(N,{orientation:"vertical",flexItem:!0,sx:{mx:2}}),n(i,{children:[e(l,{variant:"subtitle2",children:"Remaining"}),e(l,{variant:"h4",children:r.remaining_days||0})]})]})]})})},a)})})}),e(o,{children:P?n(i,{textAlign:"center",py:4,children:[e(U,{}),e(l,{mt:2,children:"Loading leaves..."})]}):g.length>0?e(z,{leaves:g,allUsers:D,onDelete:a=>f("delete",a),onEdit:a=>f("edit",a.id)}):e(l,{align:"center",children:"No leaves found."})})]})})})]})};R.layout=d=>e(Y,{children:d});export{R as default};
