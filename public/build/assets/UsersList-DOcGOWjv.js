import{a as e,j as c,b as O,B as S,F as v,q as ee,Y as re,G as ae,d as H}from"./app-Dl05hPVL.js";import{r as f,j as G,c as W,a1 as te,k as oe,M as le,a2 as ne,S as de,F as ie,t as N,X as se,T as ce,G as C,B as T,Y as pe,b as B,Z as me,$ as ue,u as ge,e as he,g as be,a as fe}from"./vendor-CLmvDlKR.js";import{A as ye}from"./App-DbKLIXm4.js";import{E as Ce,D as xe}from"./Edit-VBa5HUC5.js";import{a as ve,b as ke,c as _e,d as Se,e as De,t as Fe}from"./chunk-YRZGWF2W-CEyd-Xa4.js";import{t as q}from"./chunk-KQ7OR4H5-j3JpDeBv.js";import{u as Ae}from"./chunk-TLBGAR4N-Cm-qSlgO.js";import{d as Ee,G as we}from"./GlassDialog-DhrtSjAV.js";import{P as Pe}from"./PhotoCamera-D9ypWTYh.js";import{L as Ie}from"./LoadingButton-CiSAWvL2.js";import{i as R}from"./chunk-IR2E3HZF-DhOQwH-C.js";import{s as L,l as _}from"./chunk-QEQ4EHOG-1VVf72ng.js";import{A as K}from"./Add-Db0pbpWO.js";import"./useFormValidationState-BkMPC0CQ.js";import"./useLabel-DJOw9D8i.js";const Te=({allUsers:r,roles:E})=>{const[w,D]=f.useState(r),o=G(),[M,F]=f.useState({});async function l(a,b,u){const n=new Promise(async(s,i)=>{try{const p=await axios.post(route("user.updateRole",{id:b}),{[a]:u});p.status===200&&(D(k=>k.map(A=>A.id===b?{...A,[a]:u}:A)),s([p.data.messages||"Role updated successfully"]))}catch(p){p.response?(p.response.status===422?i(p.response.data.errors||["Failed to update user role."]):i("An unexpected error occurred. Please try again later."),console.error(p.response)):p.request?(i("No response received from the server. Please check your internet connection."),console.error(p.request)):(i("An error occurred while setting up the request."),console.error("Error",p.message))}});S.promise(n,{pending:{render(){return c("div",{style:{display:"flex",alignItems:"center"},children:[e(N,{}),c("span",{style:{marginLeft:"8px"},children:["Updating employee ",a,"..."]})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:s}){return e(v,{children:s.map((i,p)=>e("div",{children:i},p))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:s}){return e(v,{children:s})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})}const P=async(a,b)=>{const u=new Promise(async(n,s)=>{try{const i=await axios.put(route("user.toggleStatus",{id:a}),{active:b});i.status===200&&(D(p=>p.map(k=>k.id===a?{...k,active:b}:k)),n([i.data.message||"User status updated successfully"]))}catch(i){i.response?(i.response.status===422?s(i.response.data.errors||["Failed to update user status."]):s("An unexpected error occurred. Please try again later."),console.error(i.response)):i.request?(s("No response received from the server. Please check your internet connection."),console.error(i.request)):(s("An error occurred while setting up the request."),console.error("Error",i.message))}});S.promise(u,{pending:{render(){return c("div",{style:{display:"flex",alignItems:"center"},children:[e(N,{}),e("span",{style:{marginLeft:"8px"},children:"Updating user status..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:n}){return e(v,{children:n.map((s,i)=>e("div",{children:s},i))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:n}){return e(v,{children:n})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},d=async a=>{const b=new Promise(async(u,n)=>{try{const s=await fetch(route("profile.delete"),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({user_id:a})}),i=await s.json();s.ok?(D(p=>p.filter(k=>k.id!==a)),u([i.message])):n([i.message])}catch(s){console.error("Error deleting user:",s),n(["An error occurred while deleting user. Please try again."])}});S.promise(b,{pending:{render(){return c("div",{style:{display:"flex",alignItems:"center"},children:[e(N,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting user..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:u}){return e(v,{children:u.map((n,s)=>e("div",{children:n},s))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:u}){return e(v,{children:u.map((n,s)=>e("div",{children:n},s))})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},I=a=>{F(b=>({...b,[a]:null}))},U=(a,b)=>{const u=a[b];switch(b){case"name":return e(Ae,{avatarProps:{radius:"lg",src:a==null?void 0:a.profile_image},name:a==null?void 0:a.name,children:a==null?void 0:a.email});case"email":return u;case"phone":return u;case"created_at":return u||"N/A";case"role":return c(ie,{size:"small",fullWidth:!0,children:[e(oe,{id:"role",children:"Role"}),e(de,{disabled:!a.active,labelId:"role",id:"role",multiple:!0,value:a.roles,onChange:n=>l("roles",a.id,n.target.value),label:"Role",variant:"outlined",renderValue:n=>n.join(", "),MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px"}}},children:E.map(n=>c(le,{value:n.name,children:[e(ne,{size:"small",checked:a.roles.includes(n.name)}),n.name]},n.name))})]});case"actions":return c("div",{className:"relative flex items-center gap-2",children:[e(q,{content:"Edit Leave",children:e(W,{className:"text-lg text-default-400 cursor-pointer active:opacity-50",component:O,href:route("profile",{user:a.id}),onClick:()=>{I(a.id)},children:e(Ce,{})})}),e(q,{content:"Delete Leave",color:"danger",children:c(W,{className:"text-lg text-danger cursor-pointer active:opacity-50",component:O,href:route("profile",{user:a.id}),onClick:()=>{d(a.id)},children:[e(xe,{})," "]})}),e(q,{content:"Set Active Status",color:"danger",children:e(te,{checked:a.active,onChange:()=>P(a.id,!a.active)})})]});default:return"N/A"}};return e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:c(Fe,{fullWidth:!0,isStriped:!0,isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Employees Table",children:[e(ve,{columns:[{name:"Name",uid:"name"},{name:"Email",uid:"email"},{name:"Phone",uid:"phone"},{name:"Created At",uid:"created_at"},{name:"Role",uid:"role"},{name:"Action",uid:"actions"}],children:a=>e(ke,{align:a.uid==="actions"?"center":"start",children:a.name},a.uid)}),e(_e,{items:w,children:a=>e(Se,{children:b=>e(De,{style:{whiteSpace:"nowrap"},children:U(a,b)})},a.id)})]},w)})},Me=({user:r,allUsers:E,departments:w,designations:D,setUser:o,open:M,closeModal:F})=>{const[l,P]=f.useState({id:r==null?void 0:r.id,name:(r==null?void 0:r.name)||"",user_name:(r==null?void 0:r.user_name)||"",gender:(r==null?void 0:r.gender)||"",birthday:(r==null?void 0:r.birthday)||"",date_of_joining:(r==null?void 0:r.date_of_joining)||"",address:(r==null?void 0:r.address)||"",employee_id:(r==null?void 0:r.employee_id)||"",phone:(r==null?void 0:r.phone)||"",email:(r==null?void 0:r.email)||"",department:(r==null?void 0:r.department)||"",designation:(r==null?void 0:r.designation)||"",report_to:(r==null?void 0:r.report_to)||""}),[d,I]=f.useState({id:r==null?void 0:r.id}),[U,j]=f.useState(!1),[a,b]=f.useState({}),[u,n]=f.useState(!1),[s,i]=f.useState(!1),[p,k]=f.useState(null),[A,J]=f.useState(null),[Y,z]=f.useState(D),[V,X]=f.useState(E),m=G(),Q=async t=>{var g;t.preventDefault(),n(!0);const y=new FormData;if(Object.keys(l).forEach(h=>{y.append(h,l[h])}),A){const h=A.type;if(["image/jpeg","image/jpg","image/png"].includes(h))y.append("profile_image",A);else{S.error("Invalid file type. Only JPEG and PNG are allowed.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:m.glassCard.backgroundColor,border:m.glassCard.border,color:m.palette.text.primary}}),n(!1);return}}try{const h=await axios.post(route("addUser"),y);h.status===200&&(o(h.data.user),S.success(((g=h.data.messages)==null?void 0:g.length)>0?h.data.messages.join(" "):"Profile information updated successfully",{icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:m.glassCard.backgroundColor,border:m.glassCard.border,color:m.palette.text.primary}}),F())}catch(h){n(!1),Z(h)}finally{n(!1)}},Z=t=>{t.response?t.response.status===422?(b(t.response.data.errors||{}),S.error(t.response.data.error||"Failed to update profile information.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:m.glassCard.backgroundColor,border:m.glassCard.border,color:m.palette.text.primary}})):S.error("An unexpected error occurred. Please try again later.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:m.glassCard.backgroundColor,border:m.glassCard.border,color:m.palette.text.primary}}):t.request?S.error("No response received from the server. Please check your internet connection.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:m.glassCard.backgroundColor,border:m.glassCard.border,color:m.palette.text.primary}}):S.error("An error occurred while setting up the request.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:m.glassCard.backgroundColor,border:m.glassCard.border,color:m.palette.text.primary}})},$=t=>{const y=t.target.files[0];if(y){const g=URL.createObjectURL(y);k(g),J(y)}},x=(t,y)=>{P(g=>{const h={...g,[t]:y};return y===""&&delete h[t],h}),I(g=>{const h={...g,[t]:y};return y===""&&delete h[t],h})};return f.useEffect(()=>{(r==null?void 0:r.department)!==l.department&&(l.designation=null,l.report_to=null),z(D.filter(g=>g.department_id===(d.department||l.department))),X(E.filter(g=>g.department===(d.department||l.department)));const t={...d};for(const g in t)r&&g!=="id"&&t[g]===r[g]&&delete t[g];const y=Object.keys(t).length>1;j(y)},[l,d]),c(we,{open:M,onClose:F,children:[c(se,{style:{cursor:"move"},id:"draggable-dialog-title",children:[e(ce,{children:"Profile Information"}),e(W,{variant:"outlined",color:"primary",onClick:F,sx:{position:"absolute",top:8,right:16},children:e(Ee,{})})]}),c("form",{onSubmit:Q,children:[e(me,{children:c(C,{container:!0,spacing:2,children:[e(C,{item:!0,xs:12,display:"flex",alignItems:"center",justifyContent:"center",children:c(T,{position:"relative",display:"inline-block",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[e(pe,{alt:d.name||l.name,src:p||(r==null?void 0:r.profile_image),sx:{width:100,height:100}}),s&&e(v,{children:e(T,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(0, 0, 0, 0.5)",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(W,{color:"primary",component:"span",children:e(Pe,{})})})}),e("input",{accept:"image/*",style:{display:"none"},id:"upload-button",type:"file",onChange:$}),e("label",{htmlFor:"upload-button",children:e(T,{sx:{position:"absolute",width:"100%",height:"100%",top:0,left:0,borderRadius:"50%",cursor:"pointer"}})})]})}),e(C,{item:!0,xs:12,md:6,children:e(R,{type:"text",label:"Name",variant:"bordered",isInvalid:!!a.name,errorMessage:a.name,fullWidth:!0,value:d.name||l.name||"",onChange:t=>x("name",t.target.value)})}),e(C,{item:!0,xs:12,md:6,children:e(R,{label:"Username",fullWidth:!0,value:d.user_name||l.user_name||"",onChange:t=>x("user_name",t.target.value),type:"text",variant:"bordered",isInvalid:!!a.user_name,errorMessage:a.user_name})}),e(C,{item:!0,xs:12,md:6,children:e(R,{label:"Email Adress",fullWidth:!0,value:d.email||l.email,onChange:t=>x("email",t.target.value),type:"email",variant:"bordered",isInvalid:!!a.email,errorMessage:a.email})}),e(C,{item:!0,xs:12,md:6,children:e(R,{label:"Phone Number",fullWidth:!0,value:d.phone||l.phone,onChange:t=>x("phone",t.target.value),type:"tel",variant:"bordered",isInvalid:!!a.phone,errorMessage:a.phone})}),e(C,{item:!0,xs:12,md:6,children:c(L,{variant:"bordered",fullWidth:!0,label:"Gender",placeholder:"Select Gender",value:d.gender||l.gender||"na",onChange:t=>x("gender",t),errorMessage:!!a.gender,selectedKeys:[d.gender||l.gender||"na"],children:[e(_,{value:"na",disabled:!0,children:"Select Gender"}),e(_,{value:"Male",children:"Male"}),e(_,{value:"Female",children:"Female"})]})}),e(C,{item:!0,xs:12,md:6,children:e(B,{label:"Birth Date",type:"date",fullWidth:!0,value:d.birthday||l.birthday||"",onChange:t=>x("birthday",t.target.value),InputLabelProps:{shrink:!0},error:!!a.birthday,helperText:a.birthday})}),e(C,{item:!0,xs:12,md:6,children:e(B,{label:"Joining Date",type:"date",fullWidth:!0,value:d.date_of_joining||l.date_of_joining||"",onChange:t=>x("date_of_joining",t.target.value),InputLabelProps:{shrink:!0},error:!!a.date_of_joining,helperText:a.date_of_joining})}),e(C,{item:!0,xs:12,children:e(B,{label:"Address",fullWidth:!0,value:d.address||l.address,onChange:t=>x("address",t.target.value),error:!!a.address,helperText:a.address})}),e(C,{item:!0,xs:12,md:6,children:e(B,{label:"Employee ID",fullWidth:!0,value:d.employee_id||l.employee_id||"",onChange:t=>x("employee_id",t.target.value),error:!!a.employee_id,helperText:a.employee_id})}),e(C,{item:!0,xs:12,md:6,children:c(L,{variant:"bordered",fullWidth:!0,label:"Department",placeholder:"Select Department",value:d.department||l.department||"na",onChange:t=>x("department",t),errorMessage:!!a.department,selectedKeys:[d.department||l.department||"na"],children:[e(_,{value:"na",disabled:!0,children:"Select Department"}),w.map(t=>e(_,{value:t.id,children:t.name},t.id))]})}),e(C,{item:!0,xs:12,md:6,children:c(L,{variant:"bordered",fullWidth:!0,label:"Designation",placeholder:"Select Designation",value:d.designation||l.designation||"na",onChange:t=>x("designation",t),errorMessage:a.designation?"This field is required":"",disabled:!(r!=null&&r.department),selectedKeys:[d.designation||l.designation||"na"],children:[e(_,{value:"na",disabled:!0,children:"Select Designation"}),Y.map(t=>e(_,{value:t.id,children:t.title},t.id))]})}),e(C,{item:!0,xs:12,md:6,children:c(L,{variant:"bordered",fullWidth:!0,label:"Reports To",placeholder:"Select Reports To",value:d.report_to||l.report_to,onChange:t=>x("report_to",t),errorMessage:a.report_to?"This field is required":"",disabled:(r==null?void 0:r.report_to)==="na",selectedKeys:[d.report_to||l.report_to],children:[e(_,{value:"na",disabled:!0,children:"--"}),V.map(t=>e(_,{value:t.id,children:t.name},t.id))]})})]})}),e(ue,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:e(Ie,{disabled:!U,sx:{borderRadius:"50px",padding:"6px 16px"},variant:"outlined",color:"primary",type:"submit",loading:u,children:"Submit"})})]})]})},Ue=({title:r,roles:E,departments:w,designations:D})=>{const o=G(),M=ge(o.breakpoints.down("md")),[F,l]=f.useState(null),[P,d]=f.useState(ee().props.allUsers),I=j=>{l(j)};return c(v,{children:[e(re,{title:r}),F==="add"&&e(Me,{allUsers:P,departments:w,designations:D,open:F==="add",setUsers:d,closeModal:()=>{l(null)}}),e(T,{sx:{display:"flex",justifyContent:"center",p:2},children:e(he,{in:!0,children:c(ae,{children:[e(be,{title:"Employees",sx:{padding:"24px"},action:e(T,{display:"flex",gap:2,children:M?e(v,{children:e(H,{isIconOnly:!0,title:"Add Employee",variant:"bordered",color:"success",onClick:()=>I("add"),children:e(K,{})})}):e(v,{children:e(H,{title:"Add Employee",variant:"bordered",color:"success",startContent:e(K,{}),onClick:()=>I("add"),children:"Add Employee"})})})}),e(fe,{children:e(Te,{allUsers:P,roles:E})})]})})})]})};Ue.layout=r=>e(ye,{children:r});export{Ue as default};
