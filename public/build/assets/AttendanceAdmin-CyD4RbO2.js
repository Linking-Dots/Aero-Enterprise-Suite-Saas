import{a as e,j as d,V as Ne,M as Me,F as j,c as Ee}from"./app-CLXqCRon.js";import{r as c,u as we,t as q,B as f,T as L,v as ie,w as z,c as P,x as _,g as se,a as V,R as Ae,e as Ce,f as Se,G as re,h as Fe}from"./vendor-qGV-i6la.js";import{F as de,d as ae,b as me,o as he,G as $e,A as Ye,B as pe}from"./App--FXJDFZg.js";import{d as m}from"./dayjs.min-CjftnUql.js";import{u as D,w as ke}from"./xlsx-CggEr6S4.js";import{E as ve,P as ue}from"./jspdf.es.min-L7RS_9m7.js";import{a as Pe,F as fe}from"./jspdf.plugin.autotable-Co8Bq-cw.js";import{F as oe}from"./UserIcon-miehdqhJ.js";import{s as De}from"./chunk-TLYTI3QM-BumEVY6h.js";import{R as ge}from"./Refresh-BfDhS3rU.js";import{t as Re,a as We,b as Ie,c as je,d as Le,e as Z}from"./chunk-F3UDT23P-DdDqWApK.js";import{u as be}from"./chunk-R6AK6OQ4-B1U5Rh8G.js";import{a as ze,b as He,F as Be}from"./XCircleIcon-IZp_bSJ6.js";import{d as Ge}from"./Search-Tex0exyH.js";import{D as ye}from"./Download-D_2GEqsS.js";import{i as xe}from"./chunk-HJTJQZF3-A1aW62sw.js";import{p as Ue}from"./chunk-YHY32LNM-DYEG5Tav.js";import"./chunk-MZRCPRP2-CW2WIkga.js";import"./chunk-SLABUSGS-7c0pk9lC.js";import"./chunk-7F3ZLNJ6-CtRuqfri.js";import"./chunk-2BFF5KFD-B3UrLInM.js";function Oe({title:g,titleId:a,...r},l){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},r),g?c.createElement("title",{id:a},g):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const K=c.forwardRef(Oe);function Ze({title:g,titleId:a,...r},l){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},r),g?c.createElement("title",{id:a},g):null,c.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const Ke=c.forwardRef(Ze),Ve=({loading:g,attendanceData:a,currentYear:r,currentMonth:l,leaveTypes:o,leaveCounts:x,onRefresh:v})=>{const i=we(),H=q("(min-width: 1025px)");q("(min-width: 641px) and (max-width: 1024px)");const J=q("(max-width: 640px)"),b=m(`${r}-${l}-01`).daysInMonth(),X={"√":{icon:ze,color:"text-success",bg:"bg-success-100",label:"√",short:"P"},"▼":{icon:He,color:"text-danger",bg:"bg-danger-100",label:"▼",short:"A"},"#":{icon:Be,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:Ke,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},T=c.useMemo(()=>[{label:"No.",key:"sl",icon:K,width:60},{label:"Employee",key:"name",icon:oe,width:200},...Array.from({length:b},(t,u)=>{const w=u+1,h=m(`${r}-${l}-${w}`);return{label:`${w}`,sublabel:h.format("ddd"),key:`day-${w}`,width:40,isWeekend:h.day()===0||h.day()===6}}),...o?o.map(t=>({label:t.type,key:t.type,icon:de,width:80})):[]],[b,r,l,o]),B=t=>X[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},ee=({data:t,index:u})=>e($e,{className:"mb-4",shadow:"sm",children:d(V,{className:"p-4",children:[e(f,{className:"flex items-center gap-3 mb-4",children:e(be,{avatarProps:{radius:"lg",size:"md",src:t.profile_image,fallback:e(oe,{className:"w-6 h-6"})},name:e(L,{variant:"body1",fontWeight:"medium",children:t.name}),description:d(L,{variant:"caption",color:"textSecondary",children:["Employee #",u+1]})})}),e(ae,{className:"my-3"}),e(f,{className:"grid grid-cols-7 gap-1 mb-4",children:Array.from({length:b},(w,h)=>{const n=h+1,$=m(`${r}-${l}-${n}`).format("YYYY-MM-DD"),s=t[$]||"▼",y=B(s),E=m(`${r}-${l}-${n}`).day()===0||m(`${r}-${l}-${n}`).day()===6;return d(f,{className:`
                                    flex flex-col items-center justify-center p-1 rounded text-xs
                                    ${E?"bg-default-100":"bg-default-50"}
                                    ${y.bg}
                                `,children:[e("span",{className:"font-medium",children:n}),e("span",{className:"text-xs",children:y.icon?e(y.icon,{className:`w-3 h-3 ${y.color}`}):e("span",{className:y.color,children:s})})]},n)})}),o&&o.length>0&&e(f,{className:"flex flex-wrap gap-2",children:o.map(w=>{const h=x&&x[t.user_id]&&x[t.user_id][w.type]||0;return d(he,{size:"sm",variant:"flat",color:h>0?"warning":"default",startContent:e(de,{className:"w-3 h-3"}),children:[w.type,": ",h]},w.type)})})]})}),Q=c.useCallback(()=>{try{if(!a||a.length===0){alert("No data available to export");return}const t=a.map((p,C)=>{const F={"No.":C+1,"Employee Name":p.name||"N/A","Employee ID":p.employee_id||p.user_id||"N/A"};return Array.from({length:b},(W,k)=>{const N=k+1,S=m(`${r}-${l}-${N}`).format("YYYY-MM-DD"),M=p[S]||"▼";F[`Day ${N}`]=M}),o&&o.length>0&&o.forEach(W=>{const k=x&&x[p.user_id]&&x[p.user_id][W.type]||0;F[W.type]=k}),F}),u=D.book_new(),h=[[`Monthly Attendance Report - ${m(`${r}-${l}-01`).format("MMMM YYYY")}`],[`Generated on: ${new Date().toLocaleString("en-US")}`],[`Total Employees: ${a.length}`],[],["No.","Employee Name","Employee ID",...Array.from({length:b},(p,C)=>`Day ${C+1}`),...o?o.map(p=>p.type):[]]],n=t.map(p=>[p["No."],p["Employee Name"],p["Employee ID"],...Array.from({length:b},(C,F)=>p[`Day ${F+1}`]),...o?o.map(C=>p[C.type]):[]]),$=[...h,...n],s=D.aoa_to_sheet($),y=[{wch:5},{wch:25},{wch:15},...Array.from({length:b},()=>({wch:10})),...o?o.map(()=>({wch:12})):[]];s["!cols"]=y;const E=3+b+(o?o.length:0);s["!merges"]=[{s:{r:0,c:0},e:{r:0,c:E-1}},{s:{r:1,c:0},e:{r:1,c:E-1}},{s:{r:2,c:0},e:{r:2,c:E-1}}],s.A1&&(s.A1.s={font:{bold:!0,sz:16},alignment:{horizontal:"center"}}),D.book_append_sheet(u,s,"Attendance");const G=`Monthly_Attendance_${m(`${r}-${l}-01`).format("YYYY_MM")}.xlsx`;ke(u,G)}catch(t){console.error("Error generating Excel file:",t),alert("Error generating Excel file. Please try again.")}},[a,r,l,b,o,x]),R=c.useCallback(()=>{try{if(!a||a.length===0){alert("No data available to export");return}const t=new ve("landscape"),u=`Monthly Attendance Report - ${m(`${r}-${l}-01`).format("MMMM YYYY")}`;t.setFontSize(18),t.setFont("helvetica","bold"),t.text(u,t.internal.pageSize.getWidth()/2,20,{align:"center"}),t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Generated on: ${new Date().toLocaleString("en-US")}`,14,35),t.text(`Total Employees: ${a.length}`,14,42);const w=48;t.setFontSize(8),t.text("Legend: P = Present, A = Absent, H = Holiday, L = Leave",14,w);const h=a.map(($,s)=>[s+1,$.name||"N/A",...Array.from({length:b},(y,E)=>{const G=E+1,p=m(`${r}-${l}-${G}`).format("YYYY-MM-DD"),C=$[p]||"▼";return B(C).short}),...o?o.map(y=>x&&x[$.user_id]&&x[$.user_id][y.type]||0):[]]);Pe(t,{head:[["No.","Employee",...Array.from({length:b},($,s)=>s+1),...o?o.map($=>$.type.substr(0,3)):[]]],body:h,startY:55,theme:"grid",styles:{fontSize:6,cellPadding:1,lineColor:[200,200,200],lineWidth:.5},headStyles:{fillColor:[66,139,202],textColor:[255,255,255],fontStyle:"bold",fontSize:7},columnStyles:{0:{cellWidth:15,halign:"center"},1:{cellWidth:40},...Object.fromEntries(Array.from({length:b},($,s)=>[s+2,{cellWidth:8,halign:"center"}]))},margin:{top:10,left:14,right:14}});const n=`Monthly_Attendance_${m(`${r}-${l}-01`).format("YYYY_MM")}.pdf`;t.save(n)}catch(t){console.error("Error generating PDF file:",t),alert("Error generating PDF file. Please try again.")}},[a,r,l,b,o,x]);return g?e(f,{className:"flex justify-center items-center h-64",children:e(De,{className:"w-full h-full rounded-lg"})}):!a||a.length===0?d(f,{className:"flex flex-col items-center justify-center py-8",children:[e(K,{className:"w-12 h-12 text-default-300 mb-4"}),e(L,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):J?d(f,{children:[e(se,{title:d(f,{className:"flex items-center gap-3",children:[e(K,{className:"w-6 h-6 text-primary"}),e(L,{variant:"h6",component:"h1",children:"Attendance Report"})]}),action:d(ie,{direction:"row",children:[e(z,{title:"Download as Excel",children:e(P,{onClick:Q,disabled:g||!a||a.length===0,sx:{background:_(i.palette.success.main,.1),"&:hover":{background:_(i.palette.success.main,.2)}},children:e(fe,{sx:{color:i.palette.success.main}})})}),e(z,{title:"Download as PDF",children:e(P,{onClick:R,disabled:g||!a||a.length===0,sx:{background:_(i.palette.error.main,.1),"&:hover":{background:_(i.palette.error.main,.2)}},children:e(ue,{sx:{color:i.palette.error.main}})})}),v&&e(z,{title:"Refresh Data",children:e(P,{onClick:v,disabled:g,sx:{background:_(i.palette.primary.main,.1),"&:hover":{background:_(i.palette.primary.main,.2)}},children:e(ge,{color:"primary"})})})]})}),e(ae,{}),e(V,{children:e(me,{className:"max-h-[70vh]",children:a.map((t,u)=>e(ee,{data:t,index:u},t.user_id||u))})})]}):d(f,{children:[e(se,{title:d(f,{className:"flex items-center gap-3",children:[e(K,{className:"w-6 h-6 text-primary"}),d(L,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",m(`${r}-${l}-01`).format("MMMM YYYY")]})]}),action:d(ie,{direction:"row",spacing:1,children:[e(z,{title:"Download as Excel",children:e(P,{onClick:Q,disabled:g||!a||a.length===0,sx:{background:_(i.palette.success.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${_(i.palette.success.main,.2)}`,"&:hover":{background:_(i.palette.success.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(fe,{sx:{color:i.palette.success.main}})})}),e(z,{title:"Download as PDF",children:e(P,{onClick:R,disabled:g||!a||a.length===0,sx:{background:_(i.palette.error.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${_(i.palette.error.main,.2)}`,"&:hover":{background:_(i.palette.error.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(ue,{sx:{color:i.palette.error.main}})})}),v&&e(z,{title:"Refresh Data",children:e(P,{onClick:v,disabled:g,sx:{background:_(i.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${_(i.palette.primary.main,.2)}`,"&:hover":{background:_(i.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(ge,{color:"primary"})})})]}),sx:{padding:"24px"}}),e(ae,{}),e(V,{children:e(f,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e(me,{className:"max-h-[70vh]",children:d(Re,{isCompact:!H,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e(We,{columns:T,children:t=>e(Ie,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:d(f,{className:"flex flex-col items-center gap-1",children:[d(f,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e(je,{items:a,emptyContent:d(f,{className:"flex flex-col items-center justify-center py-8",children:[e(K,{className:"w-12 h-12 text-default-300 mb-4"}),e(L,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e(Le,{children:u=>{const w=a.findIndex(h=>(h.user_id||h.id)===(t.user_id||t.id));switch(u){case"sl":return e(Z,{className:"text-center font-medium",children:w+1});case"name":return e(Z,{className:"whitespace-nowrap",children:e(be,{avatarProps:{radius:"lg",size:H?"md":"sm",src:t.profile_image,fallback:e(oe,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(u.startsWith("day-")){const n=parseInt(u.split("-")[1]),$=m(`${r}-${l}-${n}`).format("YYYY-MM-DD"),s=t[$]||"▼",y=B(s),E=m(`${r}-${l}-${n}`).day()===0||m(`${r}-${l}-${n}`).day()===6;return e(Z,{className:`text-center ${E?"bg-default-50":""}`,children:e(f,{className:"flex items-center justify-center",children:y.icon?e(y.icon,{className:`w-4 h-4 ${y.color}`}):e("span",{className:`text-xs ${y.color}`,children:s})})})}const h=o&&o.find(n=>n.type===u);if(h){const n=x&&x[t.user_id]&&x[t.user_id][h.type]||0;return e(Z,{className:"text-center",children:e(he,{size:"sm",variant:n>0?"flat":"bordered",color:n>0?"warning":"default",className:"min-w-8",children:n})})}return e(Z,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},Qe=Ae.memo(({title:g,allUsers:a})=>{const r=we(),[l,o]=c.useState(!1),{auth:x}=Ne().props,[v,i]=c.useState([]),[H,J]=c.useState([]),[b,X]=c.useState([]),[T,B]=c.useState(0),[ee,Q]=c.useState(0),[R,t]=c.useState(""),u=q(r.breakpoints.down("md")),[w,h]=c.useState(30),[n,$]=c.useState(1),[s,y]=c.useState({currentMonth:m().format("YYYY-MM")}),E=m(`${s.currentYear}-${s.currentMonth}-01`).daysInMonth(),G=c.useCallback((k,N)=>{y(S=>({...S,[k]:N}))},[]),p=async(k,N,S)=>{o(!0);try{const M=await Ee.get(route("attendancesAdmin.paginate"),{params:{page:k,perPage:N,employee:R,currentYear:S.currentMonth?m(S.currentMonth).year():"",currentMonth:S.currentMonth?m(S.currentMonth).format("MM"):""}});i(M.data.data),B(M.data.total),Q(M.data.last_page),X(M.data.leaveTypes),J(M.data.leaveCounts)}catch(M){console.error(M),pe.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:r.glassCard.background,border:r.glassCard.border,color:r.palette.text.primary}})}finally{o(!1)}},C=k=>{const N=k.target.value.toLowerCase();t(N)};c.useEffect(()=>{p(n,w,s)},[n,w,s,R]);const F=k=>{$(k)},W=async()=>{const k=new Promise((N,S)=>{try{const M=a.map((A,U)=>{const I=v.find(Y=>Y.user_id===A.id)||{},te={sl:U+1,name:A.name};for(let Y=0;Y<E;Y++){const O=Y+1,_e=m(`${s.currentYear}-${s.currentMonth}-${O}`).format("YYYY-MM-DD");te[`day-${O}`]=I[_e]||"▼"}return b.forEach(Y=>{var O;te[Y.type]=((O=H[A.id])==null?void 0:O[Y.type])||0}),te}),le=[{label:"Sl",key:"sl"},{label:"Name",key:"name"},...Array.from({length:E},(A,U)=>{const I=U+1;return{label:`${I}`,key:`day-${I}`}}),...b.map(A=>({label:A.type,key:A.type}))],ne=D.json_to_sheet(M,{header:le.map(A=>A.key)});le.forEach((A,U)=>{const I=D.encode_cell({c:U,r:0});ne[I].v=A.label});const ce=D.book_new();D.book_append_sheet(ce,ne,"Attendance"),ke(ce,"AttendanceData.xlsx"),N("Export successful!")}catch(M){S("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",M)}});pe.promise(k,{pending:{render(){return d("div",{style:{display:"flex",alignItems:"center"},children:[e(Fe,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:r.glassCard.background,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:N}){return e(j,{children:N})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:r.glassCard.background,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:N}){return e(j,{children:N})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:r.glassCard.background,border:r.glassCard.border,color:r.palette.text.primary}}})};return d(j,{children:[e(Me,{title:g}),e(f,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Ce,{in:!0,children:d($e,{children:[e(se,{title:"Attendances",sx:{padding:"24px"},action:e(f,{display:"flex",gap:2,children:x.roles.includes("Administrator")&&e(j,{children:u?e(j,{children:e(P,{title:"Export Daily Works",color:"success",onClick:W,children:e(ye,{})})}):e(j,{children:e(Se,{title:"Export Daily Works",variant:"outlined",color:"success",startIcon:e(ye,{}),onClick:W,children:"Export"})})})})}),e(V,{children:e(f,{children:d(re,{container:!0,spacing:2,children:[e(re,{item:!0,xs:12,sm:6,md:4,children:e(xe,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:R,onChange:C,endContent:e(Ge,{})})}),e(re,{item:!0,xs:12,sm:6,md:4,children:e(xe,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:s.currentMonth,onChange:k=>G("currentMonth",k.target.value)})})]})})}),d(V,{children:[e(Ve,{attendanceData:v,currentYear:s.currentYear,currentMonth:s.currentMonth,leaveTypes:b,leaveCounts:H,loading:l}),T>=30&&e("div",{className:"py-2 px-2 flex justify-center items-center",children:e(Ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:n,total:ee,onChange:F})})]})]})})})]})});Qe.layout=g=>e(Ye,{children:g});export{Qe as default};
