import{V as de,j as l,a as e,F as Y,M as ye}from"./app-WtkjyYqF.js";import{u as ce,r as a,X as ue,T as V,c as be,G as y,F as re,k as se,S as oe,M as H,V as le,b as O,B as Q,Y as fe,Z as pe,$ as me,t as ae,a0 as ve,f as ee,e as Ce,h as xe,a as ne}from"./vendor-CAwIk-m4.js";import{d as Se}from"./Search-CtWsg0kh.js";import{B as he,G as De,A as ke}from"./App-vubgWhxu.js";import{L as Te}from"./LeaveEmployeeTable-TJOCZ_f6.js";import{d as Pe,G as ge}from"./GlassDialog-C2GcWaP9.js";import{L as we}from"./LoadingButton-DWkeAh3Y.js";import{d as _e}from"./dayjs.min-CTH_U6Xy.js";import{A as Fe}from"./Add-BDxfnPJ2.js";import{i as ie}from"./chunk-HJTJQZF3-DLmWL5E4.js";import"./Edit-Da7aI-K6.js";import"./chunk-F3UDT23P-CfmPkOyc.js";import"./chunk-MZRCPRP2-97pF5nBi.js";import"./chunk-SLABUSGS-BgiKgmLT.js";import"./chunk-7F3ZLNJ6-CaUeb2g5.js";import"./chunk-YHY32LNM-BRgjPAZ1.js";import"./chunk-CSXHODZI-YUNJZcTH.js";import"./chunk-7JXO3E7I-DdTtPkFL.js";import"./chunk-2BFF5KFD-C6KWC1W_.js";import"./chunk-4EXC76WE-D0FOJS7O.js";import"./chunk-R6AK6OQ4-Bd7di_2E.js";const Ie=({open:w,closeModal:b,leavesData:m,setLeavesData:C,currentLeave:r,allUsers:D,setTotalRows:M,setLastPage:x,setLeaves:d,handleMonthChange:k,employee:W})=>{const{auth:p}=de().props,o=ce(),[h,A]=a.useState((r==null?void 0:r.user_id)||p.user.id),[s,S]=a.useState(m.leaveTypes||[]),[R,_]=a.useState(m.leaveCounts||[]),[F,I]=a.useState((r==null?void 0:r.leave_type)||(s.length>0?s[0].type:"")),j=t=>{const v=new Date(t);return isNaN(v.getTime())?new Date().toISOString().split("T")[0]:v.toISOString().split("T")[0]},[f,$]=a.useState(j(r==null?void 0:r.from_date)),[L,X]=a.useState(j(r==null?void 0:r.to_date)),[G,N]=a.useState((r==null?void 0:r.no_of_days)||""),[U,Z]=a.useState(""),[q,z]=a.useState((r==null?void 0:r.reason)||""),[n,J]=a.useState({}),[c,T]=a.useState(!1),[P,B]=a.useState("");return a.useEffect(()=>{m&&(S(m.leaveTypes||[]),_(m.leaveCountsByUser[h]||[]))},[m,h]),a.useEffect(()=>{var g;const t=((g=R==null?void 0:R.find(u=>u.leave_type===F))==null?void 0:g.days_used)||0;B(t);const v=s==null?void 0:s.find(u=>u.type===F);v&&Z(v.days-t)},[F,R,s]),a.useEffect(()=>{N(((v,g)=>{if(!v||!g)return"";const u=new Date(v),i=new Date(g);if(u>i)return"";const K=i.getTime()-u.getTime();return Math.ceil(K/(1e3*3600*24))+1})(f,L))},[f,L]),l(ge,{open:w,onClose:b,fullWidth:!0,maxWidth:"sm",children:[l(ue,{sx:{display:"flex",alignItems:"center"},children:[e(V,{variant:"h6",children:"Add Leave"}),e(be,{onClick:b,sx:{position:"absolute",top:8,right:16},children:e(Pe,{})})]}),l("form",{onSubmit:async t=>{t.preventDefault(),T(!0);const v=new Promise(async(g,u)=>{try{const i={route:route().current(),user_id:h,leaveType:F,fromDate:f,toDate:L,daysCount:G,leaveReason:q,employee:W},K=r?route("leave-update"):route("leave-add");r&&(i.id=r.id);const E=await axios.post(K,i);E.status===200&&(C(E.data.leavesData),M(E.data.leaves.total),x(E.data.leaves.last_page),d(E.data.leaves.data),k({target:{value:f.slice(0,7)}}),b(),g([E.data.message||"Leave application submitted successfully"]))}catch(i){console.error(i),T(!1),i.response?(i.response.status===422?(J(i.response.data.errors||{}),u(i.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(i.response.data.error)):i.request?(u("No response received from the server. Please check your internet connection."),console.error(i.request)):(u("An error occurred while setting up the request."),console.error("Error",i.message))}finally{T(!1)}});he.promise(v,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(ae,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:g}){return e(Y,{children:g.map((u,i)=>e("div",{children:u},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:g}){return e(Y,{children:g})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(pe,{children:l(y,{container:!0,spacing:2,children:[e(y,{item:!0,xs:12,md:6,children:l(re,{fullWidth:!0,children:[e(se,{id:"leave-type-label",children:"Leave Type"}),l(oe,{labelId:"leave-type-label",value:F,onChange:t=>I(t.target.value),label:"Leave Type",error:!!n.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(H,{value:"",disabled:!0,children:"Select Leave Type"}),s.map(t=>l(H,{value:t.type,children:[t.type," ",t.days," Days"]},t.id))]}),e(le,{children:n.leaveType})]})}),e(y,{item:!0,xs:12,md:6,children:e(O,{label:"From",type:"date",fullWidth:!0,value:f,onChange:t=>$(t.target.value),InputLabelProps:{shrink:!0},error:!!n.fromDate,helperText:n.fromDate})}),e(y,{item:!0,xs:12,md:6,children:e(O,{label:"To",type:"date",fullWidth:!0,value:L,onChange:t=>X(t.target.value),InputLabelProps:{shrink:!0},error:!!n.toDate,helperText:n.toDate})}),e(y,{item:!0,xs:12,md:6,children:e(O,{label:"Number of days",type:"text",fullWidth:!0,value:G,InputProps:{readOnly:!0},error:!!n.daysCount,helperText:n.daysCount})}),e(y,{item:!0,xs:12,md:6,children:e(O,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:U,InputProps:{readOnly:!0},error:!!n.remainingLeaves,helperText:n.remainingLeaves})}),p.roles.includes("Administrator")&&route().current()==="leaves"&&e(y,{item:!0,xs:12,md:6,children:l(re,{fullWidth:!0,children:[e(se,{id:"leave-employee-label",children:"Employee"}),l(oe,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:h||"na",error:!!n.user_id,onChange:t=>A(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(H,{value:"na",disabled:!0,children:"Please select"}),D.map(t=>e(H,{value:t.id,children:l(Q,{sx:{display:"flex"},children:[e(fe,{src:t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(le,{children:n.user_id})]})}),e(y,{item:!0,xs:12,children:e(O,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:q,onChange:t=>z(t.target.value),error:!!n.leaveReason,helperText:n.leaveReason})})]})}),e(me,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:c,disabled:c,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Be=({open:w,handleClose:b,leaveIdToDelete:m,setLeavesData:C,setLeaves:r,setTotalRows:D,setLastPage:M,setError:x})=>{const d=ce();return l(ge,{open:w,onClose:b,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ue,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(pe,{children:e(ve,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(me,{children:[e(ee,{onClick:b,color:"primary",children:"Cancel"}),e(ee,{onClick:()=>{const W=new Promise(async(p,o)=>{var h,A;try{const s=await axios.delete(route("leave-delete",{id:m,route:route().current()}));console.log(s),s.status===200&&(C(s.data.leavesData),D(s.data.leaves.total),M(s.data.leaves.last_page),r(s.data.leaves.data),x(!1),p("Leave application deleted successfully"))}catch(s){if(console.error("Error deleting task:",s),s.response.status===404){const{leavesData:S}=s.response.data;C(S),x(((A=(h=s.response)==null?void 0:h.data)==null?void 0:A.message)||"Error retrieving data.")}o(s.response.data.error||"Failed to delete leave application")}finally{b()}});he.promise(W,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(ae,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},success:{render({data:p}){return e(Y,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},error:{render({data:p}){return e(Y,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ee=({title:w,allUsers:b})=>{de();const[m,C]=a.useState(!1),[r,D]=a.useState(null),[M,x]=a.useState([]),[d,k]=a.useState(),[W,p]=a.useState(0),[o,h]=a.useState(0),[A,s]=a.useState(null),[S,R]=a.useState(""),[_,F]=a.useState(_e().format("YYYY-MM")),[I,j]=a.useState(30),[f,$]=a.useState(1),[L,X]=a.useState(),[G,N]=a.useState(""),U=c=>D(c),Z=a.useCallback((c,T)=>{s(c),D(T)},[]),q=a.useCallback(()=>{D(null),s(null)},[]),z=c=>R(c.target.value.toLowerCase()),n=c=>{F(c.target.value)},J=async()=>{var c,T;try{const P=await axios.get(route("leaves.paginate"),{params:{page:f,perPage:I,employee:S,month:_}});if(P.status===200){const{leaves:B,leavesData:te}=P.data;k(B.data),x(te),p(B.total),h(B.last_page),N(!1),C(!1)}}catch(P){if(console.error("Error fetching leaves data:",P.response),P.response.status===404){const{leavesData:B}=P.response.data;x(B),N(((T=(c=P.response)==null?void 0:c.data)==null?void 0:T.message)||"Error retrieving data.")}k(!1),C(!1)}};return a.useEffect(()=>{C(!0),J()},[_,f,I,S]),console.log(M),l(Y,{children:[e(ye,{title:w}),["add_leave","edit_leave"].includes(r)&&e(Ie,{setTotalRows:p,setLastPage:h,setLeaves:k,perPage:I,employee:S,currentPage:f,selectedMonth:_,allUsers:b,open:!0,setLeavesData:x,closeModal:()=>D(null),leavesData:M,currentLeave:r==="edit_leave"?L:null,handleMonthChange:n}),r==="delete_leave"&&e(Be,{setTotalRows:p,setLastPage:h,setLeaves:k,perPage:I,open:!0,handleClose:q,leaveIdToDelete:A,setLeavesData:x,setError:N,setLoading:C}),e(Q,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Ce,{in:!0,children:l(De,{children:[e(xe,{title:"Leaves",sx:{padding:"24px"},action:e(ee,{title:"Add Leave",variant:"outlined",color:"success",startIcon:e(Fe,{}),onClick:()=>U("add_leave"),children:"Add Leave"})}),e(ne,{children:l(y,{container:!0,spacing:2,children:[e(y,{item:!0,xs:12,sm:6,md:4,children:e(ie,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:S,onChange:z,endContent:e(Se,{})})}),e(y,{item:!0,xs:12,sm:6,md:4,children:e(ie,{label:"Select Month",type:"month",variant:"bordered",onChange:n,value:_,isLoading:m})})]})}),e(ne,{children:m?l(Q,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:[e(ae,{sx:{p:1}}),e(V,{variant:"body1",align:"center",children:"Loading leaves data..."})]}):d&&d.length>0?e(Te,{totalRows:W,lastPage:o,setCurrentPage:$,setPerPage:j,perPage:I,currentPage:f,handleClickOpen:Z,setCurrentLeave:X,openModal:U,leaves:d,allUsers:b,setLeaves:k,employee:S,selectedMonth:_}):G?e(V,{variant:"body1",align:"center",children:G}):e(V,{variant:"body1",align:"center",children:"No leaves data found."})})]})})})]})};Ee.layout=w=>e(ke,{children:w});export{Ee as default};
