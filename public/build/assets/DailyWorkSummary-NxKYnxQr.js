import{q as Y,j as s,a as e,F as k,B as O,Y as z,G as X}from"./app-DsNLFmGn.js";import{y as $,u as _,V as q,B as x,r as g,W as K,T as Q,c as E,j as V,k as Z,l as R,m as W,n as J,O as N,X as U,Y as ee,o as te,Z as re,$ as ae,e as oe,g as le,f as ne,a as j,G as I,b as G,F as se,h as ie,S as de,M as H}from"./vendor-D_Qsh6wj.js";import{A as ce}from"./App-1zcAwj2N.js";import{X as ue,D as A,u as M,w as pe,m as me,a as be,A as ge,L as ye,b as he}from"./xlsx-D7Vfhhxd.js";import{d as b}from"./dayjs.min-Bk5DZr9d.js";import{d as xe,G as ke}from"./GlassDialog-DF3tjSLB.js";import{L as Ce}from"./LoadingButton-BqVU-fyS.js";const De=$(ue)(({theme:a})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{backgroundColor:"transparent",color:a.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","& .rdt_TableRow":{backgroundColor:"transparent",color:a.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${a.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:a.palette.action.hover}}}})),fe=({handleClickOpen:a,allInCharges:y,setDailyWorks:f,reports:B,juniors:d,reports_with_daily_works:S,openModal:m,setCurrentRow:w,filteredData:C,setFilteredData:v})=>{const{auth:l}=Y().props,c=_();l.roles.includes("Administrator"),l.roles.includes("Supervision Engineer");const p=[{name:"Date",selector:t=>t.date,sortable:!0,center:!0,width:"100px"},{name:"Total Daily Works",selector:t=>t.totalDailyWorks,sortable:!0,center:!0,width:"160px"},{name:"Resubmissions",selector:t=>t.resubmissions,sortable:!0,center:!0,width:"130px"},{name:"Embankment",selector:t=>t.embankment,sortable:!0,center:!0,width:"130px"},{name:"Structure",selector:t=>t.structure,sortable:!0,center:!0,width:"130px"},{name:"Pavement",selector:t=>t.pavement,sortable:!0,center:!0,width:"130px"},{name:"Completed",selector:t=>t.completed,sortable:!0,center:!0,width:"130px"},{name:"Pending",selector:t=>t.pending,sortable:!0,center:!0,width:"130px"},{name:"Completion Percentage",selector:t=>t.completionPercentage,sortable:!0,center:!0,width:"180px",cell:t=>s(x,{sx:{textAlign:"center",color:t.completionPercentage>=100?"green":"red"},children:[t.completionPercentage,"%"]})},{name:"RFI Submissions",selector:t=>t.rfiSubmissions,sortable:!0,center:!0,width:"160px"},{name:"RFI Submission Percentage",selector:t=>t.rfiSubmissionPercentage,sortable:!0,center:!0,width:"180px",cell:t=>s(x,{sx:{textAlign:"center",color:t.rfiSubmissionPercentage>=100?"green":"red"},children:[t.rfiSubmissionPercentage,"%"]})}];return s(k,{children:[e(q,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:c.palette.text.primary}}}),e(De,{columns:p,data:C,defaultSortField:"date",defaultSortFieldId:1,defaultSortAsc:!1,pagination:!0,highlightOnHover:!0,responsive:!0})]})},Se=({open:a,closeModal:y,filteredData:f,users:B})=>{g.useState(!1);const d=_(),S=[{label:"Date",key:"date"},{label:"Total Daily Works",key:"totalDailyWorks"},{label:"Resubmissions",key:"resubmissions"},{label:"Embankment",key:"embankment"},{label:"Structure",key:"structure"},{label:"Pavement",key:"pavement"},{label:"Completed",key:"completed"},{label:"Pending",key:"pending"},{label:"Completion Percentage",key:"completionPercentage"},{label:"RFI Submissions",key:"rfiSubmissions"},{label:"RFI Submission Percentage",key:"rfiSubmissionPercentage"}],[m,w]=g.useState(S.map(l=>({...l,checked:!0}))),C=l=>{const c=[...m];c[l].checked=!c[l].checked,w(c)},v=async l=>{const c=new Promise((p,t)=>{try{const h=f.map(T=>{const D={};return l.forEach(r=>{r.checked&&(D[r.label]=T[r.key])}),D}),P=M.json_to_sheet(h),i=M.book_new();M.book_append_sheet(i,P,"Daily Work Summary"),pe(i,"DailyWorkSummary.xlsx"),p("Export successful!"),y()}catch(h){t("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",h)}});O.promise(c,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(te,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},success:{render({data:p}){return e(k,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},error:{render({data:p}){return e(k,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}}})};return s(ke,{open:a,onClose:y,children:[s(K,{style:{cursor:"move"},id:"draggable-dialog-title",children:[e(Q,{children:"Export Daily Works"}),e(E,{variant:"outlined",color:"primary",onClick:y,sx:{position:"absolute",top:8,right:16},children:e(xe,{})})]}),e(U,{children:s(V,{size:"small",sx:{"& .MuiTableCell-root":{padding:"4px 8px"},"& .MuiCheckbox-root":{padding:"0px"}},children:[e(Z,{children:s(R,{children:[e(W,{children:"Column Label"}),e(W,{align:"center",children:"Include in Export"})]})}),e(J,{children:m.map((l,c)=>s(R,{children:[e(W,{children:l.label}),e(W,{align:"center",children:e(N,{checked:l.checked,onChange:()=>C(c)})})]},l.key))})]})}),e(ee,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:e(Ce,{sx:{borderRadius:"50px",padding:"6px 16px"},variant:"outlined",color:"primary",type:"submit",onClick:()=>v(m),startIcon:e(A,{}),children:"Download"})})]})};b.extend(me);const L=re(be)(({theme:a})=>({"& .MuiPaper-root":{backgroundColor:a.glassCard.backgroundColor},"& .MuiInputBase-root":{color:a.palette.text.primary,borderColor:a.palette.divider},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:a.palette.divider},"&:hover fieldset":{borderColor:a.palette.primary.main},"&.Mui-focused fieldset":{borderColor:a.palette.primary.main}},"& .MuiSvgIcon-root":{color:a.palette.text.secondary},"& .MuiPickersDay-root":{color:a.palette.text.primary,"&.Mui-selected":{backgroundColor:a.palette.primary.main,color:a.palette.primary.contrastText},"&.MuiPickersDay-today":{borderColor:a.palette.primary.main}}})),ve=({auth:a,title:y,summary:f,jurisdictions:B,inCharges:d})=>{const S=_(),[m,w]=g.useState(f),[C,v]=g.useState(f),l=m.map(r=>b(r.date)),[c,p]=g.useState(null),t=ae(S.breakpoints.down("md")),h=r=>{p(r)},P=()=>{p(null)},[i,T]=g.useState({startDate:b.min(...l),endDate:b.max(...l),status:"all",incharge:"all"}),D=(r,F)=>{T(o=>({...o,[r]:F}))};return g.useEffect(()=>{(!i.startDate||!i.endDate)&&T(r=>({...r,startDate:b.min(...l),endDate:b.max(...l)}))},[l]),g.useEffect(()=>{const F=m.filter(o=>b(o.date).isBetween(i.startDate,i.endDate,null,"[]")&&(i.incharge==="all"||!i.incharge||o.incharge===i.incharge)).reduce((o,u)=>{const n=b(u.date).format("YYYY-MM-DD");return o[n]?(o[n].totalDailyWorks+=u.totalDailyWorks,o[n].resubmissions+=u.resubmissions,o[n].embankment+=u.embankment,o[n].structure+=u.structure,o[n].pavement+=u.pavement,o[n].pending+=u.pending,o[n].completed+=u.completed,o[n].rfiSubmissions+=u.rfiSubmissions,o[n].completionPercentage=o[n].totalDailyWorks>0?o[n].completed/o[n].totalDailyWorks*100:0,o[n].rfiSubmissionPercentage=o[n].totalDailyWorks>0?o[n].rfiSubmissions/o[n].totalDailyWorks*100:0):o[n]={...u},o},{});v(Object.values(F))},[i,m]),s(k,{children:[e(z,{title:y}),c==="exportDailyWorkSummary"&&e(Se,{open:c==="exportDailyWorkSummary",closeModal:P,filteredData:C}),e(x,{sx:{display:"flex",justifyContent:"center",p:2},children:e(oe,{in:!0,children:s(X,{children:[e(le,{title:y,sx:{padding:"24px"},action:s(x,{display:"flex",gap:2,children:[a.permissions.includes("addTask")&&e(E,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:e(ge,{})}),a.roles.includes("Administrator")&&e(k,{children:t?e(k,{children:e(E,{title:"Export Daily Works",color:"success",onClick:()=>h("exportDailyWorkSummary"),children:e(A,{})})}):e(k,{children:e(ne,{title:"Export Daily Works",variant:"outlined",color:"success",startIcon:e(A,{}),onClick:()=>h("exportDailyWorkSummary"),children:"Export"})})})]})}),e(j,{children:e(x,{children:s(I,{container:!0,spacing:3,children:[e(I,{item:!0,xs:12,sm:6,md:3,sx:{paddingTop:"8px !important"},children:e(ye,{dateAdapter:he,children:s(x,{display:"flex",alignItems:"center",children:[e(L,{label:"Start date",value:i.startDate,onChange:r=>D("startDate",r),textField:r=>e(G,{...r,fullWidth:!0,size:"small"})}),e(x,{sx:{mx:1},children:" to "}),e(L,{label:"End date",value:i.endDate,onChange:r=>D("endDate",r),textField:r=>e(G,{...r,fullWidth:!0,size:"small"})})]})})}),a.roles.includes("Administrator")&&e(I,{item:!0,xs:6,sm:4,md:3,sx:{paddingTop:"8px !important"},children:s(se,{fullWidth:!0,children:[e(ie,{id:"incharge-label",children:"Incharge"}),s(de,{variant:"outlined",labelId:"incharge-label",label:"Incharge",name:"incharge",value:i.incharge,onChange:r=>D("incharge",r.target.value),children:[e(H,{value:"all",children:"All"}),d.map(r=>e(H,{value:r.id,children:r.name},r.id))]})]})})]})})}),e(j,{children:e(fe,{filteredData:C,openModal:h})})]})})})]})};ve.layout=a=>e(ce,{children:a});export{ve as default};
