import{J as le,r as i,j as e,b as n,s as Ce,h as $,F as Ne,a as k,Q as Pe}from"./app-CFP6hyYs.js";import{aA as V,ap as Se,aq as Fe,ar as G,as as Te,m as Ae,h as Ee,u as ce,a as q,T as A,aB as de,I as me,f as M,Q as Ie,aC as Me,aD as ke,n as P,B as H,am as Re,G as Be,e as $e,i as je,ai as ze,A as Le}from"./App-D6An07Kr.js";import{P as Oe}from"./PageHeader-Bz93Sfm2.js";import{S as We}from"./StatsCards-CUpUkWwy.js";import"./dayjs.min-ChetXucw.js";import{N as Ge}from"./NoDataMessage-qJ_0JT4k.js";import{F as ae}from"./EyeIcon-DgjWumnb.js";import{a as se,F as Qe}from"./PencilIcon-BF3p_yc2.js";import{F as re}from"./TrashIcon-BZfJHKgb.js";import{F as ue}from"./CheckCircleIcon-AZmqMBxU.js";import{F as he}from"./XCircleIcon--Ts0rzjR.js";import{a as Ve,b as qe,c as He,d as Ue,e as Ye,t as Je}from"./chunk-F3UDT23P-DyOXJHi9.js";import{p as Xe}from"./chunk-O5I3QTYU-DQH7fxZK.js";import{t as Q}from"./chunk-7ZZXWEXF-D1kpgAQR.js";import{G as Ze}from"./GlassDialog-BpMvQG8W.js";import{D as pe}from"./DialogTitle-CuQhO8kb.js";import{D as j}from"./Divider-BZcpBGrc.js";import{T as Ke,F as ne}from"./TextField-BXsOYBjR.js";import{I as et}from"./InputLabel-iYTjAW9D.js";import{S as tt}from"./Select-Du8X2Jnk.js";import{M as oe}from"./MenuItem-CGyUvAUg.js";import{b as ge,c as fe,a as at}from"./DialogContent-BtQ3vICj.js";import{B as z}from"./Button-MN0ZW-Kq.js";import{F as st}from"./ExclamationTriangleIcon-CRuJlVxF.js";import{A as ie}from"./Alert-B_X6_iWg.js";import{C as be}from"./CircularProgress-CFRIP969.js";import{F as rt}from"./PlusIcon-vwTHQno-.js";import"./app-CA3O2NZp.js";import"./chunk-D5XJWRAV-uH3KDZFl.js";import"./chunk-MZRCPRP2-DWGhMUGC.js";import"./LiveAnnouncer-C2yfromK.js";import"./useHasTabbableChild-D8mnK-MW.js";import"./chunk-7F3ZLNJ6-BGGFeK05.js";import"./index-CokAva9Y.js";import"./dividerClasses-BZroorQj.js";import"./Popover-D8TPN1sn.js";import"./List-D9MzT9Av.js";import"./listItemTextClasses-BZGV-Gs5.js";import"./useSlot-CUo2w1xl.js";const nt=({designations:l,onEdit:o,onDelete:x,onView:s,loading:c,isMobile:D,isTablet:m,pagination:r,onPageChange:C,onRowsPerPageChange:u,canEditDesignation:f=!1,canDeleteDesignation:b=!1})=>{var _,v;const{auth:g}=le().props,h=f||((_=g.permissions)==null?void 0:_.includes("designations.update"))||!1,d=b||((v=g.permissions)==null?void 0:v.includes("designations.delete"))||!1,T=i.useMemo(()=>[{name:"TITLE",uid:"title"},{name:"DEPARTMENT",uid:"department_name"},{name:"EMPLOYEES",uid:"employee_count"},{name:"STATUS",uid:"status"},{name:"ACTIONS",uid:"actions"}],[]),y=(a,F)=>{switch(F){case"title":return e("span",{className:"font-semibold text-foreground",children:a.title});case"department_name":return e("span",{className:"text-default-500",children:a.department_name||"-"});case"employee_count":return n("div",{className:"flex items-center gap-2",children:[e(Ee,{className:"w-4 h-4 text-default-400"}),e("span",{children:a.employee_count||0})]});case"status":return e(Ae,{size:"sm",variant:a.is_active?"solid":"bordered",color:a.is_active?"success":"danger",startContent:a.is_active?e(ue,{className:"w-3 h-3"}):e(he,{className:"w-3 h-3"}),children:a.is_active?"Active":"Inactive"});case"actions":return e("div",{className:"flex justify-end items-center",children:D?n(Te,{children:[e(Se,{children:e($,{isIconOnly:!0,size:"sm",variant:"light",children:e(Qe,{className:"w-4 h-4"})})}),n(Fe,{"aria-label":"Designation actions",children:[e(G,{startContent:e(ae,{className:"w-4 h-4"}),onPress:()=>s(a),children:"View Details"},"view"),h&&e(G,{startContent:e(se,{className:"w-4 h-4"}),onPress:()=>o(a),children:"Edit Designation"},"edit"),d&&e(G,{className:"text-danger",color:"danger",startContent:e(re,{className:"w-4 h-4"}),isDisabled:a.employee_count>0,onPress:()=>x(a),children:"Delete Designation"},"delete")]})]}):n(Ne,{children:[e(Q,{content:"View Designation",children:e($,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-foreground",onPress:()=>s(a),children:e(ae,{className:"w-4 h-4"})})}),h&&e(Q,{content:"Edit Designation",children:e($,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-blue-500",onPress:()=>o(a),children:e(se,{className:"w-4 h-4"})})}),d&&e(Q,{content:a.employee_count>0?"Cannot delete designation with employees":"Delete Designation",children:e($,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-danger",isDisabled:a.employee_count>0,onPress:()=>x(a),children:e(re,{className:"w-4 h-4"})})})]})});default:return e("span",{children:a[F]})}},w=()=>!l||!l.data||c?null:n("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2 border-t border-white/10",children:[n("span",{className:"text-xs text-default-400 mb-3 sm:mb-0",children:["Showing ",(r.currentPage-1)*r.perPage+1," to ",Math.min(r.currentPage*r.perPage,l.total)," of ",l.total," designations"]}),e(Xe,{total:Math.ceil(l.total/r.perPage),initialPage:r.currentPage,page:r.currentPage,onChange:C,size:D?"sm":"md",variant:"bordered",showControls:!0,classNames:{item:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",cursor:"bg-white/20 backdrop-blur-md border-white/20"}})]});return!c&&(!l||!l.data||l.data.length===0)?e("div",{className:"w-full",children:e(Ge,{message:"No designations found",icon:e(V,{className:"w-12 h-12 text-default-300"}),description:"Try adjusting your search or filters"})}):e("div",{className:"w-full",children:n(Je,{"aria-label":"Designations table",removeWrapper:!0,classNames:{base:"bg-transparent",th:"bg-white/5 backdrop-blur-md text-default-500 border-b border-white/10 font-medium text-xs",td:"border-b border-white/5 py-3"},bottomContent:w(),children:[e(Ve,{columns:T,children:a=>e(qe,{children:a.name},a.uid)}),e(He,{items:l.data||[],emptyContent:!c&&"No designations found",loadingContent:e(Ce,{}),isLoading:c,children:a=>e(Ue,{children:F=>e(Ye,{children:y(a,F)})},a.id)})]})})},ot=({open:l,onClose:o,onSuccess:x,designation:s=null,departments:c=[]})=>{var y;console.log("DesignationForm rendered with departments:",c),console.log("DesignationForm rendered with designation:",s);const D=ce(),m=q(D.breakpoints.down("md")),[r,C]=i.useState(!1),[u,f]=i.useState({}),b={title:"",department_id:"",is_active:!0},[g,h]=i.useState(b);i.useEffect(()=>{h(s?{title:s.title||"",department_id:s.department_id||"",is_active:s.is_active??!0}:b),f({})},[s,l]);const d=w=>{const{name:_,value:v,type:a,checked:F}=w.target;h(S=>({...S,[_]:a==="checkbox"?F:v})),u[_]&&f(S=>({...S,[_]:null}))},T=async()=>{var w,_;C(!0),f({});try{const v={...g};let a;s!=null&&s.id?(a=await k.put(`/designations/${s.id}`,v),P.success("Designation updated successfully")):(a=await k.post("/designations",v),P.success("Designation created successfully")),x(a.data.designation),o()}catch(v){if((_=(w=v.response)==null?void 0:w.data)!=null&&_.errors){f(v.response.data.errors);const a=Object.values(v.response.data.errors)[0];a&&P.error(a[0])}else P.error("An error occurred while saving the designation")}finally{C(!1)}};return n(Ze,{open:l,onClose:r?void 0:o,maxWidth:"sm",fullWidth:!0,fullScreen:m,"aria-labelledby":"designation-form-dialog",children:[n(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e(A,{variant:"h6",component:"div",children:s?"Edit Designation":"Create New Designation"}),e(me,{edge:"end",color:"inherit",onClick:o,disabled:r,"aria-label":"close",children:e(de,{className:"w-5 h-5"})})]}),e(j,{}),e(ge,{sx:{pt:2},children:n(M,{container:!0,spacing:3,children:[e(M,{item:!0,xs:12,children:e(A,{variant:"subtitle1",color:"primary",gutterBottom:!0,children:"Designation Information"})}),e(M,{item:!0,xs:12,md:6,children:e(Ke,{name:"title",label:"Designation Title",fullWidth:!0,required:!0,value:g.title,onChange:d,error:!!u.title,helperText:((y=u.title)==null?void 0:y[0])||"",disabled:r})}),e(M,{item:!0,xs:12,md:6,children:n(Ie,{fullWidth:!0,error:!!u.department_id,children:[e(et,{id:"department-label",children:"Department"}),n(tt,{labelId:"department-label",name:"department_id",value:g.department_id,onChange:d,label:"Department",disabled:r,children:[e(oe,{value:"",children:e("em",{children:"Select Department"})}),c.map(w=>e(oe,{value:w.id,children:w.name},w.id))]}),u.department_id&&e(ne,{children:u.department_id[0]})]})}),n(M,{item:!0,xs:12,children:[e(Me,{control:e(ke,{checked:g.is_active,onChange:d,name:"is_active",color:"success",disabled:r}),label:"Designation is active"}),u.is_active&&e(ne,{error:!0,children:u.is_active[0]})]})]})}),e(j,{}),n(fe,{sx:{px:3,py:2},children:[e(z,{onClick:o,disabled:r,color:"inherit",children:"Cancel"}),e(z,{onClick:T,variant:"contained",color:"primary",disabled:r,children:r?"Saving...":s?"Update Designation":"Create Designation"})]})]})},it=({open:l,onClose:o,onSuccess:x,designation:s})=>{const[c,D]=i.useState(!1),[m,r]=i.useState(null),C=async()=>{var u,f,b,g;if(s){D(!0),r(null);try{await k.delete(`/hr/designations/${s.id}`),P.success("Designation deleted successfully"),x(),o()}catch(h){if((f=(u=h.response)==null?void 0:u.data)!=null&&f.message)r(h.response.data.message),P.error(h.response.data.message);else if((g=(b=h.response)==null?void 0:b.data)!=null&&g.errors){const d=Object.values(h.response.data.errors)[0];r(d),P.error(d)}else r("An error occurred while deleting the designation"),P.error("An error occurred while deleting the designation")}finally{D(!1)}}};return s?n(at,{open:l,onClose:c?void 0:o,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"delete-designation-dialog",children:[n(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e(A,{variant:"h6",children:"Delete Designation"}),e(me,{edge:"end",color:"inherit",onClick:o,disabled:c,"aria-label":"close",children:e(de,{className:"w-5 h-5"})})]}),e(j,{}),e(ge,{children:n(H,{sx:{display:"flex",flexDirection:"column",gap:2},children:[n(H,{sx:{display:"flex",alignItems:"center",gap:2},children:[e(st,{className:"w-8 h-8 text-yellow-500"}),n(A,{variant:"body1",children:["Are you sure you want to delete the designation ",e("strong",{children:s.title}),"?"]})]}),s.employee_count>0&&n(ie,{severity:"warning",sx:{mt:2},children:["This designation has ",s.employee_count," employees assigned to it. You cannot delete a designation with active employees. Please reassign these employees to other designations first."]}),m&&e(ie,{severity:"error",sx:{mt:2},children:m}),e(A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This action cannot be undone. All associated data will be permanently removed."})]})}),e(j,{}),n(fe,{sx:{px:3,py:2},children:[e(z,{onClick:o,disabled:c,color:"inherit",children:"Cancel"}),e(z,{onClick:C,variant:"contained",color:"error",disabled:c||s.employee_count>0,startIcon:c&&e(be,{size:20,color:"inherit"}),children:c?"Deleting...":"Delete Designation"})]})]}):null},Ht=({title:l,initialDesignations:o,departments:x,managers:s,parentDesignations:c,stats:D,filters:m})=>{var K,ee,te;const{auth:r}=le().props,C=ce(),u=q(C.breakpoints.down("sm"));q(C.breakpoints.down("md"));const[f,b]=i.useState(o||{data:[]}),[g,h]=i.useState(!1),[d,T]=i.useState({type:null,designation:null}),[y,w]=i.useState({search:(m==null?void 0:m.search)||"",status:(m==null?void 0:m.status)||"all",parentDesignation:(m==null?void 0:m.parentDesignation)||"all"}),[_,v]=i.useState(!1),[a,F]=i.useState("table"),[S,L]=i.useState({currentPage:(o==null?void 0:o.current_page)||1,perPage:(o==null?void 0:o.per_page)||10}),[E,we]=i.useState(D||{total:0,active:0,inactive:0,parent_designations:0}),U=((K=r.permissions)==null?void 0:K.includes("designations.create"))||!1,Y=((ee=r.permissions)==null?void 0:ee.includes("designations.update"))||!1,J=((te=r.permissions)==null?void 0:te.includes("designations.delete"))||!1,O=i.useCallback(async()=>{h(!0);try{const t=await k.get(route("designations.json"),{params:{page:S.currentPage,per_page:S.perPage,search:y.search,status:y.status,parent_designation:y.parentDesignation}});console.log("Fetched designations:",t.data),b(t.data.designations||t.data)}catch(t){console.error("Error fetching designations:",t),P.error("Failed to load designations data")}finally{h(!1)}},[S,y]),W=i.useCallback(async()=>{try{const t=await k.get(route("designations.stats"));t.status===200&&we(t.data.stats)}catch(t){console.error("Error fetching designation stats:",t)}},[]);i.useEffect(()=>{O(),W()},[O,W]);const ve=(t,N)=>{w(p=>({...p,[t]:N})),L(p=>({...p,currentPage:1}))},ye=t=>{L(N=>({...N,currentPage:t})),window.scrollTo({top:0,behavior:"smooth"})},_e=t=>{L({currentPage:1,perPage:t})},R=(t,N=null)=>{T({type:t,designation:N})},X=()=>{T({type:null,designation:null})},Z=(t=null,N=null)=>{N==="add"&&t?b(p=>{const I=[t,...p.data];return{...p,data:I,total:(p.total||0)+1}}):N==="edit"&&t?b(p=>{const I=p.data.map(B=>B.id===t.id?t:B);return{...p,data:I}}):N==="delete"&&t?b(p=>{const I=p.data.filter(B=>B.id!==t.id);return{...p,data:I,total:(p.total||1)-1}}):(O(),W())},xe=i.useMemo(()=>[{title:"Total Designations",value:E.total,icon:e(V,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All designations"},{title:"Active",value:E.active,icon:e(ue,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Active designations"},{title:"Inactive",value:E.inactive,icon:e(he,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Inactive designations"},{title:"Parent Designations",value:E.parent_designations,icon:e(Re,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Top-level designations"}],[E]),De=i.useMemo(()=>{const t=[];return U&&t.push({label:u?"Add":"Add Designation",icon:e(rt,{className:"w-4 h-4"}),onPress:()=>R("add_designation"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}),t},[U,u]);return console.log("Designations:",f),console.log("Departments:",x),n(Le,{children:[e(Pe,{title:l}),e(H,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Be,{in:!0,timeout:800,children:e($e,{children:e(Oe,{title:"Designation Management",subtitle:"Manage company designations and hierarchy",icon:e(V,{className:"w-8 h-8"}),variant:"default",actionButtons:De,children:n("div",{className:"p-4 sm:p-6",children:[e(We,{stats:xe,className:"mb-6"}),e("div",{className:"mb-6",children:e(je,{label:"Search",placeholder:"Search designations...",value:y.search,onValueChange:t=>ve("search",t),startContent:e(ze,{className:"w-4 h-4"}),size:"md"})}),e("div",{children:g?n("div",{className:"text-center py-6",children:[e(be,{size:40}),e(A,{className:"mt-4",children:"Loading..."})]}):e(nt,{designations:f,loading:g,onEdit:Y?t=>R("edit_designation",t):void 0,onDelete:J?t=>R("delete_designation",t):void 0,onView:t=>R("view_designation",t),pagination:S,onPageChange:ye,onRowsPerPageChange:_e,canEditDesignation:Y,canDeleteDesignation:J})})]})})})})}),(d.type==="add_designation"||d.type==="edit_designation")&&e(ot,{open:!0,departments:x,onClose:X,onSuccess:t=>Z(t,d.type==="add_designation"?"add":"edit"),designation:d.designation,managers:s,parentDesignations:c}),d.type==="delete_designation"&&e(it,{open:!0,onClose:X,onSuccess:t=>Z(t,"delete"),designation:d.designation})]})};export{Ht as default};
