import{a as t,V as ge,j as g,c as le,M as be,F as k}from"./app-Blpamcva.js";import{A as $,E as H,K as fe,u as se,r as l,ak as xe,B as j,R as ye,t as ke,e as ve,g as _e,c as E,f as J,a as Q,G as U,h as Ce}from"./vendor-Dz0S-B-S.js";import{r as W,j as Z,B as S,G as we,A as Se}from"./App-DaWfJDeQ.js";import{X as De,m as Le,A as Te}from"./minMax-DmUnt_DC.js";import{d as Me}from"./Edit-lPlnekbo.js";import{d as Re}from"./Delete-g5q2IH7y.js";import{l as Ie,U as ee}from"./index-B1iY4Sfc.js";import{c as I}from"./chunk-MZRCPRP2-CNdabUFX.js";import{l as N,s as O}from"./chunk-7JXO3E7I-DxCDg1Bt.js";import{i as oe}from"./chunk-HJTJQZF3-D5k-E81R.js";import{l as te}from"./chunk-T45N425O-U_QceaMg.js";import{t as je}from"./chunk-CSXHODZI-BzONx_Uo.js";import{t as Fe}from"./chunk-ORPGD37S-DtOBB2uV.js";import{u as re}from"./chunk-R6AK6OQ4-COP44Jfg.js";import{d as Pe}from"./dayjs.min-CAEEVKYd.js";import{d as Ae}from"./Search-DHcwVMR_.js";import{D as ae}from"./Download-DOhEiHFB.js";import{p as Be}from"./chunk-YHY32LNM-BrPgamN0.js";import"./chunk-SLABUSGS-DkpN-FGf.js";import"./chunk-2BFF5KFD-CfQFItv7.js";import"./chunk-7F3ZLNJ6-BWkLKS2d.js";const Ee=()=>t("div",{className:"spinner-container",children:t(Ie.Dots,{animation:"fade",background:"rgba(0, 0, 0, 0.5)",color:"#3498db",size:60})});var z={},Ne=H;Object.defineProperty(z,"__esModule",{value:!0});var ne=z.default=void 0,Oe=Ne(W()),$e=$();ne=z.default=(0,Oe.default)((0,$e.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var V={},He=H;Object.defineProperty(V,"__esModule",{value:!0});var de=V.default=void 0,We=He(W()),ze=$();de=V.default=(0,We.default)((0,ze.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");var Y={},Ve=H;Object.defineProperty(Y,"__esModule",{value:!0});var ie=Y.default=void 0,Ye=Ve(W()),Ke=$();ie=Y.default=(0,Ye.default)((0,Ke.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");const qe=fe(De)(({theme:d})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{"& .hZUxNm":{"white-space":"normal"},backgroundColor:"transparent",color:d.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none","& .rdt_TableRow":{minHeight:"auto",backgroundColor:"transparent",color:d.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${d.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:d.palette.action.hover}}}})),Ge=({allData:d,setData:D,users:L,loading:s,handleClickOpen:F,openModal:b,setCurrentRow:K,search:x})=>{const{auth:v}=ge().props,o=se();l.useState(null),v.roles.includes("Administrator"),v.roles.includes("Supervision Engineer");const m=e=>{switch(e){case"Open":return"danger";case"Closed":return"success";case"Processing":return"primary";case"Signed":return"warning";case"Sent":return"success";default:return""}},T=e=>{if(!x)return e;const r=x.split(" ").filter(Boolean),a=new RegExp(`(${r.join("|")})`,"gi");return e.split(a).map((n,c)=>r.some(_=>n.toLowerCase()===_.toLowerCase())?t("span",{style:{backgroundColor:"yellow"},children:n},c):n)},P=[{name:"From",selector:e=>e.from,sortable:!0,center:"true",width:"80px",cell:e=>T(e.from)},{name:"Status",selector:e=>e.status,sortable:!0,center:"true",width:"170px",cell:e=>t(O,{"aria-label":"Status",color:m(e.status),placeholder:"Select Status",value:e.status,onChange:r=>i(e.id,"status",r.target.value),fullWidth:!0,selectedKeys:[e.status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Open","Closed"].map(r=>t(N,{value:e.status,children:r},r))})},{name:"Received Date",selector:e=>e.received_date,sortable:!0,center:"true",width:"160px",cell:e=>t(oe,{variant:"underlined",type:"date",fullWidth:!0,value:e.received_date,onChange:r=>i(e.id,"received_date",r.target.value)})},{name:"Memo Number",selector:e=>e.memo_number,sortable:!0,center:"true",width:"200px",cell:e=>t(te,{isExternal:!0,color:"foreground",isBlock:!0,showAnchorIcon:!0,href:e.letter_link||`/letters/${e.memo_number}.pdf`,anchorIcon:t(de,{}),children:e.memo_number||"N/A"})},{name:"Subject",selector:e=>e.subject,sortable:!0,left:!0,width:"260px",cell:e=>t(je,{content:e.subject,placement:"top",showArrow:!0,radius:"md",size:"md",classNames:{content:["bg-transparent backdrop-blur-lg border border-gray-200","max-w-[300px] text-sm"]},children:t(j,{sx:{whiteSpace:"normal",wordWrap:"break-word",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:T(e.subject)})})},{name:"Action Taken",selector:e=>e.action_taken,sortable:!0,left:!0,width:"250px",cell:e=>{const[r,a]=l.useState(e.action_taken||"");return t(Fe,{variant:"underlined",size:"sm",radius:"sm",maxRows:2,fullWidth:!0,value:r,onChange:c=>{a(c.target.value)},onBlur:()=>{i(e.id,"action_taken",r)}})}},{name:"Handling Link",selector:e=>e.handling_link,sortable:!0,center:"true",width:"200px",cell:e=>t(te,{isExternal:!0,color:"primary",isBlock:!0,showAnchorIcon:!0,href:e.handling_link||"#",anchorIcon:t(ne,{}),children:e.handling_memo||"N/A"})},{name:"Handling Status",selector:e=>e.handling_status,sortable:!0,center:"true",width:"180px",cell:e=>t(O,{"aria-label":"Handling Status",color:m(e.handling_status),placeholder:"Select Status",value:e.handling_status,onChange:r=>i(e.id,"handling_status",r.target.value),fullWidth:!0,selectedKeys:[e.handling_status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Processing","Signed","Sent"].map(r=>t(N,{value:e.handling_status,children:r},r))})},{name:"Need Reply",selector:e=>e.need_reply,center:"true",width:"80px",cell:e=>t(I,{color:m(e.status),isSelected:e.need_reply,onChange:r=>i(e.id,"need_reply",r.target.checked)})},{name:"Replied Status",selector:e=>e.replied_status,center:"true",width:"80px",cell:e=>t(I,{color:m(e.status),isSelected:e.replied_status,onChange:r=>i(e.id,"replied_status",r.target.checked)})},{name:"Need Forward",selector:e=>e.need_forward,center:"true",width:"80px",cell:e=>t(I,{color:m(e.status),isSelected:e.need_forward,onChange:r=>i(e.id,"need_forward",r.target.checked)})},{name:"Forwarded Status",selector:e=>e.forwarded_status,center:"true",width:"90px",cell:e=>t(I,{color:m(e.status),isSelected:e.forwarded_status,onChange:r=>i(e.id,"forwarded_status",r.target.checked)})},{name:"Dealt By",selector:e=>e.dealt_by,sortable:!0,center:"true",cell:e=>t(O,{items:L,variant:"underlined","aria-label":"Dealt By",fullWidth:!0,value:e.dealt_by||"na",onChange:r=>i(e.id,"dealt_by",r.target.value),selectedKeys:[String(e.dealt_by)],style:{minWidth:"260px"},popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"},style:{whiteSpace:"nowrap",minWidth:"fit-content"}},placeholder:"Select a user",renderValue:r=>r.map(a=>t("div",{className:"flex items-center gap-2 m-1",children:t(re,{style:{whiteSpace:"nowrap"},size:"sm",name:a.data.name,description:a.data.designation.title,avatarProps:{radius:"sm",size:"sm",src:a.data.profile_image}})},a.key)),children:r=>t(N,{textValue:r.id,children:t(re,{style:{whiteSpace:"nowrap"},size:"sm",name:r.name,description:r.designation.title,avatarProps:{radius:"sm",size:"sm",src:r.profile_image}})},r.id)})},{name:"Actions",center:"true",width:"150px",cell:e=>g("div",{className:"flex gap-4 items-center",children:[t(Z,{variant:"bordered",isIconOnly:!0,color:"warning","aria-label":"Edit",onClick:()=>b("editLetter",e),children:t(Me,{})}),t(Z,{variant:"bordered",isIconOnly:!0,color:"danger","aria-label":"Delete",onClick:()=>handleDelete(e.id),children:t(Re,{})})]})}],i=async(e,r,a)=>{var h,n;try{const c=await le.put(route("letters.update"),{id:e,[r]:a});c.status===200?(D(_=>_.map(y=>y.id===e?{...y,[r]:a}:y)),S.success(...c.data.messages||"Letter updated successfully",{icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}})):S.error(c.data.error||`Failed to update letter ${[r]}.`,{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}})}catch(c){S.error(((n=(h=c.response)==null?void 0:h.data)==null?void 0:n.message)||"An unexpected error occurred.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}})}};return g("div",{children:[s&&t(Ee,{}),t(xe,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:o.palette.text.primary}}}),t(qe,{columns:P,data:d,defaultSortField:"received_date",highlightOnHover:!0,responsive:!0,dense:!0,sortIcon:t(ie,{}),keyField:"id"})]})};Pe.extend(Le);const Xe=ye.memo(({auth:d,title:D,users:L})=>{const s=se(),[F,b]=l.useState([]),[K,x]=l.useState(!1),[v,o]=l.useState(0),[m,T]=l.useState(0);l.useState([]);const[P,i]=l.useState(),[e,r]=l.useState(null),[a,h]=l.useState(null),[n,c]=l.useState(""),_=ke(s.breakpoints.down("md")),[y,Je]=l.useState(30),[C,q]=l.useState(1),ce=async(u,p,M)=>{try{const f=await le.get(route("letters.paginate"),{params:{page:u,perPage:p,search:M}});b(f.data.data),o(f.data.total),T(f.data.last_page),x(!1)}catch(f){console.error(f),S.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}}),x(!1)}},ue=()=>{const u=new Promise(async(p,M)=>{var f,X;try{const R=await fetch("/delete-daily-work",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({id:e,page:C,perPage:y,search:n,status:filterData.status!=="all"?filterData.status:"",inCharge:filterData.incharge!=="all"?filterData.incharge:"",startDate:(f=filterData.startDate)==null?void 0:f.format("YYYY-MM-DD"),endDate:(X=filterData.endDate)==null?void 0:X.format("YYYY-MM-DD")})}),B=await R.json();R.ok?(b(B.data),o(B.total),p("Daily work deleted successfully")):M(B.error||"Failed to delete task")}catch(R){console.error("Error deleting task:",R),M("An error occurred while deleting the task")}finally{G()}});S.promise(u,{pending:{render(){return g("div",{style:{display:"flex",alignItems:"center"},children:[t(Ce,{}),t("span",{style:{marginLeft:"8px"},children:"Deleting task..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}},success:{render({data:p}){return t(k,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}},error:{render({data:p}){return t(k,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}}})},pe=l.useCallback((u,p)=>{r(u),h(p)},[]),G=l.useCallback(()=>{h(null),r(null)},[]),w=l.useCallback(u=>{h(u)},[]),A=l.useCallback(()=>{h(null)},[]),me=u=>{const p=u.target.value;c(p)};l.useEffect(()=>{x(!0),ce(C,y,n)},[C,y,n]);const he=u=>{q(u)};return g(k,{children:[t(be,{title:D}),a==="editLetter"&&t(LetterForm,{open:a==="editLetter",currentRow:P,setData:b,closeModal:A}),a==="deleteLetter"&&t(DeleteLetterForm,{open:a==="deleteLetter",handleClose:G,handleDelete:ue,setData:b}),a==="importLetters"&&t(LettersUploadForm,{open:a==="importLetters",closeModal:A,setData:b,setTotalRows:o}),a==="exportLetters"&&t(LettersDownloadForm,{open:a==="exportLetters",closeModal:A,data:F,users:L}),t(j,{sx:{display:"flex",justifyContent:"center",p:2},children:t(ve,{in:!0,children:g(we,{children:[t(_e,{title:D,sx:{padding:"24px"},action:g(j,{display:"flex",gap:2,children:[d.permissions.includes("addTask")&&t(E,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:t(Te,{})}),d.roles.includes("Administrator")&&t(k,{children:_?g(k,{children:[t(E,{title:"Import Letters",color:"warning",onClick:()=>w("importLetters"),children:t(ee,{})}),t(E,{title:"Export Letters",color:"success",onClick:()=>w("exportLetters"),children:t(ae,{})})]}):g(k,{children:[t(J,{title:"Import Letters",variant:"outlined",color:"warning",startIcon:t(ee,{}),onClick:()=>w("importLetters"),children:"Import"}),t(J,{title:"Export Letters",variant:"outlined",color:"success",startIcon:t(ae,{}),onClick:()=>w("exportLetters"),children:"Export"})]})})]})}),t(Q,{children:t(j,{children:t(U,{container:!0,spacing:2,children:t(U,{item:!0,xs:12,sm:6,md:3,children:t(oe,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Search...",value:n,onChange:me,endContent:t(Ae,{})})})})})}),g(Q,{children:[t(Ge,{setData:b,setCurrentRow:i,currentPage:C,setCurrentPage:q,setLoading:x,handleClickOpen:pe,openModal:w,totalRows:v,lastPage:m,loading:K,allData:F,users:L,search:n}),v>=30&&t("div",{className:"py-2 px-2 flex justify-center items-center",children:t(Be,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:C,total:m,onChange:he})})]})]})})})]})});Xe.layout=d=>t(Se,{children:d});export{Xe as default};
