import{a as t,V as _e,j as z,c as me,M as we,F as P}from"./app-D0nw11-W.js";import{r as l,O as Le,_ as Re,w as R,z as fe,H as He,u as be,ac as Te,B as O,R as ze,g as De,e as Ie,h as Ee,c as X,f as ee,a as te,G as re,t as Fe}from"./vendor-TQEDv41K.js";import{f as Me,D as ae,r as ve,E as Pe,c as je,b as ne,B as j,G as We,A as Be}from"./App-ssU5KC34.js";import{X as Ae,m as Ne,A as $e}from"./minMax-Bi6xZslU.js";import{d as Oe}from"./Delete-P6VCfh9X.js";import{l as Ye,U as oe}from"./index-BPYJgbp_.js";import{u as Ve,$ as se,i as xe}from"./chunk-IR2E3HZF-BolBn45f.js";import{c as $}from"./chunk-KBN3H6OQ-C9ZX646S.js";import{l as U,s as Z}from"./chunk-QEQ4EHOG-l3I5UE5j.js";import{l as le}from"./chunk-FGDGYNYV-h3CPNY3a.js";import{t as Ge}from"./chunk-KQ7OR4H5-QQw3Lgg5.js";import{u as ie}from"./chunk-TLBGAR4N-BfLbJI2V.js";import{d as qe}from"./dayjs.min-CEI8migf.js";import{d as Ke,p as Xe}from"./Search-CJBSratB.js";import{D as de}from"./Download-BLZ3CQUw.js";import"./useFormValidationState-DHA-he-t.js";import"./useLabel-Ct9GBkfd.js";import"./DOMLayoutDelegate-C6ve1q38.js";import"./chunk-NCVCYSZZ-D0CT_U16.js";var Ue=l.useLayoutEffect,Ze=function(n){var o=l.useRef(n);return Ue(function(){o.current=n}),o},ce=function(n,o){if(typeof n=="function"){n(o);return}n.current=o},Je=function(n,o){var a=l.useRef();return l.useCallback(function(d){n.current=d,a.current&&ce(a.current,null),a.current=o,o&&ce(o,d)},[o])},ue={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},Qe=function(n){Object.keys(ue).forEach(function(o){n.style.setProperty(o,ue[o],"important")})},pe=Qe,v=null,he=function(n,o){var a=n.scrollHeight;return o.sizingStyle.boxSizing==="border-box"?a+o.borderSize:a-o.paddingSize};function et(s,n,o,a){o===void 0&&(o=1),a===void 0&&(a=1/0),v||(v=document.createElement("textarea"),v.setAttribute("tabindex","-1"),v.setAttribute("aria-hidden","true"),pe(v)),v.parentNode===null&&document.body.appendChild(v);var d=s.paddingSize,p=s.borderSize,b=s.sizingStyle,x=b.boxSizing;Object.keys(b).forEach(function(L){var g=L;v.style[g]=b[g]}),pe(v),v.value=n;var m=he(v,s);v.value=n,m=he(v,s),v.value="x";var c=v.scrollHeight-d,h=c*o;x==="border-box"&&(h=h+d+p),m=Math.max(h,m);var y=c*a;return x==="border-box"&&(y=y+d+p),m=Math.min(y,m),[m,c]}var ge=function(){},tt=function(n,o){return n.reduce(function(a,d){return a[d]=o[d],a},{})},rt=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],at=!!document.documentElement.currentStyle,nt=function(n){var o=window.getComputedStyle(n);if(o===null)return null;var a=tt(rt,o),d=a.boxSizing;if(d==="")return null;at&&d==="border-box"&&(a.width=parseFloat(a.width)+parseFloat(a.borderRightWidth)+parseFloat(a.borderLeftWidth)+parseFloat(a.paddingRight)+parseFloat(a.paddingLeft)+"px");var p=parseFloat(a.paddingBottom)+parseFloat(a.paddingTop),b=parseFloat(a.borderBottomWidth)+parseFloat(a.borderTopWidth);return{sizingStyle:a,paddingSize:p,borderSize:b}},ot=nt;function ye(s,n,o){var a=Ze(o);l.useLayoutEffect(function(){var d=function(b){return a.current(b)};if(s)return s.addEventListener(n,d),function(){return s.removeEventListener(n,d)}},[])}var st=function(n){ye(window,"resize",n)},lt=function(n){ye(document.fonts,"loadingdone",n)},it=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],dt=function(n,o){var a=n.cacheMeasurements,d=n.maxRows,p=n.minRows,b=n.onChange,x=b===void 0?ge:b,m=n.onHeightChange,c=m===void 0?ge:m,h=Le(n,it),y=h.value!==void 0,L=l.useRef(null),g=Je(L,o),e=l.useRef(0),r=l.useRef(),i=function(){var u=L.current,H=a&&r.current?r.current:ot(u);if(H){r.current=H;var S=et(H,u.value||u.placeholder||"x",p,d),I=S[0],T=S[1];e.current!==I&&(e.current=I,u.style.setProperty("height",I+"px","important"),c(I,{rowHeight:T}))}},C=function(u){y||i(),x(u)};return l.useLayoutEffect(i),st(i),lt(i),l.createElement("textarea",Re({},h,{onChange:C,ref:g}))},ct=l.forwardRef(dt),Ce=Me(({style:s,minRows:n=3,maxRows:o=8,cacheMeasurements:a=!1,disableAutosize:d=!1,onHeightChange:p,...b},x)=>{const{Component:m,label:c,description:h,startContent:y,endContent:L,hasHelper:g,shouldLabelBeOutside:e,shouldLabelBeInside:r,isInvalid:i,errorMessage:C,getBaseProps:f,getLabelProps:u,getInputProps:H,getInnerWrapperProps:S,getInputWrapperProps:I,getHelperWrapperProps:T,getDescriptionProps:W,getErrorMessageProps:Y}=Ve({...b,ref:x,isMultiline:!0}),[V,G]=l.useState(n>1),[B,E]=l.useState(!1),M=c?R.jsx("label",{...u(),children:c}):null,F=H(),q=(D,w)=>{if(n===1&&G(D>=w.rowHeight*2),o>n){const A=D>=o*w.rowHeight;E(A)}p==null||p(D,w)},k=d?R.jsx("textarea",{...F,style:se(F.style,s??{})}):R.jsx(ct,{...F,cacheMeasurements:a,"data-hide-scroll":ae(!B),maxRows:o,minRows:n,style:se(F.style,s??{}),onHeightChange:q}),_=l.useMemo(()=>y||L?R.jsxs("div",{...S(),children:[y,k,L]}):R.jsx("div",{...S(),children:k}),[y,F,L,S]);return R.jsxs(m,{...f(),children:[e?M:null,R.jsxs("div",{...I(),"data-has-multiple-rows":ae(V),children:[r?M:null,_]}),g?R.jsx("div",{...T(),children:i&&C?R.jsx("div",{...Y(),children:C}):h?R.jsx("div",{...W(),children:h}):null}):null]})});Ce.displayName="NextUI.Textarea";var ut=Ce;const pt=()=>t("div",{className:"spinner-container",children:t(Ye.Dots,{animation:"fade",background:"rgba(0, 0, 0, 0.5)",color:"#3498db",size:60})});var J={},ht=fe;Object.defineProperty(J,"__esModule",{value:!0});var Se=J.default=void 0,gt=ht(ve()),mt=R;Se=J.default=(0,gt.default)((0,mt.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var Q={},ft=fe;Object.defineProperty(Q,"__esModule",{value:!0});var ke=Q.default=void 0,bt=ft(ve()),vt=R;ke=Q.default=(0,bt.default)((0,vt.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");const xt=He(Ae)(({theme:s})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{"& .hZUxNm":{"white-space":"normal"},backgroundColor:"transparent",color:s.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none","& .rdt_TableRow":{minHeight:"auto",backgroundColor:"transparent",color:s.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${s.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:s.palette.action.hover}}}})),yt=({allData:s,setData:n,users:o,loading:a,handleClickOpen:d,openModal:p,setCurrentRow:b,search:x})=>{const{auth:m}=_e().props,c=be();l.useState(null),m.roles.includes("Administrator"),m.roles.includes("Supervision Engineer");const h=e=>{switch(e){case"Open":return"danger";case"Closed":return"success";case"Processing":return"primary";case"Signed":return"warning";case"Sent":return"success";default:return""}},y=e=>{if(!x)return e;const r=x.split(" ").filter(Boolean),i=new RegExp(`(${r.join("|")})`,"gi");return e.split(i).map((f,u)=>r.some(H=>f.toLowerCase()===H.toLowerCase())?t("span",{style:{backgroundColor:"yellow"},children:f},u):f)};console.log(o);const L=[{name:"From",selector:e=>e.from,sortable:!0,center:"true",width:"80px",cell:e=>y(e.from)},{name:"Status",selector:e=>e.status,sortable:!0,center:"true",width:"170px",cell:e=>t(Z,{"aria-label":"Status",color:h(e.status),placeholder:"Select Status",value:e.status,onChange:r=>g(e.id,"status",r.target.value),fullWidth:!0,selectedKeys:[e.status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Open","Closed"].map(r=>t(U,{value:e.status,children:r},r))})},{name:"Received Date",selector:e=>e.received_date,sortable:!0,center:"true",width:"160px",cell:e=>t(xe,{variant:"underlined",type:"date",fullWidth:!0,value:e.received_date,onChange:r=>g(e.id,"received_date",r.target.value)})},{name:"Memo Number",selector:e=>e.memo_number,sortable:!0,center:"true",width:"200px",cell:e=>t(le,{isExternal:!0,color:"foreground",isBlock:!0,showAnchorIcon:!0,href:e.letter_link||`/letters/${e.memo_number}.pdf`,anchorIcon:t(ke,{}),children:e.memo_number||"N/A"})},{name:"Subject",selector:e=>e.subject,sortable:!0,left:!0,width:"260px",cell:e=>t(Ge,{content:e.subject,placement:"top",showArrow:!0,radius:"md",size:"md",classNames:{content:["bg-transparent backdrop-blur-lg border border-gray-200","max-w-[300px] text-sm"]},children:t(O,{sx:{whiteSpace:"normal",wordWrap:"break-word",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:y(e.subject)})})},{name:"Action Taken",selector:e=>e.action_taken,sortable:!0,left:!0,width:"250px",cell:e=>{const[r,i]=l.useState(e.action_taken||"");return t(ut,{variant:"underlined",size:"sm",radius:"sm",maxRows:2,fullWidth:!0,value:r,onChange:u=>{i(u.target.value)},onBlur:()=>{g(e.id,"action_taken",r)}})}},{name:"Handling Link",selector:e=>e.handling_link,sortable:!0,center:"true",width:"200px",cell:e=>t(le,{isExternal:!0,color:"primary",isBlock:!0,showAnchorIcon:!0,href:e.handling_link||"#",anchorIcon:t(Se,{}),children:e.handling_memo||"N/A"})},{name:"Handling Status",selector:e=>e.handling_status,sortable:!0,center:"true",width:"180px",cell:e=>t(Z,{"aria-label":"Handling Status",color:h(e.handling_status),placeholder:"Select Status",value:e.handling_status,onChange:r=>g(e.id,"handling_status",r.target.value),fullWidth:!0,selectedKeys:[e.handling_status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Processing","Signed","Sent"].map(r=>t(U,{value:e.handling_status,children:r},r))})},{name:"Need Reply",selector:e=>e.need_reply,center:"true",width:"80px",cell:e=>t($,{color:h(e.status),isSelected:e.need_reply,onChange:r=>g(e.id,"need_reply",r.target.checked)})},{name:"Replied Status",selector:e=>e.replied_status,center:"true",width:"80px",cell:e=>t($,{color:h(e.status),isSelected:e.replied_status,onChange:r=>g(e.id,"replied_status",r.target.checked)})},{name:"Need Forward",selector:e=>e.need_forward,center:"true",width:"80px",cell:e=>t($,{color:h(e.status),isSelected:e.need_forward,onChange:r=>g(e.id,"need_forward",r.target.checked)})},{name:"Forwarded Status",selector:e=>e.forwarded_status,center:"true",width:"90px",cell:e=>t($,{color:h(e.status),isSelected:e.forwarded_status,onChange:r=>g(e.id,"forwarded_status",r.target.checked)})},{name:"Dealt By",selector:e=>e.dealt_by,sortable:!0,center:"true",cell:e=>t(Z,{items:o,variant:"underlined","aria-label":"Dealt By",fullWidth:!0,value:e.dealt_by||"na",onChange:r=>g(e.id,"dealt_by",r.target.value),selectedKeys:[String(e.dealt_by)],style:{minWidth:"260px"},popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"},style:{whiteSpace:"nowrap",minWidth:"fit-content"}},placeholder:"Select a user",renderValue:r=>r.map(i=>t("div",{className:"flex items-center gap-2 m-1",children:t(ie,{style:{whiteSpace:"nowrap"},size:"sm",name:i.data.name,description:i.data.designation.title,avatarProps:{radius:"sm",size:"sm",src:i.data.profile_image}})},i.key)),children:r=>t(U,{textValue:r.id,children:t(ie,{style:{whiteSpace:"nowrap"},size:"sm",name:r.name,description:r.designation.title,avatarProps:{radius:"sm",size:"sm",src:r.profile_image}})},r.id)})},{name:"Actions",center:"true",width:"150px",cell:e=>z("div",{className:"flex gap-4 items-center",children:[t(ne,{variant:"bordered",isIconOnly:!0,color:"warning","aria-label":"Edit",onClick:()=>p("editLetter",e),children:t(je,{})}),t(ne,{variant:"bordered",isIconOnly:!0,color:"danger","aria-label":"Delete",onClick:()=>handleDelete(e.id),children:t(Oe,{})})]})}],g=async(e,r,i)=>{var C,f;console.log(e,r,i);try{const u=await me.put(route("letters.update"),{id:e,[r]:i});u.status===200?(n(H=>H.map(S=>S.id===e?{...S,[r]:i}:S)),j.success(...u.data.messages||"Letter updated successfully",{icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})):j.error(u.data.error||`Failed to update letter ${[r]}.`,{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}catch(u){j.error(((f=(C=u.response)==null?void 0:C.data)==null?void 0:f.message)||"An unexpected error occurred.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}};return z("div",{children:[a&&t(pt,{}),t(Te,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:c.palette.text.primary}}}),t(xt,{columns:L,data:s,defaultSortField:"received_date",highlightOnHover:!0,responsive:!0,dense:!0,sortIcon:t(Pe,{}),keyField:"id"})]})};qe.extend(Ne);const Ct=ze.memo(({auth:s,title:n,users:o})=>{const a=be(),[d,p]=l.useState([]),[b,x]=l.useState(!1),[m,c]=l.useState(0),[h,y]=l.useState(0);l.useState([]);const[L,g]=l.useState(),[e,r]=l.useState(null),[i,C]=l.useState(null),[f,u]=l.useState(""),H=De(a.breakpoints.down("md")),[S,I]=l.useState(30),[T,W]=l.useState(1),Y=async(k,_,D)=>{try{const w=await me.get(route("letters.paginate"),{params:{page:k,perPage:_,search:D}});console.log(w),p(w.data.data),c(w.data.total),y(w.data.last_page),x(!1)}catch(w){console.log(w),j.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}}),x(!1)}},V=()=>{const k=new Promise(async(_,D)=>{var w,A;try{const N=await fetch("/delete-daily-work",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({id:e,page:T,perPage:S,search:f,status:filterData.status!=="all"?filterData.status:"",inCharge:filterData.incharge!=="all"?filterData.incharge:"",startDate:(w=filterData.startDate)==null?void 0:w.format("YYYY-MM-DD"),endDate:(A=filterData.endDate)==null?void 0:A.format("YYYY-MM-DD")})}),K=await N.json();N.ok?(p(K.data),c(K.total),_("Daily work deleted successfully")):D(K.error||"Failed to delete task")}catch(N){console.error("Error deleting task:",N),D("An error occurred while deleting the task")}finally{B()}});j.promise(k,{pending:{render(){return z("div",{style:{display:"flex",alignItems:"center"},children:[t(Fe,{}),t("span",{style:{marginLeft:"8px"},children:"Deleting task..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},success:{render({data:_}){return t(P,{children:_})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},error:{render({data:_}){return t(P,{children:_})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}}})},G=l.useCallback((k,_)=>{r(k),C(_)},[]),B=l.useCallback(()=>{C(null),r(null)},[]),E=l.useCallback(k=>{C(k)},[]),M=l.useCallback(()=>{C(null)},[]),F=k=>{const _=k.target.value;u(_)};l.useEffect(()=>{x(!0),Y(T,S,f)},[T,S,f]);const q=k=>{W(k)};return z(P,{children:[t(we,{title:n}),i==="editLetter"&&t(LetterForm,{open:i==="editLetter",currentRow:L,setData:p,closeModal:M}),i==="deleteLetter"&&t(DeleteLetterForm,{open:i==="deleteLetter",handleClose:B,handleDelete:V,setData:p}),i==="importLetters"&&t(LettersUploadForm,{open:i==="importLetters",closeModal:M,setData:p,setTotalRows:c}),i==="exportLetters"&&t(LettersDownloadForm,{open:i==="exportLetters",closeModal:M,data:d,users:o}),t(O,{sx:{display:"flex",justifyContent:"center",p:2},children:t(Ie,{in:!0,children:z(We,{children:[t(Ee,{title:n,sx:{padding:"24px"},action:z(O,{display:"flex",gap:2,children:[s.permissions.includes("addTask")&&t(X,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:t($e,{})}),s.roles.includes("Administrator")&&t(P,{children:H?z(P,{children:[t(X,{title:"Import Letters",color:"warning",onClick:()=>E("importLetters"),children:t(oe,{})}),t(X,{title:"Export Letters",color:"success",onClick:()=>E("exportLetters"),children:t(de,{})})]}):z(P,{children:[t(ee,{title:"Import Letters",variant:"outlined",color:"warning",startIcon:t(oe,{}),onClick:()=>E("importLetters"),children:"Import"}),t(ee,{title:"Export Letters",variant:"outlined",color:"success",startIcon:t(de,{}),onClick:()=>E("exportLetters"),children:"Export"})]})})]})}),t(te,{children:t(O,{children:t(re,{container:!0,spacing:2,children:t(re,{item:!0,xs:12,sm:6,md:3,children:t(xe,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Search...",value:f,onChange:F,endContent:t(Ke,{})})})})})}),z(te,{children:[t(yt,{setData:p,setCurrentRow:g,currentPage:T,setCurrentPage:W,setLoading:x,handleClickOpen:G,openModal:E,totalRows:m,lastPage:h,loading:b,allData:d,users:o,search:f}),m>=30&&t("div",{className:"py-2 px-2 flex justify-center items-center",children:t(Xe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:T,total:h,onChange:q})})]})]})})})]})});Ct.layout=s=>t(Be,{children:s});export{Ct as default};
