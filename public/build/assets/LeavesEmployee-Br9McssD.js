import{J as G,r as t,g as H,a as l,b as e,Q as I,h as O,c as b,d as f,F as J,i as V}from"./app-WmnCG5Fz.js";import{d as W}from"./dayjs.min-CPsvstEg.js";import{u as X,e as Y,B as Z,d as K,i as h,T as n,b as ee,A as ae}from"./App-0uPz_bAn.js";import{P as te}from"./PageHeader-Bf4j3zU9.js";import{L as re}from"./LeaveEmployeeTable-Ctlc_WDO.js";import{F as y}from"./ChartBarIcon-DRSFaDW-.js";import{C as se}from"./CircularProgress-CIBZ8liK.js";import{F as le}from"./PresentationChartLineIcon-Bz9KjT7B.js";import{s as ne,l as oe}from"./chunk-2GIFKCNQ-CGe4_-PZ.js";import{c as ie}from"./chunk-D5XJWRAV-CO6zSkN0.js";import"./app-DNvvDii_.js";import"./PencilIcon-mmkGg9B9.js";import"./TrashIcon-BzUzIQjK.js";import"./XCircleIcon-Cepy0lLj.js";import"./UserIcon-Cuyhv7eW.js";import"./CardContent-CjdXiIyz.js";import"./colorManipulator-DEnRusvB.js";import"./chunk-F3UDT23P-BsXw7IEw.js";import"./useHasTabbableChild-WTz0rn8D.js";import"./chunk-7F3ZLNJ6-BhrcPkoD.js";import"./chunk-7ZZXWEXF-BmpCvzUQ.js";import"./chunk-R6AK6OQ4-CsNm-kki.js";import"./chunk-O5I3QTYU-BnrCVQWa.js";import"./index-CokAva9Y.js";const ce=({title:N,allUsers:M})=>{const{auth:C}=G().props,_=X(),c=Y(_.breakpoints.down("sm")),D=Y(_.breakpoints.down("md")),[u,S]=t.useState(!1),[P,k]=t.useState([]),[p,T]=t.useState({leaveTypes:[],leaveCountsByUser:{}}),[i,w]=t.useState({page:1,perPage:30,total:0,lastPage:0}),[m,R]=t.useState({employee:"",selectedMonth:W().format("YYYY-MM"),year:new Date().getFullYear()}),B=t.useMemo(()=>{const a=new Date().getFullYear();return Array.from({length:a-1900+1},(r,s)=>{const o=1900+s;return{key:o.toString(),label:o.toString(),value:o}}).reverse()},[]),L=t.useCallback((a,r)=>{if(a==="year"){const s=Number(r);if(s<1900||s>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}R(s=>({...s,[a]:r})),a==="year"&&w(s=>({...s,page:1}))},[]),[de,v]=t.useState({add_leave:!1,edit_leave:!1,delete_leave:!1});t.useCallback((a,r=null)=>{v(s=>({...s,[a]:!0}))},[]),t.useCallback(()=>{v({add_leave:!1,edit_leave:!1,delete_leave:!1})},[]);const U=t.useCallback(a=>{v(r=>({...r,[a]:!0}))},[]),j=t.useCallback((a,r)=>{F({id:a}),v(s=>({...s,[r]:!0}))},[]),[me,F]=t.useState(null),A=t.useCallback(a=>{F(a)},[]),g=t.useCallback(async()=>{S(!0);try{const{page:a,perPage:r}=i,{year:s}=m,o=await H.get(route("leaves.paginate"),{params:{page:a,perPage:r,year:s},timeout:1e4});if(o.status===200){const{leaves:d,leavesData:x}=o.data;k(d.data||[]),T(x||{leaveTypes:[],leaveCountsByUser:{}}),w(q=>({...q,total:d.total||0,lastPage:d.last_page||0}))}}catch(a){console.error("Error fetching leaves:",a)}finally{S(!1)}},[i.page,i.perPage,m]),E=t.useCallback(a=>{w(r=>({...r,page:a}))},[]);t.useEffect(()=>{g()},[g]);const $=t.useMemo(()=>p.leaveCountsByUser[C.user.id]||[],[p.leaveCountsByUser,C.user.id]),z=()=>p.leaveTypes.length?e("div",{className:`grid gap-4 ${c?"grid-cols-1":D?"grid-cols-2":"grid-cols-4"}`,children:p.leaveTypes.map(({type:a})=>{const r=$.find(x=>x.leave_type===a)||{},s=r.days_used||0,o=r.remaining_days||0,d=s+o;return l(b,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[e(ie,{className:"pb-2",children:l("div",{className:"flex items-center gap-2",children:[e(h,{className:"w-5 h-5"}),e(n,{variant:c?"subtitle1":"h6",className:"font-semibold truncate",children:a})]})}),e(f,{className:"pt-0",children:l("div",{className:"space-y-3",children:[l("div",{className:"flex justify-between items-center",children:[l("div",{className:"text-center",children:[e(n,{variant:"caption",color:"textSecondary",children:"Used"}),e(n,{variant:c?"h6":"h5",className:"font-bold text-red-400",children:s})]}),e(V,{orientation:"vertical",className:"h-8"}),l("div",{className:"text-center",children:[e(n,{variant:"caption",color:"textSecondary",children:"Remaining"}),e(n,{variant:c?"h6":"h5",className:"font-bold text-green-400",children:o})]})]}),d>0&&e("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${s/d*100}%`}})})]})})]},a)})}):e(b,{className:"bg-white/10 backdrop-blur-md border-white/20",children:l(f,{className:"text-center py-8",children:[e(y,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e(n,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),Q=t.useRef(null);return l(J,{children:[e(I,{title:N}),l(Z,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",e(ee,{in:!0,children:e(K,{children:e(te,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:e(le,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Current Year",icon:e(h,{className:"w-4 h-4"}),onPress:()=>L("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:e(y,{className:"w-4 h-4"}),onPress:g,isDisabled:u,variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:l("div",{className:"p-6",children:[e("div",{className:"mb-6",children:l("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(ne,{label:"Select Year",variant:"bordered",selectedKeys:[String(m.year)],onSelectionChange:a=>{const r=Array.from(a)[0];r&&L("year",Number(r))},startContent:e(h,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:c?"sm":"md",children:B.map(a=>e(oe,{value:a.value,children:a.label},a.key))})}),e("div",{className:"flex gap-2",children:e(O,{variant:"flat",color:"primary",size:c?"sm":"md",onPress:g,isLoading:u,startContent:!u&&e(y,{className:"w-4 h-4"}),children:"Refresh"})})]})}),l("div",{className:"mb-6",children:[l(n,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(y,{className:"w-5 h-5"}),"Leave Balance Summary"]}),z()]}),l("div",{className:"min-h-96",children:[l(n,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(h,{className:"w-5 h-5"}),"Leave History"]}),u?e(b,{className:"bg-white/10 backdrop-blur-md border-white/20",children:l(f,{className:"text-center py-12",children:[e(se,{size:40}),e(n,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):P.length>0?e("div",{className:"overflow-hidden rounded-lg",children:e(re,{ref:Q,leaves:P,allUsers:M||[],handleClickOpen:j,setCurrentLeave:A,openModal:U,setLeaves:k,setCurrentPage:E,currentPage:i.page,totalRows:i.total,lastPage:i.lastPage,perPage:i.perPage,selectedMonth:m.selectedMonth,employee:"",isAdminView:!1})}):e(b,{className:"bg-white/10 backdrop-blur-md border-white/20",children:l(f,{className:"text-center py-12",children:[e(h,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e(n,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),l(n,{color:"textSecondary",children:["You haven't submitted any leave requests for ",m.year,"."]}),"                      "]})})]})]})})})})]})]})};ce.layout=N=>e(ae,{children:N});export{ce as default};
