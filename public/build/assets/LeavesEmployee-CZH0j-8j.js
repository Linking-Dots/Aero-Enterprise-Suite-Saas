import{J as $,r as l,a as A,b as r,j as e,Q as z,i as G,e as v,f as y,F as O,d as Q}from"./app-CiEVawP3.js";import{u as q,a as P,B as H,c as I,m,d as o,G as J,A as W}from"./App-CewhXpPY.js";import{P as X}from"./PageHeader-D-ssfyVi.js";import{L as Z}from"./LeaveEmployeeTable-CSuyHflo.js";import{F as f}from"./ChartBarIcon-C935vBIg.js";import{C as K}from"./CircularProgress-qA9Tw5Du.js";import{F as V}from"./PresentationChartLineIcon-7oqAY5SY.js";import{s as ee,l as ae}from"./chunk-2GIFKCNQ-Bmg2tnZx.js";import{c as re}from"./chunk-D5XJWRAV-5oe-TFrV.js";import"./app-ih7M3oVU.js";import"./PencilIcon-DZUdw5nb.js";import"./TrashIcon-DcZHlLIq.js";import"./XCircleIcon-ChZ59qQK.js";import"./UserIcon-CNkkbYkl.js";import"./CheckCircleIcon-C5ianYIz.js";import"./XCircleIcon-BRkG8xDv.js";import"./CardContent-BakiEWl5.js";import"./colorManipulator-DFDffA3m.js";import"./chunk-F3UDT23P-C2xsynIC.js";import"./useHasTabbableChild-CqjckYwx.js";import"./chunk-7F3ZLNJ6-Cm1c4Hz5.js";import"./chunk-7ZZXWEXF-B3Xaf-7d.js";import"./chunk-R6AK6OQ4-Bagsb6sI.js";import"./chunk-O5I3QTYU-qK7-FHe0.js";import"./index-CokAva9Y.js";const te=({title:N,allUsers:D})=>{const{auth:x}=$().props,C=q(),i=P(C.breakpoints.down("sm")),Y=P(C.breakpoints.down("md")),[h,S]=l.useState(!1),[_,L]=l.useState([]),[u,T]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[p,w]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[g,B]=l.useState({employee:"",year:new Date().getFullYear()}),M=l.useMemo(()=>{const a=new Date().getFullYear();return Array.from({length:a-1900+1},(t,s)=>{const n=1900+s;return{key:n.toString(),label:n.toString(),value:n}}).reverse()},[]),k=l.useCallback((a,t)=>{if(a==="year"){const s=Number(t);if(s<1900||s>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}B(s=>({...s,[a]:t})),a==="year"&&w(s=>({...s,page:1}))},[]),F=l.useCallback((a,t=null)=>{console.log(`Opening ${a} modal for item:`,t)},[]);l.useCallback(()=>{console.log("Closing modal")},[]);const b=l.useCallback(async()=>{S(!0);try{const{page:a,perPage:t}=p,{employee:s,year:n}=g,c=await A.get(route("leaves.paginate"),{params:{page:a,perPage:t,employee:s,year:n},timeout:1e4});if(c.status===200){const{leaves:d,leavesData:j}=c.data;L(d.data||[]),T(j||{leaveTypes:[],leaveCountsByUser:{}}),w(U=>({...U,total:d.total||0,lastPage:d.last_page||0}))}}catch(a){console.error("Error fetching leaves:",a)}finally{S(!1)}},[p.page,p.perPage,g]);l.useEffect(()=>{b()},[b]);const R=l.useMemo(()=>u.leaveCountsByUser[x.user.id]||[],[u.leaveCountsByUser,x.user.id]),E=()=>u.leaveTypes.length?e("div",{className:`grid gap-4 ${i?"grid-cols-1":Y?"grid-cols-2":"grid-cols-4"}`,children:u.leaveTypes.map(({type:a})=>{const t=R.find(d=>d.leave_type===a)||{},s=t.days_used||0,n=t.remaining_days||0,c=s+n;return r(v,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[e(re,{className:"pb-2",children:r("div",{className:"flex items-center gap-2",children:[e(m,{className:"w-5 h-5"}),e(o,{variant:i?"subtitle1":"h6",className:"font-semibold truncate",children:a})]})}),e(y,{className:"pt-0",children:r("div",{className:"space-y-3",children:[r("div",{className:"flex justify-between items-center",children:[r("div",{className:"text-center",children:[e(o,{variant:"caption",color:"textSecondary",children:"Used"}),e(o,{variant:i?"h6":"h5",className:"font-bold text-red-400",children:s})]}),e(Q,{orientation:"vertical",className:"h-8"}),r("div",{className:"text-center",children:[e(o,{variant:"caption",color:"textSecondary",children:"Remaining"}),e(o,{variant:i?"h6":"h5",className:"font-bold text-green-400",children:n})]})]}),c>0&&e("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${s/c*100}%`}})})]})})]},a)})}):e(v,{className:"bg-white/10 backdrop-blur-md border-white/20",children:r(y,{className:"text-center py-8",children:[e(f,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e(o,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})});return r(O,{children:[e(z,{title:N}),r(H,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",e(J,{in:!0,children:e(I,{children:e(X,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:e(V,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Current Year",icon:e(m,{className:"w-4 h-4"}),onPress:()=>k("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:e(f,{className:"w-4 h-4"}),onPress:b,isDisabled:h,variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:r("div",{className:"p-6",children:[e("div",{className:"mb-6",children:r("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(ee,{label:"Select Year",variant:"bordered",selectedKeys:[String(g.year)],onSelectionChange:a=>{const t=Array.from(a)[0];t&&k("year",Number(t))},startContent:e(m,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:i?"sm":"md",children:M.map(a=>e(ae,{value:a.value,children:a.label},a.key))})}),e("div",{className:"flex gap-2",children:e(G,{variant:"flat",color:"primary",size:i?"sm":"md",onPress:b,isLoading:h,startContent:!h&&e(f,{className:"w-4 h-4"}),children:"Refresh"})})]})}),r("div",{className:"mb-6",children:[r(o,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(f,{className:"w-5 h-5"}),"Leave Balance Summary"]}),E()]}),r("div",{className:"min-h-96",children:[r(o,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(m,{className:"w-5 h-5"}),"Leave History"]}),h?e(v,{className:"bg-white/10 backdrop-blur-md border-white/20",children:r(y,{className:"text-center py-12",children:[e(K,{size:40}),e(o,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):_.length>0?e("div",{className:"overflow-hidden rounded-lg",children:e(Z,{leaves:_,allUsers:D,onDelete:a=>F("delete",a),onEdit:a=>F("edit",a.id),pagination:p,onPageChange:a=>w(t=>({...t,page:a})),isMobile:i,setLeaves:L})}):e(v,{className:"bg-white/10 backdrop-blur-md border-white/20",children:r(y,{className:"text-center py-12",children:[e(m,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e(o,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),r(o,{color:"textSecondary",children:["You haven't submitted any leave requests for ",g.year,"."]}),"                      "]})})]})]})})})})]})]})};te.layout=N=>e(W,{children:N});export{te as default};
