import{J as j,r as l,g as A,a as r,b as e,Q as z,h as O,c as v,d as y,F as Q,i as q}from"./app-DMbZ8egF.js";import{u as G,e as P,B as H,d as I,i as m,T as o,b as J,A as W}from"./App-DBihHj7U.js";import{P as X}from"./PageHeader-Dkz_rrRt.js";import{L as Z}from"./LeaveEmployeeTable-CFBvtjj4.js";import{F as f}from"./ChartBarIcon-BTm8n4vW.js";import{C as K}from"./CircularProgress-CqbIOdKa.js";import{F as V}from"./PresentationChartLineIcon-Cpmk3w7f.js";import{s as ee,l as ae}from"./chunk-2GIFKCNQ-BwZHuHwi.js";import{c as re}from"./chunk-D5XJWRAV-C0iPUUQx.js";import"./app-DbVQyYWD.js";import"./PencilIcon-CpzunO_i.js";import"./TrashIcon-tnESjZUx.js";import"./XCircleIcon-Di2h1Bp2.js";import"./UserIcon-D2DuDTuw.js";import"./CheckCircleIcon-CPp_yjo1.js";import"./XCircleIcon-b-Y9KmSO.js";import"./CardContent-B0Zh1gK5.js";import"./colorManipulator-B4EFOkEC.js";import"./chunk-F3UDT23P-DtFhl1MB.js";import"./useHasTabbableChild-BXtalMCB.js";import"./chunk-7F3ZLNJ6-CCnKMx8B.js";import"./chunk-7ZZXWEXF-Bmmm2n3N.js";import"./chunk-R6AK6OQ4-7JPU21Vm.js";import"./chunk-O5I3QTYU-CsHrxnEj.js";import"./index-CokAva9Y.js";const te=({title:N,allUsers:D})=>{const{auth:x}=j().props,C=G(),i=P(C.breakpoints.down("sm")),T=P(C.breakpoints.down("md")),[h,S]=l.useState(!1),[_,L]=l.useState([]),[u,Y]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[p,w]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[g,B]=l.useState({employee:"",year:new Date().getFullYear()}),M=l.useMemo(()=>{const a=new Date().getFullYear();return Array.from({length:a-1900+1},(t,s)=>{const n=1900+s;return{key:n.toString(),label:n.toString(),value:n}}).reverse()},[]),k=l.useCallback((a,t)=>{if(a==="year"){const s=Number(t);if(s<1900||s>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}B(s=>({...s,[a]:t})),a==="year"&&w(s=>({...s,page:1}))},[]),F=l.useCallback((a,t=null)=>{console.log(`Opening ${a} modal for item:`,t)},[]);l.useCallback(()=>{console.log("Closing modal")},[]);const b=l.useCallback(async()=>{S(!0);try{const{page:a,perPage:t}=p,{employee:s,year:n}=g,c=await A.get(route("leaves.paginate"),{params:{page:a,perPage:t,employee:s,year:n},timeout:1e4});if(c.status===200){const{leaves:d,leavesData:U}=c.data;L(d.data||[]),Y(U||{leaveTypes:[],leaveCountsByUser:{}}),w($=>({...$,total:d.total||0,lastPage:d.last_page||0}))}}catch(a){console.error("Error fetching leaves:",a)}finally{S(!1)}},[p.page,p.perPage,g]);l.useEffect(()=>{b()},[b]);const R=l.useMemo(()=>u.leaveCountsByUser[x.user.id]||[],[u.leaveCountsByUser,x.user.id]),E=()=>u.leaveTypes.length?e("div",{className:`grid gap-4 ${i?"grid-cols-1":T?"grid-cols-2":"grid-cols-4"}`,children:u.leaveTypes.map(({type:a})=>{const t=R.find(d=>d.leave_type===a)||{},s=t.days_used||0,n=t.remaining_days||0,c=s+n;return r(v,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[e(re,{className:"pb-2",children:r("div",{className:"flex items-center gap-2",children:[e(m,{className:"w-5 h-5"}),e(o,{variant:i?"subtitle1":"h6",className:"font-semibold truncate",children:a})]})}),e(y,{className:"pt-0",children:r("div",{className:"space-y-3",children:[r("div",{className:"flex justify-between items-center",children:[r("div",{className:"text-center",children:[e(o,{variant:"caption",color:"textSecondary",children:"Used"}),e(o,{variant:i?"h6":"h5",className:"font-bold text-red-400",children:s})]}),e(q,{orientation:"vertical",className:"h-8"}),r("div",{className:"text-center",children:[e(o,{variant:"caption",color:"textSecondary",children:"Remaining"}),e(o,{variant:i?"h6":"h5",className:"font-bold text-green-400",children:n})]})]}),c>0&&e("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${s/c*100}%`}})})]})})]},a)})}):e(v,{className:"bg-white/10 backdrop-blur-md border-white/20",children:r(y,{className:"text-center py-8",children:[e(f,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e(o,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})});return r(Q,{children:[e(z,{title:N}),r(H,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",e(J,{in:!0,children:e(I,{children:e(X,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:e(V,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Current Year",icon:e(m,{className:"w-4 h-4"}),onPress:()=>k("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:e(f,{className:"w-4 h-4"}),onPress:b,isDisabled:h,variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:r("div",{className:"p-6",children:[e("div",{className:"mb-6",children:r("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(ee,{label:"Select Year",variant:"bordered",selectedKeys:[String(g.year)],onSelectionChange:a=>{const t=Array.from(a)[0];t&&k("year",Number(t))},startContent:e(m,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:i?"sm":"md",children:M.map(a=>e(ae,{value:a.value,children:a.label},a.key))})}),e("div",{className:"flex gap-2",children:e(O,{variant:"flat",color:"primary",size:i?"sm":"md",onPress:b,isLoading:h,startContent:!h&&e(f,{className:"w-4 h-4"}),children:"Refresh"})})]})}),r("div",{className:"mb-6",children:[r(o,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(f,{className:"w-5 h-5"}),"Leave Balance Summary"]}),E()]}),r("div",{className:"min-h-96",children:[r(o,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(m,{className:"w-5 h-5"}),"Leave History"]}),h?e(v,{className:"bg-white/10 backdrop-blur-md border-white/20",children:r(y,{className:"text-center py-12",children:[e(K,{size:40}),e(o,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):_.length>0?e("div",{className:"overflow-hidden rounded-lg",children:e(Z,{leaves:_,allUsers:D,onDelete:a=>F("delete",a),onEdit:a=>F("edit",a.id),pagination:p,onPageChange:a=>w(t=>({...t,page:a})),isMobile:i,setLeaves:L})}):e(v,{className:"bg-white/10 backdrop-blur-md border-white/20",children:r(y,{className:"text-center py-12",children:[e(m,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e(o,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),r(o,{color:"textSecondary",children:["You haven't submitted any leave requests for ",g.year,"."]}),"                      "]})})]})]})})})})]})]})};te.layout=N=>e(W,{children:N});export{te as default};
