import{a as t,V as He,j as z,c as ve,M as Te,F}from"./app-BgZxPh_T.js";import{r as l,R as q,L as ze,_ as De,s as _,x as xe,A as Ie,u as Ce,ac as je,B as G,t as Ee,e as Fe,g as Me,c as J,f as ae,a as ne,G as oe,p as Pe}from"./vendor-aMbn8-Jn.js";import{f as Be,e as se,r as ye,j as We,g as Ae,b as le,B,G as Ne,A as $e}from"./App-DYsj1FwD.js";import{X as Oe,m as Ye,A as Ve}from"./minMax-CfkULLcH.js";import{d as Ge}from"./Delete-CbQX6NyW.js";import{l as qe,U as ie}from"./index-42-sn4A3.js";import{u as Ke,$ as de,C as Xe,i as Se}from"./chunk-HJTJQZF3-Car__j_2.js";import{c as V}from"./chunk-MZRCPRP2-Dd_xYQnA.js";import{l as Q,s as ee}from"./chunk-7JXO3E7I-CIzg5OjD.js";import{l as ce}from"./chunk-T45N425O-B5phFMeL.js";import{t as Ue}from"./chunk-CSXHODZI-BXDxKzre.js";import{u as ue}from"./chunk-R6AK6OQ4-bmHOZR1c.js";import{d as Ze}from"./dayjs.min-BZ3s2SPr.js";import{d as Je}from"./Search-DHBRVQbO.js";import{D as pe}from"./Download-DqDPA3nB.js";import{p as Qe}from"./chunk-YHY32LNM-CP9Pzjl6.js";import"./chunk-2BFF5KFD-C_OvEdJU.js";import"./chunk-SLABUSGS-CEQ_8DGs.js";import"./chunk-4EXC76WE-B_WN-iZL.js";import"./chunk-7F3ZLNJ6-NYkHz8z-.js";var et=l.useLayoutEffect,tt=function(n){var o=q.useRef(n);return et(function(){o.current=n}),o},he=function(n,o){if(typeof n=="function"){n(o);return}n.current=o},rt=function(n,o){var r=q.useRef();return q.useCallback(function(d){n.current=d,r.current&&he(r.current,null),r.current=o,o&&he(o,d)},[o])},ge={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},at=function(n){Object.keys(ge).forEach(function(o){n.style.setProperty(o,ge[o],"important")})},me=at,x=null,fe=function(n,o){var r=n.scrollHeight;return o.sizingStyle.boxSizing==="border-box"?r+o.borderSize:r-o.paddingSize};function nt(s,n,o,r){o===void 0&&(o=1),r===void 0&&(r=1/0),x||(x=document.createElement("textarea"),x.setAttribute("tabindex","-1"),x.setAttribute("aria-hidden","true"),me(x)),x.parentNode===null&&document.body.appendChild(x);var d=s.paddingSize,p=s.borderSize,v=s.sizingStyle,C=v.boxSizing;Object.keys(v).forEach(function(L){var g=L;x.style[g]=v[g]}),me(x),x.value=n;var m=fe(x,s);x.value=n,m=fe(x,s),x.value="x";var c=x.scrollHeight-d,h=c*o;C==="border-box"&&(h=h+d+p),m=Math.max(h,m);var y=c*r;return C==="border-box"&&(y=y+d+p),m=Math.min(y,m),[m,c]}var be=function(){},ot=function(n,o){return n.reduce(function(r,d){return r[d]=o[d],r},{})},st=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],lt=!!document.documentElement.currentStyle,it=function(n){var o=window.getComputedStyle(n);if(o===null)return null;var r=ot(st,o),d=r.boxSizing;if(d==="")return null;lt&&d==="border-box"&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var p=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),v=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:p,borderSize:v}},dt=it;function ke(s,n,o){var r=tt(o);l.useLayoutEffect(function(){var d=function(v){return r.current(v)};if(s)return s.addEventListener(n,d),function(){return s.removeEventListener(n,d)}},[])}var ct=function(n){ke(window,"resize",n)},ut=function(n){ke(document.fonts,"loadingdone",n)},pt=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],ht=function(n,o){var r=n.cacheMeasurements,d=n.maxRows,p=n.minRows,v=n.onChange,C=v===void 0?be:v,m=n.onHeightChange,c=m===void 0?be:m,h=ze(n,pt),y=h.value!==void 0,L=l.useRef(null),g=rt(L,o),e=l.useRef(0),a=l.useRef(),i=function(){var u=L.current,R=r&&a.current?a.current:dt(u);if(R){a.current=R;var k=nt(R,u.value||u.placeholder||"x",p,d),D=k[0],T=k[1];e.current!==D&&(e.current=D,u.style.setProperty("height",D+"px","important"),c(D,{rowHeight:T}))}},S=function(u){y||i(),C(u)};return l.useLayoutEffect(i),ct(i),ut(i),l.createElement("textarea",De({},h,{onChange:S,ref:g}))},gt=l.forwardRef(ht),_e=Be(({style:s,minRows:n=3,maxRows:o=8,cacheMeasurements:r=!1,disableAutosize:d=!1,onHeightChange:p,...v},C)=>{const{Component:m,label:c,description:h,startContent:y,endContent:L,hasHelper:g,shouldLabelBeOutside:e,shouldLabelBeInside:a,isInvalid:i,errorMessage:S,getBaseProps:f,getLabelProps:u,getInputProps:R,getInnerWrapperProps:k,getInputWrapperProps:D,getHelperWrapperProps:T,getDescriptionProps:W,getErrorMessageProps:K,isClearable:A,getClearButtonProps:N}=Ke({...v,ref:C,isMultiline:!0}),[$,I]=l.useState(n>1),[M,X]=l.useState(!1),O=c?_.jsx("label",{...u(),children:c}):null,b=R(),w=(U,Z)=>{if(n===1&&I(U>=Z.rowHeight*2),o>n){const Re=U>=o*Z.rowHeight;X(Re)}p==null||p(U,Z)},j=d?_.jsx("textarea",{...b,style:de(b.style,s??{})}):_.jsx(gt,{...b,cacheMeasurements:r,"data-hide-scroll":se(!M),maxRows:o,minRows:n,style:de(b.style,s??{}),onHeightChange:w}),H=l.useMemo(()=>A?_.jsx("button",{...N(),children:_.jsx(Xe,{})}):null,[A,N]),Y=l.useMemo(()=>y||L?_.jsxs("div",{...k(),children:[y,j,L]}):_.jsx("div",{...k(),children:j}),[y,b,L,k]),E=i&&S,P=E||h;return _.jsxs(m,{...f(),children:[e?O:null,_.jsxs("div",{...D(),"data-has-multiple-rows":se($),children:[a?O:null,Y,H]}),g&&P?_.jsx("div",{...T(),children:E?_.jsx("div",{...K(),children:S}):_.jsx("div",{...W(),children:h})}):null]})});_e.displayName="HeroUI.Textarea";var mt=_e;const ft=()=>t("div",{className:"spinner-container",children:t(qe.Dots,{animation:"fade",background:"rgba(0, 0, 0, 0.5)",color:"#3498db",size:60})});var te={},bt=xe;Object.defineProperty(te,"__esModule",{value:!0});var we=te.default=void 0,vt=bt(ye()),xt=_;we=te.default=(0,vt.default)((0,xt.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var re={},Ct=xe;Object.defineProperty(re,"__esModule",{value:!0});var Le=re.default=void 0,yt=Ct(ye()),St=_;Le=re.default=(0,yt.default)((0,St.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");const kt=Ie(Oe)(({theme:s})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{"& .hZUxNm":{"white-space":"normal"},backgroundColor:"transparent",color:s.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none","& .rdt_TableRow":{minHeight:"auto",backgroundColor:"transparent",color:s.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${s.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:s.palette.action.hover}}}})),_t=({allData:s,setData:n,users:o,loading:r,handleClickOpen:d,openModal:p,setCurrentRow:v,search:C})=>{const{auth:m}=He().props,c=Ce();l.useState(null),m.roles.includes("Administrator"),m.roles.includes("Supervision Engineer");const h=e=>{switch(e){case"Open":return"danger";case"Closed":return"success";case"Processing":return"primary";case"Signed":return"warning";case"Sent":return"success";default:return""}},y=e=>{if(!C)return e;const a=C.split(" ").filter(Boolean),i=new RegExp(`(${a.join("|")})`,"gi");return e.split(i).map((f,u)=>a.some(R=>f.toLowerCase()===R.toLowerCase())?t("span",{style:{backgroundColor:"yellow"},children:f},u):f)},L=[{name:"From",selector:e=>e.from,sortable:!0,center:"true",width:"80px",cell:e=>y(e.from)},{name:"Status",selector:e=>e.status,sortable:!0,center:"true",width:"170px",cell:e=>t(ee,{"aria-label":"Status",color:h(e.status),placeholder:"Select Status",value:e.status,onChange:a=>g(e.id,"status",a.target.value),fullWidth:!0,selectedKeys:[e.status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Open","Closed"].map(a=>t(Q,{value:e.status,children:a},a))})},{name:"Received Date",selector:e=>e.received_date,sortable:!0,center:"true",width:"160px",cell:e=>t(Se,{variant:"underlined",type:"date",fullWidth:!0,value:e.received_date,onChange:a=>g(e.id,"received_date",a.target.value)})},{name:"Memo Number",selector:e=>e.memo_number,sortable:!0,center:"true",width:"200px",cell:e=>t(ce,{isExternal:!0,color:"foreground",isBlock:!0,showAnchorIcon:!0,href:e.letter_link||`/letters/${e.memo_number}.pdf`,anchorIcon:t(Le,{}),children:e.memo_number||"N/A"})},{name:"Subject",selector:e=>e.subject,sortable:!0,left:!0,width:"260px",cell:e=>t(Ue,{content:e.subject,placement:"top",showArrow:!0,radius:"md",size:"md",classNames:{content:["bg-transparent backdrop-blur-lg border border-gray-200","max-w-[300px] text-sm"]},children:t(G,{sx:{whiteSpace:"normal",wordWrap:"break-word",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:y(e.subject)})})},{name:"Action Taken",selector:e=>e.action_taken,sortable:!0,left:!0,width:"250px",cell:e=>{const[a,i]=l.useState(e.action_taken||"");return t(mt,{variant:"underlined",size:"sm",radius:"sm",maxRows:2,fullWidth:!0,value:a,onChange:u=>{i(u.target.value)},onBlur:()=>{g(e.id,"action_taken",a)}})}},{name:"Handling Link",selector:e=>e.handling_link,sortable:!0,center:"true",width:"200px",cell:e=>t(ce,{isExternal:!0,color:"primary",isBlock:!0,showAnchorIcon:!0,href:e.handling_link||"#",anchorIcon:t(we,{}),children:e.handling_memo||"N/A"})},{name:"Handling Status",selector:e=>e.handling_status,sortable:!0,center:"true",width:"180px",cell:e=>t(ee,{"aria-label":"Handling Status",color:h(e.handling_status),placeholder:"Select Status",value:e.handling_status,onChange:a=>g(e.id,"handling_status",a.target.value),fullWidth:!0,selectedKeys:[e.handling_status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Processing","Signed","Sent"].map(a=>t(Q,{value:e.handling_status,children:a},a))})},{name:"Need Reply",selector:e=>e.need_reply,center:"true",width:"80px",cell:e=>t(V,{color:h(e.status),isSelected:e.need_reply,onChange:a=>g(e.id,"need_reply",a.target.checked)})},{name:"Replied Status",selector:e=>e.replied_status,center:"true",width:"80px",cell:e=>t(V,{color:h(e.status),isSelected:e.replied_status,onChange:a=>g(e.id,"replied_status",a.target.checked)})},{name:"Need Forward",selector:e=>e.need_forward,center:"true",width:"80px",cell:e=>t(V,{color:h(e.status),isSelected:e.need_forward,onChange:a=>g(e.id,"need_forward",a.target.checked)})},{name:"Forwarded Status",selector:e=>e.forwarded_status,center:"true",width:"90px",cell:e=>t(V,{color:h(e.status),isSelected:e.forwarded_status,onChange:a=>g(e.id,"forwarded_status",a.target.checked)})},{name:"Dealt By",selector:e=>e.dealt_by,sortable:!0,center:"true",cell:e=>t(ee,{items:o,variant:"underlined","aria-label":"Dealt By",fullWidth:!0,value:e.dealt_by||"na",onChange:a=>g(e.id,"dealt_by",a.target.value),selectedKeys:[String(e.dealt_by)],style:{minWidth:"260px"},popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"},style:{whiteSpace:"nowrap",minWidth:"fit-content"}},placeholder:"Select a user",renderValue:a=>a.map(i=>t("div",{className:"flex items-center gap-2 m-1",children:t(ue,{style:{whiteSpace:"nowrap"},size:"sm",name:i.data.name,description:i.data.designation.title,avatarProps:{radius:"sm",size:"sm",src:i.data.profile_image}})},i.key)),children:a=>t(Q,{textValue:a.id,children:t(ue,{style:{whiteSpace:"nowrap"},size:"sm",name:a.name,description:a.designation.title,avatarProps:{radius:"sm",size:"sm",src:a.profile_image}})},a.id)})},{name:"Actions",center:"true",width:"150px",cell:e=>z("div",{className:"flex gap-4 items-center",children:[t(le,{variant:"bordered",isIconOnly:!0,color:"warning","aria-label":"Edit",onClick:()=>p("editLetter",e),children:t(Ae,{})}),t(le,{variant:"bordered",isIconOnly:!0,color:"danger","aria-label":"Delete",onClick:()=>handleDelete(e.id),children:t(Ge,{})})]})}],g=async(e,a,i)=>{var S,f;try{const u=await ve.put(route("letters.update"),{id:e,[a]:i});u.status===200?(n(R=>R.map(k=>k.id===e?{...k,[a]:i}:k)),B.success(...u.data.messages||"Letter updated successfully",{icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})):B.error(u.data.error||`Failed to update letter ${[a]}.`,{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}catch(u){B.error(((f=(S=u.response)==null?void 0:S.data)==null?void 0:f.message)||"An unexpected error occurred.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}};return z("div",{children:[r&&t(ft,{}),t(je,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:c.palette.text.primary}}}),t(kt,{columns:L,data:s,defaultSortField:"received_date",highlightOnHover:!0,responsive:!0,dense:!0,sortIcon:t(We,{}),keyField:"id"})]})};Ze.extend(Ye);const wt=q.memo(({auth:s,title:n,users:o})=>{const r=Ce(),[d,p]=l.useState([]),[v,C]=l.useState(!1),[m,c]=l.useState(0),[h,y]=l.useState(0);l.useState([]);const[L,g]=l.useState(),[e,a]=l.useState(null),[i,S]=l.useState(null),[f,u]=l.useState(""),R=Ee(r.breakpoints.down("md")),[k,D]=l.useState(30),[T,W]=l.useState(1),K=async(b,w,j)=>{try{const H=await ve.get(route("letters.paginate"),{params:{page:b,perPage:w,search:j}});p(H.data.data),c(H.data.total),y(H.data.last_page),C(!1)}catch(H){console.error(H),B.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}),C(!1)}},A=()=>{const b=new Promise(async(w,j)=>{var H,Y;try{const E=await fetch("/delete-daily-work",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({id:e,page:T,perPage:k,search:f,status:filterData.status!=="all"?filterData.status:"",inCharge:filterData.incharge!=="all"?filterData.incharge:"",startDate:(H=filterData.startDate)==null?void 0:H.format("YYYY-MM-DD"),endDate:(Y=filterData.endDate)==null?void 0:Y.format("YYYY-MM-DD")})}),P=await E.json();E.ok?(p(P.data),c(P.total),w("Daily work deleted successfully")):j(P.error||"Failed to delete task")}catch(E){console.error("Error deleting task:",E),j("An error occurred while deleting the task")}finally{$()}});B.promise(b,{pending:{render(){return z("div",{style:{display:"flex",alignItems:"center"},children:[t(Pe,{}),t("span",{style:{marginLeft:"8px"},children:"Deleting task..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:w}){return t(F,{children:w})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:w}){return t(F,{children:w})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},N=l.useCallback((b,w)=>{a(b),S(w)},[]),$=l.useCallback(()=>{S(null),a(null)},[]),I=l.useCallback(b=>{S(b)},[]),M=l.useCallback(()=>{S(null)},[]),X=b=>{const w=b.target.value;u(w)};l.useEffect(()=>{C(!0),K(T,k,f)},[T,k,f]);const O=b=>{W(b)};return z(F,{children:[t(Te,{title:n}),i==="editLetter"&&t(LetterForm,{open:i==="editLetter",currentRow:L,setData:p,closeModal:M}),i==="deleteLetter"&&t(DeleteLetterForm,{open:i==="deleteLetter",handleClose:$,handleDelete:A,setData:p}),i==="importLetters"&&t(LettersUploadForm,{open:i==="importLetters",closeModal:M,setData:p,setTotalRows:c}),i==="exportLetters"&&t(LettersDownloadForm,{open:i==="exportLetters",closeModal:M,data:d,users:o}),t(G,{sx:{display:"flex",justifyContent:"center",p:2},children:t(Fe,{in:!0,children:z(Ne,{children:[t(Me,{title:n,sx:{padding:"24px"},action:z(G,{display:"flex",gap:2,children:[s.permissions.includes("addTask")&&t(J,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:t(Ve,{})}),s.roles.includes("Administrator")&&t(F,{children:R?z(F,{children:[t(J,{title:"Import Letters",color:"warning",onClick:()=>I("importLetters"),children:t(ie,{})}),t(J,{title:"Export Letters",color:"success",onClick:()=>I("exportLetters"),children:t(pe,{})})]}):z(F,{children:[t(ae,{title:"Import Letters",variant:"outlined",color:"warning",startIcon:t(ie,{}),onClick:()=>I("importLetters"),children:"Import"}),t(ae,{title:"Export Letters",variant:"outlined",color:"success",startIcon:t(pe,{}),onClick:()=>I("exportLetters"),children:"Export"})]})})]})}),t(ne,{children:t(G,{children:t(oe,{container:!0,spacing:2,children:t(oe,{item:!0,xs:12,sm:6,md:3,children:t(Se,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Search...",value:f,onChange:X,endContent:t(Je,{})})})})})}),z(ne,{children:[t(_t,{setData:p,setCurrentRow:g,currentPage:T,setCurrentPage:W,setLoading:C,handleClickOpen:N,openModal:I,totalRows:m,lastPage:h,loading:v,allData:d,users:o,search:f}),m>=30&&t("div",{className:"py-2 px-2 flex justify-center items-center",children:t(Qe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:T,total:h,onChange:O})})]})]})})})]})});wt.layout=s=>t($e,{children:s});export{wt as default};
