import{J as Fe,r as m,j as e,b as a,e as Ie,F as ge,i as fe,d as ie,R as Ke,a as ze,p as Je}from"./app-DZ7wekd6.js";import{u as it,a as Re,d as o,B as r,E as We,F as O,b as _,f as j,G as be,H as re,i as ce,J as se,c as xe,K as me,L as Qe,M as Xe}from"./App-BgzboC1v.js";import{d as Y}from"./dayjs.min-Dxc1yh7j.js";import{u as le,w as ct}from"./xlsx-DbTalbU2.js";import{E as mt}from"./jspdf.es.min-CuTgJ-vP.js";import{a as dt}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{F as R}from"./ExclamationTriangleIcon-Cppl0Irh.js";import{F as de}from"./UserIcon-Dpnr_B5_.js";import{C as we}from"./CardHeader-CbuAQxn2.js";import{F as je}from"./DocumentArrowDownIcon-CrbKuyNE.js";import{F as H}from"./CheckCircleIcon-W0xXWNcF.js";import{C as he}from"./CardContent-Lcyb_-0B.js";import{B as qe}from"./Button-D0Tc_d3s.js";import{F as Ze}from"./XCircleIcon-C8pM07Bv.js";import{s as He}from"./chunk-TLYTI3QM-gXr1XZmE.js";import{t as Ue,a as Ye,b as Oe,c as Be,d as Ge,e as I}from"./chunk-F3UDT23P-DU-BVP7B.js";import{p as Ve}from"./chunk-O5I3QTYU-zCP-jUMc.js";import{u as ht}from"./chunk-R6AK6OQ4-C4V75bYW.js";import"./app-CPPT5dG3.js";import"./useHasTabbableChild-B7pyzHVN.js";import"./chunk-7F3ZLNJ6-BBZ_V3qk.js";import"./index-CokAva9Y.js";const zt=({handleDateChange:N,selectedDate:b,updateTimeSheet:X,externalFilterData:S,externalEmployee:P})=>{var De,$e,Le;const{auth:x}=Fe().props,{url:y}=Fe();it();const c=Re("(min-width: 1025px)"),L=Re("(min-width: 641px) and (max-width: 1024px)"),[h,B]=m.useState([]),[d,u]=m.useState([]),[C,l]=m.useState([]),[w,p]=m.useState(""),[D,$]=m.useState(0),[A,ne]=m.useState(0),[G,pt]=m.useState(10),[V,Ne]=m.useState(1),[q,ye]=m.useState(P||""),[Z,ue]=m.useState(!1),[et,tt]=m.useState(0),[F,ve]=m.useState(S||{currentMonth:Y().format("YYYY-MM")}),_e=async(t,g,i,k,E,n=!1)=>{var T,z;const f=y!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{ue(!1);const v=await ze.get(f,{params:{page:g,perPage:i,employee:k,date:t,currentYear:E.currentMonth?Y(E.currentMonth).year():"",currentMonth:E.currentMonth?Y(E.currentMonth).format("MM"):"",_t:n?Date.now():void 0}});v.status===200&&(B(v.data.attendances||[]),$(v.data.total||0),ne(v.data.last_page||1),Ne(v.data.current_page||1),p(""),ue(!0))}catch(v){p(((z=(T=v.response)==null?void 0:T.data)==null?void 0:z.message)||"An error occurred while retrieving present users data."),ue(!0)}},Se=async(t,g)=>{if(y==="/attendance-employee"){l([]),u([]);return}try{const i=await ze.get(route("admin.getAbsentUsersForDate"),{params:{date:t}});i.status===200&&(l(i.data.absent_users||[]),u(i.data.leaves||[]))}catch(i){console.error("Error fetching absent users:",i),l([]),u([])}},at=m.useCallback(()=>{tt(t=>t+1),_e(b,V,G,q,F,!0),Se(b)},[b,V,G,q,F]),rt=t=>{ye(t.target.value.toLowerCase())},Ce=t=>{Ne(t)};m.useCallback((t,g)=>{ve(i=>({...i,[t]:g}))},[]);const ee=t=>d.find(g=>String(g.user_id)===String(t)),W=(t,g)=>{if(!t)return null;try{let i;if(typeof t=="string")if(t.match(/^\d{2}:\d{2}:\d{2}$/)){const k=`${g}T${t}`;i=new Date(k)}else if(t.includes("T")||t.includes(" "))i=new Date(t);else if(t.match(/^\d{2}:\d{2}$/)){const k=`${g}T${t}:00`;i=new Date(k)}else i=new Date(`${g}T${t}`);else i=new Date(t);return isNaN(i.getTime())?(console.warn("Invalid time data:",t),"Invalid time"):i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(i){return console.warn("Error formatting time:",{timeString:t,date:g,error:i}),"Invalid time"}},te=((De=x.permissions)==null?void 0:De.includes("attendance.view"))||!1,st=(($e=x.permissions)==null?void 0:$e.includes("attendance.manage"))||!1,nt=((Le=x.permissions)==null?void 0:Le.includes("attendance.export"))||st||!1,U=m.useMemo(()=>C,[C]),ke=[{name:"Date",uid:"date",icon:O},...te&&y!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:de}]:[],{name:"Clock In",uid:"clockin_time",icon:_},{name:"Clock Out",uid:"clockout_time",icon:_},{name:"Work Hours",uid:"production_time",icon:_},{name:"Punches",uid:"punch_details",icon:_}],Pe=(t,g)=>{var k,E,n;const i=new Date(t.date).toDateString()===new Date().toDateString();switch(g){case"date":return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(O,{className:"w-4 h-4 text-primary"}),e(r,{className:"flex flex-col",children:e("span",{children:new Date(t.date).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})})})]})});case"employee":return e(I,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base",children:e(ht,{avatarProps:{radius:"lg",size:c||L?"md":"sm",src:(k=t.user)==null?void 0:k.profile_image,fallback:e(de,{className:"w-6 h-6"})},description:(E=t.user)==null?void 0:E.phone,name:(n=t.user)==null?void 0:n.name})});case"clockin_time":return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(_,{className:"w-4 h-4 text-success"}),a(r,{className:"flex flex-col",children:[e("span",{children:t.punchin_time?W(t.punchin_time,t.date)||"Invalid time":"Not clocked in"}),t.punchin_time&&e("span",{className:"text-xs text-default-500",children:"First punch"})]})]})});case"clockout_time":return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(_,{className:"w-4 h-4 text-danger"}),a(r,{className:"flex flex-col",children:[e("span",{children:t.punchout_time?W(t.punchout_time,t.date)||"Invalid time":t.punchin_time?i?"Still working":"Not Punched Out":"Not started"}),t.punchout_time&&e("span",{className:"text-xs text-default-500",children:"Last punch"})]})]})});case"production_time":const T=t.total_work_minutes>0,z=t.has_incomplete_punch,v=t.punchin_time&&!t.punchout_time&&i;if(T){const K=Math.floor(t.total_work_minutes/60),ae=Math.floor(t.total_work_minutes%60);return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(_,{className:`w-4 h-4 ${z?"text-warning":"text-primary"}`}),a(r,{className:"flex flex-col",children:[e("span",{className:"font-medium",children:`${K}h ${ae}m`}),e("span",{className:"text-xs text-default-500",children:z?"Partial + In Progress":"Total worked"})]})]})})}else{if(v)return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(_,{className:"w-4 h-4 text-warning"}),a(r,{className:"flex flex-col",children:[e("span",{className:"text-warning",children:"In Progress"}),e("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(t.punchin_time&&!t.punchout_time&&!i)return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(R,{className:"w-4 h-4 text-danger"}),a(r,{className:"flex flex-col",children:[e("span",{className:"text-danger",children:"Incomplete punch"}),e("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(R,{className:"w-4 h-4 text-warning"}),a(r,{className:"flex flex-col",children:[e("span",{className:"text-warning",children:"No work time"}),e("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e(I,{className:"text-xs sm:text-sm md:text-base",children:a(r,{className:"flex items-center gap-2",children:[e(_,{className:"w-4 h-4 text-default-400"}),a(r,{className:"flex flex-col",children:[a("span",{className:"text-xs font-medium",children:[t.punch_count||0," punch",(t.punch_count||0)!==1?"es":""]}),t.complete_punches!==t.punch_count&&a("span",{className:"text-xs text-warning",children:[t.complete_punches," complete"]}),t.complete_punches===t.punch_count&&t.punch_count>0&&e("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e(I,{className:"text-xs sm:text-sm md:text-base",children:"N/A"})}},ot=m.useCallback(()=>{try{const t=[];h.forEach((s,M)=>{var Ae,Ee,Te,Me;const J=Math.floor(s.total_work_minutes/60),oe=Math.floor(s.total_work_minutes%60),pe=s.total_work_minutes>0?`${J}h ${oe}m`:s.has_incomplete_punch?"In Progress":"No work time",Q=s.complete_punches===s.punch_count&&s.punch_count>0?"Complete":s.has_incomplete_punch?"In Progress":"Incomplete";t.push({"No.":t.length+1,Date:new Date(s.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),"Employee Name":((Ae=s.user)==null?void 0:Ae.name)||"N/A","Employee ID":((Ee=s.user)==null?void 0:Ee.employee_id)||"N/A",Designation:((Te=s.user)==null?void 0:Te.designation_name)||"N/A",Phone:((Me=s.user)==null?void 0:Me.phone)||"N/A","Clock In":s.punchin_time?W(s.punchin_time,s.date)||"Invalid time":"Not clocked in","Clock Out":s.punchout_time?W(s.punchout_time,s.date)||"Invalid time":s.punchin_time?new Date(s.date).toDateString()===new Date().toDateString()?"Still working":"Not Punched Out":"Not started","Work Hours":pe,"Total Punches":s.punch_count||0,"Complete Punches":s.complete_punches||0,Status:Q,Remarks:Q==="Complete"?"Present - All punches complete":Q==="In Progress"?"Present - Currently working":"Present - Incomplete punches"})}),U.forEach(s=>{const M=ee(s.id);let J="Absent without leave";if(M){const oe=M.from_date===M.to_date?M.from_date:`${M.from_date} to ${M.to_date}`;J=`On ${M.leave_type} Leave (${oe}) - Status: ${M.status}`}t.push({"No.":t.length+1,Date:new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),"Employee Name":s.name||"N/A","Employee ID":s.employee_id||"N/A",Designation:s.designation_name||"N/A",Phone:s.phone||"N/A","Clock In":"Absent","Clock Out":"Absent","Work Hours":"0h 0m","Total Punches":0,"Complete Punches":0,Status:"Absent",Remarks:J})});const g=le.book_new(),k=[[y==="/attendance-employee"?`Employee Timesheet - ${new Date(F.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"})}`:`Daily Timesheet - ${new Date(b).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}`],[`Generated on: ${new Date().toLocaleString("en-US")}`],[`Total Employees: ${t.length} (Present: ${h.length}, Absent: ${U.length})`],[],["No.","Date","Employee Name","Employee ID","Designation","Phone","Clock In","Clock Out","Work Hours","Total Punches","Complete Punches","Status","Remarks"]],E=t.map(s=>[s["No."],s.Date,s["Employee Name"],s["Employee ID"],s.Designation,s.Phone,s["Clock In"],s["Clock Out"],s["Work Hours"],s["Total Punches"],s["Complete Punches"],s.Status,s.Remarks]),n=[...k,...E],f=le.aoa_to_sheet(n),T=[{wch:5},{wch:12},{wch:20},{wch:12},{wch:20},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15},{wch:12},{wch:40}];f["!cols"]=T,f["!merges"]=[{s:{r:0,c:0},e:{r:0,c:12}},{s:{r:1,c:0},e:{r:1,c:12}},{s:{r:2,c:0},e:{r:2,c:12}}];const z={font:{bold:!0,sz:16},alignment:{horizontal:"center"}};f.A1&&(f.A1.s=z);const v=["A5","B5","C5","D5","E5","F5","G5","H5","I5","J5","K5","L5","M5"];v.forEach(s=>{f[s]&&(f[s].s={font:{bold:!0},fill:{fgColor:{rgb:"E3F2FD"}},alignment:{horizontal:"center"}})});const K=6;t.forEach((s,M)=>{const J=K+M;s.Status==="Absent"&&v.forEach((oe,pe)=>{const Q=le.encode_cell({r:J-1,c:pe});f[Q]&&(f[Q].s={fill:{fgColor:{rgb:"FFEBEE"}},font:{color:{rgb:"D32F2F"}}})})}),le.book_append_sheet(g,f,"Timesheet");const ae=y==="/attendance-employee"?`Employee_Timesheet_${Y(F.currentMonth).format("YYYY_MM")}.xlsx`:`Daily_Timesheet_${Y(b).format("YYYY_MM_DD")}.xlsx`;ct(g,ae)}catch(t){console.error("Error generating Excel file:",t),alert("Error generating Excel file. Please try again.")}},[h,U,b,F,y,ee,W]),lt=m.useCallback(()=>{try{const t=new mt,g=y==="/attendance-employee"?`Employee Timesheet - ${new Date(F.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"})}`:`Daily Timesheet - ${new Date(b).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}`;t.setFontSize(18),t.setFont("helvetica","bold"),t.text(g,t.internal.pageSize.getWidth()/2,20,{align:"center"}),t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Generated on: ${new Date().toLocaleString("en-US")}`,14,35),t.text(`Total Employees: ${h.length+U.length} (Present: ${h.length}, Absent: ${U.length})`,14,42);const i=[];h.forEach((n,f)=>{var s;const T=Math.floor(n.total_work_minutes/60),z=Math.floor(n.total_work_minutes%60),v=n.total_work_minutes>0?`${T}h ${z}m`:n.has_incomplete_punch?"In Progress":"No work time",K=n.complete_punches===n.punch_count&&n.punch_count>0?"Complete":n.has_incomplete_punch?"In Progress":"Incomplete",ae=K==="Complete"?"Present - All complete":K==="In Progress"?"Present - Working":"Present - Incomplete";i.push([i.length+1,new Date(n.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),((s=n.user)==null?void 0:s.name)||"N/A",n.punchin_time?W(n.punchin_time,n.date)||"Invalid time":"Not clocked in",n.punchout_time?W(n.punchout_time,n.date)||"Invalid time":n.punchin_time?new Date(n.date).toDateString()===new Date().toDateString()?"Still working":"Not Punched Out":"Not started",v,`${n.complete_punches}/${n.punch_count}`,ae])}),U.forEach(n=>{const f=ee(n.id);let T="Absent without leave";f&&(T=`On ${f.leave_type} Leave - ${f.status}`),i.push([i.length+1,new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),n.name||"N/A","Absent","Absent","0h 0m","0/0",T])}),dt(t,{head:[["No.","Date","Employee","Clock In","Clock Out","Work Hours","Punches","Remarks"]],body:i,startY:50,theme:"grid",styles:{fontSize:7,cellPadding:2,lineColor:[200,200,200],lineWidth:.5},headStyles:{fillColor:[66,139,202],textColor:[255,255,255],fontStyle:"bold",fontSize:8},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{0:{cellWidth:12,halign:"center"},1:{cellWidth:20},2:{cellWidth:30},3:{cellWidth:20},4:{cellWidth:20},5:{cellWidth:18},6:{cellWidth:15,halign:"center"},7:{cellWidth:35}},margin:{top:10,left:14,right:14},didParseCell:function(n){if(n.row.index>=0){const f=i[n.row.index];f&&f[7]&&(f[7].includes("Absent")||f[7].includes("Leave"))&&(n.cell.styles.fillColor=[255,235,238],n.cell.styles.textColor=[211,47,47])}}});const k=t.internal.getNumberOfPages();for(let n=1;n<=k;n++)t.setPage(n),t.setFontSize(8),t.setFont("helvetica","normal"),t.text(`Page ${n} of ${k}`,t.internal.pageSize.getWidth()-30,t.internal.pageSize.getHeight()-10),t.text("Generated by Glass ERP System",14,t.internal.pageSize.getHeight()-10);const E=y==="/attendance-employee"?`Employee_Timesheet_${Y(F.currentMonth).format("YYYY_MM")}.pdf`:`Daily_Timesheet_${Y(b).format("YYYY_MM_DD")}.pdf`;t.save(E)}catch(t){console.error("Error generating PDF file:",t),alert("Error generating PDF file. Please try again.")}},[h,U,b,F,y,ee,W]);return m.useEffect(()=>{_e(b,V,G,q,F),Se(b)},[b,V,G,q,F,X,et]),m.useEffect(()=>{S&&ve(S)},[S]),m.useEffect(()=>{P!==void 0&&ye(P)},[P]),y==="/attendance-employee"?e(r,{role:"region","aria-label":"Attendance data table",className:"w-full",children:w?e(Ie,{className:"p-4 bg-danger-50 border-danger-200",children:a(r,{className:"flex items-center gap-3",children:[e(R,{className:"w-5 h-5 text-danger"}),e(o,{color:"error",variant:"body1",children:w})]})}):a(ge,{children:[e(We,{orientation:"horizontal",className:"overflow-y-hidden",children:e(He,{className:"rounded-lg",isLoaded:Z,children:a(Ue,{selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,classNames:{base:"max-h-[520px] overflow-scroll",table:"min-h-[200px]"},children:[e(Ye,{columns:ke,children:t=>e(Oe,{align:"start",children:a(r,{className:"flex items-center gap-2",children:[t.icon&&e(t.icon,{className:"w-4 h-4"}),e("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e(Be,{items:h,emptyContent:a(r,{className:"flex flex-col items-center justify-center py-8",children:[e(_,{className:"w-12 h-12 text-default-300 mb-4"}),e(o,{variant:"body1",color:"textSecondary",children:"No attendance records found"})]}),children:t=>e(Ge,{children:g=>Pe(t,g)},t.id||t.user_id)})]})})}),D>G&&e(r,{className:"py-4 flex justify-center",children:e(Ve,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:V,total:A,onChange:Ce,"aria-label":"Timesheet pagination"})})]})}):e(r,{sx:{display:"flex",justifyContent:"center",p:2},component:"main",role:"main","aria-label":"Timesheet Management",children:e(j,{container:!0,spacing:2,children:e(j,{item:!0,xs:12,children:e(be,{in:!0,timeout:500,children:a(xe,{children:["                            ",e(we,{className:"bg-gradient-to-br from-slate-50/50 to-white/30 backdrop-blur-sm border-b border-white/20",title:e("div",{className:`${c?"p-6":L?"p-4":"p-3"}`,children:a("div",{className:"flex flex-col space-y-4",children:[a("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[a("div",{className:"flex items-center gap-3 lg:gap-4",children:[e("div",{className:`
                                                        ${c?"p-3":L?"p-2.5":"p-2"} 
                                                        rounded-xl bg-gradient-to-br from-[rgba(var(--theme-primary-rgb),0.2)] to-[rgba(var(--theme-secondary-rgb),0.2)] border border-[rgba(var(--theme-primary-rgb),0.3)] backdrop-blur-sm
                                                    `,children:e(_,{className:`
                                                                ${c?"w-8 h-8":L?"w-6 h-6":"w-5 h-5"}
                                                            `,style:{color:"var(--theme-primary)"}})}),a("div",{className:"min-w-0 flex-1",children:[e(o,{variant:c?"h4":L?"h5":"h6",className:`
                                                                font-bold bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] bg-clip-text text-transparent
                                                                ${c?"":"truncate"}
                                                            `,style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:"Daily Timesheet"}),e(o,{variant:c?"body2":"caption",color:"textSecondary",className:c?"":"truncate",style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:new Date(b).toLocaleString("en-US",{month:c?"long":"short",day:"numeric",year:c?"numeric":void 0})})]})]}),"                                                ",a("div",{className:"flex gap-2 flex-wrap justify-start lg:justify-end",children:[nt&&a(ge,{children:[e(fe,{color:"success",variant:"flat",size:c?"md":"sm",startContent:e(je,{className:`
                                                                        ${c?"w-4 h-4":"w-3.5 h-3.5"}
                                                                    `}),className:"bg-gradient-to-r from-[rgba(var(--theme-success-rgb),0.1)] to-[rgba(var(--theme-success-rgb),0.2)] hover:from-[rgba(var(--theme-success-rgb),0.2)] hover:to-[rgba(var(--theme-success-rgb),0.3)] border border-[rgba(var(--theme-success-rgb),0.2)] backdrop-blur-sm",onPress:ot,isDisabled:!Z||h.length===0,style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:c?"Excel":"XLS"}),e(fe,{color:"danger",variant:"flat",size:c?"md":"sm",startContent:e(je,{className:`
                                                                        ${c?"w-4 h-4":"w-3.5 h-3.5"}
                                                                    `}),className:"bg-gradient-to-r from-[rgba(var(--theme-danger-rgb),0.1)] to-[rgba(var(--theme-danger-rgb),0.2)] hover:from-[rgba(var(--theme-danger-rgb),0.2)] hover:to-[rgba(var(--theme-danger-rgb),0.3)] border border-[rgba(var(--theme-danger-rgb),0.2)] backdrop-blur-sm",onPress:lt,isDisabled:!Z||h.length===0,style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:"PDF"})]}),e(fe,{color:"primary",variant:"flat",size:c?"md":"sm",startContent:e("svg",{className:`${c?"w-4 h-4":"w-3.5 h-3.5"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),onPress:at,isDisabled:!Z,className:"bg-gradient-to-r from-[rgba(var(--theme-primary-rgb),0.1)] to-[rgba(var(--theme-secondary-rgb),0.1)] hover:from-[rgba(var(--theme-primary-rgb),0.2)] hover:to-[rgba(var(--theme-secondary-rgb),0.2)] border border-[rgba(var(--theme-primary-rgb),0.2)] backdrop-blur-sm",style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:c?"Refresh":""})]})]}),c&&a("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[a("div",{className:"flex items-center gap-2",children:[e(H,{className:"w-4 h-4 text-success"}),a(o,{variant:"caption",color:"textSecondary",children:["Present: ",h.length]})]}),te&&a("div",{className:"flex items-center gap-2",children:[e(R,{className:"w-4 h-4 text-warning"}),a(o,{variant:"caption",color:"textSecondary",children:["Absent: ",C.length]})]}),a("div",{className:"flex items-center gap-2",children:[e(re,{className:"w-4 h-4 text-primary"}),a(o,{variant:"caption",color:"textSecondary",children:["Total: ",h.length+C.length]})]})]})]})}),sx:{padding:0,"& .MuiCardHeader-content":{width:"100%",overflow:"hidden"}}}),e(ie,{}),e(he,{children:e(r,{component:"section",role:"search","aria-label":"Timesheet filters",children:e(j,{container:!0,spacing:3,children:te&&a(ge,{children:[e(j,{item:!0,xs:12,sm:6,md:4,children:e(ce,{label:"Search Employee",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Enter employee name...",value:q,onChange:rt,startContent:e(se,{className:"w-4 h-4 text-default-400"}),"aria-label":"Search employees",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})}),e(j,{item:!0,xs:12,sm:6,md:4,children:e(ce,{label:"Select Date",type:"date",variant:"bordered",onChange:N,value:new Date(b).toISOString().slice(0,10)||"",startContent:e(O,{className:"w-4 h-4 text-default-400"}),"aria-label":"Select date for timesheet",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})})]})})})}),e(ie,{}),e(he,{children:a(j,{container:!0,spacing:3,children:[e(j,{item:!0,xs:12,md:te?9:12,children:w?e(Ie,{className:"p-4 bg-danger-50 border-danger-200",children:a(r,{className:"flex items-center gap-3",children:[e(R,{className:"w-5 h-5 text-danger"}),e(o,{color:"error",variant:"body1",children:w})]})}):a(r,{role:"region","aria-label":"Present employees attendance table",className:"border-r border-gray-200 pr-4",sx:{borderRightColor:"rgba(0, 0, 0, 0.1)"},children:[e(r,{className:"mb-4",children:a(o,{variant:"h6",className:"font-semibold text-blue-600 flex items-center gap-2",children:[e(H,{className:"w-5 h-5"}),"Present Employees (",h.length,")"]})}),e(We,{orientation:"horizontal",className:"overflow-y-hidden",children:e(He,{className:"rounded-lg",isLoaded:Z,children:a(Ue,{selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,classNames:{base:"max-h-[520px] overflow-scroll",table:"min-h-[200px]"},children:[e(Ye,{columns:ke,children:t=>e(Oe,{align:"start",children:a(r,{className:"flex items-center gap-2",children:[t.icon&&e(t.icon,{className:"w-4 h-4"}),e("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e(Be,{items:h,emptyContent:a(r,{className:"flex flex-col items-center justify-center py-8",children:[e(_,{className:"w-12 h-12 text-default-300 mb-4"}),e(o,{variant:"body1",color:"textSecondary",children:"No attendance records found"})]}),children:t=>e(Ge,{children:g=>Pe(t,g)},t.id||t.user_id)})]})})}),D>G&&e(r,{className:"py-4 flex justify-center",children:e(Ve,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:V,total:A,onChange:Ce,"aria-label":"Timesheet pagination"})})]})}),te&&e(j,{item:!0,xs:12,md:3,children:e(ut,{absentUsers:C,selectedDate:b,getUserLeave:ee})})]})})]})})})})})},ut=Ke.memo(({absentUsers:N,selectedDate:b,getUserLeave:X})=>{const[S,P]=m.useState(5),[x,y]=m.useState(""),c=m.useMemo(()=>{if(!x.trim())return N;const d=x.toLowerCase();return N.filter(u=>{var D,$,A,ne;const C=((D=u.name)==null?void 0:D.toLowerCase())||"",l=(($=u.employee_id)==null?void 0:$.toString().toLowerCase())||"",w=((A=u.email)==null?void 0:A.toLowerCase())||"",p=((ne=u.phone)==null?void 0:ne.toString().toLowerCase())||"";return C.includes(d)||l.includes(d)||w.includes(d)||p.includes(d)})},[N,x]),L=()=>{P(d=>d+5)},h=d=>{y(d.target.value),P(5)},B=d=>{switch(d==null?void 0:d.toLowerCase()){case"approved":return e(H,{className:"w-4 h-4 text-success"});case"rejected":return e(Ze,{className:"w-4 h-4 text-danger"});default:return e(_,{className:"w-4 h-4 text-warning"})}};return N.length===0?a(r,{className:"h-full",children:[a(r,{className:"mb-4 flex items-center justify-between",children:[a(o,{variant:"h6",className:"font-semibold text-orange-600 flex items-center gap-2 text-sm",children:[e(re,{className:"w-4 h-4"}),"Absent Today"]}),e(me,{label:"0",variant:"flat",color:"success",size:"sm",startContent:e(H,{className:"w-3 h-3"})})]}),a(r,{role:"region","aria-label":"No absent employees today",className:"text-center py-12 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg h-96 flex flex-col items-center justify-center",children:[e(H,{className:"w-12 h-12 text-success mx-auto mb-4"}),e(o,{variant:"body2",color:"success",className:"mb-2 text-sm font-medium",children:"Perfect Attendance!"}),e(o,{variant:"caption",color:"textSecondary",className:"text-xs",children:"No employees are absent today."}),e(o,{variant:"caption",color:"textSecondary",className:"mt-1 block text-xs",children:"All employees are either present or on approved leave."})]})]}):a(r,{className:"h-full",children:[a(r,{className:"mb-4 flex items-center justify-between",children:[a(o,{variant:"h6",className:"font-semibold text-orange-600 flex items-center gap-2 text-sm",children:[e(re,{className:"w-4 h-4"}),"Absent Today"]}),e(me,{label:N.length,variant:"flat",color:"warning",size:"sm",startContent:e(R,{className:"w-3 h-3"})})]}),e(r,{className:"mb-3 m-2",children:e(ce,{size:"sm",placeholder:"Search absent employees...",value:x,onChange:h,startContent:e(se,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 h-8",input:"text-xs"},"aria-label":"Search absent employees"})}),x&&e(r,{className:"mb-2 ",children:a(o,{variant:"caption",color:"textSecondary",className:"text-xs",children:[c.length," of ",N.length," employees found"]})}),x&&c.length===0&&a(r,{className:"text-center py-8 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg",children:[e(se,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),a(o,{variant:"body2",color:"textSecondary",className:"text-sm",children:['No employees found matching "',x,'"']})]}),a(r,{role:"region","aria-label":"Absent employees list",className:"overflow-y-auto max-h-[520px]",children:[c.slice(0,S).map(d=>{var C,l;const u=X(d.id);return e(Xe,{in:!0,timeout:"auto",children:e("div",{className:"p-3 m-2 bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all duration-200 rounded-lg",children:a(r,{className:"flex items-start justify-between",children:[a(r,{className:"flex items-center gap-2 flex-1",children:[e(Qe,{src:d.profile_image,alt:d.name,size:"sm",fallback:e(de,{className:"w-4 h-4"})}),a(r,{className:"flex-1 min-w-0",children:["                                            ",e(o,{variant:"body2",fontWeight:"medium",className:"truncate text-sm",children:d.name}),d.employee_id&&a(o,{variant:"caption",color:"textSecondary",className:"block text-xs",children:["ID: ",d.employee_id]}),u?a(r,{className:"flex flex-col gap-1 mt-1",children:[a(o,{variant:"caption",color:"textSecondary",className:"flex items-center gap-1 text-xs",children:[e(O,{className:"w-3 h-3"}),u.from_date===u.to_date?u.from_date:`${u.from_date} - ${u.to_date}`]}),a(o,{variant:"caption",color:"primary",className:"flex items-center gap-1 text-xs",children:[B(u.status),u.leave_type," Leave"]})]}):a(o,{variant:"caption",color:"error",className:"flex items-center gap-1 mt-1 text-xs",children:[e(R,{className:"w-3 h-3"}),"Absent without leave"]})]})]}),u&&e("div",{className:"bg-white/20 backdrop-blur-md border border-white/30 rounded-md px-1.5 py-0.5 ml-2",children:a("div",{className:"flex items-center gap-1",children:[B(u.status),e(o,{variant:"caption",className:`font-semibold text-xs ${((C=u.status)==null?void 0:C.toLowerCase())==="approved"?"text-green-600":((l=u.status)==null?void 0:l.toLowerCase())==="rejected"?"text-red-600":"text-orange-600"}`,children:u.status})]})})]})})},d.id)}),S<c.length&&e(r,{className:"text-center mt-4 pb-4",children:a(qe,{variant:"outlined",onClick:L,startIcon:e(Je,{className:"w-4 h-4"}),size:"small",color:"warning",fullWidth:!0,children:["Show More (",c.length-S," remaining)"]})})]})]})});Ke.memo(({absentUsers:N,selectedDate:b,getUserLeave:X})=>{const[S,P]=m.useState(2),[x,y]=m.useState(""),c=m.useRef(null),L=m.useRef(null),h=m.useMemo(()=>{if(!x.trim())return N;const l=x.toLowerCase();return N.filter(w=>{var p,D,$,A;return((p=w.name)==null?void 0:p.toLowerCase().includes(l))||((D=w.employee_id)==null?void 0:D.toString().toLowerCase().includes(l))||(($=w.email)==null?void 0:$.toLowerCase().includes(l))||((A=w.phone)==null?void 0:A.toString().toLowerCase().includes(l))})},[N,x]),B=l=>{y(l.target.value),P(2)},d=m.useCallback(()=>{if(c.current&&L.current){const l=c.current.clientHeight,w=120,p=L.current.clientHeight+12,D=l-w,$=Math.floor(D/p);P(Math.max(2,Math.min($,h.length)))}},[h.length]),u=()=>{P(l=>l+2)},C=l=>{switch(l==null?void 0:l.toLowerCase()){case"approved":return e(H,{className:"w-4 h-4 text-success"});case"rejected":return e(Ze,{className:"w-4 h-4 text-danger"});default:return e(_,{className:"w-4 h-4 text-warning"})}};return m.useEffect(()=>{P(2);const l=setTimeout(()=>{d()},100);return window.addEventListener("resize",d),()=>{clearTimeout(l),window.removeEventListener("resize",d)}},[h,d]),N.length===0?e(be,{in:!0,timeout:700,children:a(xe,{ref:c,children:[e(we,{title:a("div",{className:"flex items-center gap-4",children:[e("div",{className:"p-3 rounded-xl bg-gradient-to-br from-[rgba(var(--theme-warning-rgb),0.2)] to-[rgba(var(--theme-danger-rgb),0.2)] border border-[rgba(var(--theme-warning-rgb),0.3)] backdrop-blur-sm",children:e(re,{className:"w-6 h-6",style:{color:"var(--theme-warning)"}})}),a("div",{children:[e(o,{variant:"h6",className:"font-bold bg-gradient-to-r from-[var(--theme-warning)] to-[var(--theme-danger)] bg-clip-text text-transparent",style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:"Absent Today"}),a(o,{variant:"body2",color:"textSecondary",className:"flex items-center gap-1",children:[e(O,{className:"w-4 h-4"}),new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]})]}),action:e(me,{label:"0",variant:"flat",color:"success",size:"sm",startContent:e(H,{className:"w-3 h-3"})}),sx:{padding:"24px"}}),e(ie,{}),e(he,{children:a(r,{role:"region","aria-label":"No absent employees today",className:"text-center py-8",children:[e(H,{className:"w-12 h-12 text-success mx-auto mb-3"}),e(o,{variant:"body2",color:"textSecondary",children:"No employees are absent today!"}),e(o,{variant:"caption",color:"textSecondary",className:"mt-1",children:"All employees are either present or on approved leave."})]})})]})}):e(be,{in:!0,timeout:700,children:a(xe,{ref:c,children:[e(we,{title:a("div",{className:"flex items-center gap-4",children:[e("div",{className:"p-3 rounded-xl bg-gradient-to-br from-[rgba(var(--theme-warning-rgb),0.2)] to-[rgba(var(--theme-danger-rgb),0.2)] border border-[rgba(var(--theme-warning-rgb),0.3)] backdrop-blur-sm",children:e(re,{className:"w-6 h-6",style:{color:"var(--theme-warning)"}})}),"                            ",a("div",{children:[e(o,{variant:"h6",className:"font-bold bg-gradient-to-r from-[var(--theme-warning)] to-[var(--theme-danger)] bg-clip-text text-transparent",style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:"Absent Today"}),a(o,{variant:"body2",color:"textSecondary",className:"flex items-center gap-1",style:{fontFamily:"var(--font-current)",transition:"all var(--transition)"},children:[e(O,{className:"w-4 h-4"}),new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]})]}),action:e(me,{label:N.length,variant:"flat",color:"warning",size:"sm",startContent:e(R,{className:"w-3 h-3"})}),sx:{padding:"24px"}}),"                ",e(ie,{}),a(he,{children:[e(r,{className:"mb-4",children:e(ce,{size:"sm",placeholder:"Search absent employees...",value:x,onChange:B,startContent:e(se,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",input:"text-sm"},"aria-label":"Search absent employees"})}),x&&e(r,{className:"mb-3",children:a(o,{variant:"caption",color:"textSecondary",className:"text-xs",children:[h.length," of ",N.length," employees found"]})}),x&&h.length===0&&a(r,{className:"text-center py-8 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg mb-4",children:[e(se,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),a(o,{variant:"body2",color:"textSecondary",className:"text-sm",children:['No employees found matching "',x,'"']})]}),a(r,{role:"region","aria-label":"Absent employees list",children:[h.slice(0,S).map((l,w)=>{var $,A;const p=X(l.id),D=w===0?L:null;return e(Xe,{in:w<S,timeout:"auto",unmountOnExit:!0,children:e("div",{ref:D,className:"mb-3 p-3 bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all duration-200 rounded-lg",children:a(r,{className:"flex items-start justify-between",children:[a(r,{className:"flex items-center gap-3 flex-1",children:[e(Qe,{src:l.profile_image,alt:l.name,size:"sm",fallback:e(de,{className:"w-4 h-4"})}),a(r,{children:[e(o,{variant:"body2",fontWeight:"medium",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:l.name}),p?a(r,{className:"flex flex-col gap-1 mt-1",children:[a(o,{variant:"caption",color:"textSecondary",className:"flex items-center gap-1",children:[e(O,{className:"w-3 h-3"}),p.from_date===p.to_date?p.from_date:`${p.from_date} - ${p.to_date}`]}),a(o,{variant:"caption",color:"primary",className:"flex items-center gap-1",children:[C(p.status),p.leave_type," Leave"]})]}):a(o,{variant:"caption",color:"error",className:"flex items-center gap-1 mt-1",children:[e(R,{className:"w-3 h-3"}),"Absent without leave"]})]})]}),p&&e("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg px-2 py-1",children:a("div",{className:"flex items-center gap-1",children:[C(p.status),e(o,{variant:"caption",className:`font-semibold ${(($=p.status)==null?void 0:$.toLowerCase())==="approved"?"text-green-600":((A=p.status)==null?void 0:A.toLowerCase())==="rejected"?"text-red-600":"text-orange-600"}`,children:p.status})]})})]})})},l.id)}),"                        ",S<h.length&&a(r,{className:"text-center mt-3",children:["                        ",a(qe,{variant:"outlined",onClick:u,startIcon:e(Je,{className:"w-4 h-4"}),size:"small",className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 text-sm",children:["Show More (",h.length-S," remaining)"]})]})]})]})]})})});export{zt as default};
