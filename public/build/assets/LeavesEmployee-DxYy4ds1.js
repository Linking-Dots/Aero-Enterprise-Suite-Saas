import{V as I,j as n,a,M as w,F as B}from"./app-D6ekk2dC.js";import{r as t,e as O,h as k,a as o,G as c,T as l,B as i,D as N,t as U}from"./vendor-DG6x5ItM.js";import{G as C,A as Y}from"./App-BSF3OwYC.js";import{L as z}from"./LeaveEmployeeTable-Drvwbbqp.js";import{s as H,l as K}from"./chunk-7JXO3E7I-C9Z5ESTt.js";import"./Edit-C7Y0JyE7.js";import"./chunk-F3UDT23P-SgOzUwUO.js";import"./chunk-MZRCPRP2-BCOSl0Xy.js";import"./chunk-SLABUSGS-Bdszw1Td.js";import"./chunk-7F3ZLNJ6-DcgTPguD.js";import"./chunk-YHY32LNM-BYWXEAzA.js";import"./chunk-CSXHODZI-C_VbwtXi.js";import"./chunk-R6AK6OQ4-sLn0XnWH.js";import"./chunk-2BFF5KFD-wfZH1LLj.js";import"./chunk-4EXC76WE-D65K3Xw3.js";const R=({title:d,allUsers:D})=>{const{auth:L}=I().props,[P,h]=t.useState(!1),[g,_]=t.useState([]),[v,S]=t.useState({leaveTypes:[],leaveCountsByUser:{}}),[p,f]=t.useState({page:1,perPage:30,total:0,lastPage:0}),[m,F]=t.useState({employee:"",year:new Date().getFullYear()}),T=t.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(r,s)=>1900+s).reverse()},[]),j=t.useCallback((e,r)=>{console.log(e,r),F(s=>({...s,[e]:r})),e==="year"&&f(s=>({...s,page:1}))},[]),y=t.useCallback((e,r=null)=>{setOpenModalType(e),setDeleteLeaveId(r)},[]);t.useCallback(()=>{setOpenModalType(null),setDeleteLeaveId(null)},[]);const x=t.useCallback(async()=>{h(!0);try{const{page:e,perPage:r}=p,{employee:s,year:A}=m,b=await axios.get(route("leaves.paginate"),{params:{page:e,perPage:r,employee:s,year:A}});if(b.status===200){const{leaves:u,leavesData:E}=b.data;_(u.data),S(E),f(G=>({...G,total:u.total,lastPage:u.last_page}))}}catch(e){console.error("Fetch leaves error",e)}finally{h(!1)}},[p.page,p.perPage,m]);t.useEffect(()=>{x()},[x]);const M=v.leaveCountsByUser[L.user.id]||[];return n(B,{children:[a(w,{title:d}),a(i,{display:"flex",justifyContent:"center",p:2,children:a(O,{in:!0,children:n(C,{children:[a(k,{title:"Leaves",sx:{p:3}}),a(o,{children:a(c,{container:!0,spacing:2,alignItems:"center",children:a(c,{item:!0,xs:12,sm:6,md:4,children:a(H,{label:"Year",variant:"bordered",selectedKeys:[String(m.year)],onChange:e=>j("year",Number(e)),popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:T.map(e=>a(K,{value:e,children:String(e)},e))})})})}),a(o,{children:a(c,{container:!0,spacing:2,children:v.leaveTypes.map(({type:e})=>{const r=M.find(s=>s.leave_type===e)||{};return a(c,{item:!0,xs:12,sm:6,md:3,children:a(C,{children:n(o,{sx:{textAlign:"center"},children:[a(l,{variant:"h6",sx:{mb:2,fontSize:["1rem","1.25rem","1.5rem"]},children:e}),n(i,{display:"flex",justifyContent:"center",alignItems:"center",children:[n(i,{children:[a(l,{variant:"subtitle2",children:"Used"}),a(l,{variant:"h4",children:r.days_used||0})]}),a(N,{orientation:"vertical",flexItem:!0,sx:{mx:2}}),n(i,{children:[a(l,{variant:"subtitle2",children:"Remaining"}),a(l,{variant:"h4",children:r.remaining_days||0})]})]})]})})},e)})})}),a(o,{children:P?n(i,{textAlign:"center",py:4,children:[a(U,{}),a(l,{mt:2,children:"Loading leaves..."})]}):g.length>0?a(z,{leaves:g,allUsers:D,onDelete:e=>y("delete",e),onEdit:e=>y("edit",e.id)}):a(l,{align:"center",children:"No leaves found."})})]})})})]})};R.layout=d=>a(Y,{children:d});export{R as default};
