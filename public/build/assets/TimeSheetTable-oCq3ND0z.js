import{V as se,a as e,j as a,F as Me,c as Le}from"./app-COej-qut.js";import{r,u as Re,t as re,G as S,e as ne,g as le,B as s,T as g,a6 as Ae,a7 as De,c as Fe,a8 as Y,a as V,x as oe,a9 as Ee,f as Ue}from"./vendor-jz9Knmfr.js";import{d as T,F as p,G as ce,e as ie,f as je}from"./App-Bh__gnbe.js";import{d as K}from"./dayjs.min-BXV5SrPP.js";import{F as Q,a as P,b as Ie}from"./XCircleIcon-BPTISfSS.js";import{R as ze}from"./Refresh-DkRA1sbe.js";import{c as me,s as Pe,F as We}from"./CheckCircleIcon-De7pdHqa.js";import{s as Be}from"./chunk-4EXC76WE-C1zfbgpY.js";import{a as He}from"./chunk-A6PX3NG3-Be0FpWxR.js";import{i as Z}from"./chunk-HJTJQZF3-Dx-8I7IT.js";import{t as Ge,a as Oe,b as Ye,c as Ve,d as Ke,e as _}from"./chunk-F3UDT23P-B9Bbk0MH.js";import{p as Qe}from"./chunk-YHY32LNM-BVFuFTPV.js";import{u as Ze}from"./chunk-R6AK6OQ4-srYMT2VM.js";import"./chunk-2BFF5KFD-Dt7Cw_Z_.js";import"./chunk-SLABUSGS-yLyu-M1S.js";import"./chunk-M3MASYO7-BSa8BdOI.js";import"./chunk-MZRCPRP2-CkCeC-Il.js";import"./chunk-7F3ZLNJ6-CJy-mc9r.js";function qe({title:x,titleId:i,...y},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":i},y),x?r.createElement("title",{id:i},x):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Je=r.forwardRef(qe);function Xe({title:x,titleId:i,...y},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":i},y),x?r.createElement("title",{id:i},x):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const et=r.forwardRef(Xe),tt=x=>{if(!Array.isArray(x))return[];const i=x.reduce((n,l)=>{var h;const d=(h=l.user)==null?void 0:h.id;return d&&(n[d]||(n[d]={id:l.id,user_id:l.user.id,user:l.user,date:l.date,punches:[]}),n[d].punches.push({punch_in:l.punchin_time,punch_out:l.punchout_time||null,id:l.id,date:l.date})),n},{});return Object.values(i).map(n=>{if(n.punches.length===0)return{...n,punchin_time:null,punchout_time:null,total_work_minutes:0,punch_count:0,complete_punches:0,has_incomplete_punch:!1};n.punches.sort((c,f)=>{if(!c.punch_in)return 1;if(!f.punch_in)return-1;const u=new Date(`${c.date}T${c.punch_in}`),w=new Date(`${f.date}T${f.punch_in}`);return u-w});const l=n.punches[0],d=n.punches.filter(c=>c.punch_out);let h=null;d.length>0&&(d.sort((c,f)=>{const u=new Date(`${c.date}T${c.punch_out}`);return new Date(`${f.date}T${f.punch_out}`)-u}),h=d[0]);let R=0,A=0,D=!1;return n.punches.forEach(c=>{if(c.punch_in&&c.punch_out){const f=c.date.split("T")[0],u=new Date(`${f}T${c.punch_in}`),w=new Date(`${f}T${c.punch_out}`);if(!isNaN(u.getTime())&&!isNaN(w.getTime())){const $=w-u;$>0&&(R+=$/(1e3*60),A++)}}else c.punch_in&&!c.punch_out&&(D=!0)}),{...n,punchin_time:(l==null?void 0:l.punch_in)||null,punchout_time:(h==null?void 0:h.punch_out)||null,total_work_minutes:Math.round(R*100)/100,punch_count:n.punches.length,complete_punches:A,has_incomplete_punch:D,first_punch_date:(l==null?void 0:l.date)||n.date,last_punch_date:(h==null?void 0:h.date)||n.date}})},bt=({handleDateChange:x,selectedDate:i,updateTimeSheet:y})=>{const{auth:n}=se().props,{url:l}=se(),d=Re(),h=re("(min-width: 1025px)"),R=re("(min-width: 641px) and (max-width: 1024px)"),[A,D]=r.useState([]),[c,f]=r.useState([]),[u,w]=r.useState([]),[$,q]=r.useState(""),[ue,de]=r.useState(0),[he,pe]=r.useState(0),[F,at]=r.useState(10),[M,fe]=r.useState(1),[L,xe]=r.useState(""),[J,W]=r.useState(!1),[ge,_e]=r.useState(0),[C,we]=r.useState({currentMonth:K().format("YYYY-MM")}),[E,B]=r.useState(2),H=r.useRef(null),G=r.useRef(null),X=async(t,m,o,N,v,te=!1)=>{var k,j,I,ae;const O=l!=="/attendance-employee"?route("getAllUsersAttendanceForDate"):route("getCurrentUserAttendanceForDate");try{W(!1);const b=await Le.get(O,{params:{page:m,perPage:o,employee:N,date:t,currentYear:v.currentMonth?K(v.currentMonth).year():"",currentMonth:v.currentMonth?K(v.currentMonth).format("MM"):"",_t:te?Date.now():void 0}});if(console.log("Raw attendance data:",b.data.attendances),b.status===200){const z=tt(b.data.attendances);console.log("Processed attendance data:",z),D(z),f(b.data.leaves),w(b.data.absent_users),de(z.length),pe(Math.ceil(z.length/o)),q(""),W(!0)}}catch(b){q(((j=(k=b.response)==null?void 0:k.data)==null?void 0:j.message)||"An error occurred while retrieving attendance data."),w(((ae=(I=b.response)==null?void 0:I.data)==null?void 0:ae.absent_users)||[]),W(!0)}},Ne=r.useCallback(()=>{_e(t=>t+1),X(i,M,F,L,C,!0)},[i,M,F,L,C]),U=r.useCallback(()=>{if(H.current&&G.current){const t=H.current.clientHeight,m=G.current.clientHeight,o=t-150,N=Math.max(1,Math.floor(o/m));B(N)}},[]);r.useEffect(()=>{B(2);const t=setTimeout(()=>{U()},100);return window.addEventListener("resize",U),()=>{clearTimeout(t),window.removeEventListener("resize",U)}},[u,y,U]),r.useEffect(()=>{X(i,M,F,L,C)},[i,M,F,L,C,y,ge]);const be=t=>{xe(t.target.value.toLowerCase())},ye=t=>{fe(t)},ve=r.useCallback((t,m)=>{we(o=>({...o,[t]:m}))},[]),Se=()=>{B(t=>t+2)},Ce=t=>c.find(m=>String(m.user_id)===String(t)),ee=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return e(We,{className:"w-4 h-4 text-success"});case"rejected":return e(Ie,{className:"w-4 h-4 text-danger"});default:return e(p,{className:"w-4 h-4 text-warning"})}},ke=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}},Te=[{name:"Date",uid:"date",icon:T},...n.roles.includes("Administrator")&&l!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:Q}]:[],{name:"Clock In",uid:"clockin_time",icon:p},{name:"Clock Out",uid:"clockout_time",icon:p},{name:"Work Hours",uid:"production_time",icon:p},{name:"Punches",uid:"punch_details",icon:p}],$e=(t,m)=>{var o,N,v;switch(m){case"date":return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(T,{className:"w-4 h-4 text-primary"}),a(s,{className:"flex flex-col",children:[e("span",{children:new Date(t.first_punch_date||t.date).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})}),t.last_punch_date&&t.last_punch_date!==t.first_punch_date&&a("span",{className:"text-xs text-default-500",children:["to ",new Date(t.last_punch_date).toLocaleString("en-US",{month:"short",day:"numeric"})]})]})]})});case"employee":return e(_,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base",children:e(Ze,{avatarProps:{radius:"lg",size:h||R?"md":"sm",src:(o=t.user)==null?void 0:o.profile_image,fallback:e(Q,{className:"w-6 h-6"})},description:(N=t.user)==null?void 0:N.phone,name:(v=t.user)==null?void 0:v.name})});case"clockin_time":return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(p,{className:"w-4 h-4 text-success"}),a(s,{className:"flex flex-col",children:[e("span",{children:t.punchin_time?new Date(`2024-06-04T${t.punchin_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Not clocked in"}),t.punchin_time&&e("span",{className:"text-xs text-default-500",children:"First punch"})]})]})});case"clockout_time":return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(p,{className:"w-4 h-4 text-danger"}),a(s,{className:"flex flex-col",children:[e("span",{children:t.punchout_time?new Date(`2024-06-04T${t.punchout_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t.punchin_time?"Still working":"Not started"}),t.punchout_time&&e("span",{className:"text-xs text-default-500",children:"Last punch"})]})]})});case"production_time":const O=t.total_work_minutes>0,k=t.has_incomplete_punch;if(O){const j=Math.floor(t.total_work_minutes/60),I=Math.floor(t.total_work_minutes%60);return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(p,{className:`w-4 h-4 ${k?"text-warning":"text-primary"}`}),a(s,{className:"flex flex-col",children:[e("span",{className:"font-medium",children:`${j}h ${I}m`}),e("span",{className:"text-xs text-default-500",children:k?"Partial + In Progress":"Total worked"})]})]})})}else if(k||t.punchin_time&&!t.punchout_time)return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(p,{className:"w-4 h-4 text-warning"}),a(s,{className:"flex flex-col",children:[e("span",{className:"text-warning",children:"In Progress"}),e("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(P,{className:"w-4 h-4 text-warning"}),a(s,{className:"flex flex-col",children:[e("span",{className:"text-warning",children:"No work time"}),e("span",{className:"text-xs text-default-500",children:"Incomplete punches"})]})]})});case"punch_details":return e(_,{className:"text-xs sm:text-sm md:text-base",children:a(s,{className:"flex items-center gap-2",children:[e(p,{className:"w-4 h-4 text-default-400"}),a(s,{className:"flex flex-col",children:[a("span",{className:"text-xs font-medium",children:[t.punch_count||0," punch",(t.punch_count||0)!==1?"es":""]}),t.complete_punches!==t.punch_count&&a("span",{className:"text-xs text-warning",children:[t.complete_punches," complete"]}),t.complete_punches===t.punch_count&&t.punch_count>0&&e("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e(_,{className:"text-xs sm:text-sm md:text-base",children:"N/A"})}};return e(s,{sx:{display:"flex",justifyContent:"center",p:2},component:"main",role:"main","aria-label":"Timesheet Management",children:a(S,{container:!0,spacing:2,children:[e(S,{item:!0,xs:12,md:l!=="/attendance-employee"?9:12,children:e(ne,{in:!0,timeout:500,children:a(ce,{children:[e(le,{title:a(s,{className:"flex items-center gap-3",children:[e(p,{className:"w-6 h-6 text-primary"}),e(g,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:l==="/attendance-employee"?`Timesheet - ${new Date(C.currentMonth).toLocaleString("en-US",{month:"long",year:"numeric"})}`:`Daily Timesheet - ${new Date(i).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}`})]}),action:e(Ae,{direction:"row",spacing:1,children:e(De,{title:"Refresh Timesheet",children:e(Fe,{onClick:Ne,disabled:!J,sx:{background:Y(d.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${Y(d.palette.primary.main,.2)}`,"&:hover":{background:Y(d.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(ze,{color:"primary"})})})}),sx:{padding:"24px"}}),e(ie,{}),e(V,{children:e(s,{component:"section",role:"search","aria-label":"Timesheet filters",children:a(S,{container:!0,spacing:3,children:[n.roles.includes("Administrator")&&l!=="/attendance-employee"&&a(Me,{children:[e(S,{item:!0,xs:12,sm:6,md:4,children:e(Z,{label:"Search Employee",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Enter employee name...",value:L,onChange:be,startContent:e(et,{className:"w-4 h-4 text-default-400"}),"aria-label":"Search employees"})}),e(S,{item:!0,xs:12,sm:6,md:4,children:e(Z,{label:"Select Date",type:"date",variant:"bordered",onChange:x,value:new Date(i).toISOString().slice(0,10)||"",startContent:e(T,{className:"w-4 h-4 text-default-400"}),"aria-label":"Select date for timesheet"})})]}),n.roles.includes("Employee")&&l==="/attendance-employee"&&e(S,{item:!0,xs:12,sm:6,md:4,children:e(Z,{label:"Select Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Select month...",value:C.currentMonth,onChange:t=>ve("currentMonth",t.target.value),startContent:e(T,{className:"w-4 h-4 text-default-400"}),"aria-label":"Select month for timesheet"})})]})})}),e(V,{children:$?e(me,{className:"p-4 bg-danger-50 border-danger-200",children:a(s,{className:"flex items-center gap-3",children:[e(P,{className:"w-5 h-5 text-danger"}),e(g,{color:"error",variant:"body1",children:$})]})}):a(s,{sx:{maxHeight:"70vh"},role:"region","aria-label":"Attendance data table",children:[e(Be,{orientation:"horizontal",className:"overflow-y-hidden",children:e(Pe,{className:"rounded-lg",isLoaded:J,children:a(Ge,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,children:[e(Oe,{columns:Te,children:t=>e(Ye,{align:"start",children:a(s,{className:"flex items-center gap-2",children:[t.icon&&e(t.icon,{className:"w-4 h-4"}),e("span",{children:t.name})]})},t.uid)}),e(Ve,{items:A,emptyContent:a(s,{className:"flex flex-col items-center justify-center py-8",children:[e(p,{className:"w-12 h-12 text-default-300 mb-4"}),e(g,{variant:"body1",color:"textSecondary",children:"No attendance records found"})]}),children:t=>e(Ke,{children:m=>$e(t,m)},t.user_id)})]})})}),ue>10&&e(s,{className:"py-4 flex justify-center",children:e(Qe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:M,total:he,onChange:ye,"aria-label":"Timesheet pagination"})})]})})]})})}),n.roles.includes("Administrator")&&l!=="/attendance-employee"&&u.length>0&&e(S,{item:!0,xs:12,md:3,children:e(ne,{in:!0,timeout:700,children:a(ce,{ref:H,children:[e(le,{title:a(s,{className:"flex items-center justify-between",children:[a(s,{className:"flex items-center gap-2",children:[e(je,{className:"w-5 h-5 text-warning"}),e(g,{variant:"h6",component:"h2",sx:{fontSize:{xs:"1rem",sm:"1.1rem",md:"1.2rem"},fontWeight:600},children:"Absent Today"})]}),e(oe,{label:u.length,variant:"flat",color:"warning",size:"sm",startContent:e(P,{className:"w-3 h-3"})})]}),subheader:a(g,{variant:"body2",color:"textSecondary",className:"flex items-center gap-1",children:[e(T,{className:"w-4 h-4"}),new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})}),e(ie,{}),e(V,{children:a(s,{role:"region","aria-label":"Absent employees list",children:[u.slice(0,E).map((t,m)=>{const o=Ce(t.id),N=m===0?G:null;return e(Ee,{in:m<E,timeout:"auto",unmountOnExit:!0,children:e(me,{ref:N,className:"mb-3 p-3 bg-default-50 border-default-200",shadow:"sm",children:a(s,{className:"flex items-start justify-between",children:[a(s,{className:"flex items-center gap-3 flex-1",children:[e(He,{src:t.profile_image,alt:t.name,size:"sm",fallback:e(Q,{className:"w-4 h-4"})}),a(s,{children:[e(g,{variant:"body2",fontWeight:"medium",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:t.name}),o?a(s,{className:"flex flex-col gap-1 mt-1",children:[a(g,{variant:"caption",color:"textSecondary",className:"flex items-center gap-1",children:[e(T,{className:"w-3 h-3"}),o.from_date===o.to_date?o.from_date:`${o.from_date} - ${o.to_date}`]}),a(g,{variant:"caption",color:"primary",className:"flex items-center gap-1",children:[ee(o.status),o.leave_type," Leave"]})]}):a(g,{variant:"caption",color:"error",className:"flex items-center gap-1 mt-1",children:[e(P,{className:"w-3 h-3"}),"Absent without leave"]})]})]}),o&&e(oe,{label:o.status,variant:"flat",color:ke(o.status),size:"sm",startContent:ee(o.status)})]})})},t.id)}),E<u.length&&e(s,{className:"text-center mt-3",children:a(Ue,{variant:"outlined",onClick:Se,startIcon:e(Je,{className:"w-4 h-4"}),size:"small",children:["Show More (",u.length-E," remaining)"]})})]})})]})})})]})})};export{bt as default};
