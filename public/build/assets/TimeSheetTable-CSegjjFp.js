import{q as R,a as e,j as s,G as F,F as I}from"./app-BD7xXmcj.js";import{u as L,r as a,G as o,g as j,T as c,a as z,B as m,e as de,h as D,i as ue,f as he}from"./vendor-PiFfO_u0.js";import{d as U}from"./dayjs.min-XSZEkWQE.js";import{d as pe,p as xe}from"./Search-N71rQrGG.js";import{a as ge,u as fe}from"./chunk-TLBGAR4N-CHgrCcIA.js";import{i as N}from"./chunk-IR2E3HZF-Df9wInMJ.js";import{s as Se}from"./App-CBeTnX2b.js";import{t as ye,a as _e,b as be,c as ve,d as we,e as d}from"./chunk-YRZGWF2W-DP_wcOXX.js";const Ce=({handleDateChange:G,selectedDate:p})=>{const{auth:g}=R().props,{url:u}=R();L("(max-width: 640px)");const O=L("(min-width: 641px) and (max-width: 1024px)"),Y=L("(min-width: 1025px)"),[B,V]=a.useState([]),[W,q]=a.useState([]),[f,P]=a.useState([]),[E,Q]=a.useState(""),[J,K]=a.useState(0),[X,Z]=a.useState(0),[k,Me]=a.useState(10),[_,ee]=a.useState(1),[b,te]=a.useState(""),[v,re]=a.useState({currentMonth:U().format("YYYY-MM")}),ne=t=>{const n=t.target.value.toLowerCase();te(n)},[w,H]=a.useState(2),C=a.useRef(null),M=a.useRef(null),A=()=>{if(C.current&&M.current){const t=C.current.clientHeight,n=M.current.clientHeight,r=t-150,h=Math.floor(r/n);H(h)}},ae=()=>{H(t=>t+2)},se=t=>W.find(n=>String(n.user_id)===String(t)),ie=async(t,n,r,h,l)=>{var S,T,x,y;const $=u!=="/attendance-employee"?route("getAllUsersAttendanceForDate"):route("getCurrentUserAttendanceForDate");try{const i=await axios.get($,{params:{page:n,perPage:r,employee:h,date:t,currentYear:l.currentMonth?U(l.currentMonth).year():"",currentMonth:l.currentMonth?U(l.currentMonth).format("MM"):""}});i.status===200&&(V(i.data.attendances),q(i.data.leaves),P(i.data.absent_users),K(i.data.total),Z(i.data.last_page))}catch(i){console.error("Error fetching attendance data:",i),Q(((T=(S=i.response)==null?void 0:S.data)==null?void 0:T.message)||"An error occurred while retrieving attendance data."),P((y=(x=i.response)==null?void 0:x.data)==null?void 0:y.absent_users)}},oe=(t,n)=>{var r,h,l;switch(n){case"date":return e(d,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:new Date(t.date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})});case"employee":return e(d,{className:"whitespace-nowrap text-xs sm:text-sm md:text-base lg:text-lg",children:e(fe,{avatarProps:{radius:"lg",size:Y||O?"md":"sm",src:(r=t.user)==null?void 0:r.profile_image},description:(h=t.user)==null?void 0:h.phone,name:(l=t.user)==null?void 0:l.name})});case"clockin_time":return e(d,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:t.punchin_time?new Date(`2024-06-04T${t.punchin_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"});case"clockout_time":return e(d,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:t.punchout_time?new Date(`2024-06-04T${t.punchout_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"});case"production_time":if(t.punchin_time&&t.punchout_time){const S=new Date(`2024-06-04T${t.punchin_time}`),x=new Date(`2024-06-04T${t.punchout_time}`)-S,y=Math.floor(x/(1e3*60*60)),i=Math.floor(x%(1e3*60*60)/(1e3*60));return e(d,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:`${y}h ${i}m`})}return e(d,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:"N/A"});default:return e(d,{className:"text-xs sm:text-sm md:text-base lg:text-lg",children:"N/A"})}},le=[{name:"Date",uid:"date"},...g.roles.includes("Administrator")&&u!=="/attendance-employee"?[{name:"Employee",uid:"employee"}]:[],{name:"Clockin Time",uid:"clockin_time"},{name:"Clockout Time",uid:"clockout_time"},{name:"Production Time",uid:"production_time"}],ce=t=>{ee(t)},me=a.useCallback((t,n)=>{re(r=>({...r,[t]:n}))},[]);return a.useEffect(()=>(setTimeout(()=>{A()},500),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)),[]),a.useEffect(()=>{ie(p,_,k,b,v)},[p,_,k,b,v]),e(m,{sx:{display:"flex",justifyContent:"center",p:2},children:s(o,{container:!0,spacing:2,children:[e(o,{item:!0,xs:12,md:u!=="/attendance-employee"?9:12,children:s(F,{children:[e(j,{title:e(c,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:"Timesheet of "+p.toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}),sx:{padding:"24px"}}),e(z,{children:e(m,{children:s(o,{container:!0,spacing:2,children:[g.roles.includes("Administrator")&&u!=="/attendance-employee"&&s(I,{children:[e(o,{item:!0,xs:12,sm:6,md:4,children:e(N,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:b,onChange:ne,endContent:e(pe,{})})}),e(o,{item:!0,xs:12,sm:6,md:4,children:e(N,{label:"Select Date",type:"date",variant:"bordered",onChange:G,value:new Date(p).toISOString().slice(0,10)||""})})]}),g.roles.includes("Employee")&&u==="/attendance-employee"&&e(o,{item:!0,xs:12,sm:6,md:4,children:e(N,{label:"Current Month",type:"month",fullWidth:!0,variant:"bordered",placeholder:"Month...",value:v.currentMonth,onChange:t=>me("currentMonth",t.target.value)})})]})})}),e(z,{children:E?e(c,{color:"error",children:E}):s("div",{style:{maxHeight:"84vh"},children:[e(Se,{orientation:"horizontal",className:"overflow-y-hidden",children:s(ye,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Attendance Table",isHeaderSticky:!0,children:[e(_e,{columns:le,children:t=>e(be,{align:"start",children:t.name},t.uid)}),e(ve,{items:B,children:t=>e(we,{children:n=>oe(t,n)},t.id)})]})}),J>=10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(xe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:_,total:X,onChange:ce})})]})})]})}),g.roles.includes("Administrator")&&u!=="/attendance-employee"&&f.length>0&&e(o,{item:!0,xs:12,md:3,children:e(de,{in:!0,children:s(F,{ref:C,children:[e(j,{title:s(m,{sx:{display:"flex",alignItems:"center"},children:[e(c,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:"Absent on "+p.toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e(D,{sx:{ml:1,fontSize:{xs:"0.8rem",sm:"1.1rem",md:"1.4rem"}},label:f.length,variant:"outlined",color:"error",size:"small"})]})}),e(z,{children:s(m,{children:[f.slice(0,w).map((t,n)=>{const r=se(t.id);return e(ue,{in:n<w,timeout:"auto",unmountOnExit:!0,children:e(m,{ref:M,sx:{mb:2,p:2,border:"1px solid #e0e0e0",borderRadius:2},children:s(o,{container:!0,alignItems:"center",children:[e(o,{item:!0,xs:12,children:s(m,{sx:{display:"flex",alignItems:"center"},children:[e(ge,{src:t.profile_image,alt:t.name}),e(c,{sx:{m:2,fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:t.name})]})}),r?s(I,{children:[s(o,{item:!0,xs:6,children:[e(c,{sx:{fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:r.from_date===r.to_date?r.from_date:`${r.from_date} to ${r.to_date}`}),e(c,{sx:{fontSize:{xs:"0.8rem",sm:"1.0rem",md:"1.2rem"}},color:"textSecondary",children:"On "+r.leave_type+" Leave"})]}),e(o,{item:!0,xs:6,sx:{textAlign:"right"},children:e(D,{label:r.status,variant:"outlined",color:r.status==="Pending"?"error":"success",size:"small"})})]}):e(o,{item:!0,xs:12,children:e(c,{color:"error",sx:{fontSize:{xs:"1.0rem",sm:"1.2rem",md:"1.4rem"}},children:"Absent without Leave"})})]})})},n)}),w<f.length&&e(m,{textAlign:"center",children:e(he,{variant:"outlined",onClick:ae,children:"Load More"})})]})})]})})})]})})},ke=Ce;export{ke as T};
