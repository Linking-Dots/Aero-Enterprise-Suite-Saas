import{V as fe,c as ge,a as e,j as r,F as we}from"./app-CLXqCRon.js";import{r as u,u as xe,t as $,x as p,c as E,B as s,w as be,T as c,v as ye,R as Ne,a as _e}from"./vendor-qGV-i6la.js";import{B as ve,g as Y,h as J,i as X,j as K,k as ee,m as j,F as N,n as C,b as ae,o as te,d as re,a as se,G as Ce}from"./App--FXJDFZg.js";import{F as Se,a as Fe,b as Re}from"./XCircleIcon-IZp_bSJ6.js";import{F as ne}from"./TrashIcon-CLrHPpyS.js";import{F as oe}from"./EllipsisVerticalIcon-Cko5T4G9.js";import{F as M}from"./UserIcon-miehdqhJ.js";import{e as f,t as ke,a as De,b as Le,c as ze,d as $e}from"./chunk-F3UDT23P-DdDqWApK.js";import{t as ie}from"./chunk-CSXHODZI-Dt55el8S.js";import{u as ce}from"./chunk-R6AK6OQ4-B1U5Rh8G.js";import{p as le}from"./chunk-YHY32LNM-DYEG5Tav.js";function Ee({title:w,titleId:_,...x},b){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":_},x),w?u.createElement("title",{id:_},w):null,u.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z",clipRule:"evenodd"}))}const je=u.forwardRef(Ee),qe=({leaves:w,allUsers:_,handleClickOpen:x,setCurrentLeave:b,openModal:S,setLeaves:T,setCurrentPage:I,currentPage:A,totalRows:B,lastPage:P,perPage:U,selectedMonth:Me,employee:W})=>{const{auth:G}=fe().props,o=xe(),F=$("(min-width: 1025px)"),de=$("(min-width: 641px) and (max-width: 1024px)"),me=$("(max-width: 640px)"),[y,H]=u.useState(!1),l=G.roles.includes("Administrator"),R=G.roles.includes("Supervision Engineer"),m={New:{color:"primary",icon:Se,bgColor:p(o.palette.primary.main,.1),textColor:o.palette.primary.main},Pending:{color:"warning",icon:je,bgColor:p(o.palette.warning.main,.1),textColor:o.palette.warning.main},Approved:{color:"success",icon:Fe,bgColor:p(o.palette.success.main,.1),textColor:o.palette.success.main},Declined:{color:"danger",icon:Re,bgColor:p(o.palette.error.main,.1),textColor:o.palette.error.main}},V=u.useCallback(a=>{I(a)},[I]),k=u.useCallback(async(a,t)=>{if(y)return;H(!0);const n=new Promise(async(i,d)=>{var h,v,Q;try{const g=await ge.post(route("leave-update-status"),{id:a.id,status:t});g.status===200&&(T(L=>L.map(z=>z.id===a.id?{...z,status:t}:z)),i(g.data.message||"Leave status updated successfully"))}catch(g){const L=((v=(h=g.response)==null?void 0:h.data)==null?void 0:v.message)||((Q=g.response)==null?void 0:Q.statusText)||"Failed to update leave status";d(L),console.error(g)}finally{H(!1)}});ve.promise(n,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"})},[T,y]),Z=a=>{const t=m[a]||m.New,n=t.icon;return e(te,{size:"sm",variant:"flat",color:t.color,startContent:e(n,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:a})},q=(a,t)=>{const n=new Date(a),i=new Date(t),d=Math.abs(i-n),h=Math.ceil(d/(1e3*60*60*24))+1;return h===1?"1 day":`${h} days`},D=a=>new Date(a).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),O=a=>_.find(t=>String(t.id)===String(a)),he=({leave:a})=>{const t=O(a.user_id),n=q(a.from_date,a.to_date);return m[a.status]||m.New,e(Ce,{className:"mb-3",shadow:"sm",children:r(_e,{className:"p-4",children:[r(s,{className:"flex items-start justify-between mb-3",children:[e(s,{className:"flex items-center gap-3 flex-1",children:l&&e(ce,{avatarProps:{radius:"lg",size:"sm",src:t==null?void 0:t.profile_image,fallback:e(M,{className:"w-4 h-4"})},name:e(c,{variant:"body2",fontWeight:"medium",children:t==null?void 0:t.name}),description:e(c,{variant:"caption",color:"textSecondary",children:t==null?void 0:t.phone})})}),r(s,{className:"flex items-center gap-2",children:[Z(a.status),l&&r(J,{children:[e(X,{children:e(E,{size:"small",children:e(oe,{className:"w-4 h-4"})})}),r(ee,{"aria-label":"Leave actions",children:[e(j,{startContent:e(Y,{className:"w-4 h-4"}),onPress:()=>{b(a),S("edit_leave")},children:"Edit Leave"},"edit"),e(j,{className:"text-danger",color:"danger",startContent:e(ne,{className:"w-4 h-4"}),onPress:()=>x(a.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(re,{className:"my-3"}),r(ye,{spacing:2,children:[r(s,{className:"flex items-center gap-2",children:[e(C,{className:"w-4 h-4 text-primary"}),e(c,{variant:"body2",fontWeight:"medium",children:a.leave_type})]}),r(s,{className:"flex items-center gap-2",children:[e(N,{className:"w-4 h-4 text-default-500"}),r(c,{variant:"body2",color:"textSecondary",children:[D(a.from_date)," - ",D(a.to_date)]}),e(te,{size:"sm",variant:"bordered",color:"default",children:n})]}),a.reason&&r(s,{className:"flex items-start gap-2",children:[e(se,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(c,{variant:"body2",color:"textSecondary",className:"flex-1",children:a.reason})]})]}),l&&(R||l)&&r(we,{children:[e(re,{className:"my-3"}),e(s,{className:"flex gap-2",children:["Approved","Declined"].map(i=>e(K,{size:"sm",variant:a.status===i?"solid":"bordered",color:m[i].color,isLoading:y,onPress:()=>k(a,i),startContent:Ne.createElement(m[i].icon,{className:"w-3 h-3"}),classNames:{base:"flex-1"},children:i},i))})]})]})})},pe=u.useCallback((a,t)=>{const n=O(a.user_id);switch(t){case"employee":return e(f,{className:"whitespace-nowrap",children:e(ce,{avatarProps:{radius:"lg",size:F?"md":"sm",src:n==null?void 0:n.profile_image,fallback:e(M,{className:"w-6 h-6"})},description:n==null?void 0:n.phone,name:n==null?void 0:n.name})});case"leave_type":return e(f,{children:r(s,{className:"flex items-center gap-2",children:[e(C,{className:"w-4 h-4 text-primary"}),e(c,{variant:"body2",fontWeight:"medium",children:a.leave_type})]})});case"from_date":case"to_date":return e(f,{children:r(s,{className:"flex items-center gap-2",children:[e(N,{className:"w-4 h-4 text-default-500"}),r(s,{className:"flex flex-col",children:[e(c,{variant:"body2",children:D(a[t])}),t==="from_date"&&e(c,{variant:"caption",color:"textSecondary",children:q(a.from_date,a.to_date)})]})]})});case"status":return e(f,{children:r(s,{className:"flex items-center gap-2",children:[Z(a.status),l&&(R||l)&&r(J,{children:[e(X,{children:e(K,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:y,children:e(oe,{className:"w-4 h-4"})})}),e(ee,{"aria-label":"Status actions",onAction:d=>k(a,d),children:Object.keys(m).map(d=>{const h=m[d],v=h.icon;return e(j,{startContent:e(v,{className:"w-4 h-4"}),color:h.color,children:d},d)})})]})]})});case"reason":return e(f,{children:e(be,{title:a.reason||"No reason provided",children:e(c,{variant:"body2",className:"max-w-xs truncate cursor-help",color:"textSecondary",children:a.reason||"No reason provided"})})});case"actions":return e(f,{children:r(s,{className:"flex items-center gap-1",children:[e(ie,{content:"Edit Leave",children:e(E,{size:"small",onClick:()=>{b(a),S("edit_leave")},sx:{background:p(o.palette.primary.main,.1),"&:hover":{background:p(o.palette.primary.main,.2)}},children:e(Y,{className:"w-4 h-4"})})}),e(ie,{content:"Delete Leave",color:"danger",children:e(E,{size:"small",onClick:()=>x(a.id,"delete_leave"),sx:{background:p(o.palette.error.main,.1),"&:hover":{background:p(o.palette.error.main,.2)}},children:e(ne,{className:"w-4 h-4"})})})]})});default:return e(f,{children:a[t]})}},[l,R,F,y,o,b,S,x,k]),ue=[...l?[{name:"Employee",uid:"employee",icon:M}]:[],{name:"Leave Type",uid:"leave_type",icon:C},{name:"From Date",uid:"from_date",icon:N},{name:"To Date",uid:"to_date",icon:N},{name:"Status",uid:"status",icon:se},{name:"Reason",uid:"reason",icon:C},...l?[{name:"Actions",uid:"actions"}]:[]];return me?r(s,{className:"space-y-4",children:[e(ae,{className:"max-h-[70vh]",children:w.map(a=>e(he,{leave:a},a.id))}),B>U&&e(s,{className:"flex justify-center pt-4",children:e(le,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:A,total:P,onChange:V,size:"sm"})})]}):r(s,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(ae,{className:"max-h-[70vh]",children:r(ke,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!F,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[222px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e(De,{columns:ue,children:a=>e(Le,{align:a.uid==="actions"?"center":"start",className:"bg-default-100/50 backdrop-blur-md",children:r(s,{className:"flex items-center gap-2",children:[a.icon&&e(a.icon,{className:"w-4 h-4"}),e("span",{children:a.name})]})},a.uid)}),e(ze,{items:w,emptyContent:r(s,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(N,{className:"w-12 h-12 text-default-300 mb-4"}),e(c,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(c,{variant:"body2",color:"textSecondary",children:W?`No leaves found for "${W}"`:"No leave requests for the selected period"})]}),children:a=>e($e,{children:t=>pe(a,t)},a.id)})]})}),B>U&&e(s,{className:"py-4 flex justify-center",children:e(le,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:A,total:P,onChange:V,size:de?"sm":"md"})})]})};export{qe as L};
