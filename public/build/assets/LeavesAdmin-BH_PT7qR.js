import{V as ne,j as s,a as e,F as G,M as me}from"./app-nmz8ZRqA.js";import{u as ie,r as t,W as de,T as V,c as ge,G as m,F as ae,k as te,S as re,M as $,U as se,b as W,B as K,X as ye,Y as ce,Z as ue,t as ee,$ as be,f as Q,e as fe,h as ve,a as oe}from"./vendor-DG6x5ItM.js";import{d as Ce}from"./Search-D3wPn0WQ.js";import{B as pe,G as xe,A as De}from"./App-eZICUyyH.js";import{L as Se}from"./LeaveEmployeeTable-DDEiSNyT.js";import{d as ke,G as he}from"./GlassDialog-CQvg03j8.js";import{L as Te}from"./LoadingButton-D7xyitX5.js";import{d as Pe}from"./dayjs.min-DoTx5zCQ.js";import{A as _e}from"./Add-BAkyKogE.js";import{i as le}from"./chunk-HJTJQZF3-PP66oLqA.js";import"./Edit-C7Y0JyE7.js";import"./chunk-F3UDT23P-BZStXzFK.js";import"./chunk-MZRCPRP2-BiXwXOjo.js";import"./chunk-SLABUSGS-WPx9rJ87.js";import"./chunk-7F3ZLNJ6-DcgTPguD.js";import"./chunk-YHY32LNM-B_9I4P5O.js";import"./chunk-CSXHODZI-oYpNj16q.js";import"./chunk-7JXO3E7I-C4z-s8du.js";import"./chunk-2BFF5KFD-D0xR2nZQ.js";import"./chunk-4EXC76WE-C3tyfT1o.js";import"./chunk-R6AK6OQ4-i1CaP15N.js";const we=({open:v,closeModal:g,leavesData:p,setLeavesData:C,currentLeave:a,allUsers:x,setTotalRows:F,setLastPage:c,setLeaves:D,handleMonthChange:u,employee:X})=>{const{auth:A}=ne().props,o=ie(),[S,Z]=t.useState((a==null?void 0:a.user_id)||A.user.id),[y,k]=t.useState(p.leaveTypes||[]),[I,T]=t.useState(p.leaveCounts||[]),[P,B]=t.useState((a==null?void 0:a.leave_type)||(y.length>0?y[0].type:"")),[_,E]=t.useState((a==null?void 0:a.from_date)||""),[R,z]=t.useState((a==null?void 0:a.to_date)||""),[U,Y]=t.useState((a==null?void 0:a.no_of_days)||""),[j,N]=t.useState(""),[O,J]=t.useState((a==null?void 0:a.reason)||""),[n,q]=t.useState({}),[H,i]=t.useState(!1),[L,b]=t.useState("");return t.useEffect(()=>{p&&(k(p.leaveTypes||[]),T(p.leaveCountsByUser[S]||[]))},[p,S]),t.useEffect(()=>{var h;const r=((h=I==null?void 0:I.find(d=>d.leave_type===P))==null?void 0:h.days_used)||0;b(r);const w=y==null?void 0:y.find(d=>d.type===P);w&&N(w.days-r)},[P,I,y]),t.useEffect(()=>{Y(((w,h)=>{if(!w||!h)return"";const d=new Date(w),l=new Date(h);if(d>l)return"";const f=l.getTime()-d.getTime();return Math.ceil(f/(1e3*3600*24))+1})(_,R))},[_,R]),s(he,{open:v,onClose:g,fullWidth:!0,maxWidth:"sm",children:[s(de,{sx:{display:"flex",alignItems:"center"},children:[e(V,{variant:"h6",children:"Add Leave"}),e(ge,{onClick:g,sx:{position:"absolute",top:8,right:16},children:e(ke,{})})]}),s("form",{onSubmit:async r=>{r.preventDefault(),i(!0);const w=new Promise(async(h,d)=>{try{const l={route:route().current(),user_id:S,leaveType:P,fromDate:_,toDate:R,daysCount:U,leaveReason:O,employee:X};a&&(l.id=a.id);const f=await axios.post(route("leave-add"),l);f.status===200&&(C(f.data.leavesData),F(f.data.leavesData.leaveRecords.total),c(f.data.leavesData.leaveRecords.last_page),D(f.data.leavesData.leaveRecords.data),u({target:{value:_.slice(0,7)}}),g(),h([f.data.message||"Leave application submitted successfully"]))}catch(l){console.error(l),i(!1),l.response?(l.response.status===422?(q(l.response.data.errors||{}),d(l.response.data.error||"Failed to submit leave application")):d("An unexpected error occurred. Please try again later."),console.error(l.response.data.error)):l.request?(d("No response received from the server. Please check your internet connection."),console.error(l.request)):(d("An error occurred while setting up the request."),console.error("Error",l.message))}finally{i(!1)}});pe.promise(w,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(ee,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:h}){return e(G,{children:h.map((d,l)=>e("div",{children:d},l))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:h}){return e(G,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(ce,{children:s(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,md:6,children:s(ae,{fullWidth:!0,children:[e(te,{id:"leave-type-label",children:"Leave Type"}),s(re,{labelId:"leave-type-label",value:P,onChange:r=>B(r.target.value),label:"Leave Type",error:!!n.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e($,{value:"",disabled:!0,children:"Select Leave Type"}),y.map(r=>s($,{value:r.type,children:[r.type," ",r.days," Days"]},r.id))]}),e(se,{children:n.leaveType})]})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"From",type:"date",fullWidth:!0,value:_,onChange:r=>E(r.target.value),InputLabelProps:{shrink:!0},error:!!n.fromDate,helperText:n.fromDate})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"To",type:"date",fullWidth:!0,value:R,onChange:r=>z(r.target.value),InputLabelProps:{shrink:!0},error:!!n.toDate,helperText:n.toDate})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"Number of days",type:"text",fullWidth:!0,value:U,InputProps:{readOnly:!0},error:!!n.daysCount,helperText:n.daysCount})}),e(m,{item:!0,xs:12,md:6,children:e(W,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:j,InputProps:{readOnly:!0},error:!!n.remainingLeaves,helperText:n.remainingLeaves})}),A.roles.includes("Administrator")&&route().current()==="leaves"&&e(m,{item:!0,xs:12,md:6,children:s(ae,{fullWidth:!0,children:[e(te,{id:"leave-employee-label",children:"Employee"}),s(re,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:S||"na",error:!!n.user_id,onChange:r=>Z(r.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:o.glassCard.backgroundColor,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e($,{value:"na",disabled:!0,children:"Please select"}),x.map(r=>e($,{value:r.id,children:s(K,{sx:{display:"flex"},children:[e(ye,{src:r.profile_image,alt:r.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),r.name]})},r.id))]}),e(se,{children:n.user_id})]})}),e(m,{item:!0,xs:12,children:e(W,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:O,onChange:r=>J(r.target.value),error:!!n.leaveReason,helperText:n.leaveReason})})]})}),e(ue,{sx:{padding:"16px",justifyContent:"center"},children:e(Te,{type:"submit",variant:"outlined",color:"primary",loading:H,disabled:H,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Fe=({open:v,handleClose:g,leaveIdToDelete:p,setLeavesData:C})=>{const a=ie();return s(he,{open:v,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(de,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(ce,{children:e(be,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),s(ue,{children:[e(Q,{onClick:g,color:"primary",children:"Cancel"}),e(Q,{onClick:()=>{const F=new Promise(async(c,D)=>{try{const u=await axios.delete(route("leave-delete",{id:p,route:route().current()}));u.status===200&&(C(u.data.leavesData),c("Leave application deleted successfully"))}catch(u){console.error("Error deleting task:",u),D(u.response.data.error||"Failed to delete leave application")}finally{g()}});pe.promise(F,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(ee,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},success:{render({data:c}){return e(G,{children:c})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}},error:{render({data:c}){return e(G,{children:c})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:a.glassCard.backgroundColor,border:a.glassCard.border,color:a.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ie=({title:v,allUsers:g})=>{ne();const[p,C]=t.useState(!1),[a,x]=t.useState(null),[F,c]=t.useState([]),[D,u]=t.useState(),[X,A]=t.useState(0),[o,S]=t.useState(0),[Z,y]=t.useState(null),[k,I]=t.useState(""),[T,P]=t.useState(Pe().format("YYYY-MM")),[B,_]=t.useState(30),[E,R]=t.useState(1),[z,U]=t.useState(),[Y,j]=t.useState(""),N=i=>x(i),O=t.useCallback((i,L)=>{y(i),x(L)},[]),J=t.useCallback(()=>{x(null),y(null)},[]),n=i=>I(i.target.value.toLowerCase()),q=i=>{P(i.target.value)},H=async()=>{var i,L;try{const b=await axios.get(route("leaves.paginate"),{params:{page:E,perPage:B,employee:k,month:T}});if(b.status===200){const{leaves:M,leavesData:r}=b.data;u(M.data),c(r),A(M.total),S(M.last_page),j(!1),C(!1)}}catch(b){if(console.error("Error fetching leaves data:",b.response),b.response.status===404){const{leavesData:M}=response.data;c(M),j(((L=(i=b.response)==null?void 0:i.data)==null?void 0:L.message)||"Error retrieving data.")}u(!1),C(!1)}};return t.useEffect(()=>{C(!0),H()},[T,E,B,k]),console.log(F),s(G,{children:[e(me,{title:v}),["add_leave","edit_leave"].includes(a)&&e(we,{setTotalRows:A,setLastPage:S,setLeaves:u,perPage:B,employee:k,currentPage:E,selectedMonth:T,allUsers:g,open:!0,setLeavesData:c,closeModal:()=>x(null),leavesData:F,currentLeave:a==="edit_leave"?z:null,handleMonthChange:q}),a==="delete_leave"&&e(Fe,{open:!0,handleClose:J,leaveIdToDelete:Z,setLeavesData:c}),e(K,{sx:{display:"flex",justifyContent:"center",p:2},children:e(fe,{in:!0,children:s(xe,{children:[e(ve,{title:"Leaves",sx:{padding:"24px"},action:e(Q,{title:"Add Leave",variant:"outlined",color:"success",startIcon:e(_e,{}),onClick:()=>N("add_leave"),children:"Add Leave"})}),e(oe,{children:s(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,sm:6,md:4,children:e(le,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:k,onChange:n,endContent:e(Ce,{})})}),e(m,{item:!0,xs:12,sm:6,md:4,children:e(le,{label:"Select Month",type:"month",variant:"bordered",onChange:q,value:T,isLoading:p})})]})}),e(oe,{children:p?s(K,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:[e(ee,{sx:{p:1}}),e(V,{variant:"body1",align:"center",children:"Loading leaves data..."})]}):D&&D.length>0?e(Se,{totalRows:X,lastPage:o,setCurrentPage:R,setPerPage:_,perPage:B,currentPage:E,handleClickOpen:O,setCurrentLeave:U,openModal:N,leaves:D,allUsers:g,setLeaves:u,employee:k,selectedMonth:T}):Y?e(V,{variant:"body1",align:"center",children:Y}):e(V,{variant:"body1",align:"center",children:"No leaves data found."})})]})})})]})};Ie.layout=v=>e(De,{children:v});export{Ie as default};
