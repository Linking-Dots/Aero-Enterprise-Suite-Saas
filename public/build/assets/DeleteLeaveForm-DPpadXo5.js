import{V as se,j as o,a as e,F as P}from"./app-DvzcsS5J.js";import{r as d,u as Z,t as $,X as oe,T as pe,c as me,G as _,F as K,k as Q,S as ee,M as H,V as te,b as N,B as he,Y as ge,Z as le,$ as ne,a0 as ye,f as re}from"./vendor-DrHmFQFl.js";import{B as J}from"./App-BhpBsmfq.js";import{E as be,D as fe}from"./Edit-CtMoSlB4.js";import{l as xe,s as Ce}from"./chunk-QEQ4EHOG-Cnv3QZd2.js";import{t as ve,b as _e,a as De,d as ke,e as Se,c as Te}from"./chunk-YRZGWF2W-wyJ6pehp.js";import{p as we}from"./chunk-MRXO6UUP-Dq6wPGLS.js";import{t as ae}from"./chunk-KQ7OR4H5-Dz8xZID-.js";import{u as Fe}from"./chunk-TLBGAR4N-z-9EDjwd.js";import{d as Pe,G as ie}from"./GlassDialog-DpQAAim6.js";import{L as Ee}from"./LoadingButton-CUeR6bzk.js";var Be={name:"inyrtd",styles:"width:110px"};const je=({leaves:w,allUsers:y,handleClickOpen:h,setCurrentLeave:E,openModal:r,setLeaves:M,setCurrentPage:B,currentPage:g,totalRows:I,lastPage:b,perPage:U,selectedMonth:l,employee:F})=>{console.log(w);const{auth:L}=se().props,[f,V]=d.useState(null),x=Z(),A=L.roles.includes("Administrator");L.roles.includes("Supervision Engineer");const D=t=>B(t),j=()=>V(null),k=async(t,p)=>{j(),await O(t,"status",p)},O=async(t,p,v)=>{const n=new Promise(async(a,R)=>{try{const c=await axios.post(route("leave-add"),{page:g,perPage:U,employee:F,month:l,route:route().current(),user_id:t.user_id,id:t.id,leaveType:t.leave_type,fromDate:t.from_date,toDate:t.to_date,daysCount:t.no_of_days,leaveReason:t.reason,[p]:v});c.status===200&&(M(S=>S.map(G=>G.id===t.id?{...G,[p]:v}:G)),a([c.data.message||"Leave status updated successfully"]))}catch(c){const S=c.response?c.response.status===422?c.response.statusText||"Failed to update leave status":"An unexpected error occurred. Please try again later.":c.request?"No response received from the server. Please check your internet connection.":"An error occurred while setting up the request.";R(S),console.error(c)}});J.promise(n,{pending:{render:()=>o("div",{style:{display:"flex",alignItems:"center"},children:[e($,{}),e("span",{style:{marginLeft:"8px"},children:"Updating leave status..."})]}),icon:!1,style:C(x)},success:{render:({data:a})=>e(P,{children:a.map((R,c)=>e("div",{children:R},c))}),icon:"ðŸŸ¢",style:C(x)},error:{render:({data:a})=>e(P,{children:a}),icon:"ðŸ”´",style:C(x)}})},C=t=>({backdropFilter:"blur(16px) saturate(200%)",backgroundColor:t.glassCard.backgroundColor,border:t.glassCard.border,color:t.palette.text.primary}),Y=t=>({New:"primary",Pending:"secondary",Approved:"success",Declined:"danger"})[t]||"primary",q=(t,p)=>{const v=t[p];switch(p){case"employee":const n=y.find(a=>String(a.id)===String(t.user_id));return e(Fe,{avatarProps:{radius:"lg",src:n==null?void 0:n.profile_image},description:n==null?void 0:n.phone,name:n==null?void 0:n.name,children:n==null?void 0:n.email});case"from_date":case"to_date":return new Date(v).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"});case"status":return e(Ce,{isDisabled:!A&&route().current()!=="leaves","aria-label":"Leave Status",color:Y(t.status),placeholder:"Select status",size:"sm",selectedKeys:[t.status],onChange:a=>k(t,a.target.value),css:Be,children:["New","Pending","Approved","Declined"].map(a=>e(xe,{value:a,children:a},a))});case"actions":return o("div",{className:"relative flex items-center gap-2",children:[e(ae,{content:"Edit Leave",children:e("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>{E(t),r("edit_leave")},children:e(be,{})})}),e(ae,{content:"Delete Leave",color:"danger",children:e("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>h(t.id,"delete_leave"),children:e(fe,{})})})]});default:return v}},z=[...A?[{name:"Employee",uid:"employee"}]:[],{name:"Leave Type",uid:"leave_type"},{name:"From Date",uid:"from_date"},{name:"To Date",uid:"to_date"},{name:"Status",uid:"status"},{name:"Reason",uid:"reason"},...A?[{name:"Actions",uid:"actions"}]:[]];return o("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[o(ve,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Employee Table",children:[e(De,{columns:z,children:t=>e(_e,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(Te,{items:w,children:t=>e(ke,{children:p=>e(Se,{style:{whiteSpace:"nowrap"},children:q(t,p)})},t.id)})]}),I>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(we,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:g,total:b,onChange:D})})]})},Oe=({open:w,closeModal:y,leavesData:h,setLeavesData:E,currentLeave:r,allUsers:M,setTotalRows:B,setLastPage:g,setLeaves:I,handleMonthChange:b})=>{console.log(h);const{auth:U}=se().props,l=Z(),[F,L]=d.useState((r==null?void 0:r.user_id)||U.user.id),[f,V]=d.useState(h.leaveTypes||[]),[x,A]=d.useState([]),[D,j]=d.useState((r==null?void 0:r.leave_type)||(f.length>0?f[0].type:"")),[k,O]=d.useState((r==null?void 0:r.from_date)||""),[C,Y]=d.useState((r==null?void 0:r.to_date)||""),[q,z]=d.useState((r==null?void 0:r.no_of_days)||""),[t,p]=d.useState(""),[v,n]=d.useState((r==null?void 0:r.reason)||""),[a,R]=d.useState({}),[c,S]=d.useState(!1),[G,de]=d.useState("");return d.useEffect(()=>{h&&(V(h.leaveTypes||[]),A(h.leaveCountsByUser[F]||[]))},[h,F]),d.useEffect(()=>{var m;const s=((m=x==null?void 0:x.find(u=>u.leave_type===D))==null?void 0:m.days_used)||0;de(s);const T=f==null?void 0:f.find(u=>u.type===D);T&&p(T.days-s)},[D,x,f]),d.useEffect(()=>{z(((T,m)=>{if(!T||!m)return"";const u=new Date(T),i=new Date(m);if(u>i)return"";const W=i.getTime()-u.getTime();return Math.ceil(W/(1e3*3600*24))+1})(k,C))},[k,C]),o(ie,{open:w,onClose:y,fullWidth:!0,maxWidth:"sm",children:[o(oe,{sx:{display:"flex",alignItems:"center"},children:[e(pe,{variant:"h6",children:"Add Leave"}),e(me,{onClick:y,sx:{position:"absolute",top:8,right:16},children:e(Pe,{})})]}),o("form",{onSubmit:async s=>{s.preventDefault(),S(!0);const T=new Promise(async(m,u)=>{try{const i={route:route().current(),user_id:F,leaveType:D,fromDate:k,toDate:C,daysCount:q,leaveReason:v};r&&(i.id=r.id);const W=await axios.post(route("leave-add"),i);if(W.status===200){const{data:X,total:ce,last_page:ue}=W.data.leaves;E(X.leavesData),B(ce),g(ue),I(X),m([W.data.message||"Leave application submitted successfully"]),b({target:{value:k.slice(0,7)}}),y()}}catch(i){S(!1),i.response?(i.response.status===422?(R(i.response.data.errors||{}),u(i.response.statusText||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(i.response)):i.request?(u("No response received from the server. Please check your internet connection."),console.error(i.request)):(u("An error occurred while setting up the request."),console.error("Error",i.message))}finally{S(!1)}});J.promise(T,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e($,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},success:{render({data:m}){return e(P,{children:m.map((u,i)=>e("div",{children:u},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}},error:{render({data:m}){return e(P,{children:m})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,color:l.palette.text.primary}}})},children:[e(le,{children:o(_,{container:!0,spacing:2,children:[e(_,{item:!0,xs:12,md:6,children:o(K,{fullWidth:!0,children:[e(Q,{id:"leave-type-label",children:"Leave Type"}),o(ee,{labelId:"leave-type-label",value:D,onChange:s=>j(s.target.value),label:"Leave Type",error:!!a.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(H,{value:"",disabled:!0,children:"Select Leave Type"}),f.map(s=>o(H,{value:s.type,children:[s.type," ",s.days," Days"]},s.id))]}),e(te,{children:a.leaveType})]})}),e(_,{item:!0,xs:12,md:6,children:e(N,{label:"From",type:"date",fullWidth:!0,value:k,onChange:s=>O(s.target.value),InputLabelProps:{shrink:!0},error:!!a.fromDate,helperText:a.fromDate})}),e(_,{item:!0,xs:12,md:6,children:e(N,{label:"To",type:"date",fullWidth:!0,value:C,onChange:s=>Y(s.target.value),InputLabelProps:{shrink:!0},error:!!a.toDate,helperText:a.toDate})}),e(_,{item:!0,xs:12,md:6,children:e(N,{label:"Number of days",type:"text",fullWidth:!0,value:q,InputProps:{readOnly:!0},error:!!a.daysCount,helperText:a.daysCount})}),e(_,{item:!0,xs:12,md:6,children:e(N,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:t,InputProps:{readOnly:!0},error:!!a.remainingLeaves,helperText:a.remainingLeaves})}),U.roles.includes("Administrator")&&route().current()==="leaves"&&e(_,{item:!0,xs:12,md:6,children:o(K,{fullWidth:!0,children:[e(Q,{id:"leave-employee-label",children:"Employee"}),o(ee,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:F||"na",error:!!a.user_id,onChange:s=>L(s.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:l.glassCard.backgroundColor,border:l.glassCard.border,borderRadius:2,boxShadow:l.glassCard.boxShadow}}},children:[e(H,{value:"na",disabled:!0,children:"Please select"}),M.map(s=>e(H,{value:s.id,children:o(he,{sx:{display:"flex"},children:[e(ge,{src:s.profile_image,alt:s.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),s.name]})},s.id))]}),e(te,{children:a.user_id})]})}),e(_,{item:!0,xs:12,children:e(N,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:v,onChange:s=>n(s.target.value),error:!!a.leaveReason,helperText:a.leaveReason})})]})}),e(ne,{sx:{padding:"16px",justifyContent:"center"},children:e(Ee,{type:"submit",variant:"outlined",color:"primary",loading:c,disabled:c,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ye=({open:w,handleClose:y,leaveIdToDelete:h,setLeavesData:E})=>{const r=Z();return o(ie,{open:w,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(oe,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(le,{children:e(ye,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(ne,{children:[e(re,{onClick:y,color:"primary",children:"Cancel"}),e(re,{onClick:()=>{const B=new Promise(async(g,I)=>{try{const b=await axios.delete(route("leave-delete",{id:h,route:route().current()}));b.status===200&&(E(b.data.leavesData),g("Leave application deleted successfully"))}catch(b){console.error("Error deleting task:",b),I(b.response.data.error||"Failed to delete leave application")}finally{y()}});J.promise(B,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e($,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:g}){return e(P,{children:g})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:g}){return e(P,{children:g})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{Ye as D,Oe as L,je as a};
