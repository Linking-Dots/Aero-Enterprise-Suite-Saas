import{J as de,r,a as J,b as n,j as a,Q as me,h as pe,c as x,e as C,f as ue,F as he,d as ge}from"./app-ICdw8XZW.js";import{d as ve}from"./dayjs.min-CTpDfE_v.js";import{u as fe,a as V,n as be,B as ye,e as we,o as P,b as I,T as u,G as _e,A as Ne}from"./App-xKIEJnfh.js";import{P as xe}from"./PageHeader-C-n7yLRm.js";import{L as W,D as Ce,a as Pe}from"./DeleteLeaveForm-DgDORNbC.js";import{C as Me}from"./CircularProgress-CRTMx9g5.js";import{F as Se}from"./XCircleIcon-Bl2Ah-1J.js";import{F as Le}from"./PlusIcon-DdUPUHsP.js";import{F as ke}from"./PresentationChartLineIcon-COlu8bjC.js";import{s as Fe,l as Ye}from"./chunk-2GIFKCNQ-r13Ot1aH.js";import{c as De}from"./chunk-D5XJWRAV-ChYyTb80.js";import"./app-CA3O2NZp.js";import"./PencilIcon-BoMELbc6.js";import"./TrashIcon-6Qn0Ks3i.js";import"./CardContent-DGIH-NyB.js";import"./colorManipulator-BO-pWekM.js";import"./chunk-F3UDT23P-Dzih6ugh.js";import"./chunk-MZRCPRP2-CuDTLPCF.js";import"./LiveAnnouncer-QpWtHmnK.js";import"./useHasTabbableChild-C1gNMPSd.js";import"./chunk-7F3ZLNJ6-bb6GUB3a.js";import"./chunk-7ZZXWEXF-UZIMEnKN.js";import"./chunk-R6AK6OQ4-e2LNdSxP.js";import"./chunk-O5I3QTYU-JuO97IC0.js";import"./index-CokAva9Y.js";import"./Clear-lJ20lSRj.js";import"./GlassDialog-DtkSQAnW.js";import"./DialogContent-C99NR7Vt.js";import"./DialogTitle-FtEY60tO.js";import"./InputLabel-l_RaM-SP.js";import"./Select-CqGdc7ri.js";import"./Popover-Cy1RIh6q.js";import"./List-96IwU692.js";import"./MenuItem-Cz-a5JZM.js";import"./listItemTextClasses-CGb7pYu3.js";import"./dividerClasses-lSRERl2-.js";import"./TextField-gRWRJFLH.js";import"./Avatar-BWjKMW06.js";import"./useSlot-BsD0OkWG.js";import"./LoadingButton-BMZNmXEn.js";import"./Button-ePhGwwaI.js";import"./DialogContentText-nbEfY0qG.js";import"./chunk-2PG5BJX6-BKh2F0Oz.js";const Re=({title:T,allUsers:A})=>{const{auth:f}=de().props,U=fe(),b=V(U.breakpoints.down("sm")),X=V(U.breakpoints.down("md")),[v,M]=r.useState(0),[B,S]=r.useState(0),[L,E]=r.useState(!1),[O,h]=r.useState([]),[y,N]=r.useState({leaveTypes:[],leaveCountsByUser:{}}),[G,$]=r.useState(""),[o,j]=r.useState({page:1,perPage:30,total:0,lastPage:0}),[d,Z]=r.useState({employee:"",selectedMonth:ve().format("YYYY-MM"),year:new Date().getFullYear()}),c=r.useCallback(e=>{e&&(M(e.total||0),S(e.last_page||1),j(t=>({...t,total:e.total||0,lastPage:e.last_page||1})))},[]),w=r.useCallback(async()=>{var e,t,s;E(!0);try{const{page:l,perPage:i}=o,{year:p}=d;console.log("Fetching leaves for user:",f.user.id,"with year:",p);const R=await J.get(route("leaves.paginate"),{params:{page:l,perPage:i,year:p,user_id:f.user.id},timeout:1e4});if(R.status===200){const{leaves:g,leavesData:ce}=R.data;g.data&&Array.isArray(g.data)?(h(g.data),c({total:g.total||g.data.length,last_page:g.last_page||1,current_page:g.current_page||1,per_page:g.per_page||o.perPage})):Array.isArray(g)?(h(g),c({total:g.length,last_page:1,current_page:1,per_page:o.perPage})):(console.error("Unexpected leaves data format:",g),h([]),c({total:0,last_page:1,current_page:1,per_page:o.perPage})),N(ce),$(""),E(!1)}}catch(l){if(console.error("Error fetching leaves:",l),((e=l.response)==null?void 0:e.status)===404){const{leavesData:i}=l.response.data;N(i),$(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||"No leaves found for the selected criteria.")}else $("Error retrieving leaves data. Please try again."),be.error("Failed to load leave data. Please try again.");h([]),c({total:0,last_page:1,current_page:1,per_page:o.perPage})}finally{E(!1)}},[o.page,o.perPage,d,f.user.id,c]),k=r.useCallback((e,t,s)=>{const{page:l,perPage:i}=o;e.length>=i||l<B||w()},[o,B,w]),K=r.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(t,s)=>{const l=1900+s;return{key:l.toString(),label:l.toString(),value:l}}).reverse()},[]),Q=r.useCallback((e,t)=>{if(e==="year"){const s=Number(t);if(s<1900||s>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}Z(s=>({...s,[e]:t})),e==="year"&&j(s=>({...s,page:1}))},[]),[_,F]=r.useState({add_leave:!1,edit_leave:!1,delete_leave:!1});r.useCallback((e,t=null)=>{F(s=>({...s,[e]:!0}))},[]);const z=r.useCallback(()=>{F({add_leave:!1,edit_leave:!1,delete_leave:!1})},[]),q=r.useCallback(e=>{F(t=>({...t,[e]:!0}))},[]),ee=r.useCallback((e,t)=>{H({id:e}),F(s=>({...s,[t]:!0}))},[]),[Y,H]=r.useState(null),ae=r.useCallback(e=>{H(e)},[]),m=r.useCallback(async()=>{try{const e=await J.get(route("leaves.stats"),{params:{year:d.year}});if(e.status===200){const{stats:t,leaveCounts:s}=e.data;s&&N(l=>({...l,leaveCountsByUser:{...l.leaveCountsByUser,[f.user.id]:s}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[d.year,f.user.id]),te=r.useCallback(e=>{e!==o.page&&j(t=>({...t,page:e}))},[o.page]);r.useEffect(()=>{w()},[w]),r.useEffect(()=>{m()},[m]);const re=r.useMemo(()=>y.leaveCountsByUser[f.user.id]||[],[y.leaveCountsByUser,f.user.id]),D=r.useCallback(e=>[...e].sort((t,s)=>new Date(t.from_date)-new Date(s.from_date)),[]),se=r.useCallback(e=>{new Date(e.from_date).getFullYear()===d.year&&(h(l=>{const i=[...l,e];return D(i)}),c({total:v+1,last_page:Math.ceil((v+1)/o.perPage),current_page:o.page,per_page:o.perPage}),m())},[D,d.year,m,v,o,c]),le=r.useCallback(e=>{if(!(new Date(e.from_date).getFullYear()===d.year)){h(l=>{const i=l.filter(R=>R.id!==e.id),p=Math.max(0,v-1);return c({total:p,last_page:Math.max(1,Math.ceil(p/o.perPage)),current_page:o.page,per_page:o.perPage}),k(i,p,"update-remove"),i}),m();return}h(l=>{const i=l.map(p=>p.id===e.id?e:p);return D(i)}),m()},[D,d.year,m,v,o,c,k]),oe=r.useCallback(e=>{h(s=>{const l=s.filter(p=>p.id!==e),i=Math.max(0,v-1);return k(l,i,"delete"),l});const t=Math.max(0,v-1);c({total:t,last_page:Math.max(1,Math.ceil(t/o.perPage)),current_page:o.page,per_page:o.perPage}),m()},[m,v,o,c,k]),ne=()=>y.leaveTypes.length?a("div",{className:`grid gap-4 ${b?"grid-cols-1":X?"grid-cols-2":"grid-cols-4"}`,children:y.leaveTypes.map(({type:e})=>{const t=re.find(p=>p.leave_type===e)||{},s=t.days_used||0,l=t.remaining_days||0,i=s+l;return n(x,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[a(De,{className:"pb-2",children:n("div",{className:"flex items-center gap-2",children:[a(P,{className:"w-5 h-5"}),a(u,{variant:b?"subtitle1":"h6",className:"font-semibold truncate",children:e})]})}),a(C,{className:"pt-0",children:n("div",{className:"space-y-3",children:[n("div",{className:"flex justify-between items-center",children:[n("div",{className:"text-center",children:[a(u,{variant:"caption",color:"textSecondary",children:"Used"}),a(u,{variant:b?"h6":"h5",className:"font-bold text-red-400",children:s})]}),a(ge,{orientation:"vertical",className:"h-8"}),n("div",{className:"text-center",children:[a(u,{variant:"caption",color:"textSecondary",children:"Remaining"}),a(u,{variant:b?"h6":"h5",className:"font-bold text-green-400",children:l})]})]}),i>0&&a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${s/i*100}%`}})})]})})]},e)})}):a(x,{className:"bg-white/10 backdrop-blur-md border-white/20",children:n(C,{className:"text-center py-8",children:[a(I,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a(u,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),ie=r.useRef(null);return n(he,{children:[a(me,{title:T}),_.add_leave&&a(W,{open:_.add_leave,closeModal:()=>z(),leavesData:y,setLeavesData:N,currentLeave:null,allUsers:A,setTotalRows:M,setLastPage:S,setLeaves:h,employee:"",selectedMonth:d.selectedMonth,addLeaveOptimized:se,updatePaginationMetadata:c,fetchLeavesStats:m}),_.edit_leave&&a(W,{open:_.edit_leave,closeModal:()=>z(),leavesData:y,setLeavesData:N,currentLeave:Y,allUsers:A,setTotalRows:M,setLastPage:S,setLeaves:h,employee:"",selectedMonth:d.selectedMonth,updateLeaveOptimized:le,updatePaginationMetadata:c,fetchLeavesStats:m}),_.delete_leave&&a(Ce,{open:_.delete_leave,closeModal:()=>z(),leaveId:Y==null?void 0:Y.id,setLeaves:h,setTotalRows:M,setLastPage:S,deleteLeaveOptimized:oe,updatePaginationMetadata:c,fetchLeavesStats:m}),n(ye,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",a(_e,{in:!0,children:a(we,{children:a(xe,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:a(ke,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:a(Le,{className:"w-4 h-4"}),onPress:()=>q("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Current Year",icon:a(P,{className:"w-4 h-4"}),onPress:()=>Q("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:a(ue,{className:"w-4 h-4"}),onPress:w,isDisabled:L,variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:n("div",{className:"p-6",children:[a("div",{className:"mb-6",children:n("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(Fe,{label:"Select Year",variant:"bordered",selectedKeys:[String(d.year)],onSelectionChange:e=>{const t=Array.from(e)[0];t&&Q("year",Number(t))},startContent:a(P,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:b?"sm":"md",children:K.map(e=>a(Ye,{value:e.value,children:e.label},e.key))})}),a("div",{className:"flex gap-2",children:a(pe,{variant:"flat",color:"primary",size:b?"sm":"md",onPress:w,isLoading:L,startContent:!L&&a(I,{className:"w-4 h-4"}),children:"Refresh"})})]})}),n("div",{className:"mb-6",children:[n(u,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(I,{className:"w-5 h-5"}),"Leave Balance Summary"]}),ne()]}),n("div",{className:"min-h-96",children:[n(u,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(P,{className:"w-5 h-5"}),"Leave History"]}),L?a(x,{className:"bg-white/10 backdrop-blur-md border-white/20",children:n(C,{className:"text-center py-12",children:[a(Me,{size:40}),a(u,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):G?a(x,{className:"bg-white/10 backdrop-blur-md border-white/20",children:n(C,{className:"text-center py-12",children:[a(Se,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),a(u,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),a(u,{color:"textSecondary",children:G})]})}):O.length>0?a("div",{className:"overflow-hidden rounded-lg",children:a(Pe,{ref:ie,leaves:O,allUsers:A||[],handleClickOpen:ee,setCurrentLeave:ae,openModal:q,setLeaves:h,setCurrentPage:te,currentPage:o.page,totalRows:v,lastPage:B,perPage:o.perPage,selectedMonth:d.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:m,updatePaginationMetadata:c})}):a(x,{className:"bg-white/10 backdrop-blur-md border-white/20",children:n(C,{className:"text-center py-12",children:[a(P,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),a(u,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),n(u,{color:"textSecondary",children:["You haven't submitted any leave requests for ",d.year,"."]}),"                      "]})})]})]})})})})]})]})};Re.layout=T=>a(Ne,{children:T});export{Re as default};
