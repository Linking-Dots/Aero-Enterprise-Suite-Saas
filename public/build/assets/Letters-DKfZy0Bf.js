import{a as t,V as we,j as H,c as me,M as Le,F as M}from"./app-B4Js-pg6.js";import{r as l,P as Re,_ as Te,w as T,z as fe,A as be,J as ze,u as ve,ad as He,B as O,R as De,g as Ie,e as Ee,h as Fe,c as X,f as ee,a as te,G as re,t as Pe}from"./vendor-DrHmFQFl.js";import{f as Me,D as ae,r as xe,E as je,c as We,b as ne,B as j,G as Be,A as Ae}from"./App-B7NrVYDt.js";import{X as Ne,m as $e,A as Oe}from"./minMax-BlISuaOb.js";import{d as Ye}from"./Delete-C_JDVbha.js";import{l as Ve,U as oe}from"./index-CB4Joyx5.js";import{u as Ge,$ as se,i as ye}from"./chunk-IR2E3HZF-B2ZWZo6V.js";import{c as $}from"./chunk-KBN3H6OQ-mYDre_d8.js";import{l as J,s as U}from"./chunk-QEQ4EHOG-CJzHgFjm.js";import{l as le}from"./chunk-FGDGYNYV-Dck7nUNY.js";import{t as qe}from"./chunk-KQ7OR4H5-DwHksQY5.js";import{u as ie}from"./chunk-TLBGAR4N-BuJF7jF2.js";import{d as Ke}from"./dayjs.min-DVDxNhg-.js";import{d as Xe,p as Je}from"./Search-BDHzLar-.js";import{D as de}from"./Download-Cws1nr6R.js";import"./useFormValidationState-BUfEwBz-.js";import"./useLabel-DI8gw9fr.js";import"./DOMLayoutDelegate-DWvrrFOb.js";import"./chunk-NCVCYSZZ-CINAakwE.js";var Ue=l.useLayoutEffect,Ze=function(n){var o=l.useRef(n);return Ue(function(){o.current=n}),o},ce=function(n,o){if(typeof n=="function"){n(o);return}n.current=o},Qe=function(n,o){var r=l.useRef();return l.useCallback(function(d){n.current=d,r.current&&ce(r.current,null),r.current=o,o&&ce(o,d)},[o])},ue={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},et=function(n){Object.keys(ue).forEach(function(o){n.style.setProperty(o,ue[o],"important")})},pe=et,v=null,he=function(n,o){var r=n.scrollHeight;return o.sizingStyle.boxSizing==="border-box"?r+o.borderSize:r-o.paddingSize};function tt(s,n,o,r){o===void 0&&(o=1),r===void 0&&(r=1/0),v||(v=document.createElement("textarea"),v.setAttribute("tabindex","-1"),v.setAttribute("aria-hidden","true"),pe(v)),v.parentNode===null&&document.body.appendChild(v);var d=s.paddingSize,p=s.borderSize,b=s.sizingStyle,x=b.boxSizing;Object.keys(b).forEach(function(w){var g=w;v.style[g]=b[g]}),pe(v),v.value=n;var m=he(v,s);v.value=n,m=he(v,s),v.value="x";var c=v.scrollHeight-d,h=c*o;x==="border-box"&&(h=h+d+p),m=Math.max(h,m);var y=c*r;return x==="border-box"&&(y=y+d+p),m=Math.min(y,m),[m,c]}var ge=function(){},rt=function(n,o){return n.reduce(function(r,d){return r[d]=o[d],r},{})},at=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],nt=!!document.documentElement.currentStyle,ot=function(n){var o=window.getComputedStyle(n);if(o===null)return null;var r=rt(at,o),d=r.boxSizing;if(d==="")return null;nt&&d==="border-box"&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var p=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),b=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:p,borderSize:b}},st=ot;function Ce(s,n,o){var r=Ze(o);l.useLayoutEffect(function(){var d=function(b){return r.current(b)};if(s)return s.addEventListener(n,d),function(){return s.removeEventListener(n,d)}},[])}var lt=function(n){Ce(window,"resize",n)},it=function(n){Ce(document.fonts,"loadingdone",n)},dt=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],ct=function(n,o){var r=n.cacheMeasurements,d=n.maxRows,p=n.minRows,b=n.onChange,x=b===void 0?ge:b,m=n.onHeightChange,c=m===void 0?ge:m,h=Re(n,dt),y=h.value!==void 0,w=l.useRef(null),g=Qe(w,o),e=l.useRef(0),a=l.useRef(),i=function(){var u=w.current,R=r&&a.current?a.current:st(u);if(R){a.current=R;var S=tt(R,u.value||u.placeholder||"x",p,d),I=S[0],z=S[1];e.current!==I&&(e.current=I,u.style.setProperty("height",I+"px","important"),c(I,{rowHeight:z}))}},C=function(u){y||i(),x(u)};return l.useLayoutEffect(i),lt(i),it(i),l.createElement("textarea",Te({},h,{onChange:C,ref:g}))},ut=l.forwardRef(ct),Se=Me(({style:s,minRows:n=3,maxRows:o=8,cacheMeasurements:r=!1,disableAutosize:d=!1,onHeightChange:p,...b},x)=>{const{Component:m,label:c,description:h,startContent:y,endContent:w,hasHelper:g,shouldLabelBeOutside:e,shouldLabelBeInside:a,isInvalid:i,errorMessage:C,getBaseProps:f,getLabelProps:u,getInputProps:R,getInnerWrapperProps:S,getInputWrapperProps:I,getHelperWrapperProps:z,getDescriptionProps:W,getErrorMessageProps:Y}=Ge({...b,ref:x,isMultiline:!0}),[V,G]=l.useState(n>1),[B,E]=l.useState(!1),P=c?T.jsx("label",{...u(),children:c}):null,F=R(),q=(D,L)=>{if(n===1&&G(D>=L.rowHeight*2),o>n){const A=D>=o*L.rowHeight;E(A)}p==null||p(D,L)},k=d?T.jsx("textarea",{...F,style:se(F.style,s??{})}):T.jsx(ut,{...F,cacheMeasurements:r,"data-hide-scroll":ae(!B),maxRows:o,minRows:n,style:se(F.style,s??{}),onHeightChange:q}),_=l.useMemo(()=>y||w?T.jsxs("div",{...S(),children:[y,k,w]}):T.jsx("div",{...S(),children:k}),[y,F,w,S]);return T.jsxs(m,{...f(),children:[e?P:null,T.jsxs("div",{...I(),"data-has-multiple-rows":ae(V),children:[a?P:null,_]}),g?T.jsx("div",{...z(),children:i&&C?T.jsx("div",{...Y(),children:C}):h?T.jsx("div",{...W(),children:h}):null}):null]})});Se.displayName="NextUI.Textarea";var pt=Se;const ht=()=>t("div",{className:"spinner-container",children:t(Ve.Dots,{animation:"fade",background:"rgba(0, 0, 0, 0.5)",color:"#3498db",size:60})});var Z={},gt=be;Object.defineProperty(Z,"__esModule",{value:!0});var ke=Z.default=void 0,mt=gt(xe()),ft=fe();ke=Z.default=(0,mt.default)((0,ft.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");var Q={},bt=be;Object.defineProperty(Q,"__esModule",{value:!0});var _e=Q.default=void 0,vt=bt(xe()),xt=fe();_e=Q.default=(0,vt.default)((0,xt.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");const yt=ze(Ne)(({theme:s})=>({"& .rdt_Table":{backgroundColor:"transparent","& .rdt_TableHead":{"& .rdt_TableHeadRow":{"& .hZUxNm":{"white-space":"normal"},backgroundColor:"transparent",color:s.palette.text.primary},top:0,zIndex:1},"& .rdt_TableBody":{overflowY:"auto",maxHeight:"52vh","&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none","& .rdt_TableRow":{minHeight:"auto",backgroundColor:"transparent",color:s.palette.text.primary,"& .rdt_TableCol":{backgroundColor:"transparent",borderBottom:`1px solid ${s.palette.divider}`,width:"auto",whiteSpace:"nowrap"}},"& .rdt_TableRow:hover":{backgroundColor:s.palette.action.hover}}}})),Ct=({allData:s,setData:n,users:o,loading:r,handleClickOpen:d,openModal:p,setCurrentRow:b,search:x})=>{const{auth:m}=we().props,c=ve();l.useState(null),m.roles.includes("Administrator"),m.roles.includes("Supervision Engineer");const h=e=>{switch(e){case"Open":return"danger";case"Closed":return"success";case"Processing":return"primary";case"Signed":return"warning";case"Sent":return"success";default:return""}},y=e=>{if(!x)return e;const a=x.split(" ").filter(Boolean),i=new RegExp(`(${a.join("|")})`,"gi");return e.split(i).map((f,u)=>a.some(R=>f.toLowerCase()===R.toLowerCase())?t("span",{style:{backgroundColor:"yellow"},children:f},u):f)},w=[{name:"From",selector:e=>e.from,sortable:!0,center:"true",width:"80px",cell:e=>y(e.from)},{name:"Status",selector:e=>e.status,sortable:!0,center:"true",width:"170px",cell:e=>t(U,{"aria-label":"Status",color:h(e.status),placeholder:"Select Status",value:e.status,onChange:a=>g(e.id,"status",a.target.value),fullWidth:!0,selectedKeys:[e.status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Open","Closed"].map(a=>t(J,{value:e.status,children:a},a))})},{name:"Received Date",selector:e=>e.received_date,sortable:!0,center:"true",width:"160px",cell:e=>t(ye,{variant:"underlined",type:"date",fullWidth:!0,value:e.received_date,onChange:a=>g(e.id,"received_date",a.target.value)})},{name:"Memo Number",selector:e=>e.memo_number,sortable:!0,center:"true",width:"200px",cell:e=>t(le,{isExternal:!0,color:"foreground",isBlock:!0,showAnchorIcon:!0,href:e.letter_link||`/letters/${e.memo_number}.pdf`,anchorIcon:t(_e,{}),children:e.memo_number||"N/A"})},{name:"Subject",selector:e=>e.subject,sortable:!0,left:!0,width:"260px",cell:e=>t(qe,{content:e.subject,placement:"top",showArrow:!0,radius:"md",size:"md",classNames:{content:["bg-transparent backdrop-blur-lg border border-gray-200","max-w-[300px] text-sm"]},children:t(O,{sx:{whiteSpace:"normal",wordWrap:"break-word",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:y(e.subject)})})},{name:"Action Taken",selector:e=>e.action_taken,sortable:!0,left:!0,width:"250px",cell:e=>{const[a,i]=l.useState(e.action_taken||"");return t(pt,{variant:"underlined",size:"sm",radius:"sm",maxRows:2,fullWidth:!0,value:a,onChange:u=>{i(u.target.value)},onBlur:()=>{g(e.id,"action_taken",a)}})}},{name:"Handling Link",selector:e=>e.handling_link,sortable:!0,center:"true",width:"200px",cell:e=>t(le,{isExternal:!0,color:"primary",isBlock:!0,showAnchorIcon:!0,href:e.handling_link||"#",anchorIcon:t(ke,{}),children:e.handling_memo||"N/A"})},{name:"Handling Status",selector:e=>e.handling_status,sortable:!0,center:"true",width:"180px",cell:e=>t(U,{"aria-label":"Handling Status",color:h(e.handling_status),placeholder:"Select Status",value:e.handling_status,onChange:a=>g(e.id,"handling_status",a.target.value),fullWidth:!0,selectedKeys:[e.handling_status],popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:["Processing","Signed","Sent"].map(a=>t(J,{value:e.handling_status,children:a},a))})},{name:"Need Reply",selector:e=>e.need_reply,center:"true",width:"80px",cell:e=>t($,{color:h(e.status),isSelected:e.need_reply,onChange:a=>g(e.id,"need_reply",a.target.checked)})},{name:"Replied Status",selector:e=>e.replied_status,center:"true",width:"80px",cell:e=>t($,{color:h(e.status),isSelected:e.replied_status,onChange:a=>g(e.id,"replied_status",a.target.checked)})},{name:"Need Forward",selector:e=>e.need_forward,center:"true",width:"80px",cell:e=>t($,{color:h(e.status),isSelected:e.need_forward,onChange:a=>g(e.id,"need_forward",a.target.checked)})},{name:"Forwarded Status",selector:e=>e.forwarded_status,center:"true",width:"90px",cell:e=>t($,{color:h(e.status),isSelected:e.forwarded_status,onChange:a=>g(e.id,"forwarded_status",a.target.checked)})},{name:"Dealt By",selector:e=>e.dealt_by,sortable:!0,center:"true",cell:e=>t(U,{items:o,variant:"underlined","aria-label":"Dealt By",fullWidth:!0,value:e.dealt_by||"na",onChange:a=>g(e.id,"dealt_by",a.target.value),selectedKeys:[String(e.dealt_by)],style:{minWidth:"260px"},popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"},style:{whiteSpace:"nowrap",minWidth:"fit-content"}},placeholder:"Select a user",renderValue:a=>a.map(i=>t("div",{className:"flex items-center gap-2 m-1",children:t(ie,{style:{whiteSpace:"nowrap"},size:"sm",name:i.data.name,description:i.data.designation.title,avatarProps:{radius:"sm",size:"sm",src:i.data.profile_image}})},i.key)),children:a=>t(J,{textValue:a.id,children:t(ie,{style:{whiteSpace:"nowrap"},size:"sm",name:a.name,description:a.designation.title,avatarProps:{radius:"sm",size:"sm",src:a.profile_image}})},a.id)})},{name:"Actions",center:"true",width:"150px",cell:e=>H("div",{className:"flex gap-4 items-center",children:[t(ne,{variant:"bordered",isIconOnly:!0,color:"warning","aria-label":"Edit",onClick:()=>p("editLetter",e),children:t(We,{})}),t(ne,{variant:"bordered",isIconOnly:!0,color:"danger","aria-label":"Delete",onClick:()=>handleDelete(e.id),children:t(Ye,{})})]})}],g=async(e,a,i)=>{var C,f;try{const u=await me.put(route("letters.update"),{id:e,[a]:i});u.status===200?(n(R=>R.map(S=>S.id===e?{...S,[a]:i}:S)),j.success(...u.data.messages||"Letter updated successfully",{icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})):j.error(u.data.error||`Failed to update letter ${[a]}.`,{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}catch(u){j.error(((f=(C=u.response)==null?void 0:C.data)==null?void 0:f.message)||"An unexpected error occurred.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:c.glassCard.backgroundColor,border:c.glassCard.border,color:c.palette.text.primary}})}};return H("div",{children:[r&&t(ht,{}),t(He,{styles:{"& .cgTKyH":{backgroundColor:"transparent !important",color:c.palette.text.primary}}}),t(yt,{columns:w,data:s,defaultSortField:"received_date",highlightOnHover:!0,responsive:!0,dense:!0,sortIcon:t(je,{}),keyField:"id"})]})};Ke.extend($e);const St=De.memo(({auth:s,title:n,users:o})=>{const r=ve(),[d,p]=l.useState([]),[b,x]=l.useState(!1),[m,c]=l.useState(0),[h,y]=l.useState(0);l.useState([]);const[w,g]=l.useState(),[e,a]=l.useState(null),[i,C]=l.useState(null),[f,u]=l.useState(""),R=Ie(r.breakpoints.down("md")),[S,I]=l.useState(30),[z,W]=l.useState(1),Y=async(k,_,D)=>{try{const L=await me.get(route("letters.paginate"),{params:{page:k,perPage:_,search:D}});p(L.data.data),c(L.data.total),y(L.data.last_page),x(!1)}catch(L){console.error(L),j.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}),x(!1)}},V=()=>{const k=new Promise(async(_,D)=>{var L,A;try{const N=await fetch("/delete-daily-work",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({id:e,page:z,perPage:S,search:f,status:filterData.status!=="all"?filterData.status:"",inCharge:filterData.incharge!=="all"?filterData.incharge:"",startDate:(L=filterData.startDate)==null?void 0:L.format("YYYY-MM-DD"),endDate:(A=filterData.endDate)==null?void 0:A.format("YYYY-MM-DD")})}),K=await N.json();N.ok?(p(K.data),c(K.total),_("Daily work deleted successfully")):D(K.error||"Failed to delete task")}catch(N){console.error("Error deleting task:",N),D("An error occurred while deleting the task")}finally{B()}});j.promise(k,{pending:{render(){return H("div",{style:{display:"flex",alignItems:"center"},children:[t(Pe,{}),t("span",{style:{marginLeft:"8px"},children:"Deleting task..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},success:{render({data:_}){return t(M,{children:_})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}},error:{render({data:_}){return t(M,{children:_})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:r.glassCard.backgroundColor,border:r.glassCard.border,color:r.palette.text.primary}}})},G=l.useCallback((k,_)=>{a(k),C(_)},[]),B=l.useCallback(()=>{C(null),a(null)},[]),E=l.useCallback(k=>{C(k)},[]),P=l.useCallback(()=>{C(null)},[]),F=k=>{const _=k.target.value;u(_)};l.useEffect(()=>{x(!0),Y(z,S,f)},[z,S,f]);const q=k=>{W(k)};return H(M,{children:[t(Le,{title:n}),i==="editLetter"&&t(LetterForm,{open:i==="editLetter",currentRow:w,setData:p,closeModal:P}),i==="deleteLetter"&&t(DeleteLetterForm,{open:i==="deleteLetter",handleClose:B,handleDelete:V,setData:p}),i==="importLetters"&&t(LettersUploadForm,{open:i==="importLetters",closeModal:P,setData:p,setTotalRows:c}),i==="exportLetters"&&t(LettersDownloadForm,{open:i==="exportLetters",closeModal:P,data:d,users:o}),t(O,{sx:{display:"flex",justifyContent:"center",p:2},children:t(Ee,{in:!0,children:H(Be,{children:[t(Fe,{title:n,sx:{padding:"24px"},action:H(O,{display:"flex",gap:2,children:[s.permissions.includes("addTask")&&t(X,{title:"Add Task",color:"primary",id:"showAddModalBtn",children:t(Oe,{})}),s.roles.includes("Administrator")&&t(M,{children:R?H(M,{children:[t(X,{title:"Import Letters",color:"warning",onClick:()=>E("importLetters"),children:t(oe,{})}),t(X,{title:"Export Letters",color:"success",onClick:()=>E("exportLetters"),children:t(de,{})})]}):H(M,{children:[t(ee,{title:"Import Letters",variant:"outlined",color:"warning",startIcon:t(oe,{}),onClick:()=>E("importLetters"),children:"Import"}),t(ee,{title:"Export Letters",variant:"outlined",color:"success",startIcon:t(de,{}),onClick:()=>E("exportLetters"),children:"Export"})]})})]})}),t(te,{children:t(O,{children:t(re,{container:!0,spacing:2,children:t(re,{item:!0,xs:12,sm:6,md:3,children:t(ye,{label:"Search",type:"text",fullWidth:!0,variant:"bordered",placeholder:"Search...",value:f,onChange:F,endContent:t(Xe,{})})})})})}),H(te,{children:[t(Ct,{setData:p,setCurrentRow:g,currentPage:z,setCurrentPage:W,setLoading:x,handleClickOpen:G,openModal:E,totalRows:m,lastPage:h,loading:b,allData:d,users:o,search:f}),m>=30&&t("div",{className:"py-2 px-2 flex justify-center items-center",children:t(Je,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:z,total:h,onChange:q})})]})]})})})]})});St.layout=s=>t(Ae,{children:s});export{St as default};
