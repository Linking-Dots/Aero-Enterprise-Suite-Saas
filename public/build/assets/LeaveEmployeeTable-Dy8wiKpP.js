import{r as l,R as ae,J as Ce,g as Se,b as e,a as s,h as te,i as se,F as Fe}from"./app-gjERDQkg.js";import{u as Re,e as T,E as $e,I as j,B as o,O as ke,T as c,P as re,Q as oe,U as ne,V as E,f as N,M as C,W as ie,L as ce,h as le,S as De,d as Le}from"./App-BUSD2D5M.js";import{F as de,a as me}from"./PencilIcon-C3M0yOVL.js";import{F as he}from"./TrashIcon-B1AQP0xV.js";import{F as ze,a as Me,b as Te}from"./XCircleIcon-B2eluPXU.js";import{F as B}from"./UserIcon-KyMpuJVO.js";import{C as je}from"./CardContent-D_KMnfUx.js";import{a as m}from"./colorManipulator-DHrsacDm.js";import{e as f,t as Ee,a as Be,b as Ie,c as Pe,d as Ue}from"./chunk-F3UDT23P-4Rgnd2tZ.js";import{t as pe}from"./chunk-7ZZXWEXF-ChHHQJmk.js";import{u as fe}from"./chunk-R6AK6OQ4-BpgEZXJ7.js";import{p as ue}from"./chunk-O5I3QTYU-BoYv1-8p.js";function We({title:b,titleId:u,...y},x){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":u},y),b?l.createElement("title",{id:u},b):null,l.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z",clipRule:"evenodd"}))}const He=l.forwardRef(We),Oe=ae.forwardRef(({leaves:b,allUsers:u,handleClickOpen:y,setCurrentLeave:x,openModal:S,setLeaves:I,setCurrentPage:F,currentPage:P,totalRows:U,lastPage:W,perPage:H,selectedMonth:Qe,employee:O,isAdminView:h=!1,onBulkApprove:Ze,onBulkReject:qe,canApproveLeaves:_=!1,canEditLeaves:R=!1,canDeleteLeaves:$=!1,fetchLeavesStats:xe},Ge)=>{var A,K;const{auth:Q}=Ce().props,i=Re(),ge=T("(min-width: 1025px)"),we=T("(min-width: 641px) and (max-width: 1024px)"),be=T("(max-width: 640px)"),[v,Z]=l.useState(!1),[k,q]=l.useState(null),[Je,Ye]=l.useState(new Set);(A=Q.permissions)!=null&&A.includes("leaves.view"),(K=Q.permissions)!=null&&K.includes("leave.own.view");const ye=h&&(_||R||$),d={New:{color:"primary",icon:Te,bgColor:m(i.palette.primary.main,.1),textColor:i.palette.primary.main},Pending:{color:"warning",icon:He,bgColor:m(i.palette.warning.main,.1),textColor:i.palette.warning.main},Approved:{color:"success",icon:Me,bgColor:m(i.palette.success.main,.1),textColor:i.palette.success.main},Declined:{color:"danger",icon:ze,bgColor:m(i.palette.error.main,.1),textColor:i.palette.error.main}},G=l.useCallback(a=>{F&&F(a)},[F]),D=l.useCallback(async(a,t)=>{if(v)return;Z(!0),q(`${a.id}-${t}`);const n=new Promise(async(r,g)=>{var p,V,ee;try{const w=await Se.post(route("leave-update-status"),{id:a.id,status:t});w.status===200&&(I(z=>z.map(M=>M.id===a.id?{...M,status:t}:M)),xe(),r(w.data.message||"Leave status updated successfully"))}catch(w){const z=((V=(p=w.response)==null?void 0:p.data)==null?void 0:V.message)||((ee=w.response)==null?void 0:ee.statusText)||"Failed to update leave status";g(z),console.error(w)}finally{Z(!1),q(null)}});$e.promise(n,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"})},[I,v]),J=a=>{const t=d[a]||d.New,n=t.icon;return e(le,{size:"sm",variant:"flat",color:t.color,startContent:e(n,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:a})},Y=(a,t)=>{const n=new Date(a),r=new Date(t),g=Math.abs(r-n),p=Math.ceil(g/(1e3*60*60*24))+1;return p===1?"1 day":`${p} days`},L=a=>new Date(a).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),X=a=>(u==null?void 0:u.find(t=>String(t.id)===String(a)))||{name:"Unknown User",phone:""},Ne=({leave:a})=>{const t=X(a.user_id),n=Y(a.from_date,a.to_date);return d[a.status]||d.New,e(Le,{className:"mb-2",shadow:"sm",children:s(je,{className:"p-3",children:[s(o,{className:"flex items-start justify-between mb-3",children:[e(o,{className:"flex items-center gap-3 flex-1",children:h&&e(fe,{avatarProps:{radius:"lg",size:"sm",src:t==null?void 0:t.profile_image,fallback:e(B,{className:"w-4 h-4"})},name:e(c,{variant:"body2",fontWeight:"medium",children:t==null?void 0:t.name}),description:e(c,{variant:"caption",color:"textSecondary",children:t==null?void 0:t.phone})})}),s(o,{className:"flex items-center gap-2",children:[J(a.status),ye&&s(re,{children:[e(oe,{children:e(j,{size:"small",children:e(me,{className:"w-4 h-4"})})}),s(ne,{"aria-label":"Leave actions",children:[R&&e(E,{startContent:e(de,{className:"w-4 h-4"}),onPress:()=>{x(a),S("edit_leave")},children:"Edit Leave"},"edit"),$&&e(E,{className:"text-danger",color:"danger",startContent:e(he,{className:"w-4 h-4"}),onPress:()=>y(a.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(se,{className:"my-3"}),s(De,{spacing:2,children:[s(o,{className:"flex items-center gap-2",children:[e(C,{className:"w-4 h-4 text-primary"}),e(c,{variant:"body2",fontWeight:"medium",children:a.leave_type})]}),s(o,{className:"flex items-center gap-2",children:[e(N,{className:"w-4 h-4 text-default-500"}),s(c,{variant:"body2",color:"textSecondary",children:[L(a.from_date)," - ",L(a.to_date)]}),e(le,{size:"sm",variant:"bordered",color:"default",children:n})]}),a.reason&&s(o,{className:"flex items-start gap-2",children:[e(ce,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(c,{variant:"body2",color:"textSecondary",className:"flex-1",children:a.reason})]})]}),h&&_&&s(Fe,{children:[e(se,{className:"my-3"}),e(o,{className:"flex gap-2",children:["Approved","Declined"].map(r=>e(te,{size:"sm",variant:a.status===r?"solid":"bordered",color:d[r].color,isLoading:k===`${a.id}-${r}`,onPress:()=>D(a,r),startContent:!k||k!==`${a.id}-${r}`?ae.createElement(d[r].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:r},r))})]})]})})},_e=l.useCallback((a,t)=>{const n=X(a.user_id);switch(t){case"employee":return e(f,{className:"whitespace-nowrap",children:e(fe,{avatarProps:{radius:"lg",size:"sm",src:n==null?void 0:n.profile_image,fallback:e(B,{className:"w-4 h-4"})},description:e(c,{variant:"caption",className:"text-xs",children:n==null?void 0:n.phone}),name:e(c,{variant:"body2",className:"text-sm font-medium",children:n==null?void 0:n.name})})});case"leave_type":return e(f,{children:s(o,{className:"flex items-center gap-1",children:[e(C,{className:"w-3 h-3 text-primary"}),e(c,{variant:"body2",className:"text-sm font-medium",children:a.leave_type})]})});case"from_date":case"to_date":return e(f,{children:s(o,{className:"flex items-center gap-1",children:[e(N,{className:"w-3 h-3 text-default-500"}),s(o,{children:[e(c,{variant:"body2",className:"text-sm",children:L(a[t])}),t==="from_date"&&e(c,{variant:"caption",className:"text-xs",color:"textSecondary",children:Y(a.from_date,a.to_date)})]})]})});case"status":return e(f,{children:s(o,{className:"flex items-center gap-2",children:[J(a.status),h&&_&&s(re,{children:[e(oe,{children:e(te,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:v,children:e(me,{className:"w-4 h-4"})})}),e(ne,{"aria-label":"Status actions",onAction:r=>D(a,r),children:Object.keys(d).map(r=>{const g=d[r],p=g.icon;return e(E,{startContent:e(p,{className:"w-4 h-4"}),color:g.color,children:r},r)})})]})]})});case"reason":return e(f,{children:e(ke,{title:a.reason||"No reason provided",children:e(c,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:a.reason||"No reason provided"})})});case"actions":return e(f,{children:s(o,{className:"flex items-center gap-1",children:[R&&e(pe,{content:"Edit Leave",children:e(j,{size:"small",onClick:()=>{x(a),S("edit_leave")},sx:{background:m(i.palette.primary.main,.1),"&:hover":{background:m(i.palette.primary.main,.2)}},children:e(de,{className:"w-4 h-4"})})}),$&&e(pe,{content:"Delete Leave",color:"danger",children:e(j,{size:"small",onClick:()=>{x(a),y(a.id,"delete_leave")},sx:{background:m(i.palette.error.main,.1),"&:hover":{background:m(i.palette.error.main,.2)}},children:e(he,{className:"w-4 h-4"})})})]})});default:return e(f,{children:a[t]})}},[h,_,ge,v,i,x,S,y,D]),ve=[...h?[{name:"Employee",uid:"employee",icon:B}]:[],{name:"Leave Type",uid:"leave_type",icon:C},{name:"From Date",uid:"from_date",icon:N},{name:"To Date",uid:"to_date",icon:N},{name:"Status",uid:"status",icon:ce},{name:"Reason",uid:"reason",icon:C},...h?[{name:"Actions",uid:"actions"}]:[]];return be?s(o,{className:"space-y-4",children:[e(ie,{className:"max-h-[70vh]",children:b.map(a=>e(Ne,{leave:a},a.id))}),U>H&&e(o,{className:"flex justify-center pt-4",children:e(ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:P,total:W,onChange:G,size:"sm"})})]}):s(o,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(ie,{className:"max-h-[70vh]",children:s(Ee,{isStriped:!0,selectionMode:"none",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(Be,{columns:ve,children:a=>e(Ie,{align:a.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:s(o,{className:"flex items-center gap-1",children:[a.icon&&e(a.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:a.name})]})},a.uid)}),e(Pe,{items:b,emptyContent:s(o,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(N,{className:"w-12 h-12 text-default-300 mb-4"}),e(c,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(c,{variant:"body2",color:"textSecondary",children:O?`No leaves found for "${O}"`:"No leave requests for the selected period"})]}),children:a=>e(Ue,{children:t=>_e(a,t)},a.id)})]})}),U>H&&e(o,{className:"py-4 flex justify-center",children:e(ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:P,total:W,onChange:G,size:we?"sm":"md"})})]})});Oe.displayName="LeaveEmployeeTable";export{Oe as L};
