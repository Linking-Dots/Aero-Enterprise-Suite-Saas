import{J as Be,r as a,b as l,j as e,F as K,a as ce,e as ae,Q as Oe,h as qe,c as pe}from"./app-BJivnDWt.js";import{u as me,d as N,I as Ye,e as A,P as Ce,B as re,Q as q,a as ke,b as ze,c as Se,G as Ge,i as Pe,k as Ne,A as Qe}from"./App-DB6XQ5nR.js";import{P as Ue}from"./PageHeader-BwdAKJjU.js";import{S as He}from"./StatsCards-R-ezF4R1.js";import{L as Je}from"./LeaveEmployeeTable-BrxZXtxV.js";import{C as Ke}from"./Clear-BEUfOFHT.js";import{G as Ie}from"./GlassDialog-CuZI1zuY.js";import{D as Ee}from"./DialogTitle-DFLtRy6F.js";import{I as Te,F as De,T as J}from"./TextField-g4-Vu5I_.js";import{S as Fe}from"./Select-DGRuQ_3b.js";import{M as te}from"./MenuItem-DK9CQryM.js";import{A as Ve}from"./Avatar-DT_En2BI.js";import{b as Le,c as je}from"./DialogContent-DxrL9TxF.js";import{L as Xe}from"./LoadingButton-DRQ65YGw.js";import{C as he}from"./CircularProgress-BPoubUeS.js";import{D as Ze}from"./DialogContentText-C7LJvVyD.js";import{B as _e}from"./Button-BIz7R3KR.js";import{d as ea}from"./dayjs.min-K3I8Wf0l.js";import{F as aa}from"./CheckCircleIcon-B9EKSB8_.js";import{F as ta}from"./XCircleIcon-KuzrRNHX.js";import{F as ue}from"./ChartBarIcon-5xxGJSC-.js";import{F as Me}from"./ExclamationTriangleIcon-Dr4aBRNm.js";import{F as ra}from"./MagnifyingGlassIcon-BPlPDnUn.js";import{F as sa}from"./PlusIcon-Dg18KPDK.js";import{F as la}from"./DocumentArrowDownIcon-DpOG2AxB.js";import{F as oa}from"./PresentationChartLineIcon-uw1k9CZP.js";import{s as Re,l as Ae}from"./chunk-2GIFKCNQ-BjUWsJy2.js";import"./app-Dax45E_a.js";import"./chunk-D5XJWRAV-BDb3eWGM.js";import"./PencilIcon-DNKNerV7.js";import"./TrashIcon-CFzOPAAk.js";import"./XCircleIcon-C9uB0CDj.js";import"./UserIcon-CBLvAwYQ.js";import"./CardContent-Bdn1-Dn3.js";import"./colorManipulator-BFY2QjsD.js";import"./chunk-F3UDT23P-D6tUvYww.js";import"./useHasTabbableChild-CJp6mSTG.js";import"./chunk-7F3ZLNJ6-BrNy7kMd.js";import"./chunk-7ZZXWEXF-D2oRSwIF.js";import"./chunk-R6AK6OQ4-BBLslPyF.js";import"./chunk-O5I3QTYU-BZXFI1S0.js";import"./index-CokAva9Y.js";import"./Popover-DQgz4sA0.js";import"./List-DEB24gpF.js";import"./listItemTextClasses-BNtor7xn.js";import"./dividerClasses-DwkDgtPb.js";import"./useSlot-DRMYDr1K.js";const na=({open:B,closeModal:P,leavesData:m,setLeavesData:I,currentLeave:s,allUsers:E,setTotalRows:_,setLastPage:M,setLeaves:h,handleMonthChange:L,employee:R,selectedMonth:x})=>{var ee;const{auth:T}=Be().props,c=me(),[C,g]=a.useState((s==null?void 0:s.user_id)||T.user.id),[v,se]=a.useState((m==null?void 0:m.leaveTypes)||[]),[D,le]=a.useState([]),[w,Y]=a.useState((s==null?void 0:s.leave_type)||""),j=t=>{const u=new Date(t);return isNaN(u.getTime())?new Date().toISOString().split("T")[0]:u.toISOString().split("T")[0]},[o,oe]=a.useState(j(s==null?void 0:s.from_date)),[y,z]=a.useState(j(s==null?void 0:s.to_date)),[G,V]=a.useState((s==null?void 0:s.no_of_days)||""),[k,$]=a.useState(""),[X,Q]=a.useState((s==null?void 0:s.reason)||""),[i,ne]=a.useState({}),[Z,U]=a.useState(!1),[ge,ie]=a.useState("");return a.useEffect(()=>{var t;if(m){se(m.leaveTypes||[]);const u=((t=m.leaveCountsByUser)==null?void 0:t[C])||[];le(u),v.length>0&&!w&&Y(v[0].type)}},[m,C]),a.useEffect(()=>{if(!w||!D||!v)return;const t=D.find(n=>n.leave_type===w),u=(t==null?void 0:t.days_used)||0;ie(u);const b=v.find(n=>n.type===w);if(b){const n=b.days-u;$(n),s&&G>n&&V(n)}},[w,D,v,s,G]),a.useEffect(()=>{V(((u,b)=>{if(!u||!b)return"";const n=new Date(u),d=new Date(b);if(n>d)return"";const S=d.getTime()-n.getTime();return Math.ceil(S/(1e3*3600*24))+1})(o,y))},[o,y]),l(Ie,{open:B,onClose:P,fullWidth:!0,maxWidth:"sm",children:[l(Ee,{sx:{display:"flex",alignItems:"center"},children:[e(N,{variant:"h6",children:s?"Edit Leave":"Add Leave"}),e(Ye,{onClick:P,sx:{position:"absolute",top:8,right:16},children:e(Ke,{})})]}),l("form",{onSubmit:async t=>{t.preventDefault(),U(!0);const u=new Promise(async(b,n)=>{try{const d={route:route().current(),user_id:C,leaveType:w,fromDate:o,toDate:y,daysCount:G,leaveReason:X,employee:R,month:x},S=s?route("leave-update"):route("leave-add");s&&(d.id=s.id);const F=await axios.post(S,d);F.status===200&&(I(F.data.leavesData),_(F.data.leaves.total),M(F.data.leaves.last_page),h(F.data.leaves.data),L({target:{value:o.slice(0,7)}}),P(),b([F.data.message||"Leave application submitted successfully"]))}catch(d){console.error(d),U(!1),d.response?(d.response.status===422?(ne(d.response.data.errors||{}),n(d.response.data.error||"Failed to submit leave application")):n("An unexpected error occurred. Please try again later."),console.error(d.response.data.error)):d.request?(n("No response received from the server. Please check your internet connection."),console.error(d.request)):(n("An error occurred while setting up the request."),console.error("Error",d.message))}finally{U(!1)}});q.promise(u,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(he,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},success:{render({data:b}){return e(K,{children:b.map((n,d)=>e("div",{children:n},d))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},error:{render({data:b}){return e(K,{children:b})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}}})},children:[e(Le,{children:l(A,{container:!0,spacing:2,children:[e(A,{item:!0,xs:12,md:6,children:l(Ce,{fullWidth:!0,children:[e(Te,{id:"leave-type-label",children:"Leave Type"}),l(Fe,{labelId:"leave-type-label",value:w||"",onChange:t=>Y(t.target.value),label:"Leave Type",error:!!i.leaveType,disabled:!!s,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,borderRadius:2,boxShadow:c.glassCard.boxShadow,maxHeight:300}}},children:[e(te,{value:"",disabled:!0,children:"Select Leave Type"}),v.map(t=>{const u=D==null?void 0:D.find(d=>d.leave_type===t.type),n=(u?t.days-u.days_used:t.days)<=0;return e(te,{value:t.type,disabled:n,title:n?"No remaining leaves available":"",children:l(re,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:t.type}),e("span",{children:u?`${u.days_used} / ${t.days} days`:`${t.days} days`})]})},t.id)})]}),e(De,{children:i.leaveType})]})}),e(A,{item:!0,xs:12,md:6,children:e(J,{label:"From",type:"date",fullWidth:!0,value:o,onChange:t=>oe(t.target.value),InputLabelProps:{shrink:!0},error:!!i.fromDate,helperText:i.fromDate})}),e(A,{item:!0,xs:12,md:6,children:e(J,{label:"To",type:"date",fullWidth:!0,value:y,onChange:t=>z(t.target.value),InputLabelProps:{shrink:!0},error:!!i.toDate,helperText:i.toDate})}),e(A,{item:!0,xs:12,md:6,children:e(J,{label:"Number of days",type:"text",fullWidth:!0,value:G,InputProps:{readOnly:!0},error:!!i.daysCount,helperText:i.daysCount})}),e(A,{item:!0,xs:12,md:6,children:e(J,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${k} day${k!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:l(N,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",((ee=v.find(t=>t.type===w))==null?void 0:ee.days)||0," total"]})},error:!!i.remainingLeaves,helperText:i.remainingLeaves})}),route().current()==="leaves"&&e(A,{item:!0,xs:12,md:6,children:l(Ce,{fullWidth:!0,children:[e(Te,{id:"leave-employee-label",children:"Employee"}),l(Fe,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:C||"na",error:!!i.user_id,onChange:t=>g(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,borderRadius:2,boxShadow:c.glassCard.boxShadow}}},children:[e(te,{value:"na",disabled:!0,children:"Please select"}),E.map(t=>e(te,{value:t.id,children:l(re,{sx:{display:"flex"},children:[e(Ve,{src:t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(De,{children:i.user_id})]})}),e(A,{item:!0,xs:12,children:e(J,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:X,onChange:t=>Q(t.target.value),error:!!i.leaveReason,helperText:i.leaveReason})})]})}),e(je,{sx:{padding:"16px",justifyContent:"center"},children:e(Xe,{type:"submit",variant:"outlined",color:"primary",loading:Z,disabled:Z,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},ia=({open:B,handleClose:P,leaveIdToDelete:m,setLeavesData:I,setLeaves:s,setTotalRows:E,setLastPage:_,setError:M})=>{const h=me();return l(Ie,{open:B,onClose:P,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(Ee,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(Le,{children:e(Ze,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(je,{children:[e(_e,{onClick:P,color:"primary",children:"Cancel"}),e(_e,{onClick:()=>{const R=new Promise(async(x,T)=>{var c,C;try{const g=await axios.delete(route("leave-delete",{id:m,route:route().current()}));g.status===200&&(I(g.data.leavesData),E(g.data.leaves.total),_(g.data.leaves.last_page),s(g.data.leaves.data),M(!1),x("Leave application deleted successfully"))}catch(g){if(console.error("Error deleting task:",g),g.response.status===404){const{leavesData:v}=g.response.data;I(v),M(((C=(c=g.response)==null?void 0:c.data)==null?void 0:C.message)||"Error retrieving data.")}T(g.response.data.error||"Failed to delete leave application")}finally{P()}});q.promise(R,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(he,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:h.glassCard.background,border:h.glassCard.border,color:h.palette.text.primary}},success:{render({data:x}){return e(K,{children:x})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:h.glassCard.background,border:h.glassCard.border,color:h.palette.text.primary}},error:{render({data:x}){return e(K,{children:x})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:h.glassCard.background,border:h.glassCard.border,color:h.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},da=({title:B,allUsers:P})=>{var be,ve,ye,fe,we;const{auth:m}=Be().props,I=me(),s=ke(I.breakpoints.down("sm"));ke(I.breakpoints.down("md"));const[E,_]=a.useState(!1),[M,h]=a.useState(null),[L,R]=a.useState([]),[x,T]=a.useState(),[c,C]=a.useState(0),[g,v]=a.useState(0),[se,D]=a.useState(null),[le,w]=a.useState(),[Y,j]=a.useState(""),[o,oe]=a.useState({employee:"",selectedMonth:ea().format("YYYY-MM"),status:"all",leaveType:"all",department:"all"}),[y,z]=a.useState({perPage:30,currentPage:1}),[G,V]=a.useState("all"),k=a.useCallback((r,p)=>{if(r==="year"){const f=Number(p);if(f<1900||f>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}oe(f=>({...f,[r]:p})),z(f=>({...f,currentPage:1}))},[]);a.useCallback(r=>{V(r),k("status",{all:"all",pending:"pending",approved:"approved",rejected:"rejected"}[r]||"all")},[k]);const[$,X]=a.useState({pending:0,approved:0,rejected:0,total:0}),Q=((be=m.permissions)==null?void 0:be.includes("leaves.view"))||!1,i=((ve=m.permissions)==null?void 0:ve.includes("leaves.approve"))||!1,ne=((ye=m.permissions)==null?void 0:ye.includes("leaves.create"))||!1,Z=((fe=m.permissions)==null?void 0:fe.includes("leaves.update"))||!1,U=((we=m.permissions)==null?void 0:we.includes("leaves.delete"))||!1,ge=a.useMemo(()=>[{key:"all",label:"All Status",value:"all"},{key:"pending",label:"Pending",value:"pending"},{key:"approved",label:"Approved",value:"approved"},{key:"rejected",label:"Rejected",value:"rejected"},{key:"new",label:"New",value:"new"}],[]),ie=a.useMemo(()=>{const r=[{key:"all",label:"All Types",value:"all"}];if(!L.leaveTypes)return r;const p=L.leaveTypes.map(f=>({key:f.type.toLowerCase(),label:f.type,value:f.type.toLowerCase()}));return[...r,...p]},[L.leaveTypes]),H=a.useCallback(r=>{h(r)},[]),ee=a.useCallback((r,p)=>{D(r),h(p)},[]),t=a.useCallback(()=>{h(null),D(null),w(null)},[]);a.useCallback(r=>{w(r),H("edit_leave")},[H]);const u=a.useCallback(r=>{k("employee",r.target.value.toLowerCase())},[k]),b=a.useCallback(r=>{k("selectedMonth",r.target.value)},[k]),n=a.useCallback(r=>{z(p=>({...p,currentPage:r}))},[]),d=a.useCallback(r=>{z(p=>({...p,perPage:r,currentPage:1}))},[]),S=a.useCallback(async()=>{var r,p,f;_(!0);try{const W=await ce.get(route("leaves.paginate"),{params:{page:y.currentPage,perPage:y.perPage,employee:o.employee,month:o.selectedMonth,status:o.status!=="all"?o.status:void 0,leave_type:o.leaveType!=="all"?o.leaveType:void 0,department:o.department!=="all"?o.department:void 0}});if(W.status===200){const{leaves:O,leavesData:xe,stats:de}=W.data;console.log(O,xe,de),T(O.data),R(xe),C(O.total),v(O.last_page),de&&X(de),j(""),_(!1)}}catch(W){if(console.error("Error fetching leaves data:",W.response),((r=W.response)==null?void 0:r.status)===404){const{leavesData:O}=W.response.data;R(O),j(((f=(p=W.response)==null?void 0:p.data)==null?void 0:f.message)||"No leaves found for the selected criteria.")}else j("Error retrieving leaves data. Please try again.");T(!1),_(!1)}},[o,y]),F=a.useCallback(async r=>{if(i)try{(await ce.post(route("leaves.bulk-approve"),{leave_ids:r})).status===200&&(S(),q.success("Selected leaves approved successfully"))}catch(p){console.error("Error bulk approving leaves:",p),q.error("Failed to approve selected leaves")}},[i,S]),$e=a.useCallback(async r=>{if(i)try{(await ce.post(route("leaves.bulk-reject"),{leave_ids:r})).status===200&&(S(),q.success("Selected leaves rejected successfully"))}catch(p){console.error("Error bulk rejecting leaves:",p),q.error("Failed to reject selected leaves")}},[i,S]);a.useEffect(()=>{Q&&S()},[S,Q]);const We=a.useMemo(()=>[{title:"Pending",value:$.pending,icon:e(ze,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Awaiting approval"},{title:"Approved",value:$.approved,icon:e(aa,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Successfully approved"},{title:"Rejected",value:$.rejected,icon:e(ta,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Declined requests"},{title:"Total",value:$.total,icon:e(ue,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All leave requests"}],[$]);return Q?l(K,{children:[e(Oe,{title:B}),["add_leave","edit_leave"].includes(M)&&e(na,{setTotalRows:C,setLastPage:v,setLeaves:T,perPage:y.perPage,employee:o.employee,currentPage:y.currentPage,selectedMonth:o.selectedMonth,allUsers:P,open:!0,setLeavesData:R,closeModal:t,leavesData:L,currentLeave:M==="edit_leave"?le:null,handleMonthChange:b,isAdminView:!0,canApproveLeaves:i}),M==="delete_leave"&&e(ia,{setTotalRows:C,setLastPage:v,setLeaves:T,perPage:y.perPage,open:!0,handleClose:t,leaveIdToDelete:se,setLeavesData:R,setError:j,setLoading:_}),e(re,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Ge,{in:!0,children:e(Se,{children:e(Ue,{title:"Leave Management",subtitle:"Manage employee leave requests and approvals",icon:e(oa,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[...ne?[{label:"Add Leave",icon:e(sa,{className:"w-4 h-4"}),onPress:()=>H("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],{label:"Export",icon:e(la,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:l("div",{className:"p-6",children:[e(He,{stats:We}),e("div",{className:"mb-6",children:l("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(Pe,{label:"Month/Year",type:"month",value:o.selectedMonth,onChange:b,startContent:e(Ne,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:s?"sm":"md"})}),e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(Pe,{label:"Search Employee",placeholder:"Enter name or ID...",value:o.employee,onChange:u,startContent:e(ra,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:s?"sm":"md"})}),e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(Re,{label:"Leave Status",selectedKeys:[o.status],onSelectionChange:r=>k("status",Array.from(r)[0]),variant:"bordered",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:s?"sm":"md",children:ge.map(r=>e(Ae,{value:r.value,children:r.label},r.key))})}),e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(Re,{label:"Leave Type",selectedKeys:[o.leaveType],onSelectionChange:r=>k("leaveType",Array.from(r)[0]),variant:"bordered",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:s?"sm":"md",children:ie.map(r=>e(Ae,{value:r.value,children:r.label},r.key))})}),e("div",{className:"flex gap-2",children:e(qe,{variant:"flat",color:"primary",size:s?"sm":"md",onPress:S,isLoading:E,startContent:!E&&e(ue,{className:"w-4 h-4"}),children:"Refresh"})})]})}),l("div",{className:"min-h-96",children:[l(N,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[e(ue,{className:"w-5 h-5"}),"Leave Requests Management"]}),E?e(pe,{className:"bg-white/10 backdrop-blur-md border-white/20",children:l(ae,{className:"text-center py-12",children:[e(he,{size:40}),e(N,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):x&&x.length>0?e("div",{className:"overflow-hidden rounded-lg",children:e(Je,{totalRows:c,lastPage:g,setCurrentPage:n,setPerPage:d,perPage:y.perPage,currentPage:y.currentPage,handleClickOpen:ee,setCurrentLeave:w,openModal:H,leaves:x,allUsers:P,setLeaves:T,employee:o.employee,selectedMonth:o.selectedMonth,isAdminView:!0,onBulkApprove:F,onBulkReject:$e,canApproveLeaves:i,canEditLeaves:Z,canDeleteLeaves:U})}):Y?e(pe,{className:"bg-white/10 backdrop-blur-md border-white/20",children:l(ae,{className:"text-center py-12",children:[e(Me,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),e(N,{variant:"h6",className:"mb-2",children:"No Data Found"}),e(N,{color:"textSecondary",children:Y})]})}):e(pe,{className:"bg-white/10 backdrop-blur-md border-white/20",children:l(ae,{className:"text-center py-12",children:[e(Ne,{className:"w-16 h-16 text-default-400 mx-auto mb-4"}),e(N,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),e(N,{color:"textSecondary",children:"No leave records found for the selected criteria."})]})})]})]})})})})})]}):e(re,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Se,{children:l(ae,{className:"p-8 text-center",children:[e(Me,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),e(N,{variant:"h6",className:"mb-2",children:"Access Denied"}),e(N,{variant:"body2",color:"textSecondary",children:"You don't have permission to view leave management."})]})})})};da.layout=B=>e(Qe,{children:B});export{da as default};
