import{r as m,J as Se,g as Fe,b as e,a as r,h as v,d as ze,F as oe,c as Re,i as ne,R as $e}from"./app-DITmkBw3.js";import{u as ke,e as L,E as De,I as E,B as s,O as Me,T as i,P as ie,Q as le,U as ce,V as I,f as C,M as z,W as de,L as me,h as he,S as Pe,d as Te}from"./App-C4DqMz8L.js";import{F as fe,a as pe}from"./PencilIcon-DLHz73CS.js";import{F as ue}from"./TrashIcon-BwsaigOx.js";import{F as je,a as Le,b as Ee}from"./XCircleIcon-DNG47l5v.js";import{F as U}from"./UserIcon-B5kPSabp.js";import{F as Ie}from"./CheckCircleIcon-Cr7MJeQk.js";import{F as Ue}from"./XCircleIcon-lQCQSs44.js";import{C as We}from"./CardContent-BcAEuk01.js";import{a as p}from"./colorManipulator-vxm2l2wb.js";import{e as u,t as Be,a as He,b as Oe,c as Qe,d as Ze}from"./chunk-F3UDT23P-qgEX1dc8.js";import{t as ge}from"./chunk-7ZZXWEXF-C0hxbLfo.js";import{u as be}from"./chunk-R6AK6OQ4-CAdgA3cs.js";import{p as we}from"./chunk-O5I3QTYU-QDR0wtWD.js";function qe({title:w,titleId:S,...x},y){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":S},x),w?m.createElement("title",{id:S},w):null,m.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z",clipRule:"evenodd"}))}const Ge=m.forwardRef(qe),ca=({leaves:w,allUsers:S,handleClickOpen:x,setCurrentLeave:y,openModal:R,setLeaves:W,setCurrentPage:B,currentPage:H,totalRows:O,lastPage:Q,perPage:Z,selectedMonth:Je,employee:q,isAdminView:c=!1,onBulkApprove:G,onBulkReject:J,canApproveLeaves:N=!1,canEditLeaves:$=!1,canDeleteLeaves:k=!1})=>{var te,re;const{auth:Y}=Se().props,n=ke(),D=L("(min-width: 1025px)"),xe=L("(min-width: 641px) and (max-width: 1024px)"),ye=L("(max-width: 640px)"),[_,X]=m.useState(!1),[g,K]=m.useState(new Set);(te=Y.permissions)!=null&&te.includes("leaves.view"),(re=Y.permissions)!=null&&re.includes("leave.own.view");const Ne=c&&(N||$||k),h={New:{color:"primary",icon:Ee,bgColor:p(n.palette.primary.main,.1),textColor:n.palette.primary.main},Pending:{color:"warning",icon:Ge,bgColor:p(n.palette.warning.main,.1),textColor:n.palette.warning.main},Approved:{color:"success",icon:Le,bgColor:p(n.palette.success.main,.1),textColor:n.palette.success.main},Declined:{color:"danger",icon:je,bgColor:p(n.palette.error.main,.1),textColor:n.palette.error.main}},A=m.useCallback(a=>{B(a)},[B]),M=m.useCallback(async(a,t)=>{if(_)return;X(!0);const o=new Promise(async(l,d)=>{var f,F,se;try{const b=await Fe.post(route("leave-update-status"),{id:a.id,status:t});b.status===200&&(W(T=>T.map(j=>j.id===a.id?{...j,status:t}:j)),l(b.data.message||"Leave status updated successfully"))}catch(b){const T=((F=(f=b.response)==null?void 0:f.data)==null?void 0:F.message)||((se=b.response)==null?void 0:se.statusText)||"Failed to update leave status";d(T),console.error(b)}finally{X(!1)}});De.promise(o,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"})},[W,_]),V=a=>{const t=h[a]||h.New,o=t.icon;return e(he,{size:"sm",variant:"flat",color:t.color,startContent:e(o,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:a})},ee=(a,t)=>{const o=new Date(a),l=new Date(t),d=Math.abs(l-o),f=Math.ceil(d/(1e3*60*60*24))+1;return f===1?"1 day":`${f} days`},P=a=>new Date(a).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),ae=a=>S.find(t=>String(t.id)===String(a)),_e=({leave:a})=>{const t=ae(a.user_id),o=ee(a.from_date,a.to_date);return h[a.status]||h.New,e(Te,{className:"mb-3",shadow:"sm",children:r(We,{className:"p-4",children:[r(s,{className:"flex items-start justify-between mb-3",children:[e(s,{className:"flex items-center gap-3 flex-1",children:c&&e(be,{avatarProps:{radius:"lg",size:"sm",src:t==null?void 0:t.profile_image,fallback:e(U,{className:"w-4 h-4"})},name:e(i,{variant:"body2",fontWeight:"medium",children:t==null?void 0:t.name}),description:e(i,{variant:"caption",color:"textSecondary",children:t==null?void 0:t.phone})})}),r(s,{className:"flex items-center gap-2",children:[V(a.status),Ne&&r(ie,{children:[e(le,{children:e(E,{size:"small",children:e(pe,{className:"w-4 h-4"})})}),r(ce,{"aria-label":"Leave actions",children:[$&&e(I,{startContent:e(fe,{className:"w-4 h-4"}),onPress:()=>{y(a),R("edit_leave")},children:"Edit Leave"},"edit"),k&&e(I,{className:"text-danger",color:"danger",startContent:e(ue,{className:"w-4 h-4"}),onPress:()=>x(a.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(ne,{className:"my-3"}),r(Pe,{spacing:2,children:[r(s,{className:"flex items-center gap-2",children:[e(z,{className:"w-4 h-4 text-primary"}),e(i,{variant:"body2",fontWeight:"medium",children:a.leave_type})]}),r(s,{className:"flex items-center gap-2",children:[e(C,{className:"w-4 h-4 text-default-500"}),r(i,{variant:"body2",color:"textSecondary",children:[P(a.from_date)," - ",P(a.to_date)]}),e(he,{size:"sm",variant:"bordered",color:"default",children:o})]}),a.reason&&r(s,{className:"flex items-start gap-2",children:[e(me,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(i,{variant:"body2",color:"textSecondary",className:"flex-1",children:a.reason})]})]}),c&&N&&r(oe,{children:[e(ne,{className:"my-3"}),e(s,{className:"flex gap-2",children:["Approved","Declined"].map(l=>e(v,{size:"sm",variant:a.status===l?"solid":"bordered",color:h[l].color,isLoading:_,onPress:()=>M(a,l),startContent:$e.createElement(h[l].icon,{className:"w-3 h-3"}),classNames:{base:"flex-1"},children:l},l))})]})]})})},ve=m.useCallback((a,t)=>{const o=ae(a.user_id);switch(t){case"employee":return e(u,{className:"whitespace-nowrap",children:e(be,{avatarProps:{radius:"lg",size:D?"md":"sm",src:o==null?void 0:o.profile_image,fallback:e(U,{className:"w-6 h-6"})},description:o==null?void 0:o.phone,name:o==null?void 0:o.name})});case"leave_type":return e(u,{children:r(s,{className:"flex items-center gap-2",children:[e(z,{className:"w-4 h-4 text-primary"}),e(i,{variant:"body2",fontWeight:"medium",children:a.leave_type})]})});case"from_date":case"to_date":return e(u,{children:r(s,{className:"flex items-center gap-2",children:[e(C,{className:"w-4 h-4 text-default-500"}),r(s,{className:"flex flex-col",children:[e(i,{variant:"body2",children:P(a[t])}),t==="from_date"&&e(i,{variant:"caption",color:"textSecondary",children:ee(a.from_date,a.to_date)})]})]})});case"status":return e(u,{children:r(s,{className:"flex items-center gap-2",children:[V(a.status),c&&N&&r(ie,{children:[e(le,{children:e(v,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:_,children:e(pe,{className:"w-4 h-4"})})}),e(ce,{"aria-label":"Status actions",onAction:d=>M(a,d),children:Object.keys(h).map(d=>{const f=h[d],F=f.icon;return e(I,{startContent:e(F,{className:"w-4 h-4"}),color:f.color,children:d},d)})})]})]})});case"reason":return e(u,{children:e(Me,{title:a.reason||"No reason provided",children:e(i,{variant:"body2",className:"max-w-xs truncate cursor-help",color:"textSecondary",children:a.reason||"No reason provided"})})});case"actions":return e(u,{children:r(s,{className:"flex items-center gap-1",children:[$&&e(ge,{content:"Edit Leave",children:e(E,{size:"small",onClick:()=>{y(a),R("edit_leave")},sx:{background:p(n.palette.primary.main,.1),"&:hover":{background:p(n.palette.primary.main,.2)}},children:e(fe,{className:"w-4 h-4"})})}),k&&e(ge,{content:"Delete Leave",color:"danger",children:e(E,{size:"small",onClick:()=>x(a.id,"delete_leave"),sx:{background:p(n.palette.error.main,.1),"&:hover":{background:p(n.palette.error.main,.2)}},children:e(ue,{className:"w-4 h-4"})})})]})});default:return e(u,{children:a[t]})}},[c,N,D,_,n,y,R,x,M]),Ce=[...c?[{name:"Employee",uid:"employee",icon:U}]:[],{name:"Leave Type",uid:"leave_type",icon:z},{name:"From Date",uid:"from_date",icon:C},{name:"To Date",uid:"to_date",icon:C},{name:"Status",uid:"status",icon:me},{name:"Reason",uid:"reason",icon:z},...c?[{name:"Actions",uid:"actions"}]:[]];return ye?r(s,{className:"space-y-4",children:[e(de,{className:"max-h-[70vh]",children:w.map(a=>e(_e,{leave:a},a.id))}),O>Z&&e(s,{className:"flex justify-center pt-4",children:e(we,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:H,total:Q,onChange:A,size:"sm"})})]}):r(s,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[c&&g.size>0&&e(Re,{className:"mb-4 bg-primary-50 border border-primary-200",children:e(ze,{className:"py-3",children:r(s,{className:"flex items-center justify-between",children:[r(i,{variant:"body2",className:"text-primary-700",children:[g.size," leave",g.size>1?"s":""," selected"]}),r(s,{className:"flex gap-2",children:[N&&r(oe,{children:[e(v,{size:"sm",color:"success",variant:"flat",startContent:e(Ie,{className:"w-4 h-4"}),onPress:()=>G&&G(Array.from(g)),children:"Approve Selected"}),e(v,{size:"sm",color:"danger",variant:"flat",startContent:e(Ue,{className:"w-4 h-4"}),onPress:()=>J&&J(Array.from(g)),children:"Reject Selected"})]}),e(v,{size:"sm",variant:"light",onPress:()=>K(new Set),children:"Clear Selection"})]})]})})}),e(de,{className:"max-h-[70vh]",children:r(Be,{isStriped:!0,selectionMode:c?"multiple":"none",selectionBehavior:"toggle",selectedKeys:g,onSelectionChange:K,isCompact:!D,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[222px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e(He,{columns:Ce,children:a=>e(Oe,{align:a.uid==="actions"?"center":"start",className:"bg-default-100/50 backdrop-blur-md",children:r(s,{className:"flex items-center gap-2",children:[a.icon&&e(a.icon,{className:"w-4 h-4"}),e("span",{children:a.name})]})},a.uid)}),e(Qe,{items:w,emptyContent:r(s,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(C,{className:"w-12 h-12 text-default-300 mb-4"}),e(i,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(i,{variant:"body2",color:"textSecondary",children:q?`No leaves found for "${q}"`:"No leave requests for the selected period"})]}),children:a=>e(Ze,{children:t=>ve(a,t)},a.id)})]})}),O>Z&&e(s,{className:"py-4 flex justify-center",children:e(we,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:H,total:Q,onChange:A,size:xe?"sm":"md"})})]})};export{ca as L};
