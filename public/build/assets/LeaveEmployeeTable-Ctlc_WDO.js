import{r as i,R as te,J as Se,g as ke,b as e,a as r,h as re,i as se,F as Fe}from"./app-WmnCG5Fz.js";import{u as Re,e as E,E as $e,I as M,B as o,O as Le,T as l,ae as oe,af as ne,ag as ie,ah as T,f as y,a9 as ce,M as C,L as B,h as le,ai as je,aj as ze,S as De,d as Ee}from"./App-0uPz_bAn.js";import{F as de,a as me}from"./PencilIcon-mmkGg9B9.js";import{F as he}from"./TrashIcon-BzUzIQjK.js";import{a as Me,b as Te,F as Be}from"./XCircleIcon-Cepy0lLj.js";import{F as I}from"./UserIcon-Cuyhv7eW.js";import{C as Ie}from"./CardContent-CjdXiIyz.js";import{a as f}from"./colorManipulator-DEnRusvB.js";import{e as w,t as Pe,a as Ue,b as We,c as He,d as Oe}from"./chunk-F3UDT23P-BsXw7IEw.js";import{t as ue}from"./chunk-7ZZXWEXF-BmpCvzUQ.js";import{u as fe}from"./chunk-R6AK6OQ4-CsNm-kki.js";import{p as pe}from"./chunk-O5I3QTYU-BnrCVQWa.js";function Ze({title:m,titleId:d,...p},h){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":d},p),m?i.createElement("title",{id:d},m):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"}))}const qe=i.forwardRef(Ze);function Ge({title:m,titleId:d,...p},h){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":d},p),m?i.createElement("title",{id:d},m):null,i.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z",clipRule:"evenodd"}))}const Je=i.forwardRef(Ge),Qe=te.forwardRef(({leaves:m,allUsers:d,handleClickOpen:p,setCurrentLeave:h,openModal:S,setLeaves:P,setCurrentPage:k,currentPage:U,totalRows:W,lastPage:H,perPage:O,selectedMonth:Ye,employee:Z,isAdminView:x=!1,onBulkApprove:Xe,onBulkReject:Ae,canApproveLeaves:_=!1,canEditLeaves:F=!1,canDeleteLeaves:R=!1,fetchLeavesStats:xe},Ke)=>{var K,V;const{auth:q}=Se().props,c=Re(),ge=E("(min-width: 1025px)"),we=E("(min-width: 641px) and (max-width: 1024px)"),be=E("(max-width: 640px)"),[v,G]=i.useState(!1),[$,J]=i.useState(null),[Ve,ea]=i.useState(new Set);(K=q.permissions)!=null&&K.includes("leaves.view"),(V=q.permissions)!=null&&V.includes("leave.own.view");const Ne=x&&(_||F||R),u={New:{color:"primary",icon:Be,bgColor:f(c.palette.primary.main,.1),textColor:c.palette.primary.main},Pending:{color:"warning",icon:Je,bgColor:f(c.palette.warning.main,.1),textColor:c.palette.warning.main},Approved:{color:"success",icon:Te,bgColor:f(c.palette.success.main,.1),textColor:c.palette.success.main},Declined:{color:"danger",icon:Me,bgColor:f(c.palette.error.main,.1),textColor:c.palette.error.main}},ye=a=>{switch(a==null?void 0:a.toLowerCase()){case"casual":return e(ze,{className:"w-3 h-3 text-blue-500"});case"weekend":return e(je,{className:"w-3 h-3 text-yellow-500"});case"sick":return e(qe,{className:"w-3 h-3 text-red-500"});case"earned":return e(B,{className:"w-3 h-3 text-green-500"});default:return e(C,{className:"w-3 h-3 text-primary"})}},Q=i.useCallback(a=>{k&&k(a)},[k]),L=i.useCallback(async(a,t)=>{if(v)return;G(!0),J(`${a.id}-${t}`);const n=new Promise(async(s,b)=>{var g,ee,ae;try{const N=await ke.post(route("leave-update-status"),{id:a.id,status:t});N.status===200&&(P(z=>z.map(D=>D.id===a.id?{...D,status:t}:D)),xe(),s(N.data.message||"Leave status updated successfully"))}catch(N){const z=((ee=(g=N.response)==null?void 0:g.data)==null?void 0:ee.message)||((ae=N.response)==null?void 0:ae.statusText)||"Failed to update leave status";b(z),console.error(N)}finally{G(!1),J(null)}});$e.promise(n,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"})},[P,v]),Y=a=>{const t=u[a]||u.New,n=t.icon;return e(le,{size:"sm",variant:"flat",color:t.color,startContent:e(n,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:a})},X=(a,t)=>{const n=new Date(a),s=new Date(t),b=Math.abs(s-n),g=Math.ceil(b/(1e3*60*60*24))+1;return g===1?"1 day":`${g} days`},j=a=>new Date(a).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),A=a=>(d==null?void 0:d.find(t=>String(t.id)===String(a)))||{name:"Unknown User",phone:""},_e=({leave:a})=>{const t=A(a.user_id),n=X(a.from_date,a.to_date);return u[a.status]||u.New,e(Ee,{className:"mb-2",shadow:"sm",children:r(Ie,{className:"p-3",children:[r(o,{className:"flex items-start justify-between mb-3",children:[e(o,{className:"flex items-center gap-3 flex-1",children:x&&e(fe,{avatarProps:{radius:"lg",size:"sm",src:t==null?void 0:t.profile_image,fallback:e(I,{className:"w-4 h-4"})},name:e(l,{variant:"body2",fontWeight:"medium",children:t==null?void 0:t.name}),description:e(l,{variant:"caption",color:"textSecondary",children:t==null?void 0:t.phone})})}),r(o,{className:"flex items-center gap-2",children:[Y(a.status),Ne&&r(oe,{children:[e(ne,{children:e(M,{size:"small",children:e(me,{className:"w-4 h-4"})})}),r(ie,{"aria-label":"Leave actions",children:[F&&e(T,{startContent:e(de,{className:"w-4 h-4"}),onPress:()=>{console.log(a),h(a),S("edit_leave")},children:"Edit Leave"},"edit"),R&&e(T,{className:"text-danger",color:"danger",startContent:e(he,{className:"w-4 h-4"}),onPress:()=>p(a.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(se,{className:"my-3"}),r(De,{spacing:2,children:[r(o,{className:"flex items-center gap-2",children:[e(C,{className:"w-4 h-4 text-primary"}),e(l,{variant:"body2",fontWeight:"medium",children:a.leave_type})]}),r(o,{className:"flex items-center gap-2",children:[e(y,{className:"w-4 h-4 text-default-500"}),r(l,{variant:"body2",color:"textSecondary",children:[j(a.from_date)," - ",j(a.to_date)]}),e(le,{size:"sm",variant:"bordered",color:"default",children:n})]}),a.reason&&r(o,{className:"flex items-start gap-2",children:[e(B,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(l,{variant:"body2",color:"textSecondary",className:"flex-1",children:a.reason})]})]}),x&&_&&r(Fe,{children:[e(se,{className:"my-3"}),e(o,{className:"flex gap-2",children:["Approved","Declined"].map(s=>e(re,{size:"sm",variant:a.status===s?"solid":"bordered",color:u[s].color,isLoading:$===`${a.id}-${s}`,onPress:()=>L(a,s),startContent:!$||$!==`${a.id}-${s}`?te.createElement(u[s].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:s},s))})]})]})})},ve=i.useCallback((a,t)=>{const n=A(a.user_id);switch(t){case"employee":return e(w,{className:"whitespace-nowrap",children:e(fe,{avatarProps:{radius:"lg",size:"sm",src:n==null?void 0:n.profile_image,fallback:e(I,{className:"w-4 h-4"})},description:e(l,{variant:"caption",className:"text-xs",children:n==null?void 0:n.phone}),name:e(l,{variant:"body2",className:"text-sm font-medium",children:n==null?void 0:n.name})})});case"leave_type":return e(w,{children:r(o,{className:"flex items-center gap-1",children:[ye(a.leave_type),e(l,{variant:"body2",className:"text-sm font-medium capitalize",children:a.leave_type})]})});case"from_date":case"to_date":return e(w,{children:r(o,{className:"flex items-center gap-1",children:[e(y,{className:"w-3 h-3 text-default-500"}),r(o,{children:[e(l,{variant:"body2",className:"text-sm",children:j(a[t])}),t==="from_date"&&e(l,{variant:"caption",className:"text-xs",color:"textSecondary",children:X(a.from_date,a.to_date)})]})]})});case"status":return e(w,{children:r(o,{className:"flex items-center gap-2",children:[Y(a.status),x&&_&&r(oe,{children:[e(ne,{children:e(re,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:v,children:e(me,{className:"w-4 h-4"})})}),e(ie,{"aria-label":"Status actions",onAction:s=>L(a,s),children:Object.keys(u).map(s=>{const b=u[s],g=b.icon;return e(T,{startContent:e(g,{className:"w-4 h-4"}),color:b.color,children:s},s)})})]})]})});case"reason":return e(w,{children:e(Le,{title:a.reason||"No reason provided",children:e(l,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:a.reason||"No reason provided"})})});case"actions":return console.log(a),e(w,{children:r(o,{className:"flex items-center gap-1",children:[F&&e(ue,{content:"Edit Leave",children:e(M,{size:"small",onClick:()=>{console.log(a),h(a),S("edit_leave")},sx:{background:f(c.palette.primary.main,.1),"&:hover":{background:f(c.palette.primary.main,.2)}},children:e(de,{className:"w-4 h-4"})})}),R&&e(ue,{content:"Delete Leave",color:"danger",children:e(M,{size:"small",onClick:()=>{h(a),p(a.id,"delete_leave")},sx:{background:f(c.palette.error.main,.1),"&:hover":{background:f(c.palette.error.main,.2)}},children:e(he,{className:"w-4 h-4"})})})]})});default:return e(w,{children:a[t]})}},[x,_,ge,v,c,h,S,p,L]),Ce=[...x?[{name:"Employee",uid:"employee",icon:I}]:[],{name:"Leave Type",uid:"leave_type",icon:C},{name:"From Date",uid:"from_date",icon:y},{name:"To Date",uid:"to_date",icon:y},{name:"Status",uid:"status",icon:B},{name:"Reason",uid:"reason",icon:C},...x?[{name:"Actions",uid:"actions"}]:[]];return be?r(o,{className:"space-y-4",children:[e(ce,{className:"max-h-[70vh]",children:m.map(a=>e(_e,{leave:a},a.id))}),W>O&&e(o,{className:"flex justify-center pt-4",children:e(pe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:U,total:H,onChange:Q,size:"sm"})})]}):r(o,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(ce,{className:"max-h-[70vh]",children:r(Pe,{isStriped:!0,selectionMode:"none",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(Ue,{columns:Ce,children:a=>e(We,{align:a.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:r(o,{className:"flex items-center gap-1",children:[a.icon&&e(a.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:a.name})]})},a.uid)}),e(He,{items:m,emptyContent:r(o,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(y,{className:"w-12 h-12 text-default-300 mb-4"}),e(l,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(l,{variant:"body2",color:"textSecondary",children:Z?`No leaves found for "${Z}"`:"No leave requests for the selected period"})]}),children:a=>e(Oe,{children:t=>ve(a,t)},a.id)})]})}),W>O&&e(o,{className:"py-4 flex justify-center",children:e(pe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:U,total:H,onChange:Q,size:we?"sm":"md"})})]})});Qe.displayName="LeaveEmployeeTable";export{Qe as L};
