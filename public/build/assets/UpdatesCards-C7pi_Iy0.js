import{u as se,r as p,n as q,G as ne,l as oe,c as I,J as ie,j as e,b as r,e as J,a as le,R as ce}from"./app-DTfQ0ryi.js";import{an as de,ao as me,ap as pe,K as Q,f as W,B as s,d as i,F as z,b as M,H as X,G as T,c as Z,aq as ue,u as he,W as K,k as fe}from"./App-BmXwj8rC.js";import{d as w}from"./dayjs.min-CuBAo57k.js";import{i as ge}from"./isBetween-TVt4bUe5.js";import{F as xe}from"./ExclamationTriangleIcon-CC0GRkJn.js";import{C as ee}from"./CardHeader-BN-N7opI.js";import{D as O}from"./Divider-rLzPzUK-.js";import{C as te}from"./CardContent-Da8BZYXD.js";import{F as V}from"./UserIcon-C_qrw10i.js";import{P as ye}from"./Popover-CfYxylf5.js";import{F as ve}from"./XCircleIcon-BCFz0CYl.js";import{F as we}from"./CheckCircleIcon-DPjoGATP.js";import{s as Y}from"./chunk-TLYTI3QM-BFocYPlB.js";import"./app-B6LlI8BB.js";import"./dividerClasses-BnXuopdh.js";function be(D={}){const{as:F,ref:b,max:u=5,total:f,size:h,color:g,radius:N,children:n,isBordered:x,isDisabled:G,isGrid:d,renderCount:U,className:S,classNames:C,...R}=D,k=se(b),A=F||"div",P=p.useMemo(()=>({size:h,color:g,radius:N,isGrid:d,isBordered:x,isDisabled:G}),[h,g,N,d,x,G]),j=p.useMemo(()=>de({className:S,isGrid:d}),[S,d]),t=me(n),m=u?t.slice(0,u):t,_=f||(u!=null?t.length-u:-1),$=m.map((y,c)=>{const B=c===0,H=c===m.length-1,E={className:q(B?"ms-0":d?"":"-ms-2",H&&_<1?"hover:-translate-x-0":"")};return p.cloneElement(y,ne(E))});return{Component:A,context:P,remainingCount:_,clones:$,renderCount:U,getAvatarGroupProps:()=>({ref:k,className:j.base({class:q(C==null?void 0:C.base,S)}),role:"group",...R}),getAvatarGroupCountProps:()=>({className:j.count({class:C==null?void 0:C.count})})}}var ae=oe((D,F)=>{const{Component:b,clones:u,context:f,remainingCount:h,getAvatarGroupCountProps:g,getAvatarGroupProps:N,renderCount:n=x=>I.jsx(Q,{...g(),name:`+${x}`})}=be({...D,ref:F});return I.jsx(b,{...N(),children:I.jsxs(pe,{value:f,children:[u,h>0&&n(h)]})})});ae.displayName="HeroUI.AvatarGroup";var Ne=ae;w.extend(ge);const Se=({title:D,items:F,users:b,icon:u,color:f})=>{var k,A,P,j;const h=he(),[g,N]=p.useState(null),[n,x]=p.useState(null),G=(t,m)=>{N(t.currentTarget),x(m)},d=()=>{N(null),x(null)},U=!!g,S=U?"leave-details-popover":void 0,C=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return e(we,{className:"w-4 h-4 text-success"});case"rejected":return e(ve,{className:"w-4 h-4 text-danger"});default:return e(M,{className:"w-4 h-4 text-warning"})}},R=t=>{switch(t==null?void 0:t.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return r(Z,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e(ee,{title:r(s,{className:"flex items-center gap-3",children:[e(s,{sx:{bgcolor:`${f}20`,borderRadius:"12px",p:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:40,minHeight:40},children:e(u,{style:{width:"20px",height:"20px",color:f,strokeWidth:2},"aria-hidden":"true"})}),e(i,{variant:"h6",component:"h2",sx:{fontSize:{xs:"1rem",sm:"1.1rem",md:"1.2rem"},fontWeight:600},children:D})]}),sx:{pb:1}}),e(O,{}),e(s,{sx:{flex:1,overflow:"auto"},children:F.map((t,m)=>r(ce.Fragment,{children:[e(T,{in:!0,timeout:300+m*100,children:r(te,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2},children:[r(s,{sx:{display:"flex",flexDirection:"column",flex:1,mr:2},children:[e(i,{variant:"body2",color:"text.primary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},lineHeight:1.4},children:t.text}),t.leaves&&t.leaves.length>0&&r(i,{variant:"caption",color:"text.secondary",className:"flex items-center gap-1 mt-1",children:[e(X,{className:"w-3 h-3"}),t.leaves.length," employee",t.leaves.length>1?"s":""]})]}),t.leaves&&(()=>{const _=t.leaves.filter($=>$.leave_type===t.type);return _.length>0&&e(s,{sx:{display:"flex",gap:1,flexShrink:0},children:e(Ne,{max:4,isBordered:!0,size:"sm",children:_.map(($,a)=>{const o=b.find(y=>String(y.id)===String($.user_id));return o&&e(Q,{src:o.profile_image,alt:`${o.name} - on leave`,onClick:y=>G(y,$),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e(V,{className:"w-4 h-4"})},a)})})})})()]})}),m<F.length-1&&e(O,{})]},m))}),e(ye,{id:S,open:U,anchorEl:g,onClose:d,PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:((k=h.glassCard)==null?void 0:k.background)||"rgba(255, 255, 255, 0.9)",border:((A=h.glassCard)==null?void 0:A.border)||"1px solid rgba(255, 255, 255, 0.2)",borderRadius:2,boxShadow:((P=h.glassCard)==null?void 0:P.boxShadow)||"0 8px 32px 0 rgba(31, 38, 135, 0.37)",padding:2,minWidth:"300px"}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},role:"dialog","aria-labelledby":"leave-details-title","aria-describedby":"leave-details-content",children:n&&r(s,{component:"section","aria-labelledby":"leave-details-title",children:[r(i,{id:"leave-details-title",variant:"subtitle1",fontWeight:"600",className:"flex items-center gap-2 mb-3",children:[e(K,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),r(s,{id:"leave-details-content",className:"space-y-2",children:[r(s,{className:"flex items-start gap-2",children:[e(V,{className:"w-4 h-4 text-default-500 mt-0.5 flex-shrink-0"}),r(s,{children:[e(i,{variant:"caption",color:"text.secondary",component:"span",children:"Employee:"}),e(i,{variant:"body2",component:"div",fontWeight:"500",children:((j=b.find(t=>String(t.id)===String(n.user_id)))==null?void 0:j.name)||"Unknown"})]})]}),r(s,{className:"flex items-start gap-2",children:[e(z,{className:"w-4 h-4 text-default-500 mt-0.5 flex-shrink-0"}),r(s,{children:[e(i,{variant:"caption",color:"text.secondary",component:"span",children:"Duration:"}),e(i,{variant:"body2",component:"div",fontWeight:"500",children:n.from_date!==n.to_date?`${new Date(n.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(n.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(n.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),r(s,{className:"flex items-start gap-2",children:[e(K,{className:"w-4 h-4 text-default-500 mt-0.5 flex-shrink-0"}),r(s,{children:[e(i,{variant:"caption",color:"text.secondary",component:"span",children:"Reason:"}),e(i,{variant:"body2",component:"div",fontWeight:"500",children:n.reason||"No reason provided"})]})]}),r(s,{className:"flex items-center gap-2",children:[C(n.status),r(s,{children:[e(i,{variant:"caption",color:"text.secondary",component:"span",children:"Status:"}),e(fe,{label:n.status||"Pending",variant:"flat",color:R(n.status),size:"sm",className:"ml-2"})]})]})]})]})})]})},He=()=>{const{auth:D}=ie().props,[F,b]=p.useState(!0),[u,f]=p.useState(null),[h,g]=p.useState([]),[N,n]=p.useState([]),[x,G]=p.useState([]),[d,U]=p.useState(null);p.useEffect(()=>{let a=!0;const o=new AbortController;return(async()=>{try{b(!0),f(null);const c=await le.get(route("updates"),{signal:o.signal,timeout:1e4});a&&c.data&&(g(c.data.users||[]),n(c.data.todayLeaves||[]),G(c.data.upcomingLeaves||[]),U(c.data.upcomingHoliday||null))}catch(c){a&&!o.signal.aborted&&(console.error("Failed to fetch updates:",c),f(c.message),g([]),n([]),G([]),U(null))}finally{a&&b(!1)}})(),()=>{a=!1,o.abort()}},[]);const S=(a,o)=>{let y=o;const c=l=>o.some(L=>String(L.user_id)===String(D.user.id)&&L.leave_type===l)?(y=o.filter(L=>String(L.user_id)!==String(D.user.id)),`You ${a==="today"?"are":"will be"} on ${l} leave.`):null,B=o.reduce((l,v)=>{const L=c(v.leave_type);return L&&!l.some(re=>re.type===v.leave_type)&&l.push({text:L,type:v.leave_type}),l},[]),H=y.reduce((l,v)=>(l[v.leave_type]=(l[v.leave_type]||0)+1,l),{}),E=Object.entries(H).map(([l,v])=>({text:`${v} person${v>1?"s":""} ${a==="today"?"is":"will be"} on ${l} leave`,type:l,leaves:y.filter(L=>L.leave_type===l)}));return[...B,...E]},C=w(),R=C.add(1,"day"),k=R.add(7,"day"),A=N.filter(a=>w(C).isBetween(w(a.from_date),w(a.to_date),"day","[]")),P=x.filter(a=>w(R).isBetween(w(a.from_date),w(a.to_date),"day","[]")),j=x.filter(a=>(w(a.from_date).isBetween(R,k,"day","[]")||w(a.to_date).isBetween(R,k,"day","[]"))&&!/week/i.test(a.leave_type)),t=S("today",A),m=S("tomorrow",P),_=S("nextSevenDays",j);t.length===0&&t.push({text:"No one is away today."}),m.length===0&&m.push({text:"No one is away tomorrow."}),_.length===0&&_.push({text:"No one is going to be away in the next seven days."});const $=[{title:"Today",items:t,icon:z,color:"#3b82f6"},{title:"Tomorrow",items:m,icon:M,color:"#10b981"},{title:"Next Seven Days",items:_,icon:X,color:"#f59e0b"}];return F?e(s,{sx:{p:2},component:"section","aria-label":"Employee updates loading",children:e(W,{container:!0,spacing:3,children:[1,2,3].map((a,o)=>e(W,{item:!0,xs:12,sm:6,md:4,children:r(J,{className:"w-full h-full p-4",radius:"lg",children:[e(Y,{className:"rounded-lg mb-2",isLoaded:!1,children:e("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e(Y,{className:"rounded-lg",isLoaded:!1,children:e("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},o))})}):u?e(s,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"200px"},children:e(J,{className:"p-4 bg-danger-50 border-danger-200",children:r(s,{className:"flex items-center gap-3",children:[e(xe,{className:"w-5 h-5 text-danger"}),r(i,{color:"error",variant:"body1",children:["Failed to load updates: ",u]})]})})}):r(s,{sx:{p:2},component:"section","aria-label":"Employee Updates Dashboard",children:[e(W,{container:!0,spacing:3,sx:{alignItems:"stretch"},children:$.map((a,o)=>e(W,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e(T,{in:!0,timeout:300+o*100,style:{width:"100%"},children:e(s,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:e(Se,{title:a.title,items:a.items,users:h,icon:a.icon,color:a.color})})})},a.title))}),d&&e(T,{in:!0,timeout:800,children:e(s,{sx:{mt:3},children:r(Z,{children:[e(ee,{title:r(s,{className:"flex items-center gap-3",children:[e(s,{sx:{bgcolor:"#f59e0b20",borderRadius:"12px",p:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:40,minHeight:40},children:e(ue,{style:{width:"20px",height:"20px",color:"#f59e0b",strokeWidth:2},"aria-hidden":"true"})}),e(i,{variant:"h6",component:"h2",sx:{fontSize:{xs:"1rem",sm:"1.1rem",md:"1.2rem"},fontWeight:600},children:"Upcoming Holiday"})]})}),e(O,{}),e(te,{children:r(s,{className:"flex items-center gap-3",children:[e(z,{className:"w-5 h-5 text-primary"}),r(s,{children:[e(i,{variant:"body1",fontWeight:"600",color:"text.primary",children:d.name}),r(i,{variant:"body2",color:"text.secondary",className:"flex items-center gap-1 mt-1",children:[e(M,{className:"w-4 h-4"}),new Date(d.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(d.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]})})]})})})]})};export{He as default};
