import{r as n,a as e,j as a,d as G,F as he,R as ue,Q as fe,b as j}from"./app-DDhVNfvV.js";import{u as ie,G as le}from"./GlassCard-B8deHOrc.js";import{P as ge}from"./PageHeader-qfMvUU9K.js";import{S as be}from"./StatsCards-CaEaffu4.js";import{u as B,F as J,s as X,S as ye,T as we,I as xe,a as ve,G as Ne,B as ke,A as Me}from"./App-CULBC9Jb.js";import{d as l}from"./dayjs.min-Dao2E2MD.js";import{F as H}from"./UserIcon-BZDmR83e.js";import{s as $e}from"./chunk-TLYTI3QM-Dj5Yyjz6.js";import{B as c,T as R}from"./logo-DoLGM3I0.js";import{C as K}from"./CardHeader-BPTzkM70.js";import{C as Q}from"./CardContent-783YhD2K.js";import{R as _e}from"./Refresh-CuluZUUz.js";import{t as Fe,a as Re,b as Se,c as Ye,d as Ae,e as P}from"./chunk-F3UDT23P-Bon0qFEG.js";import{t as ee}from"./chunk-7ZZXWEXF-D8xxaoD-.js";import{u as te}from"./chunk-R6AK6OQ4-DKmNo5vD.js";import{F as Ce}from"./ExclamationTriangleIcon-yxjMXoYE.js";import{F as Pe}from"./XCircleIcon-BHAPYRVJ.js";import{F as Ee}from"./CheckCircleIcon-XdRlDbc5.js";import{a as Z}from"./colorManipulator-gWZ2MT7C.js";import{c as re}from"./chunk-J7I6W5JF-Dj4B-Czi.js";import{F as Le}from"./UserGroupIcon-CFQYzcyB.js";import{c as ae}from"./DocumentTextIcon-QwzC9WoH.js";import{F as Te}from"./CheckCircleIcon-BkPxWqsz.js";import{F as We}from"./ExclamationTriangleIcon-3tpAB86s.js";import{F as je}from"./ChartBarIcon-CzsPYg0y.js";import{F as oe}from"./ClockIcon-UBQM4q2z.js";import{F as Be}from"./MagnifyingGlassIcon-h1CDx0iK.js";import{p as He}from"./chunk-O5I3QTYU-BlPqa12Y.js";import{F as ne}from"./DocumentArrowDownIcon-C7bxjW28.js";import{F as Ie}from"./PresentationChartLineIcon-BNoIiPag.js";import{i as se}from"./chunk-6MDMHKHV-DNEscIMF.js";import"./app-CYwLuuRk.js";import"./create-visual-element-DIA5r6xh.js";import"./chunk-D5XJWRAV-BEd1Mod5.js";import"./EnvelopeIcon-jGHS91X9.js";import"./CreditCardIcon-nnu7lg95.js";import"./ShieldCheckIcon-B8pnYfIx.js";import"./QuestionMarkCircleIcon-ClI4UiU9.js";import"./BuildingOfficeIcon-BXNAJj1w.js";import"./KeyIcon-CAZJdP6I.js";import"./InformationCircleIcon-D0VUrEF1.js";import"./StarIcon-CB497gpk.js";import"./GlobeAltIcon-BeSAdHAC.js";import"./LockClosedIcon-CNT0kaEE.js";import"./chunk-LGMZDQT5-CF5HrKbt.js";import"./number-DfkVkf0F.js";import"./index-I7bPq2YP.js";import"./chunk-A6PX3NG3-DZLS-1Gt.js";import"./useLabels-Blg_QI1U.js";import"./XMarkIcon-CRGrHH6E.js";import"./useFormReset-Dv_1w4_q.js";import"./chunk-MZRCPRP2-4Sm2aTj8.js";import"./useHasTabbableChild-BMncZCCk.js";import"./chunk-7F3ZLNJ6-CHfbZssJ.js";import"./chunk-M3MASYO7-DaLySJZS.js";import"./index-CokAva9Y.js";import"./useLabel-C1JBDqVQ.js";function Ue({title:g,titleId:d,...u},b){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":d},u),g?n.createElement("title",{id:d},g):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const E=n.forwardRef(Ue);function ze({title:g,titleId:d,...u},b){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":d},u),g?n.createElement("title",{id:d},g):null,n.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const Oe=n.forwardRef(ze),De=({loading:g,attendanceData:d,currentYear:u,currentMonth:b,leaveTypes:v,leaveCounts:F,onRefresh:L})=>{const S=ie(),T=B("(min-width: 1025px)");B("(min-width: 641px) and (max-width: 1024px)");const I=B("(max-width: 640px)"),Y=l(`${u}-${b}-01`).daysInMonth(),U={"√":{icon:Ee,color:"text-success",bg:"bg-success-100",label:"√",short:"P"},"▼":{icon:Pe,color:"text-danger",bg:"bg-danger-100",label:"▼",short:"A"},"#":{icon:Ce,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:Oe,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},z=n.useMemo(()=>[{label:"No.",key:"sl",icon:E,width:60},{label:"Employee",key:"name",icon:H,width:200},...Array.from({length:Y},(t,f)=>{const N=f+1,M=l(`${u}-${b}-${N}`);return{label:`${N}`,sublabel:M.format("ddd"),key:`day-${N}`,width:40,isWeekend:M.day()===0||M.day()===6}}),...v?v.map(t=>({label:t.type,key:t.type,icon:J,width:80})):[]],[Y,u,b,v]),W=t=>U[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},O=({data:t,index:f,daysInMonth:N,currentMonth:M,currentYear:x,leaveTypes:h,leaveCounts:k})=>e(le,{className:"mb-4",shadow:"sm",children:a(Q,{children:[e(c,{className:"flex items-center gap-3 mb-4",children:e(te,{avatarProps:{radius:"lg",size:"md",src:t.profile_image,fallback:e(H,{className:"w-6 h-6"})},name:e(R,{variant:"body1",fontWeight:"medium",children:t.name||"Unknown"}),description:a(R,{variant:"caption",color:"textSecondary",children:["Employee #",f+1]})})}),e(G,{className:"my-3"}),e(c,{className:"grid grid-cols-7 sm:grid-cols-7 xs:grid-cols-4 grid-cols-3 gap-1 mb-4",children:Array.from({length:N},(o,m)=>{const y=m+1,r=l(`${x}-${M}-${y}`).format("YYYY-MM-DD"),i=t[r],D=l(r).day()===0||l(r).day()===6,A=typeof i=="object"&&(i==null?void 0:i.status)||"▼",_=W(A);return e(ee,{placement:"top",content:a("div",{className:"text-sm space-y-1",children:[a("div",{children:[e("strong",{children:"Status:"})," ",A]}),a("div",{children:[e("strong",{children:"Punch In:"})," ",(i==null?void 0:i.punch_in)||"-"]}),a("div",{children:[e("strong",{children:"Punch Out:"})," ",(i==null?void 0:i.punch_out)||"-"]}),a("div",{children:[e("strong",{children:"Work Hours:"})," ",(i==null?void 0:i.total_work_hours)||"00:00"]}),a("div",{children:[e("strong",{children:"Remarks:"})," ",(i==null?void 0:i.remarks)||"N/A"]})]}),className:"z-[99999]",children:a(c,{className:`
                                        flex flex-col items-center justify-center p-1 rounded text-xs cursor-pointer
                                        ${D?"bg-default-100":"bg-default-50"}
                                        ${_.bg}
                                    `,children:[e("span",{className:"font-medium",children:y}),e("span",{children:_.icon?e(_.icon,{className:`w-3 h-3 ${_.color}`}):e("span",{className:_.color,children:A})})]})},y)})}),(h==null?void 0:h.length)>0&&e(c,{className:"flex flex-wrap gap-2",children:h.map(o=>{var y;const m=((y=k==null?void 0:k[t.user_id])==null?void 0:y[o.type])||0;return a(re,{size:"sm",variant:"flat",color:m>0?"warning":"default",startContent:e(J,{className:"w-3 h-3"}),children:[o.type,": ",m]},o.type)})})]})});return g?e(c,{className:"flex justify-center items-center h-64",children:e($e,{className:"w-full h-full rounded-lg"})}):!d||d.length===0?a(c,{className:"flex flex-col items-center justify-center py-8",children:[e(E,{className:"w-12 h-12 text-default-300 mb-4"}),e(R,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):I?a(he,{children:[e(K,{title:a(c,{className:"flex items-center gap-3",children:[e(E,{className:"w-6 h-6 text-primary"}),e(R,{variant:"h6",component:"h1",children:"Attendance Report"})]})}),e(G,{}),e(Q,{sx:{p:0},children:e(X,{className:"max-h-[70vh]",children:d.map((t,f)=>e(O,{data:t,index:f,daysInMonth:Y,currentMonth:b,currentYear:u,leaveTypes:v,leaveCounts:F},t.user_id||f))})})]}):a(c,{children:[e(K,{title:a(c,{className:"flex items-center gap-3",children:[e(E,{className:"w-6 h-6 text-primary"}),a(R,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",l(`${u}-${b}-01`).format("MMMM YYYY")]})]}),action:e(ye,{direction:"row",spacing:1,children:L&&e(we,{title:"Refresh Data",children:e(xe,{onClick:L,disabled:g,sx:{background:Z(S.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${Z(S.palette.primary.main,.2)}`,"&:hover":{background:Z(S.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(_e,{color:"primary"})})})}),sx:{padding:"24px"}}),e(G,{}),e(Q,{children:e(c,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e(X,{className:"max-h-[70vh]",children:a(Fe,{isCompact:!T,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e(Re,{columns:z,children:t=>e(Se,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:a(c,{className:"flex flex-col items-center gap-1",children:[a(c,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e(Ye,{items:d,emptyContent:a(c,{className:"flex flex-col items-center justify-center py-8",children:[e(E,{className:"w-12 h-12 text-default-300 mb-4"}),e(R,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e(Ae,{children:f=>{var M;const N=d.findIndex(x=>(x.user_id||x.id)===(t.user_id||t.id));switch(f){case"sl":return e(P,{className:"text-center font-medium",children:N+1});case"name":return e(P,{className:"whitespace-nowrap",children:e(te,{avatarProps:{radius:"lg",size:T?"md":"sm",src:t.profile_image,fallback:e(H,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(f.startsWith("day-")){const h=parseInt(f.split("-")[1]),k=l(`${u}-${b}-${h}`).format("YYYY-MM-DD"),o=t[k],m=l(k).day()===0||l(k).day()===6,y=typeof o=="object"&&(o==null?void 0:o.status)||"▼",r=W(y);return e(P,{className:`text-center ${m?"bg-default-50":""}`,children:e(ee,{content:a("div",{className:"text-sm space-y-1",children:[a("div",{children:[e("strong",{children:"Status:"})," ",y]}),a("div",{children:[e("strong",{children:"Punch In:"})," ",(o==null?void 0:o.punch_in)||"-"]}),a("div",{children:[e("strong",{children:"Punch Out:"})," ",(o==null?void 0:o.punch_out)||"-"]}),a("div",{children:[e("strong",{children:"Work Hours:"})," ",(o==null?void 0:o.total_work_hours)||"00:00"]}),a("div",{children:[e("strong",{children:"Remarks:"})," ",(o==null?void 0:o.remarks)||"N/A"]})]}),placement:"top",className:"z-[99999]",children:e(c,{className:"flex items-center justify-center cursor-help",children:r.icon?e(r.icon,{className:`w-4 h-4 ${r.color}`}):e("span",{className:`text-xs ${r.color}`,children:y})})})})}const x=v==null?void 0:v.find(h=>h.type===f);if(x){const h=((M=F==null?void 0:F[t.user_id])==null?void 0:M[x.type])||0;return e(P,{className:"text-center",children:e(re,{size:"sm",variant:h>0?"flat":"bordered",color:h>0?"warning":"default",className:"min-w-8",children:h})})}return e(P,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},Ge=ue.memo(({title:g})=>{const d=ie(),u=B(d.breakpoints.down("sm")),[b,v]=n.useState(!1),[F,L]=n.useState([]),[S,T]=n.useState([]),[I,Y]=n.useState([]),[U,z]=n.useState(0),[W,O]=n.useState(0),[t,f]=n.useState(""),[N,M]=n.useState(30),[x,h]=n.useState(1),[k,o]=n.useState(""),[m,y]=n.useState({currentMonth:l().format("YYYY-MM")}),[r,i]=n.useState({totalEmployees:0,totalWorkingDays:0,totalDaysInMonth:0,holidaysCount:0,weekendsCount:0,presentDays:0,absentDays:0,lateArrivals:0,attendancePercentage:0,averageWorkHours:0,overtimeHours:0,totalWorkHours:0,totalLeaveDays:0,leaveBreakdown:{},presentToday:0,absentToday:0,lateToday:0,month:"",generated_at:null}),D=n.useCallback((s,$)=>{y(w=>({...w,[s]:$}))},[]),A=async(s=1,$=30,w)=>{v(!0);try{const p=w.currentMonth?l(w.currentMonth).format("MM"):l().format("MM"),V=w.currentMonth?l(w.currentMonth).year():l().year(),C=await j.get(route("attendancesAdmin.paginate"),{params:{page:s,perPage:$,employee:t,currentYear:V,currentMonth:p}});L(C.data.data),z(C.data.total),O(C.data.last_page),Y(C.data.leaveTypes),T(C.data.leaveCounts);const q=await j.get(route("attendance.monthlyStats"),{params:{currentYear:V,currentMonth:p}});q.data.success&&i(q.data.data)}catch(p){console.error(p),ke.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}})}finally{v(!1)}},_=s=>{const $=s.target.value.toLowerCase();f($)};n.useEffect(()=>{A(x,N,m).then(s=>"")},[x,N,m,t]);const ce=s=>{h(s)},de=async()=>{o("excel");try{const s=m.currentMonth?l(m.currentMonth).format("YYYY-MM"):l().format("YYYY-MM"),$=await j.get(route("attendance.exportAdminExcel"),{params:{month:s},responseType:"blob"}),w=window.URL.createObjectURL(new Blob([$.data])),p=document.createElement("a");p.href=w,p.download=`Admin_Attendance_${s}.xlsx`,document.body.appendChild(p),p.click(),o(""),p.remove(),window.URL.revokeObjectURL(w)}catch(s){console.error("Download failed:",s),o(""),alert("Failed to download attendance sheet.")}},me=async()=>{o("pdf");try{const s=m.currentMonth?l(m.currentMonth).format("YYYY-MM"):l().format("YYYY-MM"),$=await j.get(route("attendance.exportAdminPdf"),{params:{month:s},responseType:"blob"}),w=window.URL.createObjectURL(new Blob([$.data],{type:"application/pdf"})),p=document.createElement("a");p.href=w,p.download=`Admin_Attendance_${s}.pdf`,document.body.appendChild(p),p.click(),o(""),p.remove(),window.URL.revokeObjectURL(w)}catch(s){console.error("PDF download failed:",s),o(""),alert("Failed to download attendance PDF.")}},pe=n.useMemo(()=>[{title:"Total Employees",value:r.totalEmployees,icon:e(Le,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Working Days",value:r.totalWorkingDays,icon:e(ae,{}),color:"text-indigo-600",iconBg:"bg-indigo-500/20",description:`This month (${r.month})`},{title:"Present Today",value:r.presentToday,icon:e(Te,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:r.presentToday>0?`${(r.presentToday/r.totalEmployees*100).toFixed(1)}% of employees`:"No attendance yet"},{title:"Absent Today",value:r.absentToday,icon:e(ve,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:r.absentToday>0?`${(r.absentToday/r.totalEmployees*100).toFixed(1)}% absent`:"All present"},{title:"Late Today",value:r.lateToday,icon:e(We,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Late arrivals today"},{title:"Attendance Rate",value:`${r.attendancePercentage}%`,icon:e(je,{}),color:"text-emerald-600",iconBg:"bg-emerald-500/20",description:"Monthly average"},{title:"Avg Work Hours",value:`${r.averageWorkHours}h`,icon:e(oe,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Daily average this month"},{title:"Overtime",value:`${r.overtimeHours}h`,icon:e(oe,{}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Total overtime this month"},{title:"Leave Days",value:r.totalLeaveDays,icon:e(H,{}),color:"text-amber-600",iconBg:"bg-amber-500/20",description:"Total leaves this month"}],[r.totalEmployees,r.totalWorkingDays,r.month,r.presentToday,r.absentToday,r.lateToday,r.attendancePercentage,r.averageWorkHours,r.overtimeHours,r.totalLeaveDays]);return a(c,{children:[e(fe,{title:g}),e(c,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Ne,{in:!0,children:e(le,{children:e(ge,{title:"Attendance Management",subtitle:"Monitor and manage employee attendance records",icon:e(Ie,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Excel",icon:e(ne,{className:"w-4 h-4 text-primary"}),variant:"bordered",onPress:de,isLoading:k==="excel",className:"border-primary/30 bg-primary/5 hover:bg-primary/10 text-primary"},{label:"PDF",icon:e(ne,{className:"w-4 h-4 text-rose-600"}),variant:"bordered",onPress:me,isLoading:k==="pdf",className:"border-rose-600/30 bg-rose-600/5 hover:bg-rose-600/10 text-rose-600"}],children:a("div",{className:"p-6",children:[e(be,{stats:pe,className:"mb-6"}),e("div",{className:"mb-6",children:a("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(se,{label:"Search Employee",type:"text",value:t,onChange:_,placeholder:"Enter employee name...",startContent:e(Be,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:u?"sm":"md"})}),e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(se,{label:"Month/Year",type:"month",value:m.currentMonth,onChange:s=>D("currentMonth",s.target.value),startContent:e(ae,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:u?"sm":"md"})})]})}),a(c,{children:[e(De,{attendanceData:F,currentYear:m.currentYear,currentMonth:m.currentMonth,leaveTypes:I,leaveCounts:S,loading:b}),U>=30&&e("div",{className:"py-4 px-2 flex justify-center items-center",children:e(He,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:x,total:W,onChange:ce,classNames:{wrapper:"bg-white/10 backdrop-blur-md border-white/20",item:"bg-white/5 border-white/10",cursor:"bg-primary/20 backdrop-blur-md"}})})]})]})})})})})]})});Ge.layout=g=>e(Me,{children:g});export{Ge as default};
