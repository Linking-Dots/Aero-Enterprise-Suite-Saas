import{J as Ee,r as o,a as F,j as a,b as p,e as j,Q as De,h as Te,c as G,F as je}from"./app-ICdw8XZW.js";import{u as Ye,a as se,n as Y,c as Be,b as Q,e as re,T as v,B as oe,G as $e,i as le,o as ne,A as ze}from"./App-xKIEJnfh.js";import{P as Oe}from"./PageHeader-C-n7yLRm.js";import{S as Ie}from"./StatsCards-D7x2ogj2.js";import{L as ie,D as qe,a as Ge}from"./DeleteLeaveForm-DgDORNbC.js";import{d as W}from"./dayjs.min-CTpDfE_v.js";import{F as Qe}from"./CheckCircleIcon-9uvhSzaX.js";import{F as We}from"./XCircleIcon-CDAj9LiC.js";import{F as ce}from"./ExclamationTriangleIcon-C5VlXpkt.js";import{F as He}from"./MagnifyingGlassIcon-Dt-4XvL6.js";import{C as Je}from"./CircularProgress-CRTMx9g5.js";import{F as Ke}from"./PlusIcon-DdUPUHsP.js";import{F as Ve}from"./DocumentArrowDownIcon-fIHqZNSI.js";import{F as Xe}from"./PresentationChartLineIcon-COlu8bjC.js";import{s as de,l as me}from"./chunk-2GIFKCNQ-r13Ot1aH.js";import"./app-CA3O2NZp.js";import"./chunk-D5XJWRAV-ChYyTb80.js";import"./PencilIcon-BoMELbc6.js";import"./TrashIcon-6Qn0Ks3i.js";import"./XCircleIcon-Bl2Ah-1J.js";import"./CardContent-DGIH-NyB.js";import"./colorManipulator-BO-pWekM.js";import"./chunk-F3UDT23P-Dzih6ugh.js";import"./chunk-MZRCPRP2-CuDTLPCF.js";import"./LiveAnnouncer-QpWtHmnK.js";import"./useHasTabbableChild-C1gNMPSd.js";import"./chunk-7F3ZLNJ6-bb6GUB3a.js";import"./chunk-7ZZXWEXF-UZIMEnKN.js";import"./chunk-R6AK6OQ4-e2LNdSxP.js";import"./chunk-O5I3QTYU-JuO97IC0.js";import"./index-CokAva9Y.js";import"./Clear-lJ20lSRj.js";import"./GlassDialog-DtkSQAnW.js";import"./DialogContent-C99NR7Vt.js";import"./DialogTitle-FtEY60tO.js";import"./InputLabel-l_RaM-SP.js";import"./Select-CqGdc7ri.js";import"./Popover-Cy1RIh6q.js";import"./List-96IwU692.js";import"./MenuItem-Cz-a5JZM.js";import"./listItemTextClasses-CGb7pYu3.js";import"./dividerClasses-lSRERl2-.js";import"./TextField-gRWRJFLH.js";import"./Avatar-BWjKMW06.js";import"./useSlot-BsD0OkWG.js";import"./LoadingButton-BMZNmXEn.js";import"./Button-ePhGwwaI.js";import"./DialogContentText-nbEfY0qG.js";import"./chunk-2PG5BJX6-BKh2F0Oz.js";const Ze=({title:B,allUsers:$})=>{var X,Z,U,ee,ae;const{auth:w}=Ee().props,H=Ye(),P=se(H.breakpoints.down("sm"));se(H.breakpoints.down("md"));const[z,L]=o.useState(!1),[M,A]=o.useState([]),[d,c]=o.useState(),[k,g]=o.useState(0),[pe,h]=o.useState(0),[R,J]=o.useState(),[K,N]=o.useState(""),[t,ue]=o.useState({employee:"",selectedMonth:W().format("YYYY-MM"),status:"all",leaveType:"all",department:"all"}),[i,E]=o.useState({perPage:30,currentPage:1}),f=o.useCallback((e,s)=>{if(e==="year"){const r=Number(s);if(r<1900||r>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}ue(r=>({...r,[e]:s})),E(r=>({...r,currentPage:1}))},[]),[x,ve]=o.useState({pending:0,approved:0,rejected:0,total:0}),C=((X=w.permissions)==null?void 0:X.includes("leaves.view"))||!1,S=((Z=w.permissions)==null?void 0:Z.includes("leaves.approve"))||!1,ge=((U=w.permissions)==null?void 0:U.includes("leaves.create"))||!1,he=((ee=w.permissions)==null?void 0:ee.includes("leaves.update"))||!1,fe=((ae=w.permissions)==null?void 0:ae.includes("leaves.delete"))||!1,be=o.useMemo(()=>[{key:"all",label:"All Status",value:"all"},{key:"pending",label:"Pending",value:"pending"},{key:"approved",label:"Approved",value:"approved"},{key:"rejected",label:"Rejected",value:"rejected"},{key:"new",label:"New",value:"new"}],[]),ye=o.useMemo(()=>{const e=[{key:"all",label:"All Types",value:"all"}];if(!M.leaveTypes)return e;const s=M.leaveTypes.map(r=>({key:r.type.toLowerCase(),label:r.type,value:r.type.toLowerCase()}));return[...e,...s]},[M.leaveTypes]),we=o.useCallback(e=>{D(s=>({...s,[e]:!0}))},[]),Pe=o.useCallback((e,s)=>{J({id:e}),D(r=>({...r,[s]:!0}))},[]),Me=o.useCallback(e=>{f("employee",e.target.value.toLowerCase())},[f]),O=o.useCallback(e=>{f("selectedMonth",e.target.value)},[f]),ke=o.useCallback(e=>{console.log("Page change requested:",e),E(s=>({...s,currentPage:e}))},[]),Ne=o.useCallback(e=>{E(s=>({...s,perPage:e,currentPage:1}))},[]),u=o.useCallback(async()=>{var e,s,r;L(!0);try{const l=await F.get(route("leaves.paginate"),{params:{page:i.currentPage,perPage:i.perPage,employee:t.employee,month:t.selectedMonth,status:t.status!=="all"?t.status:void 0,leave_type:t.leaveType!=="all"?t.leaveType:void 0,department:t.department!=="all"?t.department:void 0}});if(l.status===200){const{leaves:n,leavesData:m}=l.data;console.log("Fetched leaves data:",l.data),console.log("Leaves structure:",n),n.data&&Array.isArray(n.data)?(console.log("Found paginated data with standard metadata"),c(n.data),g(n.total||n.data.length),h(n.last_page||1),console.log("Pagination info:",{totalRows:n.total,lastPage:n.last_page,currentPage:n.current_page})):Array.isArray(n)?(console.log("Found direct array response without pagination"),c(n),g(n.length),h(1)):(console.error("Unexpected leaves data format:",n),c([]),g(0),h(1)),A(m),N(""),L(!1)}}catch(l){if(console.error("Error fetching leaves data:",l.response),((e=l.response)==null?void 0:e.status)===404){const{leavesData:n}=l.response.data;A(n),N(((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.message)||"No leaves found for the selected criteria.")}else N("Error retrieving leaves data. Please try again.");c(!1),L(!1)}},[t,i.currentPage,i.perPage]),_=o.useCallback(async()=>{var e,s,r;try{const l=await F.get(route("leaves.stats"),{params:{month:t.selectedMonth}});if(l.status===200){const{stats:n}=l.data;ve(n)}}catch(l){console.error("Error fetching leaves data:",l.response),((e=l.response)==null?void 0:e.status)===404?N(((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.message)||"No leaves found for the selected criteria."):N("Error retrieving leaves data. Please try again."),L(!1)}},[t]),xe=o.useCallback(async e=>{if(S)try{(await F.post(route("leaves.bulk-approve"),{leave_ids:e})).status===200&&(u(),Y.success("Selected leaves approved successfully"))}catch(s){console.error("Error bulk approving leaves:",s),Y.error("Failed to approve selected leaves")}},[S,u]),Ce=o.useCallback(async e=>{if(S)try{(await F.post(route("leaves.bulk-reject"),{leave_ids:e})).status===200&&(u(),Y.success("Selected leaves rejected successfully"))}catch(s){console.error("Error bulk rejecting leaves:",s),Y.error("Failed to reject selected leaves")}},[S,u]),Se=o.useMemo(()=>[{title:"Pending",value:x.pending,icon:a(Be,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Awaiting approval"},{title:"Approved",value:x.approved,icon:a(Qe,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Successfully approved"},{title:"Rejected",value:x.rejected,icon:a(We,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Declined requests"},{title:"Total",value:x.total,icon:a(Q,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All leave requests"}],[x]);if(!C)return a(oe,{sx:{display:"flex",justifyContent:"center",p:2},children:a(re,{children:p(j,{className:"p-8 text-center",children:[a(ce,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),a(v,{variant:"h6",className:"mb-2",children:"Access Denied"}),a(v,{variant:"body2",color:"textSecondary",children:"You don't have permission to view leave management."})]})})});const[b,D]=o.useState({add_leave:!1,edit_leave:!1,delete_leave:!1}),_e=o.useRef(null),Fe=o.useCallback(e=>{D(s=>({...s,[e]:!0}))},[]),I=o.useCallback(e=>{D(s=>({...s,[e]:!1}))},[]),y=o.useCallback(e=>[...e].sort((s,r)=>new Date(r.from_date)-new Date(s.from_date)),[]),T=o.useCallback((e,s=null)=>{g(e);const r=Math.max(1,Math.ceil(e/i.perPage));h(r),i.currentPage>r&&E(l=>({...l,currentPage:r})),console.log(`Pagination metadata updated: ${e} total rows, ${r} pages`)},[i.perPage,i.currentPage]),Le=o.useCallback(e=>{const r=W(e.from_date).format("YYYY-MM")===t.selectedMonth,l=!t.employee||String(t.employee)===String(e.user_id);!r||!l||i.currentPage===1&&(c(n=>{const m=[...n,e];return y(m).slice(0,i.perPage)}),T(k+1))},[y,t.selectedMonth,t.employee,i.currentPage,i.perPage,k,T]),Ae=o.useCallback(e=>{const r=W(e.from_date).format("YYYY-MM")===t.selectedMonth,l=!t.employee||String(t.employee)===String(e.user_id),n=d.some(m=>m.id===e.id);if((!r||!l)&&n){c(m=>m.filter(q=>q.id!==e.id));return}!n&&(!r||!l)||n&&c(m=>{const q=m.map(te=>te.id===e.id?e:te);return y(q)})},[y,t.selectedMonth,t.employee,d]),V=o.useCallback(async()=>{if(i.currentPage===1&&d&&d.length<i.perPage){const e=i.perPage-d.length;if(e<=0)return;console.log(`Fetching ${e} additional items to fill the page`);try{const s=await F.get(route("leaves.paginate"),{params:{page:2,perPage:e,employee:t.employee,month:t.selectedMonth,status:t.status!=="all"?t.status:void 0,leave_type:t.leaveType!=="all"?t.leaveType:void 0,department:t.department!=="all"?t.department:void 0}});s.status===200&&s.data.leaves.data&&c(r=>{const l=[...r,...s.data.leaves.data];return y(l)})}catch(s){console.error("Error fetching additional items:",s)}}},[i.currentPage,i.perPage,d,t,y]),Re=o.useCallback(e=>{d.some(r=>r.id===e)&&(c(r=>r.filter(l=>l.id!==e)),T(k-1),V())},[d,k,T,V]);return o.useEffect(()=>{C&&u()},[u,C,i.currentPage,t.employee,t.selectedMonth,t.status,t.leaveType,t.department]),o.useEffect(()=>{C&&_()},[u,C]),p(je,{children:[a(De,{title:B}),b.add_leave&&a(ie,{open:b.add_leave,closeModal:()=>I("add_leave"),leavesData:M,setLeavesData:A,currentLeave:null,allUsers:$,setTotalRows:g,setLastPage:h,setLeaves:c,handleMonthChange:O,employee:t.employee,selectedMonth:t.selectedMonth,addLeaveOptimized:Le,fetchLeavesStats:_}),b.edit_leave&&a(ie,{open:b.edit_leave,closeModal:()=>I("edit_leave"),leavesData:M,setLeavesData:A,currentLeave:R,allUsers:$,setTotalRows:g,setLastPage:h,setLeaves:c,handleMonthChange:O,employee:t.employee,selectedMonth:t.selectedMonth,updateLeaveOptimized:Ae,fetchLeavesStats:_}),b.delete_leave&&a(qe,{open:b.delete_leave,closeModal:()=>I("delete_leave"),leaveId:R==null?void 0:R.id,setLeaves:c,setTotalRows:g,setLastPage:h,deleteLeaveOptimized:Re,fetchLeavesStats:_}),a(oe,{sx:{display:"flex",justifyContent:"center",p:2},children:a($e,{in:!0,children:a(re,{children:a(Oe,{title:"Leave Management",subtitle:"Manage employee leave requests and approvals",icon:a(Xe,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[...ge?[{label:"Add Leave",icon:a(Ke,{className:"w-4 h-4"}),onPress:()=>Fe("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"}]:[],{label:"Export",icon:a(Ve,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-primary-rgb),0.3)] bg-[rgba(var(--theme-primary-rgb),0.05)] hover:bg-[rgba(var(--theme-primary-rgb),0.1)]"}],children:p("div",{className:"p-6",children:[a(Ie,{stats:Se}),a("div",{className:"mb-6",children:p("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(le,{label:"Month/Year",type:"month",value:t.selectedMonth,onChange:O,startContent:a(ne,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:P?"sm":"md"})}),a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(le,{label:"Search Employee",placeholder:"Enter name or ID...",value:t.employee,onChange:Me,startContent:a(He,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:P?"sm":"md"})}),a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(de,{label:"Leave Status",selectedKeys:[t.status],onSelectionChange:e=>f("status",Array.from(e)[0]),variant:"bordered",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:P?"sm":"md",children:be.map(e=>a(me,{value:e.value,children:e.label},e.key))})}),a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(de,{label:"Leave Type",selectedKeys:[t.leaveType],onSelectionChange:e=>f("leaveType",Array.from(e)[0]),variant:"bordered",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:P?"sm":"md",children:ye.map(e=>a(me,{value:e.value,children:e.label},e.key))})}),a("div",{className:"flex gap-2",children:a(Te,{variant:"flat",color:"primary",size:P?"sm":"md",onPress:u,isLoading:z,startContent:!z&&a(Q,{className:"w-4 h-4"}),children:"Refresh"})})]})}),p("div",{className:"min-h-96",children:[p(v,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(Q,{className:"w-5 h-5"}),"Leave Requests Management"]}),z?a(G,{className:"bg-white/10 backdrop-blur-md border-white/20",children:p(j,{className:"text-center py-12",children:[a(Je,{size:40}),a(v,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):d&&d.length>0?a("div",{className:"overflow-hidden rounded-lg",children:a(Ge,{ref:_e,totalRows:k,lastPage:pe,setCurrentPage:ke,setPerPage:Ne,perPage:i.perPage,currentPage:i.currentPage,handleClickOpen:Pe,setCurrentLeave:J,openModal:we,leaves:d,allUsers:$,setLeaves:c,employee:t.employee,selectedMonth:t.selectedMonth,isAdminView:!0,onBulkApprove:xe,onBulkReject:Ce,canApproveLeaves:S,canEditLeaves:he,canDeleteLeaves:fe,fetchLeavesStats:_})}):K?a(G,{className:"bg-white/10 backdrop-blur-md border-white/20",children:p(j,{className:"text-center py-12",children:[a(ce,{className:"w-16 h-16 text-warning-500 mx-auto mb-4"}),a(v,{variant:"h6",className:"mb-2",children:"No Data Found"}),a(v,{color:"textSecondary",children:K})]})}):a(G,{className:"bg-white/10 backdrop-blur-md border-white/20",children:p(j,{className:"text-center py-12",children:[a(ne,{className:"w-16 h-16 text-default-400 mx-auto mb-4"}),a(v,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),a(v,{color:"textSecondary",children:"No leave records found for the selected criteria."})]})})]})]})})})})})]})};Ze.layout=B=>a(ze,{children:B});export{Ze as default};
