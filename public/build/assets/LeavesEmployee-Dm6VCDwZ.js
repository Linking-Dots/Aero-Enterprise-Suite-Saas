import{V as B,j as n,a,M as k,F as N}from"./app-BpFr8bAu.js";import{r as t,e as O,h as U,a as o,G as c,T as l,B as i,D as Y,t as z}from"./vendor-CTZgMKHz.js";import{G as D,A as H}from"./App-ClBMOFtv.js";import{L as K}from"./LeaveEmployeeTable-FMiIhlMP.js";import{s as R,l as V}from"./chunk-7H6JMIKS-Cid9I43i.js";import"./Edit-D8i8ckpX.js";import"./chunk-YRZGWF2W-o6Qhbvsa.js";import"./chunk-CKQ4RPMV-DoiHMJOm.js";import"./chunk-YBBOLEEC-DM11wLJK.js";import"./chunk-7F3ZLNJ6-BN_r0i0A.js";import"./chunk-MT6723RH-CSnXRb9K.js";import"./chunk-LY4WDGUU-Bqds3OYO.js";import"./chunk-TLBGAR4N-c2hqxK1U.js";import"./useField-DtEYweKz.js";import"./chunk-NCVCYSZZ-BfVl6JOn.js";const q=({title:d,allUsers:S})=>{const{auth:P}=B().props,[_,h]=t.useState(!1),[g,F]=t.useState([]),[v,T]=t.useState({leaveTypes:[],leaveCountsByUser:{}}),[p,f]=t.useState({page:1,perPage:30,total:0,lastPage:0}),[u,j]=t.useState({employee:"",year:new Date().getFullYear()}),[J,y]=t.useState(null),[Q,x]=t.useState(null),M=t.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(r,s)=>1900+s).reverse()},[]),A=t.useCallback((e,r)=>{console.log(e,r),j(s=>({...s,[e]:r})),e==="year"&&f(s=>({...s,page:1}))},[]),b=t.useCallback((e,r=null)=>{y(e),x(r)},[]);t.useCallback(()=>{y(null),x(null)},[]);const C=t.useCallback(async()=>{h(!0);try{const{page:e,perPage:r}=p,{employee:s,year:G}=u,L=await axios.get(route("leaves.paginate"),{params:{page:e,perPage:r,employee:s,year:G}});if(L.status===200){const{leaves:m,leavesData:I}=L.data;F(m.data),T(I),f(w=>({...w,total:m.total,lastPage:m.last_page}))}}catch(e){console.error("Fetch leaves error",e)}finally{h(!1)}},[p.page,p.perPage,u]);t.useEffect(()=>{C()},[C]);const E=v.leaveCountsByUser[P.user.id]||[];return n(N,{children:[a(k,{title:d}),a(i,{display:"flex",justifyContent:"center",p:2,children:a(O,{in:!0,children:n(D,{children:[a(U,{title:"Leaves",sx:{p:3}}),a(o,{children:a(c,{container:!0,spacing:2,alignItems:"center",children:a(c,{item:!0,xs:12,sm:6,md:4,children:a(R,{label:"Year",variant:"bordered",selectedKeys:[String(u.year)],onChange:e=>A("year",Number(e)),popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:M.map(e=>a(V,{value:e,children:String(e)},e))})})})}),a(o,{children:a(c,{container:!0,spacing:2,children:v.leaveTypes.map(({type:e})=>{const r=E.find(s=>s.leave_type===e)||{};return a(c,{item:!0,xs:12,sm:6,md:3,children:a(D,{children:n(o,{sx:{textAlign:"center"},children:[a(l,{variant:"h6",sx:{mb:2,fontSize:["1rem","1.25rem","1.5rem"]},children:e}),n(i,{display:"flex",justifyContent:"center",alignItems:"center",children:[n(i,{children:[a(l,{variant:"subtitle2",children:"Used"}),a(l,{variant:"h4",children:r.days_used||0})]}),a(Y,{orientation:"vertical",flexItem:!0,sx:{mx:2}}),n(i,{children:[a(l,{variant:"subtitle2",children:"Remaining"}),a(l,{variant:"h4",children:r.remaining_days||0})]})]})]})})},e)})})}),a(o,{children:_?n(i,{textAlign:"center",py:4,children:[a(z,{}),a(l,{mt:2,children:"Loading leaves..."})]}):g.length>0?a(K,{leaves:g,allUsers:S,onDelete:e=>b("delete",e),onEdit:e=>b("edit",e.id)}):a(l,{align:"center",children:"No leaves found."})})]})})})]})};q.layout=d=>a(H,{children:d});export{q as default};
