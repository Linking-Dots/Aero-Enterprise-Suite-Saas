import{r as l,R as De,J as qe,a as Le,j as e,b as s,f as Se,d as ke,F as oe}from"./app-CEzniZE0.js";import{u as we,a as ge,r as ue,I as pe,B as p,ao as Ve,T as b,as as Te,ap as Fe,aq as Ie,ar as ye,F as re,d as be,ab as Re,k as ce,c as xe,h as $e,aH as Ke,at as ea,an as aa,e as ta,f as j,S as Ee}from"./App-BDoHcQM2.js";import{F as Be}from"./PencilIcon-DOSt_r-h.js";import{F as Pe}from"./TrashIcon-BQQx4WSz.js";import{F as Me}from"./EllipsisVerticalIcon-CVToEg8h.js";import{F as ra,b as sa,a as oa}from"./XCircleIcon-CdVU4Q71.js";import{C as na}from"./CardContent-Bri4IZ89.js";import{a as z}from"./colorManipulator-BEWUaNJ4.js";import{e as L,t as la,a as ia,b as da,c as ca,d as ma}from"./chunk-F3UDT23P-CooYFdyi.js";import{t as We}from"./chunk-7ZZXWEXF-CVqD9ePZ.js";import{u as Ue}from"./chunk-R6AK6OQ4-BYGmJlq3.js";import{p as Ae}from"./chunk-O5I3QTYU-CkARt-O3.js";import{C as pa}from"./Clear-DHinSSP4.js";import{G as Ge}from"./GlassDialog-CbKjxt3k.js";import{D as Ye}from"./DialogTitle-NYJIUl_O.js";import{I as je}from"./InputLabel-D97QvwLg.js";import{S as ze}from"./Select-dCmhexlw.js";import{M as me}from"./MenuItem-DWIK-tUR.js";import{F as He,T as se}from"./TextField-Bik31g1t.js";import{A as ua}from"./Avatar-B-I6EeB3.js";import{D as Ze,a as Je}from"./DialogContent-BethLIN6.js";import{L as fa}from"./LoadingButton-zPDyUtPP.js";import{C as Qe}from"./CircularProgress-BwEl_KoI.js";import{D as ha}from"./DialogContentText-DCiTsU7t.js";import{B as Oe}from"./Button-C0CH6LkG.js";function ga({title:N,titleId:g,...u},x){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":g},u),N?l.createElement("title",{id:g},N):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"}))}const ya=l.forwardRef(ga);function ba({title:N,titleId:g,...u},x){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":g},u),N?l.createElement("title",{id:g},N):null,l.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z",clipRule:"evenodd"}))}const xa=l.forwardRef(ba),wa=De.forwardRef(({leaves:N,allUsers:g,handleClickOpen:u,setCurrentLeave:x,openModal:o,setLeaves:P,setCurrentPage:F,currentPage:S,totalRows:M,lastPage:I,perPage:w,selectedMonth:G,employee:W,isAdminView:U=!1,onBulkApprove:Q,onBulkReject:A,canApproveLeaves:c=!1,canEditLeaves:R=!1,canDeleteLeaves:Y=!1,fetchLeavesStats:_},X)=>{var i,m;const{auth:D}=qe().props,h=we(),v=ge("(min-width: 1025px)"),f=ge("(min-width: 641px) and (max-width: 1024px)"),$=ge("(max-width: 640px)"),[Z,ve]=l.useState(!1),[H,Ce]=l.useState(null),[T,V]=l.useState(null),[fe,Ne]=l.useState(new Set);(i=D.permissions)!=null&&i.includes("leaves.view"),(m=D.permissions)!=null&&m.includes("leave.own.view");const k={New:{color:"primary",icon:oa,bgColor:z(h.palette.primary.main,.1),textColor:h.palette.primary.main},Pending:{color:"warning",icon:xa,bgColor:z(h.palette.warning.main,.1),textColor:h.palette.warning.main},Approved:{color:"success",icon:sa,bgColor:z(h.palette.success.main,.1),textColor:h.palette.success.main},Declined:{color:"danger",icon:ra,bgColor:z(h.palette.error.main,.1),textColor:h.palette.error.main}},he=a=>{switch(a==null?void 0:a.toLowerCase()){case"casual":return e(ea,{className:"w-3 h-3 text-blue-500"});case"weekend":return e(Ke,{className:"w-3 h-3 text-yellow-500"});case"sick":return e(ya,{className:"w-3 h-3 text-red-500"});case"earned":return e(xe,{className:"w-3 h-3 text-green-500"});default:return e(ce,{className:"w-3 h-3 text-primary"})}},y=l.useCallback(a=>{F&&F(a)},[F]),ne=l.useCallback(async(a,r)=>{if(T===a.id)return;V(a.id);const d=new Promise(async(n,E)=>{var B,ae,te;try{const O=await Le.post(route("leave-update-status"),{id:a.id,status:r});O.status===200&&(P(J=>J.map(C=>C.id===a.id?{...C,status:r}:C)),_(),n(O.data.message||"Leave status updated successfully"))}catch(O){const J=((ae=(B=O.response)==null?void 0:B.data)==null?void 0:ae.message)||((te=O.response)==null?void 0:te.statusText)||"Failed to update leave status";E(J)}finally{V(null)}});ue.promise(d,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"})},[P,Z]),K=a=>{const r=k[a]||k.New,d=r.icon;return e($e,{size:"sm",variant:"flat",color:r.color,startContent:e(d,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:a})},ee=(a,r)=>{const d=new Date(a),n=new Date(r),E=Math.abs(n-d),B=Math.ceil(E/(1e3*60*60*24))+1;return B===1?"1 day":`${B} days`},le=a=>new Date(a).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),ie=a=>(g==null?void 0:g.find(r=>String(r.id)===String(a)))||{name:"Unknown User",phone:""},_e=({leave:a,updatingLeaveId:r,setCurrentLeave:d,openModal:n,handleClickOpen:E,updateLeaveStatus:B,canEditLeaves:ae,canDeleteLeaves:te,canApproveLeaves:O,isAdminView:J})=>{const C=ie(a.user_id),Xe=ee(a.from_date,a.to_date);return k[a.status]||k.New,e(ta,{className:"mb-2",shadow:"sm",children:s(na,{className:"p-3",children:[s(p,{className:"flex items-start justify-between mb-3",children:[e(p,{className:"flex items-center gap-3 flex-1",children:J&&e(Ue,{avatarProps:{radius:"lg",size:"sm",src:C==null?void 0:C.profile_image,fallback:e(be,{className:"w-4 h-4"})},name:e(b,{variant:"body2",fontWeight:"medium",children:C==null?void 0:C.name}),description:e(b,{variant:"caption",color:"textSecondary",children:C==null?void 0:C.phone})})}),s(p,{className:"flex items-center gap-2",children:[K(a.status),(ae||te)&&s(Te,{children:[e(Fe,{children:e(pe,{size:"small",children:e(Me,{className:"w-4 h-4"})})}),s(Ie,{"aria-label":"Leave actions",children:[ae&&e(ye,{startContent:e(Be,{className:"w-4 h-4"}),onPress:()=>{d(a),n("edit_leave")},children:"Edit Leave"},"edit"),te&&e(ye,{className:"text-danger",color:"danger",startContent:e(Pe,{className:"w-4 h-4"}),onPress:()=>E(a.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(ke,{className:"my-3"}),s(aa,{spacing:2,children:[s(p,{className:"flex items-center gap-2",children:[e(ce,{className:"w-4 h-4 text-primary"}),e(b,{variant:"body2",fontWeight:"medium",children:a.leave_type})]}),s(p,{className:"flex items-center gap-2",children:[e(re,{className:"w-4 h-4 text-default-500"}),s(b,{variant:"body2",color:"textSecondary",children:[le(a.from_date)," - ",le(a.to_date)]}),e($e,{size:"sm",variant:"bordered",color:"default",children:Xe})]}),a.reason&&s(p,{className:"flex items-start gap-2",children:[e(xe,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(b,{variant:"body2",color:"textSecondary",className:"flex-1",children:a.reason})]})]}),J&&O&&s(oe,{children:[e(ke,{className:"my-3"}),e(p,{className:"flex gap-2",children:["Approved","Declined"].map(q=>e(Se,{size:"sm",variant:a.status===q?"solid":"bordered",color:k[q].color,isLoading:r===a.id,onPress:()=>B(a,q),startContent:!H||H!==`${a.id}-${q}`?De.createElement(k[q].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:q},q))})]})]})})},de=l.useCallback((a,r)=>{const d=ie(a.user_id);switch(r){case"employee":return e(L,{className:"whitespace-nowrap",children:e(Ue,{avatarProps:{radius:"lg",size:"sm",src:d==null?void 0:d.profile_image,fallback:e(be,{className:"w-4 h-4"})},description:e(b,{variant:"caption",className:"text-xs",children:d==null?void 0:d.phone}),name:e(b,{variant:"body2",className:"text-sm font-medium",children:d==null?void 0:d.name})})});case"leave_type":return e(L,{children:s(p,{className:"flex items-center gap-1",children:[he(a.leave_type),e(b,{variant:"body2",className:"text-sm font-medium capitalize",children:a.leave_type})]})});case"from_date":case"to_date":return e(L,{children:s(p,{className:"flex items-center gap-1",children:[e(re,{className:"w-3 h-3 text-default-500"}),s(p,{children:[e(b,{variant:"body2",className:"text-sm",children:le(a[r])}),r==="from_date"&&e(b,{variant:"caption",className:"text-xs",color:"textSecondary",children:ee(a.from_date,a.to_date)})]})]})});case"status":return e(L,{children:s(p,{className:"flex items-center gap-2",children:[K(a.status),U&&c&&s(Te,{children:[e(Fe,{children:e(Se,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:T===a.id,children:e(Me,{className:"w-4 h-4"})})}),e(Ie,{"aria-label":"Status actions",onAction:n=>ne(a,n),children:Object.keys(k).map(n=>{const E=k[n],B=E.icon;return e(ye,{startContent:e(B,{className:"w-4 h-4"}),color:E.color,children:n},n)})})]})]})});case"reason":return e(L,{children:e(Ve,{title:a.reason||"No reason provided",children:e(b,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:a.reason||"No reason provided"})})});case"actions":return e(L,{children:s(p,{className:"flex items-center gap-1",children:[R&&e(We,{content:"Edit Leave",children:e(pe,{size:"small",onClick:()=>{T!==a.id&&(x(a),o("edit_leave"))},sx:{background:z(h.palette.primary.main,.1),"&:hover":{background:z(h.palette.primary.main,.2)}},children:e(Be,{className:"w-4 h-4"})})}),Y&&e(We,{content:"Delete Leave",color:"danger",children:e(pe,{size:"small",onClick:()=>{T!==a.id&&(x(a),u(a.id,"delete_leave"))},sx:{background:z(h.palette.error.main,.1),"&:hover":{background:z(h.palette.error.main,.2)}},children:e(Pe,{className:"w-4 h-4"})})})]})});default:return e(L,{children:a[r]})}},[U,c,v,T,h,x,o,u,ne]),t=[...U?[{name:"Employee",uid:"employee",icon:be}]:[],{name:"Leave Type",uid:"leave_type",icon:ce},{name:"From Date",uid:"from_date",icon:re},{name:"To Date",uid:"to_date",icon:re},{name:"Status",uid:"status",icon:xe},{name:"Reason",uid:"reason",icon:ce},...U?[{name:"Actions",uid:"actions"}]:[]];return $?s(p,{className:"space-y-4",children:[e(Re,{className:"max-h-[70vh]",children:N.map(a=>e(_e,{leave:a},a.id))}),M>w&&e(p,{className:"flex justify-center pt-4",children:e(Ae,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:S,total:I,onChange:y,size:"sm"})})]}):s(p,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(Re,{className:"max-h-[70vh]",children:s(la,{isStriped:!0,selectionMode:"none",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(ia,{columns:t,children:a=>e(da,{align:a.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:s(p,{className:"flex items-center gap-1",children:[a.icon&&e(a.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:a.name})]})},a.uid)}),e(ca,{items:N,emptyContent:s(p,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(re,{className:"w-12 h-12 text-default-300 mb-4"}),e(b,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(b,{variant:"body2",color:"textSecondary",children:W?`No leaves found for "${W}"`:"No leave requests for the selected period"})]}),children:a=>e(ma,{children:r=>de(a,r)},a.id)})]})}),M>w&&s(p,{className:"py-4 flex justify-center",children:[e(Ae,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:S,total:I,onChange:y,size:f?"sm":"md"}),s("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",S," of ",I," (Total: ",M," records)"]})]})]})});wa.displayName="LeaveEmployeeTable";const Ga=({open:N,closeModal:g,leavesData:u,setLeavesData:x,currentLeave:o,allUsers:P,setTotalRows:F,setLastPage:S,setLeaves:M,handleMonthChange:I,employee:w,selectedMonth:G,addLeaveOptimized:W,updateLeaveOptimized:U,fetchLeavesStats:Q})=>{var de;const{auth:A}=qe().props,c=we(),[R,Y]=l.useState((o==null?void 0:o.user_id)||A.user.id),[_,X]=l.useState((u==null?void 0:u.leaveTypes)||[]),[D,h]=l.useState([]),[v,f]=l.useState((o==null?void 0:o.leave_type)||""),$=t=>{if(!t)return new Date().toISOString().split("T")[0];if(typeof t=="string"&&t.match(/^\d{4}-\d{2}-\d{2}$/))return t;if(typeof t=="string"&&t.includes("T")){if(t.includes("T18:00:00")){const m=t.split("T")[0].split("-"),a=parseInt(m[0]),r=parseInt(m[1]),d=parseInt(m[2])+1;return new Date(a,r-1,d).toISOString().split("T")[0]}return t.split("T")[0]}try{const i=new Date(t);if(isNaN(i.getTime()))return new Date().toISOString().split("T")[0];const m=i.getFullYear(),a=String(i.getMonth()+1).padStart(2,"0"),r=String(i.getDate()).padStart(2,"0");return`${m}-${a}-${r}`}catch(i){return console.error("Error formatting date:",i),new Date().toISOString().split("T")[0]}},[Z,ve]=l.useState(o!=null&&o.from_date?$(o.from_date):""),[H,Ce]=l.useState(o!=null&&o.to_date?$(o.to_date):""),[T,V]=l.useState((o==null?void 0:o.no_of_days)||""),[fe,Ne]=l.useState(""),[k,he]=l.useState((o==null?void 0:o.reason)||""),[y,ne]=l.useState({}),[K,ee]=l.useState(!1),[le,ie]=l.useState("");return l.useEffect(()=>{var t,i;if(u){X(u.leaveTypes||[]);const m=((t=u.leaveCountsByUser)==null?void 0:t[R])||[];if(h(m),_.length>0&&!v&&!o&&f(_[0].type),o&&!v){const a=(i=u.leaveTypes)==null?void 0:i.find(r=>r.id===o.leave_type);a&&f(a.type)}}},[u,R,o]),l.useEffect(()=>{if(!v||!D||!_)return;const t=D.find(a=>a.leave_type===v),i=(t==null?void 0:t.days_used)||0;ie(i);const m=_.find(a=>a.type===v);if(m){const a=m.days-i;Ne(a),o&&T>a&&V(a)}},[v,D,_,o,T]),l.useEffect(()=>{V(((i,m)=>{if(!i||!m)return"";const a=new Date(i),r=new Date(m);if(a>r)return"";const d=r.getTime()-a.getTime();return Math.ceil(d/(1e3*3600*24))+1})(Z,H))},[Z,H]),s(Ge,{open:N,onClose:g,fullWidth:!0,maxWidth:"sm",children:[s(Ye,{sx:{display:"flex",alignItems:"center"},children:[e(b,{variant:"h6",children:o?"Edit Leave":"Add Leave"}),e(pe,{onClick:g,sx:{position:"absolute",top:8,right:16},children:e(pa,{})})]}),s("form",{onSubmit:async t=>{t.preventDefault(),ee(!0);const i=new Promise(async(m,a)=>{try{const r={route:route().current(),user_id:R,leaveType:v,fromDate:Z,toDate:H,daysCount:T,leaveReason:k,employee:w,month:G},d=o?route("leave-update"):route("leave-add");o&&(r.id=o.id),console.log("Submitting data:",r),console.log("API route:",d);const n=await axios.post(d,r);console.log("Response status:",n.status),console.log("Response data:",n.data),n.status===200||n.status===201?(x(n.data.leavesData),o&&U&&n.data.leave?(U(n.data.leave),Q()):W&&n.data.leave?(W(n.data.leave),Q(),n.data.pagination&&(F(n.data.pagination.total),S(n.data.pagination.lastPage))):(console.log("Using fallback data update mode"),n.data.leaves&&(M(n.data.leaves.data),F(n.data.leaves.total),S(n.data.leaves.last_page)),n.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(n.data.leavesData)),g(),m([n.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",n.status),a(`Unexpected response status: ${n.status}`))}catch(r){console.error("Full error object:",r),r.response?(console.error("Error response status:",r.response.status),console.error("Error response data:",r.response.data),r.response.status===422?(ne(r.response.data.errors||{}),a(r.response.data.error||"Failed to submit leave application")):a(`HTTP Error ${r.response.status}: ${r.response.data.message||"An unexpected error occurred. Please try again later."}`)):r.request?(console.error("No response received:",r.request),a("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",r.message),a("An error occurred while setting up the request."))}finally{ee(!1)}});ue.promise(i,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(Qe,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},success:{render({data:m}){return e(oe,{children:m.map((a,r)=>e("div",{children:a},r))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},error:{render({data:m}){return e(oe,{children:m})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}}})},children:[e(Ze,{children:s(j,{container:!0,spacing:2,children:[e(j,{item:!0,xs:12,md:6,children:s(Ee,{fullWidth:!0,children:[e(je,{id:"leave-type-label",children:"Leave Type"}),s(ze,{labelId:"leave-type-label",value:v||"",onChange:t=>f(t.target.value),label:"Leave Type",error:!!y.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,borderRadius:2,boxShadow:c.glassCard.boxShadow,maxHeight:300}}},children:[e(me,{value:"",disabled:!0,children:"Select Leave Type"}),_.map(t=>{const i=D==null?void 0:D.find(r=>r.leave_type===t.type),a=(i?t.days-i.days_used:t.days)<=0;return e(me,{value:t.type,disabled:a,title:a?"No remaining leaves available":"",children:s(p,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:t.type}),e("span",{children:i?`${i.days_used} / ${t.days} days`:`${t.days} days`})]})},t.id)})]}),e(He,{children:y.leaveType})]})}),e(j,{item:!0,xs:12,md:6,children:e(se,{label:"From",type:"date",fullWidth:!0,value:Z,onChange:t=>ve(t.target.value),InputLabelProps:{shrink:!0},error:!!y.fromDate,helperText:y.fromDate})}),e(j,{item:!0,xs:12,md:6,children:e(se,{label:"To",type:"date",fullWidth:!0,value:H,onChange:t=>Ce(t.target.value),InputLabelProps:{shrink:!0},error:!!y.toDate,helperText:y.toDate})}),e(j,{item:!0,xs:12,md:6,children:e(se,{label:"Number of days",type:"text",fullWidth:!0,value:T,InputProps:{readOnly:!0},error:!!y.daysCount,helperText:y.daysCount})}),e(j,{item:!0,xs:12,md:6,children:e(se,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${fe} day${fe!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:s(b,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",((de=_.find(t=>t.type===v))==null?void 0:de.days)||0," total"]})},error:!!y.remainingLeaves,helperText:y.remainingLeaves})}),route().current()==="leaves"&&e(j,{item:!0,xs:12,md:6,children:s(Ee,{fullWidth:!0,children:[e(je,{id:"leave-employee-label",children:"Employee"}),s(ze,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:R||"na",error:!!y.user_id,onChange:t=>Y(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,borderRadius:2,boxShadow:c.glassCard.boxShadow}}},children:[e(me,{value:"na",disabled:!0,children:"Please select"}),P.map(t=>e(me,{value:t.id,children:s(p,{sx:{display:"flex"},children:[e(ua,{src:t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(He,{children:y.user_id})]})}),e(j,{item:!0,xs:12,children:e(se,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:k,onChange:t=>he(t.target.value),error:!!y.leaveReason,helperText:y.leaveReason})})]})}),e(Je,{sx:{padding:"16px",justifyContent:"center"},children:e(fa,{type:"submit",variant:"outlined",color:"primary",loading:K,disabled:K,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ya=({open:N,closeModal:g,leaveId:u,setLeavesData:x,setLeaves:o,setTotalRows:P,setLastPage:F,setError:S,deleteLeaveOptimized:M,fetchLeavesStats:I})=>{const w=we(),[G,W]=l.useState(!1);return s(Ge,{open:N,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(Ye,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(Ze,{children:e(ha,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),s(Je,{children:[e(Oe,{onClick:g,color:"primary",disabled:G,children:"Cancel"}),e(Oe,{loading:G,disabled:G,onClick:()=>{if(!u){ue.error("Invalid leave ID provided");return}W(!0);const Q=new Promise(async(A,c)=>{var R,Y,_,X,D,h,v;try{const f=await Le.delete(route("leave-delete",{id:u,route:route().current()}));f.status===200&&(M?(M(u),P($=>Math.max(0,$-1)),I&&I()):(x&&x(f.data.leavesData),P&&P(f.data.leaves.total),F&&F(f.data.leaves.last_page),o&&o(f.data.leaves.data),S&&S(!1),I&&I()),A("Leave application deleted successfully"))}catch(f){if(console.error("Error deleting leave:",f),((R=f.response)==null?void 0:R.status)===404){const{leavesData:$}=f.response.data||{};x&&$&&x($),S&&S(((_=(Y=f.response)==null?void 0:Y.data)==null?void 0:_.message)||"Leave not found."),c("Leave not found or already deleted")}else((X=f.response)==null?void 0:X.status)===403?c("You do not have permission to delete this leave"):((D=f.response)==null?void 0:D.status)===422?c("Cannot delete leave with current status"):c(((v=(h=f.response)==null?void 0:h.data)==null?void 0:v.error)||"Failed to delete leave application")}finally{W(!1),g()}});ue.promise(Q,{pending:{render(){return s("div",{style:{display:"flex",alignItems:"center"},children:[e(Qe,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:w.glassCard.background,border:w.glassCard.border,color:w.palette.text.primary}},success:{render({data:A}){return e(oe,{children:A})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:w.glassCard.background,border:w.glassCard.border,color:w.palette.text.primary}},error:{render({data:A}){return e(oe,{children:A})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:w.glassCard.background,border:w.glassCard.border,color:w.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})};export{Ya as D,Ga as L,wa as a};
