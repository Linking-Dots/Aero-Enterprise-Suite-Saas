import{V as de,j as o,a as e,F as N,M as ye}from"./app-C1WntmjD.js";import{u as ce,r as t,W as ue,T as H,c as be,G as f,F as re,k as se,S as oe,M as q,U as le,b as G,B as ee,X as fe,Y as pe,Z as me,t as ae,$ as ve,f as te,e as Ce,h as xe,a as ne}from"./vendor-BNH6533b.js";import{d as Se}from"./Search-DNe4kiYU.js";import{B as he,G as De,A as ke}from"./App-12Z14cay.js";import{L as Te}from"./LeaveEmployeeTable-BBajS2If.js";import{d as Pe,G as ge}from"./GlassDialog-D-dJcZh5.js";import{L as we}from"./LoadingButton-DP_KxXYz.js";import{d as _e}from"./dayjs.min-Q3DE0Veq.js";import{A as Fe}from"./Add-Bm_vATey.js";import{i as ie}from"./chunk-HJTJQZF3-BnX5DVB_.js";import"./Edit-Bbt_Guas.js";import"./chunk-F3UDT23P-B7Z6A6B_.js";import"./chunk-MZRCPRP2-BNIXGS6a.js";import"./chunk-SLABUSGS-B8vVKBwj.js";import"./chunk-7F3ZLNJ6-BB3F-DCU.js";import"./chunk-YHY32LNM-Dg5_JLUV.js";import"./chunk-CSXHODZI-Cy7h7K0B.js";import"./chunk-7JXO3E7I-tjFPIHS0.js";import"./chunk-2BFF5KFD-Bvpvmodz.js";import"./chunk-4EXC76WE-BaBultbA.js";import"./chunk-R6AK6OQ4-DVPnVZ9c.js";const Ie=({open:w,closeModal:v,leavesData:m,setLeavesData:S,currentLeave:r,allUsers:T,setTotalRows:E,setLastPage:D,setLeaves:d,handleMonthChange:P,employee:L,selectedMonth:h})=>{const{auth:M}=de().props,s=ce(),[k,l]=t.useState((r==null?void 0:r.user_id)||M.user.id),[c,$]=t.useState(m.leaveTypes||[]),[C,V]=t.useState(m.leaveCounts||[]),[g,X]=t.useState((r==null?void 0:r.leave_type)||(c.length>0?c[0].type:"")),_=a=>{const x=new Date(a);return isNaN(x.getTime())?new Date().toISOString().split("T")[0]:x.toISOString().split("T")[0]},[F,Z]=t.useState(_(r==null?void 0:r.from_date)),[A,O]=t.useState(_(r==null?void 0:r.to_date)),[R,U]=t.useState((r==null?void 0:r.no_of_days)||""),[z,J]=t.useState(""),[Y,j]=t.useState((r==null?void 0:r.reason)||""),[i,p]=t.useState({}),[I,y]=t.useState(!1),[W,K]=t.useState("");return t.useEffect(()=>{m&&($(m.leaveTypes||[]),V(m.leaveCountsByUser[k]||[]))},[m,k]),t.useEffect(()=>{var b;const a=((b=C==null?void 0:C.find(u=>u.leave_type===g))==null?void 0:b.days_used)||0;K(a);const x=c==null?void 0:c.find(u=>u.type===g);x&&J(x.days-a)},[g,C,c]),t.useEffect(()=>{U(((x,b)=>{if(!x||!b)return"";const u=new Date(x),n=new Date(b);if(u>n)return"";const Q=n.getTime()-u.getTime();return Math.ceil(Q/(1e3*3600*24))+1})(F,A))},[F,A]),o(ge,{open:w,onClose:v,fullWidth:!0,maxWidth:"sm",children:[o(ue,{sx:{display:"flex",alignItems:"center"},children:[e(H,{variant:"h6",children:"Add Leave"}),e(be,{onClick:v,sx:{position:"absolute",top:8,right:16},children:e(Pe,{})})]}),o("form",{onSubmit:async a=>{a.preventDefault(),y(!0);const x=new Promise(async(b,u)=>{try{const n={route:route().current(),user_id:k,leaveType:g,fromDate:F,toDate:A,daysCount:R,leaveReason:Y,employee:L,month:h},Q=r?route("leave-update"):route("leave-add");r&&(n.id=r.id);const B=await axios.post(Q,n);B.status===200&&(S(B.data.leavesData),E(B.data.leaves.total),D(B.data.leaves.last_page),d(B.data.leaves.data),P({target:{value:F.slice(0,7)}}),v(),b([B.data.message||"Leave application submitted successfully"]))}catch(n){console.error(n),y(!1),n.response?(n.response.status===422?(p(n.response.data.errors||{}),u(n.response.data.error||"Failed to submit leave application")):u("An unexpected error occurred. Please try again later."),console.error(n.response.data.error)):n.request?(u("No response received from the server. Please check your internet connection."),console.error(n.request)):(u("An error occurred while setting up the request."),console.error("Error",n.message))}finally{y(!1)}});he.promise(x,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(ae,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:s.glassCard.backgroundColor,border:s.glassCard.border,color:s.palette.text.primary}},success:{render({data:b}){return e(N,{children:b.map((u,n)=>e("div",{children:u},n))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:s.glassCard.backgroundColor,border:s.glassCard.border,color:s.palette.text.primary}},error:{render({data:b}){return e(N,{children:b})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:s.glassCard.backgroundColor,border:s.glassCard.border,color:s.palette.text.primary}}})},children:[e(pe,{children:o(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,md:6,children:o(re,{fullWidth:!0,children:[e(se,{id:"leave-type-label",children:"Leave Type"}),o(oe,{labelId:"leave-type-label",value:g,onChange:a=>X(a.target.value),label:"Leave Type",error:!!i.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:s.glassCard.backgroundColor,border:s.glassCard.border,borderRadius:2,boxShadow:s.glassCard.boxShadow}}},children:[e(q,{value:"",disabled:!0,children:"Select Leave Type"}),c.map(a=>o(q,{value:a.type,children:[a.type," ",a.days," Days"]},a.id))]}),e(le,{children:i.leaveType})]})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"From",type:"date",fullWidth:!0,value:F,onChange:a=>Z(a.target.value),InputLabelProps:{shrink:!0},error:!!i.fromDate,helperText:i.fromDate})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"To",type:"date",fullWidth:!0,value:A,onChange:a=>O(a.target.value),InputLabelProps:{shrink:!0},error:!!i.toDate,helperText:i.toDate})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"Number of days",type:"text",fullWidth:!0,value:R,InputProps:{readOnly:!0},error:!!i.daysCount,helperText:i.daysCount})}),e(f,{item:!0,xs:12,md:6,children:e(G,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:z,InputProps:{readOnly:!0},error:!!i.remainingLeaves,helperText:i.remainingLeaves})}),M.roles.includes("Administrator")&&route().current()==="leaves"&&e(f,{item:!0,xs:12,md:6,children:o(re,{fullWidth:!0,children:[e(se,{id:"leave-employee-label",children:"Employee"}),o(oe,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:k||"na",error:!!i.user_id,onChange:a=>l(a.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:s.glassCard.backgroundColor,border:s.glassCard.border,borderRadius:2,boxShadow:s.glassCard.boxShadow}}},children:[e(q,{value:"na",disabled:!0,children:"Please select"}),T.map(a=>e(q,{value:a.id,children:o(ee,{sx:{display:"flex"},children:[e(fe,{src:a.profile_image,alt:a.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),a.name]})},a.id))]}),e(le,{children:i.user_id})]})}),e(f,{item:!0,xs:12,children:e(G,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:Y,onChange:a=>j(a.target.value),error:!!i.leaveReason,helperText:i.leaveReason})})]})}),e(me,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:I,disabled:I,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Be=({open:w,handleClose:v,leaveIdToDelete:m,setLeavesData:S,setLeaves:r,setTotalRows:T,setLastPage:E,setError:D})=>{const d=ce();return o(ge,{open:w,onClose:v,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ue,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(pe,{children:e(ve,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),o(me,{children:[e(te,{onClick:v,color:"primary",children:"Cancel"}),e(te,{onClick:()=>{const L=new Promise(async(h,M)=>{var s,k;try{const l=await axios.delete(route("leave-delete",{id:m,route:route().current()}));console.log(l),l.status===200&&(S(l.data.leavesData),T(l.data.leaves.total),E(l.data.leaves.last_page),r(l.data.leaves.data),D(!1),h("Leave application deleted successfully"))}catch(l){if(console.error("Error deleting task:",l),l.response.status===404){const{leavesData:c}=l.response.data;S(c),D(((k=(s=l.response)==null?void 0:s.data)==null?void 0:k.message)||"Error retrieving data.")}M(l.response.data.error||"Failed to delete leave application")}finally{v()}});he.promise(L,{pending:{render(){return o("div",{style:{display:"flex",alignItems:"center"},children:[e(ae,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},success:{render({data:h}){return e(N,{children:h})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}},error:{render({data:h}){return e(N,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",backgroundColor:d.glassCard.backgroundColor,border:d.glassCard.border,color:d.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ee=({title:w,allUsers:v})=>{de();const[m,S]=t.useState(!1),[r,T]=t.useState(null),[E,D]=t.useState([]),[d,P]=t.useState(),[L,h]=t.useState(0),[M,s]=t.useState(0),[k,l]=t.useState(null),[c,$]=t.useState(""),[C,V]=t.useState(_e().format("YYYY-MM")),[g,X]=t.useState(30),[_,F]=t.useState(1),[Z,A]=t.useState(),[O,R]=t.useState(""),U=p=>T(p),z=t.useCallback((p,I)=>{l(p),T(I)},[]),J=t.useCallback(()=>{T(null),l(null)},[]),Y=p=>$(p.target.value.toLowerCase()),j=p=>{V(p.target.value)},i=async()=>{var p,I;try{const y=await axios.get(route("leaves.paginate"),{params:{page:_,perPage:g,employee:c,month:C}});if(y.status===200){const{leaves:W,leavesData:K}=y.data;P(W.data),D(K),h(W.total),s(W.last_page),R(!1),S(!1)}}catch(y){if(console.error("Error fetching leaves data:",y.response),y.response.status===404){const{leavesData:W}=y.response.data;D(W),R(((I=(p=y.response)==null?void 0:p.data)==null?void 0:I.message)||"Error retrieving data.")}P(!1),S(!1)}};return t.useEffect(()=>{S(!0),i()},[C,_,g,c]),console.log(E),o(N,{children:[e(ye,{title:w}),["add_leave","edit_leave"].includes(r)&&e(Ie,{setTotalRows:h,setLastPage:s,setLeaves:P,perPage:g,employee:c,currentPage:_,selectedMonth:C,allUsers:v,open:!0,setLeavesData:D,closeModal:()=>T(null),leavesData:E,currentLeave:r==="edit_leave"?Z:null,handleMonthChange:j}),r==="delete_leave"&&e(Be,{setTotalRows:h,setLastPage:s,setLeaves:P,perPage:g,open:!0,handleClose:J,leaveIdToDelete:k,setLeavesData:D,setError:R,setLoading:S}),e(ee,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Ce,{in:!0,children:o(De,{children:[e(xe,{title:"Leaves",sx:{padding:"24px"},action:e(te,{title:"Add Leave",variant:"outlined",color:"success",startIcon:e(Fe,{}),onClick:()=>U("add_leave"),children:"Add Leave"})}),e(ne,{children:o(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,sm:6,md:4,children:e(ie,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:c,onChange:Y,endContent:e(Se,{})})}),e(f,{item:!0,xs:12,sm:6,md:4,children:e(ie,{label:"Select Month",type:"month",variant:"bordered",onChange:j,value:C,isLoading:m})})]})}),e(ne,{children:m?o(ee,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:[e(ae,{sx:{p:1}}),e(H,{variant:"body1",align:"center",children:"Loading leaves data..."})]}):d&&d.length>0?e(Te,{totalRows:L,lastPage:M,setCurrentPage:F,setPerPage:X,perPage:g,currentPage:_,handleClickOpen:z,setCurrentLeave:A,openModal:U,leaves:d,allUsers:v,setLeaves:P,employee:c,selectedMonth:C}):O?e(H,{variant:"body1",align:"center",children:O}):e(H,{variant:"body1",align:"center",children:"No leaves data found."})})]})})})]})};Ee.layout=w=>e(ke,{children:w});export{Ee as default};
