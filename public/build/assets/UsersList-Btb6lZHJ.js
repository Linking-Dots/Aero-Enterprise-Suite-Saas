import{a as e,j as p,U as O,F as _,V as re,M as ae}from"./app-COej-qut.js";import{r as y,u as q,c as B,a4 as te,k as oe,M as ne,a5 as le,S as de,F as se,h as L,w as ie,T as ce,G as f,B as T,a1 as pe,y as me,z as ue,t as ge,e as he,g as be,a as fe}from"./vendor-jz9Knmfr.js";import{B as S,A as ye,G as xe,c as H}from"./App-Bh__gnbe.js";import{E as ve,D as Ce}from"./Edit-BHaH8ya7.js";import{a as ke,b as _e,c as we,d as Se,e as Pe,t as De}from"./chunk-F3UDT23P-B9Bbk0MH.js";import{t as G}from"./chunk-CSXHODZI-B_ju90Id.js";import{u as Fe}from"./chunk-R6AK6OQ4-srYMT2VM.js";import{d as Ie,G as Me}from"./GlassDialog-Sauekw8K.js";import{d as Ae,a as Ee}from"./VisibilityOff-Cly_X9wD.js";import{P as Ue}from"./PhotoCamera-DG7ftPKo.js";import{L as Be}from"./LoadingButton-Qj6wJM8B.js";import{i as k}from"./chunk-HJTJQZF3-Dx-8I7IT.js";import{s as j,l as w}from"./chunk-7JXO3E7I-BmHL33O5.js";import{A as z}from"./Add-VfapyybU.js";import"./chunk-MZRCPRP2-CkCeC-Il.js";import"./chunk-SLABUSGS-yLyu-M1S.js";import"./chunk-7F3ZLNJ6-CJy-mc9r.js";import"./chunk-A6PX3NG3-Be0FpWxR.js";import"./chunk-2BFF5KFD-Dt7Cw_Z_.js";import"./chunk-M3MASYO7-BSa8BdOI.js";import"./chunk-4EXC76WE-C1zfbgpY.js";const Te=({allUsers:a,roles:I})=>{const[M,P]=y.useState(a),n=q(),[N,D]=y.useState({});async function F(t,b,o){const s=new Promise(async(i,d)=>{try{const m=await axios.post(route("user.updateRole",{id:b}),{[t]:o});m.status===200&&(P(C=>C.map(U=>U.id===b?{...U,[t]:o}:U)),i([m.data.messages||"Role updated successfully"]))}catch(m){m.response?(m.response.status===422?d(m.response.data.errors||["Failed to update user role."]):d("An unexpected error occurred. Please try again later."),console.error(m.response)):m.request?(d("No response received from the server. Please check your internet connection."),console.error(m.request)):(d("An error occurred while setting up the request."),console.error("Error",m.message))}});S.promise(s,{pending:{render(){return p("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),p("span",{style:{marginLeft:"8px"},children:["Updating employee ",t,"..."]})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:i}){return e(_,{children:i.map((d,m)=>e("div",{children:d},m))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:i}){return e(_,{children:i})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}}})}const A=async(t,b)=>{const o=new Promise(async(s,i)=>{try{const d=await axios.put(route("user.toggleStatus",{id:t}),{active:b});d.status===200&&(P(m=>m.map(C=>C.id===t?{...C,active:b}:C)),s([d.data.message||"User status updated successfully"]))}catch(d){d.response?(d.response.status===422?i(d.response.data.errors||["Failed to update user status."]):i("An unexpected error occurred. Please try again later."),console.error(d.response)):d.request?(i("No response received from the server. Please check your internet connection."),console.error(d.request)):(i("An error occurred while setting up the request."),console.error("Error",d.message))}});S.promise(o,{pending:{render(){return p("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),e("span",{style:{marginLeft:"8px"},children:"Updating user status..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:s}){return e(_,{children:s.map((i,d)=>e("div",{children:i},d))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:s}){return e(_,{children:s})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}}})},l=async t=>{const b=new Promise(async(o,s)=>{try{const i=await fetch(route("profile.delete"),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({user_id:t})}),d=await i.json();i.ok?(P(m=>m.filter(C=>C.id!==t)),o([d.message])):s([d.message])}catch(i){console.error("Error deleting user:",i),s(["An error occurred while deleting user. Please try again."])}});S.promise(b,{pending:{render(){return p("div",{style:{display:"flex",alignItems:"center"},children:[e(L,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting user..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},success:{render({data:o}){return e(_,{children:o.map((s,i)=>e("div",{children:s},i))})},icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}},error:{render({data:o}){return e(_,{children:o.map((s,i)=>e("div",{children:s},i))})},icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,color:n.palette.text.primary}}})},E=t=>{D(b=>({...b,[t]:null}))},c=(t,b)=>{const o=t[b];switch(b){case"name":return e(Fe,{avatarProps:{radius:"lg",src:t==null?void 0:t.profile_image},name:t==null?void 0:t.name,children:t==null?void 0:t.email});case"email":return o;case"phone":return o;case"created_at":return o||"N/A";case"role":return p(se,{size:"small",fullWidth:!0,children:[e(oe,{id:"role",children:"Role"}),e(de,{disabled:!t.active,labelId:"role",id:"role",multiple:!0,value:t.roles,onChange:s=>F("roles",t.id,s.target.value),label:"Role",variant:"outlined",renderValue:s=>s.join(", "),MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:n.glassCard.background,border:n.glassCard.border,borderRadius:2,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px"}}},children:I.map(s=>p(ne,{value:s.name,children:[e(le,{size:"small",checked:t.roles.includes(s.name)}),s.name]},s.name))})]});case"actions":return p("div",{className:"relative flex items-center gap-2",children:[e(G,{content:"Edit Leave",children:e(B,{className:"text-lg text-default-400 cursor-pointer active:opacity-50",component:O,href:route("profile",{user:t.id}),onClick:()=>{E(t.id)},children:e(ve,{})})}),e(G,{content:"Delete Leave",color:"danger",children:p(B,{className:"text-lg text-danger cursor-pointer active:opacity-50",component:O,href:route("profile",{user:t.id}),onClick:()=>{l(t.id)},children:[e(Ce,{})," "]})}),e(G,{content:"Set Active Status",color:"danger",children:e(te,{checked:t.active,onChange:()=>A(t.id,!t.active)})})]});default:return"N/A"}};return e("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:p(De,{fullWidth:!0,isStriped:!0,isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Employees Table",children:[e(ke,{columns:[{name:"Name",uid:"name"},{name:"Email",uid:"email"},{name:"Phone",uid:"phone"},{name:"Created At",uid:"created_at"},{name:"Role",uid:"role"},{name:"Action",uid:"actions"}],children:t=>e(_e,{align:t.uid==="actions"?"center":"start",children:t.name},t.uid)}),e(we,{items:M,children:t=>e(Se,{children:b=>e(Pe,{style:{whiteSpace:"nowrap"},children:c(t,b)})},t.id)})]},M)})},Ne=({user:a,allUsers:I,departments:M,designations:P,setUser:n,open:N,closeModal:D})=>{const[F,A]=y.useState(!1),[l,E]=y.useState({id:a==null?void 0:a.id,name:(a==null?void 0:a.name)||"",user_name:(a==null?void 0:a.user_name)||"",gender:(a==null?void 0:a.gender)||"",birthday:(a==null?void 0:a.birthday)||"",date_of_joining:(a==null?void 0:a.date_of_joining)||"",address:(a==null?void 0:a.address)||"",employee_id:(a==null?void 0:a.employee_id)||"",phone:(a==null?void 0:a.phone)||"",email:(a==null?void 0:a.email)||"",department:(a==null?void 0:a.department)||"",designation:(a==null?void 0:a.designation)||"",report_to:(a==null?void 0:a.report_to)||"",password:"",confirmPassword:""}),[c,R]=y.useState({id:a==null?void 0:a.id}),[t,b]=y.useState(!1),[o,s]=y.useState({}),[i,d]=y.useState(!1),[m,C]=y.useState(!1),[U,J]=y.useState(null),[W,V]=y.useState(null),[$,Q]=y.useState(P),[X,Y]=y.useState(I),u=q(),K=async r=>{var g;r.preventDefault(),d(!0);const v=new FormData;if(Object.keys(l).forEach(h=>{v.append(h,l[h])}),W){const h=W.type;if(["image/jpeg","image/jpg","image/png"].includes(h))v.append("profile_image",W);else{S.error("Invalid file type. Only JPEG and PNG are allowed.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}}),d(!1);return}}try{const h=await axios.post(route("addUser"),v);h.status===200&&(n(h.data.user),S.success(((g=h.data.messages)==null?void 0:g.length)>0?h.data.messages.join(" "):"Profile information updated successfully",{icon:"游릭",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}}),D())}catch(h){d(!1),Z(h)}finally{d(!1)}},Z=r=>{r.response?r.response.status===422?(s(r.response.data.errors||{}),S.error(r.response.data.error||"Failed to update profile information.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}})):S.error("An unexpected error occurred. Please try again later.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}}):r.request?S.error("No response received from the server. Please check your internet connection.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}}):S.error("An error occurred while setting up the request.",{icon:"游댮",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}})},ee=r=>{const v=r.target.files[0];if(v){const g=URL.createObjectURL(v);J(g),V(v)}},x=(r,v)=>{E(g=>{const h={...g,[r]:v};return v===""&&delete h[r],h}),R(g=>{const h={...g,[r]:v};return v===""&&delete h[r],h})};return y.useEffect(()=>{(a==null?void 0:a.department)!==l.department&&(l.designation=null,l.report_to=null),Q(P.filter(g=>g.department_id===(c.department||l.department))),Y(I.filter(g=>g.department===(c.department||l.department)));const r={...c};for(const g in r)a&&g!=="id"&&r[g]===a[g]&&delete r[g];const v=Object.keys(r).length>1;b(v)},[l,c]),p(Me,{open:N,onClose:D,children:[p(ie,{style:{cursor:"move"},id:"draggable-dialog-title",children:[e(ce,{children:"Profile Information"}),e(B,{variant:"outlined",color:"primary",onClick:D,sx:{position:"absolute",top:8,right:16},children:e(Ie,{})})]}),p("form",{onSubmit:K,children:[e(me,{children:p(f,{container:!0,spacing:2,children:[e(f,{item:!0,xs:12,display:"flex",alignItems:"center",justifyContent:"center",children:p(T,{position:"relative",display:"inline-block",onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:[e(pe,{alt:c.name||l.name,src:U||(a==null?void 0:a.profile_image),sx:{width:100,height:100}}),m&&e(_,{children:e(T,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(0, 0, 0, 0.5)",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:e(B,{color:"primary",component:"span",children:e(Ue,{})})})}),e("input",{accept:"image/*",style:{display:"none"},id:"upload-button",type:"file",onChange:ee}),e("label",{htmlFor:"upload-button",children:e(T,{sx:{position:"absolute",width:"100%",height:"100%",top:0,left:0,borderRadius:"50%",cursor:"pointer"}})})]})}),e(f,{item:!0,xs:12,md:6,children:e(k,{type:"text",label:"Name",variant:"bordered",isInvalid:!!o.name,errorMessage:o.name,fullWidth:!0,value:c.name||l.name||"",onChange:r=>x("name",r.target.value)})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Username",fullWidth:!0,value:c.user_name||l.user_name||"",onChange:r=>x("user_name",r.target.value),type:"text",variant:"bordered",isInvalid:!!o.user_name,errorMessage:o.user_name})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Email Adress",fullWidth:!0,value:c.email||l.email,onChange:r=>x("email",r.target.value),type:"email",variant:"bordered",isInvalid:!!o.email,errorMessage:o.email})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Phone Number",fullWidth:!0,value:c.phone||l.phone,onChange:r=>x("phone",r.target.value),type:"tel",variant:"bordered",isInvalid:!!o.phone,errorMessage:o.phone})}),e(f,{item:!0,xs:12,md:6,children:e(k,{variant:"bordered",errorMessage:o.password,isInvalid:!!o.password,label:"Password",type:F?"text":"password",value:c.password||l.password,onChange:r=>x("password",r.target.value),fullWidth:!0,endContent:e(B,{onClick:()=>A(!F),edge:"end",children:F?e(Ae,{}):e(Ee,{})})})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Confirm Password",type:"password",variant:"bordered",errorMessage:o.confirmPassword,isInvalid:!!o.confirmPassword,value:c.confirmPassword||l.confirmPassword,onChange:r=>x("confirmPassword",r.target.value),fullWidth:!0})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Gender",placeholder:"Select Gender",value:c.gender||l.gender||"na",onChange:r=>{x("gender",r.target?r.target.value:r)},errorMessage:!!o.gender,popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg border-inherit"}},children:[e(w,{value:"na",disabled:!0,children:"Select Gender"}),e(w,{value:"Male",children:"Male"}),e(w,{value:"Female",children:"Female"})]})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Birth Date",type:"date",fullWidth:!0,variant:"bordered",value:c.birthday||l.birthday||"",onChange:r=>x("birthday",r.target.value),isInvalid:!!o.birthday,errorMessage:o.birthday})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Joining Date",type:"date",variant:"bordered",fullWidth:!0,value:c.date_of_joining||l.date_of_joining||"",onChange:r=>x("date_of_joining",r.target.value),isInvalid:!!o.date_of_joining,errorMessage:o.date_of_joining})}),e(f,{item:!0,xs:12,children:e(k,{label:"Address",fullWidth:!0,type:"text",variant:"bordered",value:c.address||l.address,onChange:r=>x("address",r.target.value),isInvalid:!!o.address,errorMessage:o.address})}),e(f,{item:!0,xs:12,md:6,children:e(k,{label:"Employee ID",type:"text",variant:"bordered",fullWidth:!0,value:c.employee_id||l.employee_id||"",onChange:r=>x("employee_id",r.target.value),isInvalid:!!o.employee_id,errorMessage:o.employee_id})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Department",placeholder:"Select Department",value:c.department||l.department||"na",onChange:r=>{x("department",r.target?r.target.value:r)},errorMessage:!!o.department,popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg"}},children:[e(w,{value:"na",disabled:!0,children:"Select Department"}),M.map(r=>e(w,{value:r.id,children:r.name},r.id))]})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Designation",placeholder:"Select Designation",value:c.designation||l.designation||"na",onChange:r=>{x("designation",r.target?r.target.value:r)},errorMessage:o.designation?"This field is required":"",disabled:!(a!=null&&a.department),popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg"}},children:[e(w,{value:"na",disabled:!0,children:"Select Designation"}),$.map(r=>e(w,{value:r.id,children:r.title},r.id))]})}),e(f,{item:!0,xs:12,md:6,children:p(j,{variant:"bordered",fullWidth:!0,label:"Reports To",placeholder:"Select Reports To",value:c.report_to||l.report_to,onChange:r=>{x("report_to",r.target?r.target.value:r)},errorMessage:o.report_to?"This field is required":"",disabled:(a==null?void 0:a.report_to)==="na",popoverProps:{classNames:{content:"bg-transparent backdrop-blur-lg"}},children:[e(w,{value:"na",disabled:!0,children:"--"}),X.map(r=>e(w,{value:r.id,children:r.name},r.id))]})})]})}),e(ue,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:e(Be,{disabled:!t,sx:{borderRadius:"50px",padding:"6px 16px"},variant:"outlined",color:"primary",type:"submit",loading:i,children:"Submit"})})]})]})},Re=({title:a,roles:I,departments:M,designations:P})=>{const n=q(),N=ge(n.breakpoints.down("md")),[D,F]=y.useState(null),[A,l]=y.useState(re().props.allUsers),E=R=>{F(R)};return p(_,{children:[e(ae,{title:a}),D==="add"&&e(Ne,{allUsers:A,departments:M,designations:P,open:D==="add",setUsers:l,closeModal:()=>{F(null)}}),e(T,{sx:{display:"flex",justifyContent:"center",p:2},children:e(he,{in:!0,children:p(xe,{children:[e(be,{title:"Employees",sx:{padding:"24px"},action:e(T,{display:"flex",gap:2,children:N?e(_,{children:e(H,{isIconOnly:!0,title:"Add Employee",variant:"bordered",color:"success",onClick:()=>E("add"),children:e(z,{})})}):e(_,{children:e(H,{title:"Add Employee",variant:"bordered",color:"success",startContent:e(z,{}),onClick:()=>E("add"),children:"Add Employee"})})})}),e(fe,{children:e(Te,{allUsers:A,roles:I})})]})})})]})};Re.layout=a=>e(ye,{children:a});export{Re as default};
