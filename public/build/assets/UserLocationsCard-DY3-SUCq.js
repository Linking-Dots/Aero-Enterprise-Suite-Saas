import{a as f,j as E}from"./app-CBXU4Fj7.js";import{r as s,R as b,e as z,g as M,T as P,a as U,B as y}from"./vendor-CHZiis0L.js";import{l as v,L as g}from"./leaflet-routing-machine-DBaJE9ou.js";import{G as j}from"./App-Cq_fR9D2.js";function O(e,n){const t=s.useRef(n);s.useEffect(function(){n!==t.current&&e.attributionControl!=null&&(t.current!=null&&e.attributionControl.removeAttribution(t.current),n!=null&&e.attributionControl.addAttribution(n)),t.current=n},[e,n])}const I=1;function q(e){return Object.freeze({__version:I,map:e})}const w=s.createContext(null),A=w.Provider;function R(){const e=s.useContext(w);if(e==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function H(e){function n(t,l){const{instance:o}=e(t).current;return s.useImperativeHandle(l,()=>o),null}return s.forwardRef(n)}function N(e,n){const t=s.useRef();s.useEffect(function(){return n!=null&&e.instance.on(n),t.current=n,function(){t.current!=null&&e.instance.off(t.current),t.current=null}},[e,n])}function x(e,n){const t=e.pane??n.pane;return t?{...e,pane:t}:e}function $(e,n,t){return Object.freeze({instance:e,context:n,container:t})}function B(e,n){return n==null?function(l,o){const i=s.useRef();return i.current||(i.current=e(l,o)),i}:function(l,o){const i=s.useRef();i.current||(i.current=e(l,o));const m=s.useRef(l),{instance:r}=i.current;return s.useEffect(function(){m.current!==l&&(n(r,l,m.current),m.current=l)},[r,l,o]),i}}function G(e,n){s.useEffect(function(){return(n.layerContainer??n.map).addLayer(e.instance),function(){var i;(i=n.layerContainer)==null||i.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}function Z(e){return function(t){const l=R(),o=e(x(t,l),l);return O(l.map,t.attribution),N(o.current,t.eventHandlers),G(o.current,l),o}}function V(e,n){const t=B(e,n),l=Z(t);return H(l)}function W(e,n,t){const{opacity:l,zIndex:o}=n;l!=null&&l!==t.opacity&&e.setOpacity(l),o!=null&&o!==t.zIndex&&e.setZIndex(o)}function S(){return R().map}function F(){return F=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},F.apply(this,arguments)}function K({bounds:e,boundsOptions:n,center:t,children:l,className:o,id:i,placeholder:m,style:r,whenReady:c,zoom:a,...h},d){const[p]=s.useState({className:o,id:i,style:r}),[u,k]=s.useState(null);s.useImperativeHandle(d,()=>(u==null?void 0:u.map)??null,[u]);const T=s.useCallback(_=>{if(_!==null&&u===null){const C=new v.Map(_,h);t!=null&&a!=null?C.setView(t,a):e!=null&&C.fitBounds(e,n),c!=null&&C.whenReady(c),k(q(C))}},[]);s.useEffect(()=>()=>{u==null||u.map.remove()},[u]);const D=u?b.createElement(A,{value:u},l):m??null;return b.createElement("div",F({},p,{ref:T}),D)}const X=s.forwardRef(K),Y=V(function({url:n,...t},l){const o=new v.TileLayer(n,x(t,l));return $(o,l)},function(n,t,l){W(n,t,l);const{url:o}=t;o!=null&&o!==l.url&&n.setUrl(o)});L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(e){var n=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",n),this.link.href="#",this._map=e,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),n},_click:function(e){L.DomEvent.stopPropagation(e),L.DomEvent.preventDefault(e),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(e){var n=this.getContainer();this.isFullscreen()?e&&e.pseudoFullscreen?this._disablePseudoFullscreen(n):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(n):e&&e.pseudoFullscreen?this._enablePseudoFullscreen(n):n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen?n.msRequestFullscreen():this._enablePseudoFullscreen(n)},_enablePseudoFullscreen:function(e){L.DomUtil.addClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(e){L.DomUtil.removeClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(e){this._isFullscreen=e;var n=this.getContainer();e?L.DomUtil.addClass(n,"leaflet-fullscreen-on"):L.DomUtil.removeClass(n,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(e){var n=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;n===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):n!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var e;if("onfullscreenchange"in document?e="fullscreenchange":"onmozfullscreenchange"in document?e="mozfullscreenchange":"onwebkitfullscreenchange"in document?e="webkitfullscreenchange":"onmsfullscreenchange"in document&&(e="MSFullscreenChange"),e){var n=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,e,n)}),this.on("unload",function(){L.DomEvent.off(document,e,n)})}});L.control.fullscreen=function(e){return new L.Control.Fullscreen(e)};const J=({startLocation:e,endLocation:n})=>{const t=S();return s.useEffect(()=>{t&&g.Routing.control({waypoints:[g.latLng(e),g.latLng(n)],routeWhileDragging:!0}).addTo(t)},[t,e,n]),null},Q=({selectedDate:e})=>{const[n,t]=s.useState(null),l=async()=>{const r=route("getUserLocationsForDate",{date:e});try{const a=await(await fetch(r)).json();t(a.locations)}catch(c){console.error("Error fetching user locations:",c)}};s.useEffect(()=>{l()},[e]);const o=S(),i=(r,c)=>{const a=1e-4*c;return{lat:r.lat+a,lng:r.lng+a}},m=(r,c)=>Math.abs(r.lat-c.lat)<1e-4&&Math.abs(r.lng-c.lng)<1e-4;return s.useEffect(()=>{o&&n&&n.map((r,c)=>{const a=g.icon({iconUrl:`${r.profile_image}`,iconSize:[30,30],className:"user-icon"}),h=r.punchout_location?{lat:parseFloat(r.punchout_location.split(",")[0]),lng:parseFloat(r.punchout_location.split(",")[1])}:r.punchin_location?{lat:parseFloat(r.punchin_location.split(",")[0]),lng:parseFloat(r.punchin_location.split(",")[1])}:null;if(h){let d=h;n.forEach((p,u)=>{u<c&&p.punchout_location&&m(d,{lat:parseFloat(p.punchout_location.split(",")[0]),lng:parseFloat(p.punchout_location.split(",")[1])})&&(d=i(h,c))}),g.marker(d,{icon:a}).addTo(o).bindPopup(`Name: ${r.name}<br>Designation: ${r.designation}<br>Clockin Time: ${r.punchin_time?new Date(`2024-06-04T${r.punchin_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Not punched in yet"}<br>Clockout Time: ${r.punchout_time?new Date(`2024-06-04T${r.punchout_time}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Not punched out yet"}`)}return null})},[o,n]),null},oe=({updateMap:e,selectedDate:n})=>{const t={lat:23.879132,lng:90.502617},l={lat:23.987057,lng:90.361908},o={lat:23.690618,lng:90.546729};return f(y,{sx:{display:"flex",justifyContent:"center",p:2},children:f(z,{in:!0,children:E(j,{children:[f(M,{title:f(P,{sx:{fontSize:{xs:"1.0rem",sm:"1.4rem",md:"1.8rem"}},children:"Users Locations for "+new Date(n).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})})}),f(U,{children:f(y,{sx:{height:"70vh",borderRadius:"20px"},children:E(X,{center:t,zoom:12,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!1,fullscreenControl:!0,attributionControl:!1,children:[f(Y,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:19}),f(J,{startLocation:l,endLocation:o}),f(Q,{selectedDate:n})]},e)})})]})})})};export{oe as default};
