import{J as he,r as s,a as X,b as i,j as a,Q as fe,f as ve,h as Z,c as P,e as L,F as be,d as ye}from"./app-MpRbYhkS.js";import{d as K}from"./dayjs.min-CJrLyVxQ.js";import{u as we,a as U,r as $,B as _e,e as Ne,j as k,T as m,b as ee,G as Ce,A as xe}from"./App-ChX5VV_r.js";import{P as Se}from"./PageHeader-CC10cuU_.js";import{L as ae,D as Me,a as Pe}from"./DeleteLeaveForm-CTnk0PeE.js";import{C as Le}from"./CircularProgress-BVgMTZG7.js";import{F as ke}from"./XCircleIcon-BxHv9lSD.js";import{F as Fe}from"./PlusIcon-BZvK_9oq.js";import{F as Ye}from"./PresentationChartLineIcon-CR-pINQl.js";import{s as De,l as Te}from"./chunk-2GIFKCNQ-Bnl4m-aj.js";import{c as Re}from"./chunk-D5XJWRAV-Dkfk7po4.js";import"./app-CYPnucT-.js";import"./PencilIcon-Cak8D3Xc.js";import"./TrashIcon-CM3pcnfe.js";import"./EllipsisVerticalIcon-DNOdx7A-.js";import"./CardContent-BIxvR8Ce.js";import"./colorManipulator-2l_LBLs5.js";import"./chunk-F3UDT23P-DKqst6lu.js";import"./chunk-MZRCPRP2-B90AE6mW.js";import"./LiveAnnouncer-C2FyYgAC.js";import"./useHasTabbableChild-CnYlH9ZU.js";import"./chunk-7F3ZLNJ6-CF7c3QhX.js";import"./chunk-7ZZXWEXF-7AMtdiwt.js";import"./chunk-R6AK6OQ4-Cxa4-o0g.js";import"./chunk-O5I3QTYU-BaX5EXwf.js";import"./index-CokAva9Y.js";import"./Clear-CsKEgwOF.js";import"./GlassDialog-CrLmwJCc.js";import"./DialogContent-Bq3dEBgs.js";import"./DialogTitle-B87vulL7.js";import"./InputLabel-CPjNQET0.js";import"./Select-yj1GpTXy.js";import"./Popover-DRLuHBe9.js";import"./List-zZ64sibn.js";import"./MenuItem-PLPDg3_f.js";import"./listItemTextClasses-LbtaCQDN.js";import"./dividerClasses-DyD1oX6F.js";import"./TextField-UdoyefGR.js";import"./Avatar-M_iWVyCW.js";import"./useSlot-D_8OGX0s.js";import"./LoadingButton-CCeyjCVT.js";import"./Button-CiQQsF2p.js";import"./DialogContentText-83kRKKwi.js";import"./chunk-2PG5BJX6-3Oho7bh0.js";const Ae=({title:A,allUsers:h})=>{const{auth:w}=he().props,z=we(),_=U(z.breakpoints.down("sm")),te=U(z.breakpoints.down("md")),[y,F]=s.useState(0),[B,Y]=s.useState(0),[O,Be]=s.useState(!1),[N,p]=s.useState([]),[C,S]=s.useState({leaveTypes:[],leaveCountsByUser:{}}),[G,b]=s.useState(!1),[Q,E]=s.useState(""),[l,j]=s.useState({page:1,perPage:30,total:0,lastPage:0}),[n,re]=s.useState({employee:"",selectedMonth:K().format("YYYY-MM"),year:new Date().getFullYear()}),d=s.useCallback(e=>{e&&(F(e.total||0),Y(e.last_page||1),j(r=>({...r,total:e.total||0,lastPage:e.last_page||1})))},[]),f=s.useCallback(async()=>{var e,r,t;b(!0);try{const{page:o,perPage:c}=l,{year:v}=n,W=await X.get(route("leaves.paginate"),{params:{page:o,perPage:c,year:v,user_id:w.user.id},timeout:1e4});if(W.status===200){const{leaves:g,leavesData:ge}=W.data;g.data&&Array.isArray(g.data)?(p(g.data),d({total:g.total||g.data.length,last_page:g.last_page||1,current_page:g.current_page||1,per_page:g.per_page||l.perPage})):Array.isArray(g)?(p(g),d({total:g.length,last_page:1,current_page:1,per_page:l.perPage})):(console.error("Unexpected leaves data format:",g),p([]),d({total:0,last_page:1,current_page:1,per_page:l.perPage})),S(ge),E("")}}catch(o){if(console.error("Error fetching leaves:",o),((e=o.response)==null?void 0:e.status)===404){const{leavesData:c}=o.response.data;S(c),E(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.message)||"No leaves found for the selected criteria.")}else E("Error retrieving leaves data. Please try again."),$.error("Failed to load leave data. Please try again.");p([]),d({total:0,last_page:1,current_page:1,per_page:l.perPage})}finally{b(!1)}},[l.page,l.perPage,n,w.user.id,d]),q=s.useCallback((e,r,t)=>{const{page:o,perPage:c}=l;e.length>=c||o<B||f()},[l,B,f]),se=s.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(r,t)=>{const o=1900+t;return{key:o.toString(),label:o.toString(),value:o}}).reverse()},[]),H=s.useCallback((e,r)=>{if(e==="year"){const t=Number(r);if(t<1900||t>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}re(t=>({...t,[e]:r})),e==="year"&&j(t=>({...t,page:1}))},[]),[x,D]=s.useState({add_leave:!1,edit_leave:!1,delete_leave:!1});s.useCallback((e,r=null)=>{D(t=>({...t,[e]:!0}))},[]);const I=s.useCallback(()=>{D({add_leave:!1,edit_leave:!1,delete_leave:!1})},[]),J=s.useCallback(e=>{D(r=>({...r,[e]:!0}))},[]),oe=s.useCallback((e,r)=>{V({id:e}),D(t=>({...t,[r]:!0}))},[]),[T,V]=s.useState(null),le=s.useCallback(e=>{V(e)},[]),u=s.useCallback(async()=>{try{const e=await X.get(route("leaves.stats"),{params:{year:n.year}});if(e.status===200){const{stats:r,leaveCounts:t}=e.data;t&&S(o=>({...o,leaveCountsByUser:{...o.leaveCountsByUser,[w.user.id]:t}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[n.year,w.user.id]),ne=s.useCallback(e=>{e!==l.page&&j(r=>({...r,page:e}))},[l.page]);s.useEffect(()=>{f()},[f]),s.useEffect(()=>{u()},[u]);const ie=s.useMemo(()=>C.leaveCountsByUser[w.user.id]||[],[C.leaveCountsByUser,w.user.id]),R=s.useCallback(e=>[...e].sort((r,t)=>new Date(r.from_date)-new Date(t.from_date)),[]),M=s.useCallback(e=>{const r=new Date(e.from_date).getFullYear();if(n.year&&r!==n.year)return!1;if(n.employee){const t=h==null?void 0:h.find(c=>String(c.id)===String(e.user_id)),o=n.employee.trim().toLowerCase();if(t){if(String(t.id)!==o&&!(t.name&&t.name.trim().toLowerCase().includes(o)))return!1}else if(String(n.employee)!==String(e.user_id))return!1}if(n.selectedMonth&&K(e.from_date).format("YYYY-MM")!==n.selectedMonth||n.status&&n.status!=="all"&&String(e.status).toLowerCase()!==String(n.status).toLowerCase()||n.leaveType&&n.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(n.leaveType).toLowerCase())return!1;if(n.department&&n.department!=="all"){const t=h==null?void 0:h.find(o=>String(o.id)===String(e.user_id));if(!t||String(t.department).toLowerCase()!==String(n.department).toLowerCase())return!1}return!0},[n,h]);s.useMemo(()=>N||[],[N]);const ce=s.useCallback(e=>{M(e)&&(b(!0),p(r=>{const t=[...r,e];return R(t).slice(0,l.perPage)}),d({total:y+1,last_page:Math.ceil((y+1)/l.perPage),current_page:l.page,per_page:l.perPage}),b(!1),l.page!==1&&f(),u())},[M,R,l,y,d,f,u]),de=s.useCallback(e=>{const r=N.some(t=>t.id===e.id);if(b(!0),!M(e)&&r){p(t=>t.filter(o=>o.id!==e.id)),$.info("Leave removed from filtered view."),b(!1);return}if(!r&&!M(e)){b(!1);return}p(t=>{const o=t.some(v=>v.id===e.id);let c;return o?c=t.map(v=>v.id===e.id?e:v):c=[...t,e],R(c).slice(0,l.perPage)}),$.success("Leave updated!"),b(!1),l.page!==1&&f(),u()},[M,R,N,l,f,u]),me=s.useCallback(e=>{p(t=>{const o=t.filter(v=>v.id!==e),c=Math.max(0,y-1);return q(o,c,"delete"),o});const r=Math.max(0,y-1);d({total:r,last_page:Math.max(1,Math.ceil(r/l.perPage)),current_page:l.page,per_page:l.perPage}),u()},[u,y,l,d,q]),pe=()=>C.leaveTypes.length?a("div",{className:`grid gap-4 ${_?"grid-cols-1":te?"grid-cols-2":"grid-cols-4"}`,children:C.leaveTypes.map(({type:e})=>{const r=ie.find(v=>v.leave_type===e)||{},t=r.days_used||0,o=r.remaining_days||0,c=t+o;return i(P,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[a(Re,{className:"pb-2",children:i("div",{className:"flex items-center gap-2",children:[a(k,{className:"w-5 h-5"}),a(m,{variant:_?"subtitle1":"h6",className:"font-semibold truncate",children:e})]})}),a(L,{className:"pt-0",children:i("div",{className:"space-y-3",children:[i("div",{className:"flex justify-between items-center",children:[i("div",{className:"text-center",children:[a(m,{variant:"caption",color:"textSecondary",children:"Used"}),a(m,{variant:_?"h6":"h5",className:"font-bold text-red-400",children:t})]}),a(ye,{orientation:"vertical",className:"h-8"}),i("div",{className:"text-center",children:[a(m,{variant:"caption",color:"textSecondary",children:"Remaining"}),a(m,{variant:_?"h6":"h5",className:"font-bold text-green-400",children:o})]})]}),c>0&&a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a("div",{className:"bg-gradient-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${t/c*100}%`}})})]})})]},e)})}):a(P,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(L,{className:"text-center py-8",children:[a(ee,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a(m,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),ue=s.useRef(null);return i(be,{children:[a(fe,{title:A}),x.add_leave&&a(ae,{open:x.add_leave,closeModal:()=>I(),leavesData:C,setLeavesData:S,currentLeave:null,allUsers:h,setTotalRows:F,setLastPage:Y,setLeaves:p,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:ce,updatePaginationMetadata:d,fetchLeavesStats:u}),x.edit_leave&&a(ae,{open:x.edit_leave,closeModal:()=>I(),leavesData:C,setLeavesData:S,currentLeave:T,allUsers:h,setTotalRows:F,setLastPage:Y,setLeaves:p,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:de,updatePaginationMetadata:d,fetchLeavesStats:u}),x.delete_leave&&a(Me,{open:x.delete_leave,closeModal:()=>I(),leaveId:T==null?void 0:T.id,setLeaves:p,setTotalRows:F,setLastPage:Y,deleteLeaveOptimized:me,updatePaginationMetadata:d,fetchLeavesStats:u}),i(_e,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",a(Ce,{in:!0,children:a(Ne,{children:a(Se,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:a(Ye,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:a(Fe,{className:"w-4 h-4"}),onPress:()=>J("add_leave"),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Current Year",icon:a(k,{className:"w-4 h-4"}),onPress:()=>H("year",new Date().getFullYear()),className:"bg-gradient-to-r from-[var(--theme-primary)] to-[var(--theme-secondary)] text-white font-medium hover:opacity-90"},{label:"Refresh",icon:a(Z,{className:"w-4 h-4"}),onPress:f,className:"bg-gradient-to-r from-[rgba(var(--theme-success-rgb),0.8)] to-[rgba(var(--theme-success-rgb),1)] text-white font-medium hover:opacity-90"}],children:i("div",{className:"p-6",children:[a("div",{className:"mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a(De,{label:"Select Year",variant:"bordered",selectedKeys:[String(n.year)],onSelectionChange:e=>{const r=Array.from(e)[0];r&&H("year",Number(r))},startContent:a(k,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:_?"sm":"md",children:se.map(e=>a(Te,{value:e.value,children:e.label},e.key))})}),a("div",{className:"flex gap-2",children:a(ve,{variant:"flat",color:"primary",size:_?"sm":"md",onPress:f,isLoading:O,startContent:!O&&!G&&a(Z,{className:"w-4 h-4"}),children:"Refresh"})})]})}),i("div",{className:"mb-6",children:[i(m,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(ee,{className:"w-5 h-5"}),"Leave Balance Summary"]}),pe()]}),i("div",{className:"min-h-96",children:[i(m,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a(k,{className:"w-5 h-5"}),"Leave History"]}),G?a(P,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(L,{className:"text-center py-12",children:[a(Le,{size:40}),a(m,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):Q?a(P,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(L,{className:"text-center py-12",children:[a(ke,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),a(m,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),a(m,{color:"textSecondary",children:Q})]})}):N.length>0?a("div",{className:"overflow-hidden rounded-lg",children:a(Pe,{ref:ue,leaves:N,allUsers:h||[],handleClickOpen:oe,setCurrentLeave:le,openModal:J,setLeaves:p,setCurrentPage:ne,currentPage:l.page,totalRows:y,lastPage:B,perPage:l.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:u,updatePaginationMetadata:d})}):a(P,{className:"bg-white/10 backdrop-blur-md border-white/20",children:i(L,{className:"text-center py-12",children:[a(k,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),a(m,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),i(m,{color:"textSecondary",children:["You haven't submitted any leave requests for ",n.year,"."]}),"                      "]})})]})]})})})})]})]})};Ae.layout=A=>a(xe,{children:A});export{Ae as default};
